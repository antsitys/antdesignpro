(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[2866],{1822:function(Qe,D,g){"use strict";var U=g(67294),b=g(27290),p=g(27199),E=g(30731),Z=g(4874),V=function(I,L){var _e={};for(var xe in I)Object.prototype.hasOwnProperty.call(I,xe)&&L.indexOf(xe)<0&&(_e[xe]=I[xe]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Re=0,xe=Object.getOwnPropertySymbols(I);Re<xe.length;Re++)L.indexOf(xe[Re])<0&&Object.prototype.propertyIsEnumerable.call(I,xe[Re])&&(_e[xe[Re]]=I[xe[Re]]);return _e},H=(0,U.forwardRef)(function(I,L){var _e=I.style,xe=_e===void 0?{height:"inherit"}:_e,Re=I.className,$e=I.loading,Rt=I.loadingTemplate,Lt=I.errorTemplate,zt=V(I,["style","className","loading","loadingTemplate","errorTemplate"]),St=(0,p.Z)(b.aC,zt),Et=St.chart,at=St.container;return(0,U.useImperativeHandle)(L,function(){return{getChart:function(){return Et.current}}}),U.createElement(E.Z,{errorTemplate:Lt},$e&&U.createElement(Z.Z,{loadingTemplate:Rt}),U.createElement("div",{className:Re,style:xe,ref:at}))});D.Z=H},28614:function(Qe,D,g){"use strict";var U=g(67294),b=g(27290),p=g(27199),E=g(30731),Z=g(4874),V=function(I,L){var _e={};for(var xe in I)Object.prototype.hasOwnProperty.call(I,xe)&&L.indexOf(xe)<0&&(_e[xe]=I[xe]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Re=0,xe=Object.getOwnPropertySymbols(I);Re<xe.length;Re++)L.indexOf(xe[Re])<0&&Object.prototype.propertyIsEnumerable.call(I,xe[Re])&&(_e[xe[Re]]=I[xe[Re]]);return _e},H=(0,U.forwardRef)(function(I,L){var _e=I.style,xe=_e===void 0?{height:"inherit"}:_e,Re=I.className,$e=I.loading,Rt=I.loadingTemplate,Lt=I.errorTemplate,zt=V(I,["style","className","loading","loadingTemplate","errorTemplate"]),St=(0,p.Z)(b.Kj,zt),Et=St.chart,at=St.container;return(0,U.useImperativeHandle)(L,function(){return{getChart:function(){return Et.current}}}),U.createElement(E.Z,{errorTemplate:Lt},$e&&U.createElement(Z.Z,{loadingTemplate:Rt}),U.createElement("div",{className:Re,style:xe,ref:at}))});D.Z=H},98093:function(Qe,D,g){"use strict";var U=g(67294),b=g(27290),p=g(27199),E=g(30731),Z=g(4874),V=function(I,L){var _e={};for(var xe in I)Object.prototype.hasOwnProperty.call(I,xe)&&L.indexOf(xe)<0&&(_e[xe]=I[xe]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Re=0,xe=Object.getOwnPropertySymbols(I);Re<xe.length;Re++)L.indexOf(xe[Re])<0&&Object.prototype.propertyIsEnumerable.call(I,xe[Re])&&(_e[xe[Re]]=I[xe[Re]]);return _e},H=(0,U.forwardRef)(function(I,L){var _e=I.style,xe=_e===void 0?{height:"inherit"}:_e,Re=I.className,$e=I.loading,Rt=I.loadingTemplate,Lt=I.errorTemplate,zt=V(I,["style","className","loading","loadingTemplate","errorTemplate"]),St=(0,p.Z)(b.TZ,zt),Et=St.chart,at=St.container;return(0,U.useImperativeHandle)(L,function(){return{getChart:function(){return Et.current}}}),U.createElement(E.Z,{errorTemplate:Lt},$e&&U.createElement(Z.Z,{loadingTemplate:Rt}),U.createElement("div",{className:Re,style:xe,ref:at}))});D.Z=H},57611:function(Qe,D,g){"use strict";var U=g(67294),b=g(27290),p=g(27199),E=g(30731),Z=g(4874),V=function(I,L){var _e={};for(var xe in I)Object.prototype.hasOwnProperty.call(I,xe)&&L.indexOf(xe)<0&&(_e[xe]=I[xe]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Re=0,xe=Object.getOwnPropertySymbols(I);Re<xe.length;Re++)L.indexOf(xe[Re])<0&&Object.prototype.propertyIsEnumerable.call(I,xe[Re])&&(_e[xe[Re]]=I[xe[Re]]);return _e},H=(0,U.forwardRef)(function(I,L){var _e=I.style,xe=_e===void 0?{height:"inherit"}:_e,Re=I.className,$e=I.loading,Rt=I.loadingTemplate,Lt=I.errorTemplate,zt=V(I,["style","className","loading","loadingTemplate","errorTemplate"]),St=(0,p.Z)(b.m,zt),Et=St.chart,at=St.container;return(0,U.useImperativeHandle)(L,function(){return{getChart:function(){return Et.current}}}),U.createElement(E.Z,{errorTemplate:Lt},$e&&U.createElement(Z.Z,{loadingTemplate:Rt}),U.createElement("div",{className:Re,style:xe,ref:at}))});D.Z=H},99525:function(Qe,D,g){"use strict";var U=g(67294),b=g(27290),p=g(27199),E=g(30731),Z=g(4874),V=function(I,L){var _e={};for(var xe in I)Object.prototype.hasOwnProperty.call(I,xe)&&L.indexOf(xe)<0&&(_e[xe]=I[xe]);if(I!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Re=0,xe=Object.getOwnPropertySymbols(I);Re<xe.length;Re++)L.indexOf(xe[Re])<0&&Object.prototype.propertyIsEnumerable.call(I,xe[Re])&&(_e[xe[Re]]=I[xe[Re]]);return _e},H=(0,U.forwardRef)(function(I,L){var _e=I.style,xe=_e===void 0?{height:"inherit"}:_e,Re=I.className,$e=I.loading,Rt=I.loadingTemplate,Lt=I.errorTemplate,zt=V(I,["style","className","loading","loadingTemplate","errorTemplate"]),St=(0,p.Z)(b.kB,zt),Et=St.chart,at=St.container;return(0,U.useImperativeHandle)(L,function(){return{getChart:function(){return Et.current}}}),U.createElement(E.Z,{errorTemplate:Lt},$e&&U.createElement(Z.Z,{loadingTemplate:Rt}),U.createElement("div",{className:Re,style:xe,ref:at}))});D.Z=H},64335:function(Qe,D,g){"use strict";var U=g(67294),b=(0,U.createContext)({});D.Z=b},21349:function(Qe,D,g){"use strict";var U=g(84305),b=g(69224),p=g(53645),E=g.n(p),Z=g(67294),V=g(94184),H=g.n(V),I=g(64335),L=function(xe){var Re=(0,Z.useContext)(I.Z),$e=xe.children,Rt=xe.contentWidth,Lt=xe.className,zt=xe.style,St=(0,Z.useContext)(b.ZP.ConfigContext),Et=St.getPrefixCls,at=xe.prefixCls||Et("pro"),ur=Rt||Re.contentWidth,ee="".concat(at,"-grid-content");return Z.createElement("div",{className:H()(ee,Lt,{wide:ur==="Fixed"}),style:zt},Z.createElement("div",{className:"".concat(at,"-grid-content-children")},$e))};D.Z=L},46343:function(Qe,D,g){"use strict";g.d(D,{zj:function(){return Ut},oI:function(){return Vi},ni:function(){return me},gg:function(){return pn}});var U=g(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function b(ar,pe,Pe,Ge){function ke(Ft){return Ft instanceof Pe?Ft:new Pe(function(ir){ir(Ft)})}return new(Pe||(Pe=Promise))(function(Ft,ir){function T(Be){try{Se(Ge.next(Be))}catch(et){ir(et)}}function G(Be){try{Se(Ge.throw(Be))}catch(et){ir(et)}}function Se(Be){Be.done?Ft(Be.value):ke(Be.value).then(T,G)}Se((Ge=Ge.apply(ar,pe||[])).next())})}function p(ar,pe){var Pe={label:0,sent:function(){if(Ft[0]&1)throw Ft[1];return Ft[1]},trys:[],ops:[]},Ge,ke,Ft,ir;return ir={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(ir[Symbol.iterator]=function(){return this}),ir;function T(Se){return function(Be){return G([Se,Be])}}function G(Se){if(Ge)throw new TypeError("Generator is already executing.");for(;Pe;)try{if(Ge=1,ke&&(Ft=Se[0]&2?ke.return:Se[0]?ke.throw||((Ft=ke.return)&&Ft.call(ke),0):ke.next)&&!(Ft=Ft.call(ke,Se[1])).done)return Ft;switch(ke=0,Ft&&(Se=[Se[0]&2,Ft.value]),Se[0]){case 0:case 1:Ft=Se;break;case 4:return Pe.label++,{value:Se[1],done:!1};case 5:Pe.label++,ke=Se[1],Se=[0];continue;case 7:Se=Pe.ops.pop(),Pe.trys.pop();continue;default:if(Ft=Pe.trys,!(Ft=Ft.length>0&&Ft[Ft.length-1])&&(Se[0]===6||Se[0]===2)){Pe=0;continue}if(Se[0]===3&&(!Ft||Se[1]>Ft[0]&&Se[1]<Ft[3])){Pe.label=Se[1];break}if(Se[0]===6&&Pe.label<Ft[1]){Pe.label=Ft[1],Ft=Se;break}if(Ft&&Pe.label<Ft[2]){Pe.label=Ft[2],Pe.ops.push(Se);break}Ft[2]&&Pe.ops.pop(),Pe.trys.pop();continue}Se=pe.call(ar,Pe)}catch(Be){Se=[6,Be],ke=0}finally{Ge=Ft=0}if(Se[0]&5)throw Se[1];return{value:Se[0]?Se[1]:void 0,done:!0}}}function E(ar,pe){var Pe=typeof Symbol=="function"&&ar[Symbol.iterator];if(!Pe)return ar;var Ge=Pe.call(ar),ke,Ft=[],ir;try{for(;(pe===void 0||pe-- >0)&&!(ke=Ge.next()).done;)Ft.push(ke.value)}catch(T){ir={error:T}}finally{try{ke&&!ke.done&&(Pe=Ge.return)&&Pe.call(Ge)}finally{if(ir)throw ir.error}}return Ft}function Z(){for(var ar=[],pe=0;pe<arguments.length;pe++)ar=ar.concat(E(arguments[pe]));return ar}function V(ar){return ar&&ar.__esModule&&Object.prototype.hasOwnProperty.call(ar,"default")?ar.default:ar}function H(ar,pe){return pe={exports:{}},ar(pe,pe.exports),pe.exports}var I=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Pe;function Pe(Ge){return Ge&&typeof Ge.length=="number"&&Ge.length>=0&&Ge.length%1==0}ar.exports=pe.default});V(I);var L=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=function(Pe){return function(){for(var Ge=[],ke=arguments.length;ke--;)Ge[ke]=arguments[ke];var Ft=Ge.pop();return Pe.call(this,Ge,Ft)}},ar.exports=pe.default});V(L);var _e=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.fallback=ke,pe.wrap=Ft;var Pe=pe.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Ge=pe.hasNextTick=typeof U=="object"&&typeof U.nextTick=="function";function ke(T){setTimeout(T,0)}function Ft(T){return function(G){for(var Se=[],Be=arguments.length-1;Be-- >0;)Se[Be]=arguments[Be+1];return T(function(){return G.apply(void 0,Se)})}}var ir;Pe?ir=setImmediate:Ge?ir=U.nextTick:ir=ke,pe.default=Ft(ir)});V(_e);var xe=_e.fallback,Re=_e.wrap,$e=_e.hasSetImmediate,Rt=_e.hasNextTick,Lt=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Ft;var Pe=ke(L),Ge=ke(_e);function ke(G){return G&&G.__esModule?G:{default:G}}function Ft(G){return(0,zt.isAsync)(G)?function(){for(var Se=[],Be=arguments.length;Be--;)Se[Be]=arguments[Be];var et=Se.pop(),tt=G.apply(this,Se);return ir(tt,et)}:(0,Pe.default)(function(Se,Be){var et;try{et=G.apply(this,Se)}catch(tt){return Be(tt)}if(et&&typeof et.then=="function")return ir(et,Be);Be(null,et)})}function ir(G,Se){return G.then(function(Be){T(Se,null,Be)},function(Be){T(Se,Be&&Be.message?Be:new Error(Be))})}function T(G,Se,Be){try{G(Se,Be)}catch(et){(0,Ge.default)(function(tt){throw tt},et)}}ar.exports=pe.default});V(Lt);var zt=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.isAsyncIterable=pe.isAsyncGenerator=pe.isAsync=void 0;var Pe=Ge(Lt);function Ge(G){return G&&G.__esModule?G:{default:G}}function ke(G){return G[Symbol.toStringTag]==="AsyncFunction"}function Ft(G){return G[Symbol.toStringTag]==="AsyncGenerator"}function ir(G){return typeof G[Symbol.asyncIterator]=="function"}function T(G){if(typeof G!="function")throw new Error("expected a function");return ke(G)?(0,Pe.default)(G):G}pe.default=T,pe.isAsync=ke,pe.isAsyncGenerator=Ft,pe.isAsyncIterable=ir});V(zt);var St=zt.isAsyncIterable,Et=zt.isAsyncGenerator,at=zt.isAsync,ur=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Pe;function Pe(Ge,ke){if(ke===void 0&&(ke=Ge.length),!ke)throw new Error("arity is undefined");function Ft(){for(var ir=this,T=[],G=arguments.length;G--;)T[G]=arguments[G];return typeof T[ke-1]=="function"?Ge.apply(this,T):new Promise(function(Se,Be){T[ke-1]=function(et){for(var tt=[],Ct=arguments.length-1;Ct-- >0;)tt[Ct]=arguments[Ct+1];if(et)return Be(et);Se(tt.length>1?tt:tt[0])},Ge.apply(ir,T)})}return Object.defineProperty(Ft,"name",{configurable:!0,value:"awaitable("+Ge.name+")"}),Ft}ar.exports=pe.default});V(ur);var ee=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe=Ft(I),Ge=Ft(zt),ke=Ft(ur);function Ft(ir){return ir&&ir.__esModule?ir:{default:ir}}pe.default=(0,ke.default)(function(ir,T,G){var Se=(0,Pe.default)(T)?[]:{};ir(T,function(Be,et,tt){(0,Ge.default)(Be)(function(Ct){for(var jt,Mt=[],Qt=arguments.length-1;Qt-- >0;)Mt[Qt]=arguments[Qt+1];Mt.length<2&&(jt=Mt,Mt=jt[0]),Se[et]=Mt,tt(Ct)})},function(Be){return G(Be,Se)})},3),ar.exports=pe.default});V(ee);var fr=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Pe;function Pe(Ge){function ke(){for(var Ft=[],ir=arguments.length;ir--;)Ft[ir]=arguments[ir];if(Ge!==null){var T=Ge;Ge=null,T.apply(this,Ft)}}return Object.assign(ke,Ge),ke}ar.exports=pe.default});V(fr);var At=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=function(Pe){return Pe[Symbol.iterator]&&Pe[Symbol.iterator]()},ar.exports=pe.default});V(At);var Je=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=G;var Pe=ke(I),Ge=ke(At);function ke(Se){return Se&&Se.__esModule?Se:{default:Se}}function Ft(Se){var Be=-1,et=Se.length;return function(){return++Be<et?{value:Se[Be],key:Be}:null}}function ir(Se){var Be=-1;return function(){var tt=Se.next();return tt.done?null:(Be++,{value:tt.value,key:Be})}}function T(Se){var Be=Se?Object.keys(Se):[],et=-1,tt=Be.length;return function(){var jt=Be[++et];return et<tt?{value:Se[jt],key:jt}:null}}function G(Se){if((0,Pe.default)(Se))return Ft(Se);var Be=(0,Ge.default)(Se);return Be?ir(Be):T(Se)}ar.exports=pe.default});V(Je);var Pt=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Pe;function Pe(Ge){return function(){for(var ke=[],Ft=arguments.length;Ft--;)ke[Ft]=arguments[Ft];if(Ge===null)throw new Error("Callback was already called.");var ir=Ge;Ge=null,ir.apply(this,ke)}}ar.exports=pe.default});V(Pt);var Ve=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe={};pe.default=Pe,ar.exports=pe.default});V(Ve);var It=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=ke;var Pe=Ge(Ve);function Ge(Ft){return Ft&&Ft.__esModule?Ft:{default:Ft}}function ke(Ft,ir,T,G){var Se=!1,Be=!1,et=!1,tt=0,Ct=0;function jt(){tt>=ir||et||Se||(et=!0,Ft.next().then(function(ne){var Kt=ne.value,Dr=ne.done;if(!(Be||Se)){if(et=!1,Dr){Se=!0,tt<=0&&G(null);return}tt++,T(Kt,Ct,Mt),Ct++,jt()}}).catch(Qt))}function Mt(ne,Kt){if(tt-=1,!Be){if(ne)return Qt(ne);if(ne===!1){Se=!0,Be=!0;return}if(Kt===Pe.default||Se&&tt<=0)return Se=!0,G(null);jt()}}function Qt(ne){Be||(et=!1,Se=!0,G(ne))}jt()}ar.exports=pe.default});V(It);var hr=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe=T(fr),Ge=T(Je),ke=T(Pt),Ft=T(It),ir=T(Ve);function T(G){return G&&G.__esModule?G:{default:G}}pe.default=function(G){return function(Se,Be,et){if(et=(0,Pe.default)(et),G<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!Se)return et(null);if((0,zt.isAsyncGenerator)(Se))return(0,Ft.default)(Se,G,Be,et);if((0,zt.isAsyncIterable)(Se))return(0,Ft.default)(Se[Symbol.asyncIterator](),G,Be,et);var tt=(0,Ge.default)(Se),Ct=!1,jt=!1,Mt=0,Qt=!1;function ne(Dr,Mr){if(!jt)if(Mt-=1,Dr)Ct=!0,et(Dr);else if(Dr===!1)Ct=!0,jt=!0;else{if(Mr===ir.default||Ct&&Mt<=0)return Ct=!0,et(null);Qt||Kt()}}function Kt(){for(Qt=!0;Mt<G&&!Ct;){var Dr=tt();if(Dr===null){Ct=!0,Mt<=0&&et(null);return}Mt+=1,Be(Dr.value,Dr.key,(0,ke.default)(ne))}Qt=!1}Kt()}},ar.exports=pe.default});V(hr);var Jt=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe=Ft(hr),Ge=Ft(zt),ke=Ft(ur);function Ft(T){return T&&T.__esModule?T:{default:T}}function ir(T,G,Se,Be){return(0,Pe.default)(G)(T,(0,Ge.default)(Se),Be)}pe.default=(0,ke.default)(ir,4),ar.exports=pe.default});V(Jt);var Fr=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe=ke(Jt),Ge=ke(ur);function ke(ir){return ir&&ir.__esModule?ir:{default:ir}}function Ft(ir,T,G){return(0,Pe.default)(ir,1,T,G)}pe.default=(0,Ge.default)(Ft,3),ar.exports=pe.default});V(Fr);var fe=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Ft;var Pe=ke(ee),Ge=ke(Fr);function ke(ir){return ir&&ir.__esModule?ir:{default:ir}}function Ft(ir,T){return(0,Pe.default)(Ge.default,ir,T)}ar.exports=pe.default}),Fe=V(fe),me=function(){function ar(){for(var pe=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=pe[Ge];this.args=[],this.tasks=[]}return ar.prototype.call=function(){for(var pe=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=pe[Ge];return this.args=Pe,Fe(this.tasks)},ar.prototype.tap=function(pe,Pe){var Ge=this;this.tasks.push(function(ke){Pe.apply(void 0,Z(Ge.args)),ke(null,pe)})},ar}(),bt=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe=Se(I),Ge=Se(Ve),ke=Se(Jt),Ft=Se(fr),ir=Se(Pt),T=Se(zt),G=Se(ur);function Se(Ct){return Ct&&Ct.__esModule?Ct:{default:Ct}}function Be(Ct,jt,Mt){Mt=(0,Ft.default)(Mt);var Qt=0,ne=0,Kt=Ct.length,Dr=!1;Kt===0&&Mt(null);function Mr(nt,xt){nt===!1&&(Dr=!0),Dr!==!0&&(nt?Mt(nt):(++ne===Kt||xt===Ge.default)&&Mt(null))}for(;Qt<Kt;Qt++)jt(Ct[Qt],Qt,(0,ir.default)(Mr))}function et(Ct,jt,Mt){return(0,ke.default)(Ct,Infinity,jt,Mt)}function tt(Ct,jt,Mt){var Qt=(0,Pe.default)(Ct)?Be:et;return Qt(Ct,(0,T.default)(jt),Mt)}pe.default=(0,G.default)(tt,3),ar.exports=pe.default});V(bt);var vt=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0}),pe.default=Ft;var Pe=ke(bt),Ge=ke(ee);function ke(ir){return ir&&ir.__esModule?ir:{default:ir}}function Ft(ir,T){return(0,Ge.default)(Pe.default,ir,T)}ar.exports=pe.default}),Zt=V(vt),Ut=function(){function ar(){for(var pe=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=pe[Ge];this.tasks=[]}return ar.prototype.promise=function(){for(var pe=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=pe[Ge];return Zt(this.tasks)},ar.prototype.tapPromise=function(pe,Pe){var Ge=this;this.tasks.push(function(ke){return b(Ge,void 0,void 0,function(){return p(this,function(Ft){switch(Ft.label){case 0:return[4,Pe()];case 1:return Ft.sent(),ke(null,pe),[2]}})})})},ar}(),Rr=H(function(ar,pe){Object.defineProperty(pe,"__esModule",{value:!0});var Pe=ir(fr),Ge=ir(Pt),ke=ir(zt),Ft=ir(ur);function ir(G){return G&&G.__esModule?G:{default:G}}function T(G,Se){if(Se=(0,Pe.default)(Se),!Array.isArray(G))return Se(new Error("First argument to waterfall must be an array of functions"));if(!G.length)return Se();var Be=0;function et(Ct){var jt=(0,ke.default)(G[Be++]);jt.apply(void 0,Ct.concat([(0,Ge.default)(tt)]))}function tt(Ct){for(var jt=[],Mt=arguments.length-1;Mt-- >0;)jt[Mt]=arguments[Mt+1];if(Ct!==!1){if(Ct||Be===G.length)return Se.apply(void 0,[Ct].concat(jt));et(jt)}}et([])}pe.default=(0,Ft.default)(T),ar.exports=pe.default}),ln=V(Rr),pn=function(){function ar(){for(var pe=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=pe[Ge];this.tasks=[]}return ar.prototype.call=function(){for(var pe=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=pe[Ge];return ln(this.tasks)},ar.prototype.tap=function(pe,Pe){this.tasks.length===0?this.tasks.push(function(Ge){var ke=Pe();Ge(ke?null:!1,ke)}):this.tasks.push(function(Ge,ke){var Ft=Pe();ke(Ft?null:!1,pe)})},ar}(),Vi=function(){function ar(){for(var pe=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=pe[Ge];this.tasks=[]}return ar.prototype.call=function(){for(var pe=arguments,Pe=[],Ge=0;Ge<arguments.length;Ge++)Pe[Ge]=pe[Ge];return Fe(this.tasks)},ar.prototype.tap=function(pe,Pe){this.tasks.push(function(Ge){var ke=Pe();Ge(ke,pe)})},ar}()},58881:function(Qe,D,g){"use strict";g.d(D,{nC:function(){return U.ZP},Hp:function(){return U.Hp},e7:function(){return U.e7},yT:function(){return U.yT},vK:function(){return p.v},BlendType:function(){return Z.h},AttributeType:function(){return V.GC},ScaleTypes:function(){return V.vY},StyleScaleType:function(){return V.ee},MapServiceEvent:function(){return L.I},CoordinateSystem:function(){return _e.l},CoordinateUniform:function(){return _e.k},CameraUniform:function(){return $e.l},SceneEventList:function(){return zt.P},PositionType:function(){return At.d},gl:function(){return ir.gl}});var U=g(12250),b=g(69530),p=g(72302),E=g(76915),Z=g(77252),V=g(31251),H=g(8628),I=g.n(H);g.o(H,"CameraUniform")&&g.d(D,{CameraUniform:function(){return H.CameraUniform}}),g.o(H,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return H.CityBuildingLayer}}),g.o(H,"CoordinateSystem")&&g.d(D,{CoordinateSystem:function(){return H.CoordinateSystem}}),g.o(H,"CoordinateUniform")&&g.d(D,{CoordinateUniform:function(){return H.CoordinateUniform}}),g.o(H,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return H.HeatmapLayer}}),g.o(H,"ImageLayer")&&g.d(D,{ImageLayer:function(){return H.ImageLayer}}),g.o(H,"LineLayer")&&g.d(D,{LineLayer:function(){return H.LineLayer}}),g.o(H,"MapServiceEvent")&&g.d(D,{MapServiceEvent:function(){return H.MapServiceEvent}}),g.o(H,"Marker")&&g.d(D,{Marker:function(){return H.Marker}}),g.o(H,"PointLayer")&&g.d(D,{PointLayer:function(){return H.PointLayer}}),g.o(H,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return H.PolygonLayer}}),g.o(H,"Popup")&&g.d(D,{Popup:function(){return H.Popup}}),g.o(H,"PositionType")&&g.d(D,{PositionType:function(){return H.PositionType}}),g.o(H,"RasterLayer")&&g.d(D,{RasterLayer:function(){return H.RasterLayer}}),g.o(H,"Scene")&&g.d(D,{Scene:function(){return H.Scene}}),g.o(H,"SceneEventList")&&g.d(D,{SceneEventList:function(){return H.SceneEventList}}),g.o(H,"gl")&&g.d(D,{gl:function(){return H.gl}});var L=g(16606),_e=g(47282),xe=g(41906),Re=g.n(xe);g.o(xe,"CameraUniform")&&g.d(D,{CameraUniform:function(){return xe.CameraUniform}}),g.o(xe,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return xe.CityBuildingLayer}}),g.o(xe,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return xe.HeatmapLayer}}),g.o(xe,"ImageLayer")&&g.d(D,{ImageLayer:function(){return xe.ImageLayer}}),g.o(xe,"LineLayer")&&g.d(D,{LineLayer:function(){return xe.LineLayer}}),g.o(xe,"Marker")&&g.d(D,{Marker:function(){return xe.Marker}}),g.o(xe,"PointLayer")&&g.d(D,{PointLayer:function(){return xe.PointLayer}}),g.o(xe,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return xe.PolygonLayer}}),g.o(xe,"Popup")&&g.d(D,{Popup:function(){return xe.Popup}}),g.o(xe,"PositionType")&&g.d(D,{PositionType:function(){return xe.PositionType}}),g.o(xe,"RasterLayer")&&g.d(D,{RasterLayer:function(){return xe.RasterLayer}}),g.o(xe,"Scene")&&g.d(D,{Scene:function(){return xe.Scene}}),g.o(xe,"SceneEventList")&&g.d(D,{SceneEventList:function(){return xe.SceneEventList}}),g.o(xe,"gl")&&g.d(D,{gl:function(){return xe.gl}});var $e=g(4594),Rt=g(1910),Lt=g.n(Rt);g.o(Rt,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return Rt.CityBuildingLayer}}),g.o(Rt,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return Rt.HeatmapLayer}}),g.o(Rt,"ImageLayer")&&g.d(D,{ImageLayer:function(){return Rt.ImageLayer}}),g.o(Rt,"LineLayer")&&g.d(D,{LineLayer:function(){return Rt.LineLayer}}),g.o(Rt,"Marker")&&g.d(D,{Marker:function(){return Rt.Marker}}),g.o(Rt,"PointLayer")&&g.d(D,{PointLayer:function(){return Rt.PointLayer}}),g.o(Rt,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return Rt.PolygonLayer}}),g.o(Rt,"Popup")&&g.d(D,{Popup:function(){return Rt.Popup}}),g.o(Rt,"PositionType")&&g.d(D,{PositionType:function(){return Rt.PositionType}}),g.o(Rt,"RasterLayer")&&g.d(D,{RasterLayer:function(){return Rt.RasterLayer}}),g.o(Rt,"Scene")&&g.d(D,{Scene:function(){return Rt.Scene}}),g.o(Rt,"SceneEventList")&&g.d(D,{SceneEventList:function(){return Rt.SceneEventList}}),g.o(Rt,"gl")&&g.d(D,{gl:function(){return Rt.gl}});var zt=g(19793),St=g(93102),Et=g.n(St);g.o(St,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return St.CityBuildingLayer}}),g.o(St,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return St.HeatmapLayer}}),g.o(St,"ImageLayer")&&g.d(D,{ImageLayer:function(){return St.ImageLayer}}),g.o(St,"LineLayer")&&g.d(D,{LineLayer:function(){return St.LineLayer}}),g.o(St,"Marker")&&g.d(D,{Marker:function(){return St.Marker}}),g.o(St,"PointLayer")&&g.d(D,{PointLayer:function(){return St.PointLayer}}),g.o(St,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return St.PolygonLayer}}),g.o(St,"Popup")&&g.d(D,{Popup:function(){return St.Popup}}),g.o(St,"PositionType")&&g.d(D,{PositionType:function(){return St.PositionType}}),g.o(St,"RasterLayer")&&g.d(D,{RasterLayer:function(){return St.RasterLayer}}),g.o(St,"Scene")&&g.d(D,{Scene:function(){return St.Scene}}),g.o(St,"gl")&&g.d(D,{gl:function(){return St.gl}});var at=g(64532),ur=g.n(at);g.o(at,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return at.CityBuildingLayer}}),g.o(at,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return at.HeatmapLayer}}),g.o(at,"ImageLayer")&&g.d(D,{ImageLayer:function(){return at.ImageLayer}}),g.o(at,"LineLayer")&&g.d(D,{LineLayer:function(){return at.LineLayer}}),g.o(at,"Marker")&&g.d(D,{Marker:function(){return at.Marker}}),g.o(at,"PointLayer")&&g.d(D,{PointLayer:function(){return at.PointLayer}}),g.o(at,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return at.PolygonLayer}}),g.o(at,"Popup")&&g.d(D,{Popup:function(){return at.Popup}}),g.o(at,"PositionType")&&g.d(D,{PositionType:function(){return at.PositionType}}),g.o(at,"RasterLayer")&&g.d(D,{RasterLayer:function(){return at.RasterLayer}}),g.o(at,"Scene")&&g.d(D,{Scene:function(){return at.Scene}}),g.o(at,"gl")&&g.d(D,{gl:function(){return at.gl}});var ee=g(2811),fr=g.n(ee);g.o(ee,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return ee.CityBuildingLayer}}),g.o(ee,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return ee.HeatmapLayer}}),g.o(ee,"ImageLayer")&&g.d(D,{ImageLayer:function(){return ee.ImageLayer}}),g.o(ee,"LineLayer")&&g.d(D,{LineLayer:function(){return ee.LineLayer}}),g.o(ee,"Marker")&&g.d(D,{Marker:function(){return ee.Marker}}),g.o(ee,"PointLayer")&&g.d(D,{PointLayer:function(){return ee.PointLayer}}),g.o(ee,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return ee.PolygonLayer}}),g.o(ee,"Popup")&&g.d(D,{Popup:function(){return ee.Popup}}),g.o(ee,"PositionType")&&g.d(D,{PositionType:function(){return ee.PositionType}}),g.o(ee,"RasterLayer")&&g.d(D,{RasterLayer:function(){return ee.RasterLayer}}),g.o(ee,"Scene")&&g.d(D,{Scene:function(){return ee.Scene}}),g.o(ee,"gl")&&g.d(D,{gl:function(){return ee.gl}});var At=g(66690),Je=g(81732),Pt=g.n(Je);g.o(Je,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return Je.CityBuildingLayer}}),g.o(Je,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return Je.HeatmapLayer}}),g.o(Je,"ImageLayer")&&g.d(D,{ImageLayer:function(){return Je.ImageLayer}}),g.o(Je,"LineLayer")&&g.d(D,{LineLayer:function(){return Je.LineLayer}}),g.o(Je,"Marker")&&g.d(D,{Marker:function(){return Je.Marker}}),g.o(Je,"PointLayer")&&g.d(D,{PointLayer:function(){return Je.PointLayer}}),g.o(Je,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return Je.PolygonLayer}}),g.o(Je,"Popup")&&g.d(D,{Popup:function(){return Je.Popup}}),g.o(Je,"RasterLayer")&&g.d(D,{RasterLayer:function(){return Je.RasterLayer}}),g.o(Je,"Scene")&&g.d(D,{Scene:function(){return Je.Scene}}),g.o(Je,"gl")&&g.d(D,{gl:function(){return Je.gl}});var Ve=g(84007),It=g.n(Ve);g.o(Ve,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return Ve.CityBuildingLayer}}),g.o(Ve,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return Ve.HeatmapLayer}}),g.o(Ve,"ImageLayer")&&g.d(D,{ImageLayer:function(){return Ve.ImageLayer}}),g.o(Ve,"LineLayer")&&g.d(D,{LineLayer:function(){return Ve.LineLayer}}),g.o(Ve,"Marker")&&g.d(D,{Marker:function(){return Ve.Marker}}),g.o(Ve,"PointLayer")&&g.d(D,{PointLayer:function(){return Ve.PointLayer}}),g.o(Ve,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return Ve.PolygonLayer}}),g.o(Ve,"Popup")&&g.d(D,{Popup:function(){return Ve.Popup}}),g.o(Ve,"RasterLayer")&&g.d(D,{RasterLayer:function(){return Ve.RasterLayer}}),g.o(Ve,"Scene")&&g.d(D,{Scene:function(){return Ve.Scene}}),g.o(Ve,"gl")&&g.d(D,{gl:function(){return Ve.gl}});var hr=g(89648),Jt=g(90919),Fr=g.n(Jt);g.o(Jt,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return Jt.CityBuildingLayer}}),g.o(Jt,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return Jt.HeatmapLayer}}),g.o(Jt,"ImageLayer")&&g.d(D,{ImageLayer:function(){return Jt.ImageLayer}}),g.o(Jt,"LineLayer")&&g.d(D,{LineLayer:function(){return Jt.LineLayer}}),g.o(Jt,"Marker")&&g.d(D,{Marker:function(){return Jt.Marker}}),g.o(Jt,"PointLayer")&&g.d(D,{PointLayer:function(){return Jt.PointLayer}}),g.o(Jt,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return Jt.PolygonLayer}}),g.o(Jt,"Popup")&&g.d(D,{Popup:function(){return Jt.Popup}}),g.o(Jt,"RasterLayer")&&g.d(D,{RasterLayer:function(){return Jt.RasterLayer}}),g.o(Jt,"Scene")&&g.d(D,{Scene:function(){return Jt.Scene}}),g.o(Jt,"gl")&&g.d(D,{gl:function(){return Jt.gl}});var fe=g(75925),Fe=g.n(fe);g.o(fe,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return fe.CityBuildingLayer}}),g.o(fe,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return fe.HeatmapLayer}}),g.o(fe,"ImageLayer")&&g.d(D,{ImageLayer:function(){return fe.ImageLayer}}),g.o(fe,"LineLayer")&&g.d(D,{LineLayer:function(){return fe.LineLayer}}),g.o(fe,"Marker")&&g.d(D,{Marker:function(){return fe.Marker}}),g.o(fe,"PointLayer")&&g.d(D,{PointLayer:function(){return fe.PointLayer}}),g.o(fe,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return fe.PolygonLayer}}),g.o(fe,"Popup")&&g.d(D,{Popup:function(){return fe.Popup}}),g.o(fe,"RasterLayer")&&g.d(D,{RasterLayer:function(){return fe.RasterLayer}}),g.o(fe,"Scene")&&g.d(D,{Scene:function(){return fe.Scene}}),g.o(fe,"gl")&&g.d(D,{gl:function(){return fe.gl}});var me=g(85040),bt=g.n(me);g.o(me,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return me.CityBuildingLayer}}),g.o(me,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return me.HeatmapLayer}}),g.o(me,"ImageLayer")&&g.d(D,{ImageLayer:function(){return me.ImageLayer}}),g.o(me,"LineLayer")&&g.d(D,{LineLayer:function(){return me.LineLayer}}),g.o(me,"Marker")&&g.d(D,{Marker:function(){return me.Marker}}),g.o(me,"PointLayer")&&g.d(D,{PointLayer:function(){return me.PointLayer}}),g.o(me,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return me.PolygonLayer}}),g.o(me,"Popup")&&g.d(D,{Popup:function(){return me.Popup}}),g.o(me,"RasterLayer")&&g.d(D,{RasterLayer:function(){return me.RasterLayer}}),g.o(me,"Scene")&&g.d(D,{Scene:function(){return me.Scene}}),g.o(me,"gl")&&g.d(D,{gl:function(){return me.gl}});var vt=g(8594),Zt=g.n(vt);g.o(vt,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return vt.CityBuildingLayer}}),g.o(vt,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return vt.HeatmapLayer}}),g.o(vt,"ImageLayer")&&g.d(D,{ImageLayer:function(){return vt.ImageLayer}}),g.o(vt,"LineLayer")&&g.d(D,{LineLayer:function(){return vt.LineLayer}}),g.o(vt,"Marker")&&g.d(D,{Marker:function(){return vt.Marker}}),g.o(vt,"PointLayer")&&g.d(D,{PointLayer:function(){return vt.PointLayer}}),g.o(vt,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return vt.PolygonLayer}}),g.o(vt,"Popup")&&g.d(D,{Popup:function(){return vt.Popup}}),g.o(vt,"RasterLayer")&&g.d(D,{RasterLayer:function(){return vt.RasterLayer}}),g.o(vt,"Scene")&&g.d(D,{Scene:function(){return vt.Scene}}),g.o(vt,"gl")&&g.d(D,{gl:function(){return vt.gl}});var Ut=g(67571),Rr=g.n(Ut);g.o(Ut,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return Ut.CityBuildingLayer}}),g.o(Ut,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return Ut.HeatmapLayer}}),g.o(Ut,"ImageLayer")&&g.d(D,{ImageLayer:function(){return Ut.ImageLayer}}),g.o(Ut,"LineLayer")&&g.d(D,{LineLayer:function(){return Ut.LineLayer}}),g.o(Ut,"Marker")&&g.d(D,{Marker:function(){return Ut.Marker}}),g.o(Ut,"PointLayer")&&g.d(D,{PointLayer:function(){return Ut.PointLayer}}),g.o(Ut,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return Ut.PolygonLayer}}),g.o(Ut,"Popup")&&g.d(D,{Popup:function(){return Ut.Popup}}),g.o(Ut,"RasterLayer")&&g.d(D,{RasterLayer:function(){return Ut.RasterLayer}}),g.o(Ut,"Scene")&&g.d(D,{Scene:function(){return Ut.Scene}}),g.o(Ut,"gl")&&g.d(D,{gl:function(){return Ut.gl}});var ln=g(66718),pn=g.n(ln);g.o(ln,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return ln.CityBuildingLayer}}),g.o(ln,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return ln.HeatmapLayer}}),g.o(ln,"ImageLayer")&&g.d(D,{ImageLayer:function(){return ln.ImageLayer}}),g.o(ln,"LineLayer")&&g.d(D,{LineLayer:function(){return ln.LineLayer}}),g.o(ln,"Marker")&&g.d(D,{Marker:function(){return ln.Marker}}),g.o(ln,"PointLayer")&&g.d(D,{PointLayer:function(){return ln.PointLayer}}),g.o(ln,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return ln.PolygonLayer}}),g.o(ln,"Popup")&&g.d(D,{Popup:function(){return ln.Popup}}),g.o(ln,"RasterLayer")&&g.d(D,{RasterLayer:function(){return ln.RasterLayer}}),g.o(ln,"Scene")&&g.d(D,{Scene:function(){return ln.Scene}}),g.o(ln,"gl")&&g.d(D,{gl:function(){return ln.gl}});var Vi=g(92364),ar=g(78010),pe=g.n(ar);g.o(ar,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return ar.CityBuildingLayer}}),g.o(ar,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return ar.HeatmapLayer}}),g.o(ar,"ImageLayer")&&g.d(D,{ImageLayer:function(){return ar.ImageLayer}}),g.o(ar,"LineLayer")&&g.d(D,{LineLayer:function(){return ar.LineLayer}}),g.o(ar,"Marker")&&g.d(D,{Marker:function(){return ar.Marker}}),g.o(ar,"PointLayer")&&g.d(D,{PointLayer:function(){return ar.PointLayer}}),g.o(ar,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return ar.PolygonLayer}}),g.o(ar,"Popup")&&g.d(D,{Popup:function(){return ar.Popup}}),g.o(ar,"RasterLayer")&&g.d(D,{RasterLayer:function(){return ar.RasterLayer}}),g.o(ar,"Scene")&&g.d(D,{Scene:function(){return ar.Scene}}),g.o(ar,"gl")&&g.d(D,{gl:function(){return ar.gl}});var Pe=g(68116),Ge=g.n(Pe);g.o(Pe,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return Pe.CityBuildingLayer}}),g.o(Pe,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return Pe.HeatmapLayer}}),g.o(Pe,"ImageLayer")&&g.d(D,{ImageLayer:function(){return Pe.ImageLayer}}),g.o(Pe,"LineLayer")&&g.d(D,{LineLayer:function(){return Pe.LineLayer}}),g.o(Pe,"Marker")&&g.d(D,{Marker:function(){return Pe.Marker}}),g.o(Pe,"PointLayer")&&g.d(D,{PointLayer:function(){return Pe.PointLayer}}),g.o(Pe,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return Pe.PolygonLayer}}),g.o(Pe,"Popup")&&g.d(D,{Popup:function(){return Pe.Popup}}),g.o(Pe,"RasterLayer")&&g.d(D,{RasterLayer:function(){return Pe.RasterLayer}}),g.o(Pe,"Scene")&&g.d(D,{Scene:function(){return Pe.Scene}}),g.o(Pe,"gl")&&g.d(D,{gl:function(){return Pe.gl}});var ke=g(23067),Ft=g.n(ke);g.o(ke,"CityBuildingLayer")&&g.d(D,{CityBuildingLayer:function(){return ke.CityBuildingLayer}}),g.o(ke,"HeatmapLayer")&&g.d(D,{HeatmapLayer:function(){return ke.HeatmapLayer}}),g.o(ke,"ImageLayer")&&g.d(D,{ImageLayer:function(){return ke.ImageLayer}}),g.o(ke,"LineLayer")&&g.d(D,{LineLayer:function(){return ke.LineLayer}}),g.o(ke,"Marker")&&g.d(D,{Marker:function(){return ke.Marker}}),g.o(ke,"PointLayer")&&g.d(D,{PointLayer:function(){return ke.PointLayer}}),g.o(ke,"PolygonLayer")&&g.d(D,{PolygonLayer:function(){return ke.PolygonLayer}}),g.o(ke,"Popup")&&g.d(D,{Popup:function(){return ke.Popup}}),g.o(ke,"RasterLayer")&&g.d(D,{RasterLayer:function(){return ke.RasterLayer}}),g.o(ke,"Scene")&&g.d(D,{Scene:function(){return ke.Scene}}),g.o(ke,"gl")&&g.d(D,{gl:function(){return ke.gl}});var ir=g(7648)},12250:function(Qe,D,g){"use strict";g.d(D,{e7:function(){return Zi},Hp:function(){return _i},ZP:function(){return ia},yT:function(){return fi}});var U=g(28660),b=g(26729),p=g.n(b),E=g(86700),Z=g(84879),V=g(72302),H=g(6610),I=g(5991),L=g(96156),_e=g(6901),xe=g(49296),Re=g.n(xe);function $e(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function Rt(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?$e(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):$e(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}function Lt(q,te){var k=typeof Symbol!="undefined"&&q[Symbol.iterator]||q["@@iterator"];if(!k){if(Array.isArray(q)||(k=zt(q))||te&&q&&typeof q.length=="number"){k&&(q=k);var F=0,ie=function(){};return{s:ie,n:function(){return F>=q.length?{done:!0}:{done:!1,value:q[F++]}},e:function(qt){throw qt},f:ie}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ae=!0,ft=!1,Vt;return{s:function(){k=k.call(q)},n:function(){var qt=k.next();return Ae=qt.done,qt},e:function(qt){ft=!0,Vt=qt},f:function(){try{!Ae&&k.return!=null&&k.return()}finally{if(ft)throw Vt}}}}function zt(q,te){if(!!q){if(typeof q=="string")return St(q,te);var k=Object.prototype.toString.call(q).slice(8,-1);if(k==="Object"&&q.constructor&&(k=q.constructor.name),k==="Map"||k==="Set")return Array.from(q);if(k==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k))return St(q,te)}}function St(q,te){(te==null||te>q.length)&&(te=q.length);for(var k=0,F=new Array(te);k<te;k++)F[k]=q[k];return F}var Et=30;function at(q){var te=q.characterSet,k=q.getFontWidth,F=q.fontHeight,ie=q.buffer,Ae=q.maxCanvasWidth,ft=q.mapping,Vt=ft===void 0?{}:ft,Tt=q.xOffset,qt=Tt===void 0?0:Tt,Lr=q.yOffset,In=Lr===void 0?0:Lr,Fn=0,oi=qt;Array.from(te).forEach(function(mi,Gi){if(!Vt[mi]){var ma=k(mi,Gi);oi+Et>Ae&&(oi=0,Fn++),Vt[mi]={x:oi,y:In+Fn*Et,width:Et,height:Et,advance:ma},oi+=Et}});var ui=F+ie*2;return{mapping:Vt,xOffset:oi,yOffset:In+Fn*ui,canvasHeight:fr(In+(Fn+1)*ui)}}function ur(q,te,k){var F=0,ie=0,Ae=0,ft=[],Vt={},Tt=Lt(q),qt;try{for(Tt.s();!(qt=Tt.n()).done;){var Lr=qt.value;if(!Vt[Lr.id]){var In=Lr.size;F+In+te>k&&(ee(Vt,ft,ie),F=0,ie=Ae+ie+te,Ae=0,ft=[]),ft.push({icon:Lr,xOffset:F}),F=F+In+te,Ae=Math.max(Ae,In)}}}catch(oi){Tt.e(oi)}finally{Tt.f()}ft.length>0&&ee(Vt,ft,ie);var Fn=fr(Ae+ie+te);return{mapping:Vt,canvasHeight:Fn}}function ee(q,te,k){var F=Lt(te),ie;try{for(F.s();!(ie=F.n()).done;){var Ae=ie.value,ft=Ae.icon,Vt=Ae.xOffset;q[ft.id]=Rt(Rt({},ft),{},{x:Vt,y:k,image:ft.image,width:ft.width,height:ft.height})}}catch(Tt){F.e(Tt)}finally{F.f()}}function fr(q){return Math.pow(2,Math.ceil(Math.log2(q)))}var At,Je;function Pt(q,te){var k=typeof Symbol!="undefined"&&q[Symbol.iterator]||q["@@iterator"];if(!k){if(Array.isArray(q)||(k=Ve(q))||te&&q&&typeof q.length=="number"){k&&(q=k);var F=0,ie=function(){};return{s:ie,n:function(){return F>=q.length?{done:!0}:{done:!1,value:q[F++]}},e:function(qt){throw qt},f:ie}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ae=!0,ft=!1,Vt;return{s:function(){k=k.call(q)},n:function(){var qt=k.next();return Ae=qt.done,qt},e:function(qt){ft=!0,Vt=qt},f:function(){try{!Ae&&k.return!=null&&k.return()}finally{if(ft)throw Vt}}}}function Ve(q,te){if(!!q){if(typeof q=="string")return It(q,te);var k=Object.prototype.toString.call(q).slice(8,-1);if(k==="Object"&&q.constructor&&(k=q.constructor.name),k==="Map"||k==="Set")return Array.from(q);if(k==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k))return It(q,te)}}function It(q,te){(te==null||te>q.length)&&(te=q.length);for(var k=0,F=new Array(te);k<te;k++)F[k]=q[k];return F}function hr(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function Jt(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?hr(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):hr(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}var Fr=ar(),fe="sans-serif",Fe="normal",me=24,bt=3,vt=.25,Zt=8,Ut=1024,Rr=1,ln=1,pn=3,Vi=null;function ar(){for(var q=[],te=32;te<128;te++)q.push(String.fromCharCode(te));return q}function pe(q,te,k,F){q.font="".concat(F," ").concat(k,"px ").concat(te),q.fillStyle="black",q.textBaseline="middle"}function Pe(q,te){for(var k=0;k<q.length;k++)te.data[4*k+3]=q[k]}var Ge=(At=(0,E.b2)(),At(Je=function(){function q(){(0,H.Z)(this,q),(0,L.Z)(this,"fontAtlas",void 0),(0,L.Z)(this,"iconFontMap",void 0),(0,L.Z)(this,"iconFontGlyphs",{}),(0,L.Z)(this,"fontOptions",void 0),(0,L.Z)(this,"key",void 0),(0,L.Z)(this,"cache",new _e.z6(pn))}return(0,I.Z)(q,[{key:"scale",get:function(){return ln}},{key:"canvas",get:function(){var k=this.cache.get(this.key);return k&&k.data}},{key:"mapping",get:function(){var k=this.cache.get(this.key);return k&&k.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:fe,fontWeight:Fe,characterSet:Fr,fontSize:me,buffer:bt,sdf:!0,cutoff:vt,radius:Zt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(k){var F=this;k.forEach(function(ie){F.iconFontGlyphs[ie.name]=ie.unicode})}},{key:"addIconFont",value:function(k,F){this.iconFontMap.set(k,F)}},{key:"getIconFontKey",value:function(k){return this.iconFontMap.get(k)||k}},{key:"getGlyph",value:function(k){return this.iconFontGlyphs[k]?String.fromCharCode(parseInt(this.iconFontGlyphs[k],16)):""}},{key:"setFontOptions",value:function(k){this.fontOptions=Jt(Jt({},this.fontOptions),k),this.key=this.getKey();var F=this.getNewChars(this.key,this.fontOptions.characterSet),ie=this.cache.get(this.key);if(!(ie&&F.length===0)){var Ae=this.generateFontAtlas(this.key,F,ie);this.fontAtlas=Ae,this.cache.set(this.key,Ae)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(k,F,ie){var Ae=this.fontOptions,ft=Ae.fontFamily,Vt=Ae.fontWeight,Tt=Ae.fontSize,qt=Ae.buffer,Lr=Ae.sdf,In=Ae.radius,Fn=Ae.cutoff,oi=Ae.iconfont,ui=ie&&ie.data;ui||(ui=document.createElement("canvas"),ui.width=Ut);var mi=ui.getContext("2d");pe(mi,ft,Tt,Vt);var Gi=at(Jt({getFontWidth:function(Sc){return mi.measureText(Sc).width},fontHeight:Tt*ln,buffer:qt,characterSet:F,maxCanvasWidth:Ut},ie&&{mapping:ie.mapping,xOffset:ie.xOffset,yOffset:ie.yOffset})),ma=Gi.mapping,ya=Gi.canvasHeight,ro=Gi.xOffset,Oa=Gi.yOffset,mo=mi.getImageData(0,0,ui.width,ui.height);if(ui.height=ya,mi.putImageData(mo,0,0),pe(mi,ft,Tt,Vt),Lr){var Ma=new(Re())(Tt,qt,In,Fn,ft,Vt),ga=mi.getImageData(0,0,Ma.size,Ma.size),aa=Pt(F),pa;try{for(aa.s();!(pa=aa.n()).done;){var Ua=pa.value;if(oi){var Za=String.fromCharCode(parseInt(Ua.replace("&#x","").replace(";",""),16)),ko=Ma.draw(Za);Pe(ko,ga)}else Pe(Ma.draw(Ua),ga);mi.putImageData(ga,ma[Ua].x,ma[Ua].y)}}catch(Yo){aa.e(Yo)}finally{aa.f()}}else{var ji=Pt(F),Xo;try{for(ji.s();!(Xo=ji.n()).done;){var Fo=Xo.value;mi.fillText(Fo,ma[Fo].x,ma[Fo].y+Tt*Rr)}}catch(Yo){ji.e(Yo)}finally{ji.f()}}return{xOffset:ro,yOffset:Oa,mapping:ma,data:ui,width:ui.width,height:ui.height}}},{key:"getKey",value:function(){return"key";var k,F,ie,Ae,ft,Vt,Tt,qt}},{key:"getNewChars",value:function(k,F){var ie=this.cache.get(k);if(!ie)return F;var Ae=[],ft=ie.mapping,Vt=new Set(Object.keys(ft)),Tt=new Set(F);return Tt.forEach(function(qt){Vt.has(qt)||Ae.push(qt)}),Ae}}]),q}())||Je),ke=g(63349),Ft=g(10379),ir=g(46070),T=g(77608),G,Se;function Be(q){var te=et();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function et(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var tt=3,Ct=1024,jt=64,Mt=(G=(0,E.b2)(),G(Se=function(q){(0,Ft.Z)(k,q);var te=Be(k);function k(){var F;(0,H.Z)(this,k);for(var ie=arguments.length,Ae=new Array(ie),ft=0;ft<ie;ft++)Ae[ft]=arguments[ft];return F=te.call.apply(te,[this].concat(Ae)),(0,L.Z)((0,ke.Z)(F),"canvasHeight",128),(0,L.Z)((0,ke.Z)(F),"texture",void 0),(0,L.Z)((0,ke.Z)(F),"canvas",void 0),(0,L.Z)((0,ke.Z)(F),"iconData",void 0),(0,L.Z)((0,ke.Z)(F),"iconMap",void 0),(0,L.Z)((0,ke.Z)(F),"ctx",void 0),(0,L.Z)((0,ke.Z)(F),"loadingImageCount",0),F}return(0,I.Z)(k,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(ie,Ae){var ft=this,Vt=new Image;if(this.loadingImageCount++,this.hasImage(ie))throw new Error("Image Id already exists");this.iconData.push({id:ie,size:jt}),this.updateIconMap(),this.loadImage(Ae).then(function(Tt){Vt=Tt;var qt=ft.iconData.find(function(Lr){return Lr.id===ie});qt&&(qt.image=Vt,qt.width=Vt.width,qt.height=Vt.height),ft.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(ie){return this.iconMap.hasOwnProperty(ie)}},{key:"removeImage",value:function(ie){this.hasImage(ie)&&(this.iconData=this.iconData.filter(function(Ae){return Ae.id!==ie}),delete this.iconMap[ie],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var ie=this;this.canvas.width=Ct,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(Ae){var ft=ie.iconMap[Ae],Vt=ft.x,Tt=ft.y,qt=ft.image,Lr=ft.width,In=Lr===void 0?64:Lr,Fn=ft.height,oi=Fn===void 0?64:Fn,ui=Math.max(In,oi),mi=ui/jt,Gi=oi/mi,ma=In/mi;qt&&ie.ctx.drawImage(qt,Vt+(jt-ma)/2,Tt+(jt-Gi)/2,ma,Gi)})}},{key:"updateIconMap",value:function(){var ie=ur(this.iconData,tt,Ct),Ae=ie.mapping,ft=ie.canvasHeight;this.iconMap=Ae,this.canvasHeight=ft}},{key:"loadImage",value:function(ie){return new Promise(function(Ae,ft){if(ie instanceof HTMLImageElement){Ae(ie);return}var Vt=new Image;Vt.crossOrigin="anonymous",Vt.onload=function(){Ae(Vt)},Vt.onerror=function(){ft(new Error("Could not load image at "+ie))},Vt.src=ie instanceof File?URL.createObjectURL(ie):ie})}}]),k}(b.EventEmitter))||Se),Qt=g(28481),ne=g(85975),Kt,Dr,Mr=(Kt=(0,E.b2)(),Kt(Dr=function(){function q(){(0,H.Z)(this,q),(0,L.Z)(this,"viewport",void 0),(0,L.Z)(this,"overridedViewProjectionMatrix",void 0),(0,L.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,L.Z)(this,"jitteredProjectionMatrix",void 0),(0,L.Z)(this,"viewMatrixInverse",void 0),(0,L.Z)(this,"cameraPosition",void 0)}return(0,I.Z)(q,[{key:"init",value:function(){}},{key:"update",value:function(k){this.viewport=k,this.viewMatrixInverse=ne.create(),ne.invert(this.viewMatrixInverse,k.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var k=this.viewport.getCenter(),F=(0,Qt.Z)(k,2),ie=F[0],Ae=F[1];return[ie,Ae]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(k,F){return this.viewport.projectFlat(k,F)}},{key:"setViewProjectionMatrix",value:function(k){this.overridedViewProjectionMatrix=k}},{key:"jitterProjectionMatrix",value:function(k,F){var ie=ne.fromTranslation(ne.create(),[k,F,0]);this.jitteredProjectionMatrix=ne.multiply(ne.create(),ie,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=ne.multiply(ne.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),q}())||Dr),nt,xt;function ht(q,te){var k=typeof Symbol!="undefined"&&q[Symbol.iterator]||q["@@iterator"];if(!k){if(Array.isArray(q)||(k=vr(q))||te&&q&&typeof q.length=="number"){k&&(q=k);var F=0,ie=function(){};return{s:ie,n:function(){return F>=q.length?{done:!0}:{done:!1,value:q[F++]}},e:function(qt){throw qt},f:ie}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ae=!0,ft=!1,Vt;return{s:function(){k=k.call(q)},n:function(){var qt=k.next();return Ae=qt.done,qt},e:function(qt){ft=!0,Vt=qt},f:function(){try{!Ae&&k.return!=null&&k.return()}finally{if(ft)throw Vt}}}}function vr(q,te){if(!!q){if(typeof q=="string")return Zr(q,te);var k=Object.prototype.toString.call(q).slice(8,-1);if(k==="Object"&&q.constructor&&(k=q.constructor.name),k==="Map"||k==="Set")return Array.from(q);if(k==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k))return Zr(q,te)}}function Zr(q,te){(te==null||te>q.length)&&(te=q.length);for(var k=0,F=new Array(te);k<te;k++)F[k]=q[k];return F}var Ur=(nt=(0,E.b2)(),nt(xt=function(){function q(){(0,H.Z)(this,q),(0,L.Z)(this,"container",void 0),(0,L.Z)(this,"controlCorners",void 0),(0,L.Z)(this,"controlContainer",void 0),(0,L.Z)(this,"scene",void 0),(0,L.Z)(this,"mapsService",void 0),(0,L.Z)(this,"controls",[]),(0,L.Z)(this,"unAddControls",[])}return(0,I.Z)(q,[{key:"init",value:function(k,F){this.container=k.container,this.scene=F,this.mapsService=F.get(V.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(k,F){var ie=F.get(V.v.IMapService);ie.map?(k.addTo(this.scene),this.controls.push(k)):this.unAddControls.push(k)}},{key:"getControlByName",value:function(k){return this.controls.find(function(F){return F.controlOption.name===k})}},{key:"removeControl",value:function(k){var F=this.controls.indexOf(k);return F>-1&&this.controls.splice(F,1),k.remove(),this}},{key:"addControls",value:function(){var k=this;this.unAddControls.forEach(function(F){F.addTo(k.scene),k.controls.push(F)}),this.unAddControls=[]}},{key:"destroy",value:function(){var k=ht(this.controls),F;try{for(k.s();!(F=k.n()).done;){var ie=F.value;ie.remove()}}catch(Ae){k.e(Ae)}finally{k.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var k=this.controlCorners={},F="l7-",ie=this.controlContainer=_e.SO.create("div",F+"control-container",this.container);function Ae(ft,Vt){var Tt=F+ft+" "+F+Vt;k[ft+Vt]=_e.SO.create("div",Tt,ie)}Ae("top","left"),Ae("top","right"),Ae("bottom","left"),Ae("bottom","right")}},{key:"clearControlPos",value:function(){for(var k in this.controlCorners)this.controlCorners[k]&&_e.SO.remove(this.controlCorners[k]);this.controlContainer&&_e.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),q}())||xt),tn,jr,wr=(tn=(0,E.b2)(),tn(jr=function(){function q(){(0,H.Z)(this,q),(0,L.Z)(this,"container",void 0),(0,L.Z)(this,"scene",void 0),(0,L.Z)(this,"mapsService",void 0),(0,L.Z)(this,"markers",[]),(0,L.Z)(this,"markerLayers",[]),(0,L.Z)(this,"unAddMarkers",[]),(0,L.Z)(this,"unAddMarkerLayers",[])}return(0,I.Z)(q,[{key:"addMarkerLayer",value:function(k){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(k),k.addTo(this.scene)):this.unAddMarkerLayers.push(k)}},{key:"removeMarkerLayer",value:function(k){k.destroy(),this.markerLayers.indexOf(k);var F=this.markerLayers.indexOf(k);F>-1&&this.markerLayers.splice(F,1)}},{key:"addMarker",value:function(k){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(k),k.addTo(this.scene)):this.unAddMarkers.push(k)}},{key:"addMarkers",value:function(){var k=this;this.unAddMarkers.forEach(function(F){F.addTo(k.scene),k.markers.push(F)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var k=this;this.unAddMarkerLayers.forEach(function(F){k.markerLayers.push(F),F.addTo(k.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(k){k.remove(),this.markers.indexOf(k);var F=this.markers.indexOf(k);F>-1&&this.markers.splice(F,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(k){this.scene=k,this.mapsService=k.get(V.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(k){k.remove()}),this.markers=[],this.markerLayers.forEach(function(k){k.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(k){k.destroy()}}]),q}())||jr),Dn,Zn,bi=(Dn=(0,E.b2)(),Dn(Zn=function(){function q(){(0,H.Z)(this,q),(0,L.Z)(this,"scene",void 0),(0,L.Z)(this,"popup",void 0),(0,L.Z)(this,"mapsService",void 0),(0,L.Z)(this,"unAddPopup",void 0)}return(0,I.Z)(q,[{key:"removePopup",value:function(k){k.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(k){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(k.addTo(this.scene),this.popup=k):this.unAddPopup=k}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(k){this.scene=k,this.mapsService=k.get(V.v.IMapService)}}]),q}())||Zn),Hi=g(82492),qi=g.n(Hi),ki={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Oi=ki,$,ce;function ve(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function j(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?ve(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):ve(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}var se={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},de={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Me=($=(0,E.b2)(),$(ce=function(){function q(){(0,H.Z)(this,q),(0,L.Z)(this,"sceneConfigCache",{}),(0,L.Z)(this,"layerConfigCache",{})}return(0,I.Z)(q,[{key:"getSceneConfig",value:function(k){return this.sceneConfigCache[k]}},{key:"getSceneWarninfo",value:function(k){return Oi[k]}},{key:"setSceneConfig",value:function(k,F){this.sceneConfigCache[k]=j(j({},se),F)}},{key:"getLayerConfig",value:function(k){return this.layerConfigCache[k]}},{key:"setLayerConfig",value:function(k,F,ie){this.layerConfigCache[F]=j({},qi()({},this.sceneConfigCache[k],de,ie))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),q}())||ce),ue=g(55770),Te=g(3473),mt=g(98333),br=Math.PI/180,Yt=512,nr=4003e4;function kr(q){var te=q.latitude,k=te===void 0?0:te,F=q.zoom,ie=F===void 0?0:F,Ae=q.scale,ft=q.highPrecision,Vt=ft===void 0?!1:ft,Tt=q.flipY,qt=Tt===void 0?!1:Tt;Ae=Ae!==void 0?Ae:Math.pow(2,ie);var Lr={},In=Yt*Ae,Fn=Math.cos(k*br),oi=In/360,ui=oi/Fn,mi=In/nr/Fn;if(Lr.pixelsPerMeter=[mi,-mi,mi],Lr.metersPerPixel=[1/mi,-1/mi,1/mi],Lr.pixelsPerDegree=[oi,-ui,mi],Lr.degreesPerPixel=[1/oi,-1/ui,1/mi],Vt){var Gi=br*Math.tan(k*br)/Fn,ma=oi*Gi/2,ya=In/nr*Gi,ro=ya/ui*mi;Lr.pixelsPerDegree2=[0,-ma,ya],Lr.pixelsPerMeter2=[ro,0,ro],qt&&(Lr.pixelsPerDegree2[1]=-Lr.pixelsPerDegree2[1],Lr.pixelsPerMeter2[1]=-Lr.pixelsPerMeter2[1])}return qt&&(Lr.pixelsPerMeter[1]=-Lr.pixelsPerMeter[1],Lr.metersPerPixel[1]=-Lr.metersPerPixel[1],Lr.pixelsPerDegree[1]=-Lr.pixelsPerDegree[1],Lr.degreesPerPixel[1]=-Lr.degreesPerPixel[1]),Lr}var Mn=g(47282),Pn,tr,Sn,on,cn,wi=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],xn=(Pn=(0,E.b2)(),tr=(0,E.f3)(V.v.ICameraService),Pn(Sn=(on=function(){function q(){(0,H.Z)(this,q),(0,L.Z)(this,"needRefresh",!0),(0,ue.Z)(this,"cameraService",cn,this),(0,L.Z)(this,"coordinateSystem",void 0),(0,L.Z)(this,"viewportCenter",void 0),(0,L.Z)(this,"viewportCenterProjection",void 0),(0,L.Z)(this,"pixelsPerDegree",void 0),(0,L.Z)(this,"pixelsPerDegree2",void 0),(0,L.Z)(this,"pixelsPerMeter",void 0)}return(0,I.Z)(q,[{key:"refresh",value:function(){var k=this.cameraService.getZoom(),F=this.cameraService.getZoomScale(),ie=this.cameraService.getCenter(),Ae=kr({latitude:ie[1],zoom:k}),ft=Ae.pixelsPerMeter,Vt=Ae.pixelsPerDegree;this.viewportCenter=ie,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=ft,this.pixelsPerDegree=Vt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Mn.l.LNGLAT||this.coordinateSystem===Mn.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Mn.l.LNGLAT_OFFSET?this.calculateLnglatOffset(ie,k):this.coordinateSystem===Mn.l.P20_OFFSET&&this.calculateLnglatOffset(ie,k,F,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(k){this.coordinateSystem=k}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(k,F,ie,Ae){var ft=kr({latitude:k[1],zoom:F,scale:ie,flipY:Ae,highPrecision:!0}),Vt=ft.pixelsPerMeter,Tt=ft.pixelsPerDegree,qt=ft.pixelsPerDegree2,Lr=this.cameraService.getViewMatrix(),In=this.cameraService.getProjectionMatrix(),Fn=ne.multiply([],In,Lr),oi=this.cameraService.projectFlat([Math.fround(k[0]),Math.fround(k[1])],Math.pow(2,F));this.viewportCenterProjection=mt.fF([],[oi[0],oi[1],0,1],Fn),Lr=this.cameraService.getViewMatrixUncentered()||Lr,Fn=ne.multiply([],In,Lr),Fn=ne.multiply([],Fn,wi),this.cameraService.setViewProjectionMatrix(Fn),this.pixelsPerMeter=Vt,this.pixelsPerDegree=Tt,this.pixelsPerDegree2=qt}}]),q}(),cn=(0,Te.Z)(on.prototype,"cameraService",[tr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),on))||Sn),Li=g(50840),$i=g.n(Li),ai=g(89648),Ji,Ni,Ai,ha,Ca;function ii(q){var te=ti();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function ti(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var Xi={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},va=(Ji=(0,E.b2)(),Ni=(0,E.f3)(V.v.IMapService),Ji(Ai=(ha=function(q){(0,Ft.Z)(k,q);var te=ii(k);function k(){var F;(0,H.Z)(this,k);for(var ie=arguments.length,Ae=new Array(ie),ft=0;ft<ie;ft++)Ae[ft]=arguments[ft];return F=te.call.apply(te,[this].concat(Ae)),(0,ue.Z)((0,ke.Z)(F),"mapService",Ca,(0,ke.Z)(F)),(0,L.Z)((0,ke.Z)(F),"hammertime",void 0),(0,L.Z)((0,ke.Z)(F),"lastClickTime",0),(0,L.Z)((0,ke.Z)(F),"lastClickXY",[-1,-1]),(0,L.Z)((0,ke.Z)(F),"clickTimer",void 0),(0,L.Z)((0,ke.Z)(F),"$containter",void 0),(0,L.Z)((0,ke.Z)(F),"onDrag",function(Vt){var Tt=F.interactionEvent(Vt);Tt.type=Xi[Tt.type],F.emit(ai.s.Drag,Tt)}),(0,L.Z)((0,ke.Z)(F),"onHammer",function(Vt){Vt.srcEvent.stopPropagation();var Tt=F.interactionEvent(Vt);F.emit(ai.s.Hover,Tt)}),(0,L.Z)((0,ke.Z)(F),"onTouch",function(Vt){var Tt=Vt.touches[0];F.onHover({x:Tt.pageX,y:Tt.pageY,type:"touch"})}),(0,L.Z)((0,ke.Z)(F),"onHover",function(Vt){var Tt=Vt.clientX,qt=Vt.clientY,Lr=Tt,In=qt,Fn=Vt.type,oi=F.mapService.getMapContainer();if(oi){var ui=oi.getBoundingClientRect(),mi=ui.top,Gi=ui.left;Lr=Lr-Gi-oi.clientLeft,In=In-mi-oi.clientTop}var ma=F.mapService.containerToLngLat([Lr,In]);if(Fn==="click"){if("ontouchstart"in document.documentElement)return;F.isDoubleTap(Lr,In,ma);return}if(Fn==="touch"){F.isDoubleTap(Lr,In,ma);return}Fn!=="click"&&Fn!=="dblclick"&&F.emit(ai.s.Hover,{x:Lr,y:In,lngLat:ma,type:Fn,target:Vt})}),F}return(0,I.Z)(k,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ai.s.Hover)}},{key:"triggerHover",value:function(ie){var Ae=ie.x,ft=ie.y;this.emit(ai.s.Hover,{x:Ae,y:ft})}},{key:"triggerSelect",value:function(ie){this.emit(ai.s.Select,{featureId:ie})}},{key:"triggerActive",value:function(ie){this.emit(ai.s.Active,{featureId:ie})}},{key:"addEventListenerOnMap",value:function(){var ie=this.mapService.getMapContainer();if(ie){var Ae=new($i()).Manager(ie);Ae.add(new($i()).Tap({event:"dblclick",taps:2})),Ae.add(new($i()).Tap({event:"click"})),Ae.add(new($i()).Pan({threshold:0,pointers:0})),Ae.add(new($i()).Press({})),Ae.on("dblclick click",this.onHammer),Ae.on("panstart panmove panend pancancel",this.onDrag),ie.addEventListener("mousemove",this.onHover),ie.addEventListener("mousedown",this.onHover,!0),ie.addEventListener("mouseup",this.onHover),ie.addEventListener("contextmenu",this.onHover),this.hammertime=Ae}}},{key:"removeEventListenerOnMap",value:function(){var ie=this.mapService.getMapContainer();ie&&(ie.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),ie.removeEventListener("mousedown",this.onHover),ie.removeEventListener("mouseup",this.onHover),ie.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(ie){var Ae=ie.type,ft=ie.pointerType,Vt,Tt;ft==="touch"?(Tt=Math.floor(ie.pointers[0].clientY),Vt=Math.floor(ie.pointers[0].clientX)):(Tt=Math.floor(ie.srcEvent.y),Vt=Math.floor(ie.srcEvent.x));var qt=this.mapService.getMapContainer();if(qt){var Lr=qt.getBoundingClientRect(),In=Lr.top,Fn=Lr.left;Vt-=Fn,Tt-=In}var oi=this.mapService.containerToLngLat([Vt,Tt]);return{x:Vt,y:Tt,lngLat:oi,type:Ae,target:ie.srcEvent}}},{key:"isDoubleTap",value:function(ie,Ae,ft){var Vt=this,Tt=new Date().getTime(),qt="click";Tt-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-ie)<10&&Math.abs(this.lastClickXY[1]-Ae)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),qt="dblclick",this.emit(ai.s.Hover,{x:ie,y:Ae,lngLat:ft,type:qt})):(this.lastClickTime=Tt,this.lastClickXY=[ie,Ae],this.clickTimer=setTimeout(function(){qt="click",Vt.emit(ai.s.Hover,{x:ie,y:Ae,lngLat:ft,type:qt})},400))}}]),k}(p()),Ca=(0,Te.Z)(ha.prototype,"mapService",[Ni],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ha))||Ai),Vo=g(92137),ba=g(87757),gi=g.n(ba),Bs=window.document.documentElement.style,nu=0;function Aa(q){var te=q;if(typeof q=="string"&&(te=document.getElementById(q)),te){var k=document.createElement("div");return k.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,k.id="l7-scene-".concat(nu++),k.classList.add("l7-scene"),te.appendChild(k),k}return null}function Io(q){var te,k,F=!0;return q==null||(te=q.target)===null||te===void 0||(k=te.path)===null||k===void 0||k.map(function(ie){if(ie!=null&&ie.classList){var Ae;ie==null||(Ae=ie.classList)===null||Ae===void 0||Ae.forEach(function(ft){(ft==="l7-marker"||ft==="l7-popup")&&(F=!1)})}}),F}var zi=g(7648),Ka,Go,ea,To,Oo,co,fo,Yi,Da,ka,fs;function Sa(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function be(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?Sa(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):Sa(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}var Ne=(Ka=(0,E.b2)(),Go=(0,E.f3)(V.v.IRendererService),ea=(0,E.f3)(V.v.IGlobalConfigService),To=(0,E.f3)(V.v.IInteractionService),Oo=(0,E.f3)(V.v.ILayerService),Ka(co=(fo=function(){function q(){var te=this;(0,H.Z)(this,q),(0,ue.Z)(this,"rendererService",Yi,this),(0,ue.Z)(this,"configService",Da,this),(0,ue.Z)(this,"interactionService",ka,this),(0,ue.Z)(this,"layerService",fs,this),(0,L.Z)(this,"pickingFBO",void 0),(0,L.Z)(this,"width",0),(0,L.Z)(this,"height",0),(0,L.Z)(this,"alreadyInPicking",!1),(0,L.Z)(this,"pickBufferScale",1),(0,L.Z)(this,"pickFromPickingFBO",function(k,F){var ie,Ae=F.x,ft=F.y,Vt=F.lngLat,Tt=F.type,qt=F.target,Lr=!1,In=te.rendererService,Fn=In.getViewportSize,oi=In.readPixels,ui=In.getContainer,mi=ui().getBoundingClientRect(),Gi=mi.width,ma=mi.height;Gi*=_e.SO.DPR,ma*=_e.SO.DPR;var ya=k.getLayerConfig(),ro=ya.enableHighlight,Oa=ya.enableSelect,mo=Ae*_e.SO.DPR,Ma=ft*_e.SO.DPR;if(mo>Gi-1*_e.SO.DPR||mo<0||Ma>ma-1*_e.SO.DPR||Ma<0)return!1;var ga;if(ga=oi({x:Math.floor(mo/te.pickBufferScale),y:Math.floor((ma-(ft+1)*_e.SO.DPR)/te.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:te.pickingFBO}),ga[0]!==0||ga[1]!==0||ga[2]!==0){var aa=(0,_e.W0)(ga),pa=k.getSource().getFeatureById(aa);aa!==k.getCurrentPickId()&&Tt==="mousemove"&&(Tt="mouseenter");var Ua={x:Ae,y:ft,type:Tt,lngLat:Vt,featureId:aa,feature:pa,target:qt};pa&&(Lr=!0,k.setCurrentPickId(aa),te.triggerHoverOnLayer(k,Ua))}else{var Za={x:Ae,y:ft,lngLat:Vt,type:k.getCurrentPickId()!==null&&Tt==="mousemove"?"mouseout":"un"+Tt,featureId:null,target:qt,feature:null};te.triggerHoverOnLayer(k,be(be({},Za),{},{type:"unpick"})),te.triggerHoverOnLayer(k,Za),k.setCurrentPickId(null)}if(ro&&te.highlightPickedFeature(k,ga),Oa&&Tt==="click"&&((ie=ga)===null||ie===void 0?void 0:ie.toString())!==[0,0,0,0].toString()){var ko=(0,_e.W0)(ga);k.getCurrentSelectedId()===null||ko!==k.getCurrentSelectedId()?(te.selectFeature(k,ga),k.setCurrentSelectedId(ko)):(te.selectFeature(k,new Uint8Array([0,0,0,0])),k.setCurrentSelectedId(null))}return Lr})}return(0,I.Z)(q,[{key:"init",value:function(k){var F=this.rendererService,ie=F.createTexture2D,Ae=F.createFramebuffer,ft=F.getViewportSize,Vt=F.getContainer,Tt=Vt().getBoundingClientRect(),qt=Tt.width,Lr=Tt.height;qt*=_e.SO.DPR,Lr*=_e.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(k).pickBufferScale||1,this.pickingFBO=Ae({color:ie({width:Math.round(qt/this.pickBufferScale),height:Math.round(Lr/this.pickBufferScale),wrapS:zi.gl.CLAMP_TO_EDGE,wrapT:zi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(ai.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var te=(0,Vo.Z)(gi().mark(function F(ie,Ae,ft){var Vt=this,Tt,qt,Lr,In;return gi().wrap(function(oi){for(;;)switch(oi.prev=oi.next){case 0:Tt=this.rendererService,qt=Tt.useFramebuffer,Lr=Tt.clear,In=Tt.getContainer,this.resizePickingFBO(),qt(this.pickingFBO,function(){Lr({framebuffer:Vt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),ie.hooks.beforePickingEncode.call(),ie.renderModels(),ie.hooks.afterPickingEncode.call();var ui=Vt.pickBox(ie,Ae);ft(ui)});case 3:case"end":return oi.stop()}},F,this)}));function k(F,ie,Ae){return te.apply(this,arguments)}return k}()},{key:"pickBox",value:function(k,F){var ie=this,Ae=F.map(function(Za){var ko=Za<0?0:Za;return Math.floor(ko*_e.SO.DPR/ie.pickBufferScale)}),ft=(0,Qt.Z)(Ae,4),Vt=ft[0],Tt=ft[1],qt=ft[2],Lr=ft[3],In=this.rendererService,Fn=In.getViewportSize,oi=In.readPixels,ui=In.getContainer,mi=ui().getBoundingClientRect(),Gi=mi.width,ma=mi.height;if(Gi*=_e.SO.DPR,ma*=_e.SO.DPR,Vt>(Gi-1)*_e.SO.DPR/this.pickBufferScale||qt<0||Tt>(ma-1)*_e.SO.DPR/this.pickBufferScale||Lr<0)return[];var ya,ro=Math.min(Gi/this.pickBufferScale,qt)-Vt,Oa=Math.min(ma/this.pickBufferScale,Lr)-Tt;ya=oi({x:Vt,y:Math.floor(ma/this.pickBufferScale-(Lr+1)),width:ro,height:Oa,data:new Uint8Array(ro*Oa*4),framebuffer:this.pickingFBO});for(var mo=[],Ma={},ga=0;ga<ya.length/4;ga=ga+1){var aa=ya.slice(ga*4,ga*4+4),pa=(0,_e.W0)(aa);if(pa!==-1&&!Ma[pa]){var Ua=k.getSource().getFeatureById(pa);mo.push(Ua),Ma[pa]=!0}}return mo}},{key:"pickingAllLayer",value:function(){var te=(0,Vo.Z)(gi().mark(function F(ie){return gi().wrap(function(ft){for(;;)switch(ft.prev=ft.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){ft.next=2;break}return ft.abrupt("return");case 2:return this.alreadyInPicking=!0,ft.next=5,this.pickingLayers(ie);case 5:this.layerService.renderLayers("picking"),this.alreadyInPicking=!1;case 7:case"end":return ft.stop()}},F,this)}));function k(F){return te.apply(this,arguments)}return k}()},{key:"resizePickingFBO",value:function(){var k=this.rendererService.getContainer,F=k().getBoundingClientRect(),ie=F.width,Ae=F.height;ie*=_e.SO.DPR,Ae*=_e.SO.DPR,(this.width!==ie||this.height!==Ae)&&(this.pickingFBO.resize({width:Math.round(ie/this.pickBufferScale),height:Math.round(Ae/this.pickBufferScale)}),this.width=ie,this.height=Ae)}},{key:"pickingLayers",value:function(){var te=(0,Vo.Z)(gi().mark(function F(ie){var Ae=this,ft,Vt,Tt,qt,Lr;return gi().wrap(function(Fn){for(;;)switch(Fn.prev=Fn.next){case 0:ft=this.rendererService,Vt=ft.getViewportSize,Tt=ft.useFramebuffer,qt=ft.clear,Lr=ft.getContainer,this.resizePickingFBO(),Tt(this.pickingFBO,function(){var oi=Ae.layerService.getLayers();oi.filter(function(ui){return ui.needPick(ie.type)}).reverse().some(function(ui){qt({framebuffer:Ae.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),ui.hooks.beforePickingEncode.call(),ui.renderModels(),ui.hooks.afterPickingEncode.call();var mi=Ae.pickFromPickingFBO(ui,ie);return mi&&!ui.getLayerConfig().enablePropagation})});case 3:case"end":return Fn.stop()}},F,this)}));function k(F){return te.apply(this,arguments)}return k}()},{key:"triggerHoverOnLayer",value:function(k,F){k.emit(F.type,F),Io(F)&&k.emit(F.type,F)}},{key:"highlightPickedFeature",value:function(k,F){var ie=(0,Qt.Z)(F,3),Ae=ie[0],ft=ie[1],Vt=ie[2];k.hooks.beforeHighlight.call([Ae,ft,Vt])}},{key:"selectFeature",value:function(k,F){var ie=(0,Qt.Z)(F,3),Ae=ie[0],ft=ie[1],Vt=ie[2];k.hooks.beforeSelect.call([Ae,ft,Vt])}}]),q}(),Yi=(0,Te.Z)(fo.prototype,"rendererService",[Go],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Da=(0,Te.Z)(fo.prototype,"configService",[ea],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ka=(0,Te.Z)(fo.prototype,"interactionService",[To],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fs=(0,Te.Z)(fo.prototype,"layerService",[Oo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fo))||co),pt=function(){function q(){var te=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,H.Z)(this,q),(0,L.Z)(this,"autoStart",void 0),(0,L.Z)(this,"startTime",0),(0,L.Z)(this,"oldTime",0),(0,L.Z)(this,"running",!1),(0,L.Z)(this,"elapsedTime",0),this.autoStart=te}return(0,I.Z)(q,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var k=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var F=(typeof performance=="undefined"?Date:performance).now();k=(F-this.oldTime)/1e3,this.oldTime=F,this.elapsedTime+=k}return k}}]),q}(),rr,Xr,Kn,vi,Ga,ao,oo,hs=(rr=(0,E.b2)(),Xr=(0,E.f3)(V.v.IRendererService),Kn=(0,E.f3)(V.v.IGlobalConfigService),rr(vi=(Ga=function(){function q(){(0,H.Z)(this,q),(0,L.Z)(this,"clock",new pt),(0,L.Z)(this,"alreadyInRendering",!1),(0,L.Z)(this,"layers",[]),(0,L.Z)(this,"layerRenderID",void 0),(0,L.Z)(this,"sceneInited",!1),(0,L.Z)(this,"animateInstanceCount",0),(0,L.Z)(this,"lastRenderType",void 0),(0,ue.Z)(this,"renderService",ao,this),(0,ue.Z)(this,"configService",oo,this)}return(0,I.Z)(q,[{key:"add",value:function(k){this.sceneInited&&k.init(),this.layers.push(k)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(k){k.inited||k.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(k){return this.layers.find(function(F){return F.id===k})}},{key:"getLayerByName",value:function(k){return this.layers.find(function(F){return F.name===k})}},{key:"remove",value:function(k){var F=this.layers.indexOf(k);F>-1&&this.layers.splice(F,1),k.emit("remove",null),k.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(k){!this.renderTest(k)||this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(F){return F.inited}).filter(function(F){return F.isVisible()}).forEach(function(F){F.hooks.beforeRenderData.call(),F.hooks.beforeRender.call(),F.render(),F.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(k,F){return k.zIndex-F.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(k){return k.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"renderTest",value:function(k){if(k)switch(k){case"picking":return this.lastRenderType==="mapRender"||this.lastRenderType==="animate"?(this.lastRenderType="picking",!1):(this.lastRenderType="picking",!0);case"animate":return this.lastRenderType==="mapRender"?(this.lastRenderType="animate",!1):(this.lastRenderType="animate",!0);case"mapRender":return this.lastRenderType="mapRender",!0;default:return!0}return!0}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers("animate"),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),q}(),ao=(0,Te.Z)(Ga.prototype,"renderService",[Xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oo=(0,Te.Z)(Ga.prototype,"configService",[Kn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ga))||vi),Xs=g(81253),ws=g(85061),_o=g(14293),rs=g.n(_o),Ho=function(){function q(te){var k=this;(0,H.Z)(this,q),(0,L.Z)(this,"name",void 0),(0,L.Z)(this,"type",void 0),(0,L.Z)(this,"scale",void 0),(0,L.Z)(this,"descriptor",void 0),(0,L.Z)(this,"featureBufferLayout",[]),(0,L.Z)(this,"needRescale",!1),(0,L.Z)(this,"needRemapping",!1),(0,L.Z)(this,"needRegenerateVertices",!1),(0,L.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,L.Z)(this,"vertexAttribute",void 0),(0,L.Z)(this,"defaultCallback",function(F){if(F.length===0){var ie;return((ie=k.scale)===null||ie===void 0?void 0:ie.defaultValues)||[]}return F.map(function(Ae,ft){var Vt,Tt=(Vt=k.scale)===null||Vt===void 0?void 0:Vt.scalers[ft].func,qt=Tt(Ae);return qt})}),this.setProps(te)}return(0,I.Z)(q,[{key:"setProps",value:function(k){Object.assign(this,k)}},{key:"mapping",value:function(k){var F;if((F=this.scale)!==null&&F!==void 0&&F.callback){var ie,Ae=(ie=this.scale)===null||ie===void 0?void 0:ie.callback.apply(ie,(0,ws.Z)(k));if(!rs()(Ae))return[Ae]}return this.defaultCallback(k)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),q}(),Lo,xo,Si,Ds,ns,ps;function wa(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function vo(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?wa(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):wa(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}function ju(q){return new Promise(function(te){return setTimeout(te,q)})}var Sl=(Lo={},(0,L.Z)(Lo,zi.gl.FLOAT,4),(0,L.Z)(Lo,zi.gl.UNSIGNED_BYTE,1),(0,L.Z)(Lo,zi.gl.UNSIGNED_SHORT,2),Lo),wu=(xo=(0,E.b2)(),Si=(0,E.f3)(V.v.IRendererService),xo(Ds=(ns=function(){function q(){(0,H.Z)(this,q),(0,L.Z)(this,"attributesAndIndices",void 0),(0,ue.Z)(this,"rendererService",ps,this),(0,L.Z)(this,"attributes",[]),(0,L.Z)(this,"triangulation",void 0),(0,L.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,I.Z)(q,[{key:"registerStyleAttribute",value:function(k){var F=this.getLayerStyleAttribute(k.name||"");return F?F.setProps(k):(F=new Ho(k),this.attributes.push(F)),F}},{key:"updateStyleAttribute",value:function(k,F,ie){var Ae=this.getLayerStyleAttribute(k);Ae||(Ae=this.registerStyleAttribute(vo(vo({},F),{},{name:k})));var ft=F.scale;ft&&Ae&&(Ae.scale=ft,Ae.needRescale=!0,Ae.needRemapping=!0,Ae.needRegenerateVertices=!0,ie&&ie.featureRange&&(Ae.featureRange=ie.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(k){return this.attributes.find(function(F){return F.name===k})}},{key:"getLayerAttributeScale",value:function(k){var F,ie=this.getLayerStyleAttribute(k),Ae=ie==null||(F=ie.scale)===null||F===void 0?void 0:F.scalers;return Ae&&Ae[0]?Ae[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(k,F){var ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,Ae=arguments.length>3?arguments[3]:void 0,ft=this.attributes.find(function(Oa){return Oa.name===k});if(ft&&ft.descriptor){var Vt=ft.descriptor,Tt=Vt.update,qt=Vt.buffer,Lr=Vt.size,In=Lr===void 0?0:Lr,Fn=Sl[qt.type||zi.gl.FLOAT];if(Tt){var oi=this.featureLayout,ui=oi.elements,mi=oi.sizePerElement,Gi=ui.slice(ie,Ae);if(!Gi.length)return;var ma=Gi[0].offset,ya=ma*In*Fn,ro=Gi.map(function(Oa,mo){for(var Ma=Oa.featureIdx,ga=Oa.vertices,aa=Oa.normals,pa=ga.length/mi,Ua=[],Za=0;Za<pa;Za++){var ko=aa?aa.slice(Za*3,Za*3+3):[];Ua.push.apply(Ua,(0,ws.Z)(Tt(F[Ma],Ma,ga.slice(Za*mi,Za*mi+mi),mo,ko)))}return Ua}).reduce(function(Oa,mo){return Oa.push.apply(Oa,(0,ws.Z)(mo)),Oa},[]);ft.vertexAttribute.updateBuffer({data:ro,offset:ya})}}}},{key:"createAttributesAndIndices",value:function(k,F,ie){var Ae=this;this.featureLayout={sizePerElement:0,elements:[]},F&&(this.triangulation=F);var ft=this.attributes.map(function(ya){return ya.resetDescriptor(),ya.descriptor}),Vt=0,Tt=[],qt=[],Lr=[],In=3;k.forEach(function(ya,ro){var Oa=Ae.triangulation(ya,ie),mo=Oa.indices,Ma=Oa.vertices,ga=Oa.normals,aa=Oa.size;mo.forEach(function(ko){qt.push(ko+Vt)}),In=aa;var pa=Ma.length/aa;Ae.featureLayout.sizePerElement=In,Ae.featureLayout.elements.push({featureIdx:ro,vertices:Ma,normals:ga,offset:Vt}),Vt+=pa;for(var Ua=function(ji){var Xo=(ga==null?void 0:ga.slice(ji*3,ji*3+3))||[],Fo=Ma.slice(ji*aa,ji*aa+aa);ft.forEach(function(Yo,Sc){if(Yo&&Yo.update){var zu;(zu=Yo.buffer.data).push.apply(zu,(0,ws.Z)(Yo.update(ya,ro,Fo,ji,Xo)))}})},Za=0;Za<pa;Za++)Ua(Za)});var Fn=this.rendererService,oi=Fn.createAttribute,ui=Fn.createBuffer,mi=Fn.createElements,Gi={};ft.forEach(function(ya,ro){if(ya){var Oa=ya.buffer,mo=ya.update,Ma=ya.name,ga=(0,Xs.Z)(ya,["buffer","update","name"]),aa=oi(vo({buffer:ui(Oa)},ga));Gi[ya.name||""]=aa,Ae.attributes[ro].vertexAttribute=aa}});var ma=mi({data:qt,type:zi.gl.UNSIGNED_INT,count:qt.length});return this.attributesAndIndices={attributes:Gi,elements:ma},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var k;this.attributes.forEach(function(F){F.vertexAttribute&&F.vertexAttribute.destroy()}),(k=this.attributesAndIndices)===null||k===void 0||k.elements.destroy(),this.attributes=[]}}]),q}(),ps=(0,Te.Z)(ns.prototype,"rendererService",[Si],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ns))||Ds),Ul=g(46343),Vu=g(67709),Tu=g.n(Vu),Na,Gu,m,w,W,R,le,Le,ct,Nt,kt,Tr,Gr,Jn,Mi,ci,Ti,Ui,Fa,ta,ds,bo,Ts,iu,Ns,il,Ys,Ks,$s,so,Au,al,is;function Zl(q){var te=au();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function au(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var zs=(Na=(0,E.b2)(),Gu=(0,E.f3)(V.v.SceneID),m=(0,E.f3)(V.v.IIconService),w=(0,E.f3)(V.v.IFontService),W=(0,E.f3)(V.v.IControlService),R=(0,E.f3)(V.v.IGlobalConfigService),le=(0,E.f3)(V.v.IMapService),Le=(0,E.f3)(V.v.ICoordinateSystemService),ct=(0,E.f3)(V.v.IRendererService),Nt=(0,E.f3)(V.v.ILayerService),kt=(0,E.f3)(V.v.ICameraService),Tr=(0,E.f3)(V.v.IInteractionService),Gr=(0,E.f3)(V.v.IPickingService),Jn=(0,E.f3)(V.v.IShaderModuleService),Mi=(0,E.f3)(V.v.IMarkerService),ci=(0,E.f3)(V.v.IPopupService),Na(Ti=(Ui=function(q){(0,Ft.Z)(k,q);var te=Zl(k);function k(){var F;return(0,H.Z)(this,k),F=te.call(this),(0,L.Z)((0,ke.Z)(F),"destroyed",!1),(0,L.Z)((0,ke.Z)(F),"loaded",!1),(0,L.Z)((0,ke.Z)(F),"loadFont",!1),(0,L.Z)((0,ke.Z)(F),"fontFamily",""),(0,ue.Z)((0,ke.Z)(F),"id",Fa,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"iconService",ta,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"fontService",ds,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"controlService",bo,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"configService",Ts,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"map",iu,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"coordinateSystemService",Ns,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"rendererService",il,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"layerService",Ys,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"cameraService",Ks,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"interactionService",$s,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"pickingService",so,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"shaderModuleService",Au,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"markerService",al,(0,ke.Z)(F)),(0,ue.Z)((0,ke.Z)(F),"popupService",is,(0,ke.Z)(F)),(0,L.Z)((0,ke.Z)(F),"inited",!1),(0,L.Z)((0,ke.Z)(F),"initPromise",void 0),(0,L.Z)((0,ke.Z)(F),"rendering",!1),(0,L.Z)((0,ke.Z)(F),"$container",void 0),(0,L.Z)((0,ke.Z)(F),"canvas",void 0),(0,L.Z)((0,ke.Z)(F),"markerContainer",void 0),(0,L.Z)((0,ke.Z)(F),"hooks",void 0),(0,L.Z)((0,ke.Z)(F),"handleWindowResized",function(){F.emit("resize"),F.$container&&(F.initContainer(),_e.SO.triggerResize(),F.coordinateSystemService.needRefresh=!0,F.render())}),(0,L.Z)((0,ke.Z)(F),"handleMapCameraChanged",function(ie){F.cameraService.update(ie),F.render("mapRender")}),F.hooks={init:new Ul.zj},F}return(0,I.Z)(k,[{key:"init",value:function(ie){var Ae=this;this.configService.setSceneConfig(this.id,ie),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Vo.Z)(gi().mark(function ft(){return gi().wrap(function(Tt){for(;;)switch(Tt.prev=Tt.next){case 0:return Tt.next=2,new Promise(function(qt){Ae.map.onCameraChanged(function(Lr){Ae.cameraService.init(),Ae.cameraService.update(Lr),Ae.map.version!=="GAODE2.x"&&qt()}),Ae.map.version!=="GAODE2.x"?Ae.map.init():qt()});case 2:if(!(Ae.map.version==="GAODE2.x"&&Ae.map.initViewPort)){Tt.next=6;break}return Tt.next=5,Ae.map.init();case 5:Ae.map.initViewPort();case 6:Ae.map.onCameraChanged(Ae.handleMapCameraChanged),Ae.map.addMarkerContainer(),Ae.markerService.addMarkers(),Ae.markerService.addMarkerLayers(),Ae.popupService.initPopup(),Ae.interactionService.init(),Ae.interactionService.on(ai.s.Drag,Ae.addSceneEvent.bind(Ae));case 13:case"end":return Tt.stop()}},ft)}))),this.hooks.init.tapPromise("initRenderer",(0,Vo.Z)(gi().mark(function ft(){var Vt;return gi().wrap(function(qt){for(;;)switch(qt.prev=qt.next){case 0:if(Vt=Aa(Ae.configService.getSceneConfig(Ae.id).id||""),Ae.$container=Vt,!Vt){qt.next=11;break}return Ae.canvas=_e.SO.create("canvas","",Vt),Ae.setCanvas(),qt.next=7,Ae.rendererService.init(Ae.canvas,Ae.configService.getSceneConfig(Ae.id));case 7:Tu()(Ae.$container,Ae.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(Ae.handleWindowResized),qt.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:Ae.pickingService.init(Ae.id);case 13:case"end":return qt.stop()}},ft)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(ie){this.layerService.add(ie),this.render()}},{key:"render",value:function(){var F=(0,Vo.Z)(gi().mark(function Ae(ft){return gi().wrap(function(Tt){for(;;)switch(Tt.prev=Tt.next){case 0:if(!(this.rendering||this.destroyed)){Tt.next=2;break}return Tt.abrupt("return");case 2:if(this.rendering=!0,this.inited){Tt.next=15;break}return Tt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){Tt.next=10;break}return Tt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(ft),this.rendering=!1;case 17:case"end":return Tt.stop()}},Ae,this)}));function ie(Ae){return F.apply(this,arguments)}return ie}()},{key:"addFontFace",value:function(ie,Ae){this.fontFamily=ie;var ft=document.createElement("style");ft.type="text/css",ft.innerText=`
        @font-face{
            font-family: '`.concat(ie,`';
            src: url('`).concat(Ae,`') format('woff2'),
            url('`).concat(Ae,`') format('woff'),
            url('`).concat(Ae,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(ft),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(ie){var Ae,ft=(Ae=this.$container)===null||Ae===void 0?void 0:Ae.getElementsByTagName("canvas")[0];this.render();var Vt=ie==="jpg"?ft==null?void 0:ft.toDataURL("image/jpeg"):ft==null?void 0:ft.toDataURL("image/png");return Vt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var ie=this.$container.parentElement;ie!==null&&(this.markerContainer=_e.SO.create("div","l7-marker-container",ie))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,Vu.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var ie,Ae,ft=_e.SO.DPR,Vt=((ie=this.$container)===null||ie===void 0?void 0:ie.clientWidth)||400,Tt=((Ae=this.$container)===null||Ae===void 0?void 0:Ae.clientHeight)||300,qt=this.canvas;qt&&(qt.width=Vt*ft,qt.height=Tt*ft,qt.style.width="".concat(Vt,"px"),qt.style.height="".concat(Tt,"px")),this.rendererService.viewport({x:0,y:0,width:ft*Vt,height:ft*Tt})}},{key:"setCanvas",value:function(){var ie,Ae,ft=_e.SO.DPR,Vt=((ie=this.$container)===null||ie===void 0?void 0:ie.clientWidth)||400,Tt=((Ae=this.$container)===null||Ae===void 0?void 0:Ae.clientHeight)||300,qt=this.canvas;qt.width=Vt*ft,qt.height=Tt*ft,qt.style.width="".concat(Vt,"px"),qt.style.height="".concat(Tt,"px")}},{key:"addSceneEvent",value:function(ie){this.emit(ie.type,ie)}}]),k}(b.EventEmitter),Fa=(0,Te.Z)(Ui.prototype,"id",[Gu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ta=(0,Te.Z)(Ui.prototype,"iconService",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ds=(0,Te.Z)(Ui.prototype,"fontService",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bo=(0,Te.Z)(Ui.prototype,"controlService",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ts=(0,Te.Z)(Ui.prototype,"configService",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iu=(0,Te.Z)(Ui.prototype,"map",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ns=(0,Te.Z)(Ui.prototype,"coordinateSystemService",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),il=(0,Te.Z)(Ui.prototype,"rendererService",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ys=(0,Te.Z)(Ui.prototype,"layerService",[Nt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ks=(0,Te.Z)(Ui.prototype,"cameraService",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$s=(0,Te.Z)(Ui.prototype,"interactionService",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),so=(0,Te.Z)(Ui.prototype,"pickingService",[Gr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Au=(0,Te.Z)(Ui.prototype,"shaderModuleService",[Jn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),al=(0,Te.Z)(Ui.prototype,"markerService",[Mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),is=(0,Te.Z)(Ui.prototype,"popupService",[ci],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ui))||Ti),cc=g(44908),Pu=g.n(cc);function Pa(q){var te=0;switch(q){case"vec2":case"ivec2":te=2;break;case"vec3":case"ivec3":te=3;break;case"vec4":case"ivec4":case"mat2":te=4;break;case"mat3":te=9;break;case"mat4":te=16;break;default:}return te}var Hu=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function jl(q){var te={};return q=q.replace(Hu,function(k,F,ie){var Ae=ie.split(":"),ft=Ae[0].trim(),Vt="";switch(Ae.length>1&&(Vt=Ae[1].trim()),F){case"bool":Vt=Vt==="true";break;case"float":case"int":Vt=Number(Vt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":Vt?Vt=Vt.replace("[","").replace("]","").split(",").reduce(function(Tt,qt){return Tt.push(Number(qt.trim())),Tt},[]):Vt=new Array(Pa(F)).fill(0);break;default:}return te[ft]=Vt,"uniform ".concat(F," ").concat(ft,`;
`)}),{content:q,uniforms:te}}var Mu,fc;function hf(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function El(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?hf(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):hf(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}var hc="#define PI 3.14159265359",Cl=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,vu=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,ol=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,sl=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,Wu=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,ul=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Xu=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Us=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,pc=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,dc=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,kc=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Yu=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,wl=/precision\s+(high|low|medium)p\s+float/,Vl=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,vc=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Gl=(Mu=(0,E.b2)(),Mu(fc=function(){function q(){(0,H.Z)(this,q),(0,L.Z)(this,"moduleCache",{}),(0,L.Z)(this,"rawContentCache",{})}return(0,I.Z)(q,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:hc,fs:hc}),this.registerModule("decode",{vs:Cl,fs:""}),this.registerModule("projection",{vs:Xu,fs:""}),this.registerModule("project",{vs:ul,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Us}),this.registerModule("lighting",{vs:ol,fs:""}),this.registerModule("light",{vs:vu,fs:""}),this.registerModule("picking",{vs:Wu,fs:sl}),this.registerModule("styleMapping",{vs:pc,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:dc,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:kc,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Yu,fs:""})}},{key:"registerModule",value:function(k,F){if(!this.rawContentCache[k]){var ie=F.vs,Ae=F.fs,ft=F.uniforms,Vt=jl(ie),Tt=Vt.content,qt=Vt.uniforms,Lr=jl(Ae),In=Lr.content,Fn=Lr.uniforms;this.rawContentCache[k]={fs:In,uniforms:El(El(El({},qt),Fn),ft),vs:Tt}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(k){var F=this;if(this.moduleCache[k])return this.moduleCache[k];var ie=this.rawContentCache[k].vs,Ae=this.rawContentCache[k].fs,ft=this.processModule(ie,[],"vs"),Vt=ft.content,Tt=ft.includeList,qt=this.processModule(Ae,[],"fs"),Lr=qt.content,In=qt.includeList,Fn=Lr,oi=Pu()(Tt.concat(In).concat(k)).reduce(function(ui,mi){return El(El({},ui),F.rawContentCache[mi].uniforms)},{});return wl.test(Lr)||(Fn=Vl+Lr),this.moduleCache[k]={fs:Fn.trim(),uniforms:oi,vs:Vt.trim()},this.moduleCache[k]}},{key:"processModule",value:function(k,F,ie){var Ae=this,ft=k.replace(vc,function(Vt,Tt){var qt=Tt.split(" "),Lr=qt[0].replace(/"/g,"");if(F.indexOf(Lr)>-1)return"";var In=Ae.rawContentCache[Lr][ie];F.push(Lr);var Fn=Ae.processModule(In,F,ie),oi=Fn.content;return oi});return{content:ft,includeList:F}}}]),q}())||fc),Hl=g(66213),Iu=g(92364),Ou,Wl,Ha,mu,Xl,ll=(Ou=(0,E.b2)(),Wl=(0,E.f3)(V.v.IShaderModuleService),Ou(Ha=(mu=function(){function q(){(0,H.Z)(this,q),(0,ue.Z)(this,"shaderModuleService",Xl,this),(0,L.Z)(this,"rendererService",void 0),(0,L.Z)(this,"cameraService",void 0),(0,L.Z)(this,"mapService",void 0),(0,L.Z)(this,"interactionService",void 0),(0,L.Z)(this,"layerService",void 0),(0,L.Z)(this,"config",void 0)}return(0,I.Z)(q,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Iu.G.Normal}},{key:"init",value:function(k,F){this.config=F,this.rendererService=k.getContainer().get(V.v.IRendererService),this.cameraService=k.getContainer().get(V.v.ICameraService),this.mapService=k.getContainer().get(V.v.IMapService),this.interactionService=k.getContainer().get(V.v.IInteractionService),this.layerService=k.getContainer().get(V.v.ILayerService)}},{key:"render",value:function(k){}}]),q}(),Xl=(0,Te.Z)(mu.prototype,"shaderModuleService",[Wl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mu))||Ha),Yl,Lu;function Kc(q){var te=cl();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function cl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var to=(Yl=(0,E.b2)(),Yl(Lu=function(q){(0,Ft.Z)(k,q);var te=Kc(k);function k(){return(0,H.Z)(this,k),te.apply(this,arguments)}return(0,I.Z)(k,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(ie,Ae){(0,Hl.Z)((0,T.Z)(k.prototype),"init",this).call(this,ie,Ae)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),k}(ll))||Lu),fl,Ku,ou,ra,za;function _s(q,te){var k=typeof Symbol!="undefined"&&q[Symbol.iterator]||q["@@iterator"];if(!k){if(Array.isArray(q)||(k=Kl(q))||te&&q&&typeof q.length=="number"){k&&(q=k);var F=0,ie=function(){};return{s:ie,n:function(){return F>=q.length?{done:!0}:{done:!1,value:q[F++]}},e:function(qt){throw qt},f:ie}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ae=!0,ft=!1,Vt;return{s:function(){k=k.call(q)},n:function(){var qt=k.next();return Ae=qt.done,qt},e:function(qt){ft=!0,Vt=qt},f:function(){try{!Ae&&k.return!=null&&k.return()}finally{if(ft)throw Vt}}}}function Kl(q,te){if(!!q){if(typeof q=="string")return yu(q,te);var k=Object.prototype.toString.call(q).slice(8,-1);if(k==="Object"&&q.constructor&&(k=q.constructor.name),k==="Map"||k==="Set")return Array.from(q);if(k==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(k))return yu(q,te)}}function yu(q,te){(te==null||te>q.length)&&(te=q.length);for(var k=0,F=new Array(te);k<te;k++)F[k]=q[k];return F}var $l=(fl=(0,E.b2)(),Ku=(0,E.f3)(V.v.IPostProcessor),fl(ou=(ra=function(){function q(){(0,H.Z)(this,q),(0,L.Z)(this,"passes",[]),(0,ue.Z)(this,"postProcessor",za,this),(0,L.Z)(this,"layer",void 0),(0,L.Z)(this,"renderFlag",void 0),(0,L.Z)(this,"width",0),(0,L.Z)(this,"height",0)}return(0,I.Z)(q,[{key:"setLayer",value:function(k){this.layer=k}},{key:"setRenderFlag",value:function(k){this.renderFlag=k}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var te=(0,Vo.Z)(gi().mark(function F(){var ie,Ae,ft;return gi().wrap(function(Tt){for(;;)switch(Tt.prev=Tt.next){case 0:ie=_s(this.passes),Tt.prev=1,ie.s();case 3:if((Ae=ie.n()).done){Tt.next=9;break}return ft=Ae.value,Tt.next=7,ft.render(this.layer);case 7:Tt.next=3;break;case 9:Tt.next=14;break;case 11:Tt.prev=11,Tt.t0=Tt.catch(1),ie.e(Tt.t0);case 14:return Tt.prev=14,ie.f(),Tt.finish(14);case 17:this.layer.renderModels();case 18:case"end":return Tt.stop()}},F,this,[[1,11,14,17]])}));function k(){return te.apply(this,arguments)}return k}()},{key:"resize",value:function(k,F){(this.width!==k||this.height!==F)&&(this.width=k,this.height=F)}},{key:"add",value:function(k,F){k.getType()===Iu.G.PostProcessing?this.postProcessor.add(k,this.layer,F):(k.init(this.layer,F),this.passes.push(k))}},{key:"insert",value:function(k,F,ie){k.init(this.layer,F),this.passes.splice(ie,0,k)}},{key:"destroy",value:function(){this.passes.length=0}}]),q}(),za=(0,Te.Z)(ra.prototype,"postProcessor",[Ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ra))||ou),$c,Jc;function Tl(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function Al(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?Tl(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):Tl(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}function Ru(q){var te=Ro();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function Ro(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var Pl=($c=(0,E.b2)(),$c(Jc=function(q){(0,Ft.Z)(k,q);var te=Ru(k);function k(){var F;(0,H.Z)(this,k);for(var ie=arguments.length,Ae=new Array(ie),ft=0;ft<ie;ft++)Ae[ft]=arguments[ft];return F=te.call.apply(te,[this].concat(Ae)),(0,L.Z)((0,ke.Z)(F),"pickingFBO",void 0),(0,L.Z)((0,ke.Z)(F),"layer",void 0),(0,L.Z)((0,ke.Z)(F),"width",0),(0,L.Z)((0,ke.Z)(F),"height",0),(0,L.Z)((0,ke.Z)(F),"alreadyInRendering",!1),(0,L.Z)((0,ke.Z)(F),"pickFromPickingFBO",function(Vt){var Tt=Vt.x,qt=Vt.y,Lr=Vt.lngLat,In=Vt.type;if(!(!F.layer.isVisible()||!F.layer.needPick(In))){var Fn=F.rendererService,oi=Fn.getViewportSize,ui=Fn.readPixels,mi=Fn.useFramebuffer,Gi=oi(),ma=Gi.width,ya=Gi.height,ro=F.layer.getLayerConfig(),Oa=ro.enableHighlight,mo=ro.enableSelect,Ma=Tt*_e.SO.DPR,ga=qt*_e.SO.DPR;if(!(Ma>ma||Ma<0||ga>ya||ga<0)){var aa;mi(F.pickingFBO,function(){var pa;if(aa=ui({x:Math.round(Ma),y:Math.round(ya-(qt+1)*_e.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:F.pickingFBO}),aa[0]!==0||aa[1]!==0||aa[2]!==0){var Ua=(0,_e.W0)(aa),Za=F.layer.getSource().getFeatureById(Ua),ko={x:Tt,y:qt,type:In,lngLat:Lr,featureId:Ua,feature:Za};Za&&(F.layer.setCurrentPickId(Ua),F.triggerHoverOnLayer(ko))}else{var ji={x:Tt,y:qt,lngLat:Lr,type:F.layer.getCurrentPickId()===null?"un"+In:"mouseout",featureId:null,feature:null};F.triggerHoverOnLayer(Al(Al({},ji),{},{type:"unpick"})),F.triggerHoverOnLayer(ji),F.layer.setCurrentPickId(null)}Oa&&F.highlightPickedFeature(aa),mo&&In==="click"&&((pa=aa)===null||pa===void 0?void 0:pa.toString())!==[0,0,0,0].toString()&&F.selectFeature(aa)})}}}),F}return(0,I.Z)(k,[{key:"getType",value:function(){return Iu.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(ie,Ae){(0,Hl.Z)((0,T.Z)(k.prototype),"init",this).call(this,ie,Ae),this.layer=ie;var ft=this.rendererService,Vt=ft.createTexture2D,Tt=ft.createFramebuffer,qt=ft.getViewportSize,Lr=qt(),In=Lr.width,Fn=Lr.height;this.pickingFBO=Tt({color:Vt({width:In,height:Fn,wrapS:zi.gl.CLAMP_TO_EDGE,wrapT:zi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(ai.s.Hover,this.pickFromPickingFBO),this.interactionService.on(ai.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ai.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(ie){var Ae=this;if(!this.alreadyInRendering){var ft=this.rendererService,Vt=ft.getViewportSize,Tt=ft.useFramebuffer,qt=ft.clear,Lr=Vt(),In=Lr.width,Fn=Lr.height;this.alreadyInRendering=!0,(this.width!==In||this.height!==Fn)&&(this.pickingFBO.resize({width:In,height:Fn}),this.width=In,this.height=Fn),Tt(this.pickingFBO,function(){qt({framebuffer:Ae.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var oi=Ae.layer.multiPassRenderer.getRenderFlag();Ae.layer.multiPassRenderer.setRenderFlag(!1),ie.hooks.beforePickingEncode.call(),ie.render(),ie.hooks.afterPickingEncode.call(),Ae.layer.multiPassRenderer.setRenderFlag(oi),Ae.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(ie){this.layer.emit(ie.type,ie)}},{key:"highlightPickedFeature",value:function(ie){var Ae=(0,Qt.Z)(ie,3),ft=Ae[0],Vt=Ae[1],Tt=Ae[2];this.layer.hooks.beforeHighlight.call([ft,Vt,Tt]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(ie){var Ae=(0,Qt.Z)(ie,3),ft=Ae[0],Vt=Ae[1],Tt=Ae[2];this.layer.hooks.beforeSelect.call([ft,Vt,Tt]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(ie){var Ae=ie.featureId,ft=(0,_e.Z6)(Ae);this.selectFeature(new Uint8Array(ft))}},{key:"highlightFeatureHandle",value:function(ie){var Ae=ie.featureId,ft=(0,_e.Z6)(Ae);this.highlightPickedFeature(new Uint8Array(ft))}}]),k}(ll))||Jc),Zs=g(69530),So,kn;function ho(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function gu(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?ho(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):ho(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}function hl(q){var te=Js();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function Js(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var As=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,mc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,mn=(So=(0,E.b2)(),So(kn=function(q){(0,Ft.Z)(k,q);var te=hl(k);function k(){return(0,H.Z)(this,k),te.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:mc,fs:As});var ie=this.shaderModuleService.getModule("blur-pass"),Ae=ie.vs,ft=ie.fs,Vt=ie.uniforms,Tt=this.rendererService.getViewportSize(),qt=Tt.width,Lr=Tt.height;return{vs:Ae,fs:ft,uniforms:gu(gu({},Vt),{},{u_ViewportSize:[qt,Lr]})}}},{key:"convertOptionsToUniforms",value:function(ie){var Ae={};return rs()(ie.blurRadius)||(Ae.u_BlurDir=[ie.blurRadius,0]),Ae}}]),k}(Zs.Z))||kn),Jl,Ql;function Du(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function ja(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?Du(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):Du(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}function Ps(q){var te=ql();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function ql(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var _u=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Ms=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xu=(Jl=(0,E.b2)(),Jl(Ql=function(q){(0,Ft.Z)(k,q);var te=Ps(k);function k(){return(0,H.Z)(this,k),te.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Ms,fs:_u});var ie=this.shaderModuleService.getModule("blur-pass"),Ae=ie.vs,ft=ie.fs,Vt=ie.uniforms,Tt=this.rendererService.getViewportSize(),qt=Tt.width,Lr=Tt.height;return{vs:Ae,fs:ft,uniforms:ja(ja({},Vt),{},{u_ViewportSize:[qt,Lr]})}}},{key:"convertOptionsToUniforms",value:function(ie){var Ae={};return rs()(ie.blurRadius)||(Ae.u_BlurDir=[0,ie.blurRadius]),Ae}}]),k}(Zs.Z))||Ql),Fc,Ml;function yc(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function gc(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?yc(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):yc(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}function Qs(q){var te=Is();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function Is(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var na=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,bu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qs=(Fc=(0,E.b2)(),Fc(Ml=function(q){(0,Ft.Z)(k,q);var te=Qs(k);function k(){return(0,H.Z)(this,k),te.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:bu,fs:na});var ie=this.shaderModuleService.getModule("colorhalftone-pass"),Ae=ie.vs,ft=ie.fs,Vt=ie.uniforms,Tt=this.rendererService.getViewportSize(),qt=Tt.width,Lr=Tt.height;return{vs:Ae,fs:ft,uniforms:gc(gc({},Vt),{},{u_ViewportSize:[qt,Lr]})}}}]),k}(Zs.Z))||Ml),No,$u;function su(q){var te=uu();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function uu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var Eo=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,ku=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ni=(No=(0,E.b2)(),No($u=function(q){(0,Ft.Z)(k,q);var te=su(k);function k(){return(0,H.Z)(this,k),te.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:ku,fs:Eo}),this.shaderModuleService.getModule("copy-pass")}}]),k}(Zs.Z))||$u),Hn,Il;function as(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function js(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?as(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):as(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}function Wo(q){var te=lu();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function lu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var _c=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,ec=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qi=(Hn=(0,E.b2)(),Hn(Il=function(q){(0,Ft.Z)(k,q);var te=Wo(k);function k(){return(0,H.Z)(this,k),te.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:ec,fs:_c});var ie=this.shaderModuleService.getModule("hexagonalpixelate-pass"),Ae=ie.vs,ft=ie.fs,Vt=ie.uniforms,Tt=this.rendererService.getViewportSize(),qt=Tt.width,Lr=Tt.height;return{vs:Ae,fs:ft,uniforms:js(js({},Vt),{},{u_ViewportSize:[qt,Lr]})}}}]),k}(Zs.Z))||Il),Do,Bc;function xs(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function Ol(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?xs(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):xs(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}function bs(q){var te=vs();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var pl=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,cu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,tc=(Do=(0,E.b2)(),Do(Bc=function(q){(0,Ft.Z)(k,q);var te=bs(k);function k(){return(0,H.Z)(this,k),te.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:cu,fs:pl});var ie=this.shaderModuleService.getModule("ink-pass"),Ae=ie.vs,ft=ie.fs,Vt=ie.uniforms,Tt=this.rendererService.getViewportSize(),qt=Tt.width,Lr=Tt.height;return{vs:Ae,fs:ft,uniforms:Ol(Ol({},Vt),{},{u_ViewportSize:[qt,Lr]})}}}]),k}(Zs.Z))||Bc),Ju,dl;function Nc(q){var te=Ll();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function Ll(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var vl=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,xc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qu=(Ju=(0,E.b2)(),Ju(dl=function(q){(0,Ft.Z)(k,q);var te=Nc(k);function k(){return(0,H.Z)(this,k),te.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:xc,fs:vl}),this.shaderModuleService.getModule("noise-pass")}}]),k}(Zs.Z))||dl),Fu,rc;function Bu(q){var te=Vs();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function Vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var bc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Nu=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,nc=(Fu=(0,E.b2)(),Fu(rc=function(q){(0,Ft.Z)(k,q);var te=Bu(k);function k(){return(0,H.Z)(this,k),te.apply(this,arguments)}return(0,I.Z)(k,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:bc,fs:Nu}),this.shaderModuleService.getModule("sepia-pass")}}]),k}(Zs.Z))||rc),qu,n,u,a,h,_,C=(qu=(0,E.b2)(),n=(0,E.f3)(V.v.IRendererService),u=(0,E.zY)(),qu(a=(h=function(){function q(){(0,H.Z)(this,q),(0,ue.Z)(this,"rendererService",_,this),(0,L.Z)(this,"passes",[]),(0,L.Z)(this,"readFBO",void 0),(0,L.Z)(this,"writeFBO",void 0)}return(0,I.Z)(q,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var te=(0,Vo.Z)(gi().mark(function F(ie){var Ae,ft;return gi().wrap(function(Tt){for(;;)switch(Tt.prev=Tt.next){case 0:Ae=0;case 1:if(!(Ae<this.passes.length)){Tt.next=10;break}return ft=this.passes[Ae],ft.setRenderToScreen(this.isLastEnabledPass(Ae)),Tt.next=6,ft.render(ie);case 6:Ae!==this.passes.length-1&&this.swap();case 7:Ae++,Tt.next=1;break;case 10:case"end":return Tt.stop()}},F,this)}));function k(F){return te.apply(this,arguments)}return k}()},{key:"resize",value:function(k,F){this.readFBO.resize({width:k,height:F}),this.writeFBO.resize({width:k,height:F})}},{key:"add",value:function(k,F,ie){k.init(F,ie),this.passes.push(k)}},{key:"insert",value:function(k,F,ie,Ae){k.init(ie,Ae),this.passes.splice(F,0,k)}},{key:"getPostProcessingPassByName",value:function(k){return this.passes.find(function(F){return F.getName()===k})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(k){for(var F=k+1;F<this.passes.length;F++)if(this.passes[F].isEnabled())return!1;return!0}},{key:"swap",value:function(){var k=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=k}}]),q}(),_=(0,Te.Z)(h.prototype,"rendererService",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,Te.Z)(h.prototype,"init",[u],Object.getOwnPropertyDescriptor(h.prototype,"init"),h.prototype),h))||a),P,N;function K(q){var te=oe();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function oe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var Ce=(P=(0,E.b2)(),P(N=function(q){(0,Ft.Z)(k,q);var te=K(k);function k(){return(0,H.Z)(this,k),te.apply(this,arguments)}return(0,I.Z)(k,[{key:"getType",value:function(){return Iu.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(ie,Ae){(0,Hl.Z)((0,T.Z)(k.prototype),"init",this).call(this,ie,Ae)}},{key:"render",value:function(ie){var Ae=this.rendererService,ft=Ae.useFramebuffer,Vt=Ae.clear;ft(null,function(){Vt({color:[0,0,0,0],depth:1,stencil:0}),ie.multiPassRenderer.setRenderFlag(!1),ie.render(),ie.multiPassRenderer.setRenderFlag(!0)})}}]),k}(ll))||N),we,Ie,Ke,We,ot;function je(q,te){var k=Object.keys(q);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(q);te&&(F=F.filter(function(ie){return Object.getOwnPropertyDescriptor(q,ie).enumerable})),k.push.apply(k,F)}return k}function st(q){for(var te=1;te<arguments.length;te++){var k=arguments[te]!=null?arguments[te]:{};te%2?je(Object(k),!0).forEach(function(F){(0,L.Z)(q,F,k[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(k)):je(Object(k)).forEach(function(F){Object.defineProperty(q,F,Object.getOwnPropertyDescriptor(k,F))})}return q}function wt(q){var te=Wt();return function(){var F=(0,T.Z)(q),ie;if(te){var Ae=(0,T.Z)(this).constructor;ie=Reflect.construct(F,arguments,Ae)}else ie=F.apply(this,arguments);return(0,ir.Z)(this,ie)}}function Wt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(q){return!1}}var gr=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,cr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,xr=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function zr(q,te){for(var k=0,F=1/te,ie=q;ie>0;)k=k+F*(ie%te),ie=Math.floor(ie/te),F=F/te;return k}var an=1,Qr=(we=(0,E.b2)(),Ie=(0,E.f3)(V.v.IShaderModuleService),we(Ke=(We=function(q){(0,Ft.Z)(k,q);var te=wt(k);function k(){var F;(0,H.Z)(this,k);for(var ie=arguments.length,Ae=new Array(ie),ft=0;ft<ie;ft++)Ae[ft]=arguments[ft];return F=te.call.apply(te,[this].concat(Ae)),(0,ue.Z)((0,ke.Z)(F),"shaderModuleService",ot,(0,ke.Z)(F)),(0,L.Z)((0,ke.Z)(F),"haltonSequence",[]),(0,L.Z)((0,ke.Z)(F),"accumulatingId",0),(0,L.Z)((0,ke.Z)(F),"frame",0),(0,L.Z)((0,ke.Z)(F),"timer",void 0),(0,L.Z)((0,ke.Z)(F),"sampleRenderTarget",void 0),(0,L.Z)((0,ke.Z)(F),"prevRenderTarget",void 0),(0,L.Z)((0,ke.Z)(F),"outputRenderTarget",void 0),(0,L.Z)((0,ke.Z)(F),"copyRenderTarget",void 0),(0,L.Z)((0,ke.Z)(F),"blendModel",void 0),(0,L.Z)((0,ke.Z)(F),"outputModel",void 0),(0,L.Z)((0,ke.Z)(F),"copyModel",void 0),F}return(0,I.Z)(k,[{key:"getType",value:function(){return Iu.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(ie,Ae){(0,Hl.Z)((0,T.Z)(k.prototype),"init",this).call(this,ie,Ae);var ft=this.rendererService,Vt=ft.createFramebuffer,Tt=ft.createTexture2D;this.sampleRenderTarget=Vt({color:Tt({width:1,height:1,wrapS:zi.gl.CLAMP_TO_EDGE,wrapT:zi.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=Vt({color:Tt({width:1,height:1,wrapS:zi.gl.CLAMP_TO_EDGE,wrapT:zi.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=Vt({color:Tt({width:1,height:1,wrapS:zi.gl.CLAMP_TO_EDGE,wrapT:zi.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=Vt({color:Tt({width:1,height:1,wrapS:zi.gl.CLAMP_TO_EDGE,wrapT:zi.gl.CLAMP_TO_EDGE})});for(var qt=0;qt<30;qt++)this.haltonSequence.push([zr(qt,2),zr(qt,3)]);this.blendModel=this.createTriangleModel("blend-pass",gr),this.outputModel=this.createTriangleModel("copy-pass",cr,{blend:{enable:!0,func:{srcRGB:zi.gl.ONE,dstRGB:zi.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:zi.gl.ONE,dstAlpha:zi.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:zi.gl.FUNC_ADD,alpha:zi.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",cr)}},{key:"render",value:function(ie){var Ae=this,ft=this.rendererService,Vt=ft.clear,Tt=ft.getViewportSize,qt=ft.useFramebuffer,Lr=Tt(),In=Lr.width,Fn=Lr.height;this.sampleRenderTarget.resize({width:In,height:Fn}),this.prevRenderTarget.resize({width:In,height:Fn}),this.outputRenderTarget.resize({width:In,height:Fn}),this.copyRenderTarget.resize({width:In,height:Fn}),this.resetFrame(),this.stopAccumulating();var oi=ie.multiPassRenderer.getPostProcessor().getReadFBO();qt(oi,function(){Vt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:oi}),ie.multiPassRenderer.setRenderFlag(!1),ie.render(),ie.multiPassRenderer.setRenderFlag(!0)});var ui=function mi(Gi){!Ae.accumulatingId||Gi!==Ae.accumulatingId||Ae.isFinished()||(Ae.doRender(ie),requestAnimationFrame(function(){mi(Gi)}))};this.accumulatingId=an++,this.timer=window.setTimeout(function(){ui(Ae.accumulatingId)},50)}},{key:"doRender",value:function(ie){var Ae=this,ft=this.rendererService,Vt=ft.clear,Tt=ft.getViewportSize,qt=ft.useFramebuffer,Lr=Tt(),In=Lr.width,Fn=Lr.height,oi=ie.getLayerConfig(),ui=oi.jitterScale,mi=ui===void 0?1:ui,Gi=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Gi[0]*2-1)/In*mi,(Gi[1]*2-1)/Fn*mi),ie.multiPassRenderer.setRenderFlag(!1),ie.hooks.beforeRender.call(),qt(this.sampleRenderTarget,function(){Vt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Ae.sampleRenderTarget}),ie.render()}),ie.hooks.afterRender.call(),ie.multiPassRenderer.setRenderFlag(!0);var ma=ie.getLayerConfig();qt(this.outputRenderTarget,function(){Ae.blendModel.draw({uniforms:{u_opacity:ma.opacity||1,u_MixRatio:Ae.frame===0?1:.9,u_Diffuse1:Ae.sampleRenderTarget,u_Diffuse2:Ae.frame===0?ie.multiPassRenderer.getPostProcessor().getReadFBO():Ae.prevRenderTarget}})}),this.frame===0&&Vt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(qt(this.copyRenderTarget,function(){Ae.outputModel.draw({uniforms:{u_Texture:Ae.outputRenderTarget}})}),qt(ie.multiPassRenderer.getPostProcessor().getReadFBO(),function(){Ae.copyModel.draw({uniforms:{u_Texture:Ae.copyRenderTarget}})}),ie.multiPassRenderer.getPostProcessor().render(ie));var ya=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ya,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(ie,Ae,ft){this.shaderModuleService.registerModule(ie,{vs:xr,fs:Ae});var Vt=this.shaderModuleService.getModule(ie),Tt=Vt.vs,qt=Vt.fs,Lr=Vt.uniforms,In=this.rendererService,Fn=In.createAttribute,oi=In.createBuffer,ui=In.createModel;return ui(st({vs:Tt,fs:qt,attributes:{a_Position:Fn({buffer:oi({data:[-4,-4,4,-4,0,4],type:zi.gl.FLOAT}),size:2})},uniforms:st({},Lr),depth:{enable:!1},count:3},ft))}}]),k}(ll),ot=(0,Te.Z)(We.prototype,"shaderModuleService",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),We))||Ke),Cn=new E.W2;Cn.bind(V.v.IGlobalConfigService).to(Me).inSingletonScope(),Cn.bind(V.v.IShaderModuleService).to(Gl).inSingletonScope(),(0,E.GW)((0,E.b2)(),b.EventEmitter),Cn.bind(V.v.IEventEmitter).to(b.EventEmitter);var ei=(0,Z.Z)(Cn,!1),fi=function(te){var k=ei.lazyInject(te);return function(F,ie,Ae){k.call(this,F,ie),Ae&&(Ae.initializer=function(){return F[ie]})}},ri=function(te){var k=ei.lazyMultiInject(te);return function(F,ie,Ae){k.call(this,F,ie),Ae&&(Ae.initializer=function(){return F[ie]})}},ia=Cn,Nn=0;function _i(){var q=new E.W2;return q.parent=Cn,q.bind(V.v.SceneID).toConstantValue("".concat(Nn++)),q.bind(V.v.ILayerService).to(hs).inSingletonScope(),q.bind(V.v.ISceneService).to(zs).inSingletonScope(),q.bind(V.v.ICameraService).to(Mr).inSingletonScope(),q.bind(V.v.ICoordinateSystemService).to(xn).inSingletonScope(),q.bind(V.v.IInteractionService).to(va).inSingletonScope(),q.bind(V.v.IPickingService).to(Ne).inSingletonScope(),q.bind(V.v.IControlService).to(Ur).inSingletonScope(),q.bind(V.v.IMarkerService).to(wr).inSingletonScope(),q.bind(V.v.IIconService).to(Mt).inSingletonScope(),q.bind(V.v.IFontService).to(Ge).inSingletonScope(),q.bind(V.v.IPopupService).to(bi).inSingletonScope(),q.bind(V.v.INormalPass).to(to).whenTargetNamed("clear"),q.bind(V.v.INormalPass).to(Pl).whenTargetNamed("pixelPicking"),q.bind(V.v.INormalPass).to(Ce).whenTargetNamed("render"),q.bind(V.v.INormalPass).to(Qr).whenTargetNamed("taa"),q.bind(V.v.IFactoryNormalPass).toFactory(function(te){return function(k){return te.container.getNamed(V.v.INormalPass,k)}}),q.bind(V.v.IPostProcessingPass).to(ni).whenTargetNamed("copy"),q.bind(V.v.IPostProcessingPass).to(mn).whenTargetNamed("blurH"),q.bind(V.v.IPostProcessingPass).to(xu).whenTargetNamed("blurV"),q.bind(V.v.IPostProcessingPass).to(Qu).whenTargetNamed("noise"),q.bind(V.v.IPostProcessingPass).to(nc).whenTargetNamed("sepia"),q.bind(V.v.IPostProcessingPass).to(qs).whenTargetNamed("colorHalftone"),q.bind(V.v.IPostProcessingPass).to(Qi).whenTargetNamed("hexagonalPixelate"),q.bind(V.v.IPostProcessingPass).to(tc).whenTargetNamed("ink"),q.bind(V.v.IFactoryPostProcessingPass).toFactory(function(te){return function(k){var F=te.container.getNamed(V.v.IPostProcessingPass,k);return F.setName(k),F}}),q}function Zi(q){var te=new E.W2;return te.parent=q,te.bind(V.v.IStyleAttributeService).to(wu).inSingletonScope(),te.bind(V.v.IMultiPassRenderer).to($l).inSingletonScope(),te.bind(V.v.IPostProcessor).to(C).inSingletonScope(),te}},2811:function(){},64532:function(){},4594:function(Qe,D,g){"use strict";g.d(D,{l:function(){return U}});var U={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(Qe,D,g){"use strict";g.d(D,{d:function(){return U}});var U;(function(b){b.TOPRIGHT="topright",b.TOPLEFT="topleft",b.BOTTOMRIGHT="bottomright",b.BOTTOMLEFT="bottomleft"})(U||(U={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(Qe,D,g){"use strict";g.d(D,{l:function(){return U},k:function(){return b}});var U;(function(p){p[p.LNGLAT=1]="LNGLAT",p[p.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",p[p.VECTOR_TILE=3]="VECTOR_TILE",p[p.IDENTITY=4]="IDENTITY",p[p.P20=5]="P20",p[p.P20_OFFSET=6]="P20_OFFSET",p[p.METER_OFFSET=7]="METER_OFFSET",p[p.P20_2=8]="P20_2"})(U||(U={}));var b={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(Qe,D,g){"use strict";g.d(D,{s:function(){return U}});var U;(function(b){b.Hover="hover",b.Click="click",b.Select="select",b.Active="active",b.Drag="drag"})(U||(U={}))},90919:function(){},77252:function(Qe,D,g){"use strict";g.d(D,{h:function(){return U}});var U;(function(b){b.normal="normal",b.additive="additive",b.subtractive="subtractive",b.min="min",b.max="max",b.none="none"})(U||(U={}))},31251:function(Qe,D,g){"use strict";g.d(D,{vY:function(){return U},ee:function(){return b},GC:function(){return p}});var U;(function(E){E.LINEAR="linear",E.POWER="power",E.LOG="log",E.IDENTITY="identity",E.TIME="time",E.QUANTILE="quantile",E.QUANTIZE="quantize",E.THRESHOLD="threshold",E.CAT="cat"})(U||(U={}));var b;(function(E){E.CONSTANT="constant",E.VARIABLE="variable"})(b||(b={}));var p;(function(E){E[E.Attribute=0]="Attribute",E[E.InstancedAttribute=1]="InstancedAttribute",E[E.Uniform=2]="Uniform"})(p||(p={}))},16606:function(Qe,D,g){"use strict";g.d(D,{I:function(){return U}});var U=["mapload"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(Qe,D,g){"use strict";g.d(D,{G:function(){return U}});var U;(function(b){b.Normal="normal",b.PostProcessing="post-processing"})(U||(U={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(Qe,D,g){"use strict";g.d(D,{gl:function(){return U}});var U;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",b[b.POINTS=0]="POINTS",b[b.LINES=1]="LINES",b[b.LINE_LOOP=2]="LINE_LOOP",b[b.LINE_STRIP=3]="LINE_STRIP",b[b.TRIANGLES=4]="TRIANGLES",b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN",b[b.ZERO=0]="ZERO",b[b.ONE=1]="ONE",b[b.SRC_COLOR=768]="SRC_COLOR",b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",b[b.SRC_ALPHA=770]="SRC_ALPHA",b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",b[b.DST_ALPHA=772]="DST_ALPHA",b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",b[b.DST_COLOR=774]="DST_COLOR",b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",b[b.FUNC_ADD=32774]="FUNC_ADD",b[b.BLEND_EQUATION=32777]="BLEND_EQUATION",b[b.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",b[b.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",b[b.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",b[b.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",b[b.MAX_EXT=32776]="MAX_EXT",b[b.MIN_EXT=32775]="MIN_EXT",b[b.BLEND_DST_RGB=32968]="BLEND_DST_RGB",b[b.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",b[b.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",b[b.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR",b[b.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",b[b.BLEND_COLOR=32773]="BLEND_COLOR",b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER",b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",b[b.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",b[b.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",b[b.STREAM_DRAW=35040]="STREAM_DRAW",b[b.STATIC_DRAW=35044]="STATIC_DRAW",b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",b[b.BUFFER_SIZE=34660]="BUFFER_SIZE",b[b.BUFFER_USAGE=34661]="BUFFER_USAGE",b[b.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",b[b.FRONT=1028]="FRONT",b[b.BACK=1029]="BACK",b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK",b[b.CULL_FACE=2884]="CULL_FACE",b[b.BLEND=3042]="BLEND",b[b.DITHER=3024]="DITHER",b[b.STENCIL_TEST=2960]="STENCIL_TEST",b[b.DEPTH_TEST=2929]="DEPTH_TEST",b[b.SCISSOR_TEST=3089]="SCISSOR_TEST",b[b.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",b[b.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",b[b.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",b[b.NO_ERROR=0]="NO_ERROR",b[b.INVALID_ENUM=1280]="INVALID_ENUM",b[b.INVALID_VALUE=1281]="INVALID_VALUE",b[b.INVALID_OPERATION=1282]="INVALID_OPERATION",b[b.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",b[b.CW=2304]="CW",b[b.CCW=2305]="CCW",b[b.LINE_WIDTH=2849]="LINE_WIDTH",b[b.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",b[b.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",b[b.CULL_FACE_MODE=2885]="CULL_FACE_MODE",b[b.FRONT_FACE=2886]="FRONT_FACE",b[b.DEPTH_RANGE=2928]="DEPTH_RANGE",b[b.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",b[b.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",b[b.DEPTH_FUNC=2932]="DEPTH_FUNC",b[b.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",b[b.STENCIL_FUNC=2962]="STENCIL_FUNC",b[b.STENCIL_FAIL=2964]="STENCIL_FAIL",b[b.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",b[b.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",b[b.STENCIL_REF=2967]="STENCIL_REF",b[b.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",b[b.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",b[b.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",b[b.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",b[b.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",b[b.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",b[b.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",b[b.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",b[b.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",b[b.VIEWPORT=2978]="VIEWPORT",b[b.SCISSOR_BOX=3088]="SCISSOR_BOX",b[b.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",b[b.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",b[b.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",b[b.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",b[b.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",b[b.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",b[b.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",b[b.RED_BITS=3410]="RED_BITS",b[b.GREEN_BITS=3411]="GREEN_BITS",b[b.BLUE_BITS=3412]="BLUE_BITS",b[b.ALPHA_BITS=3413]="ALPHA_BITS",b[b.DEPTH_BITS=3414]="DEPTH_BITS",b[b.STENCIL_BITS=3415]="STENCIL_BITS",b[b.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",b[b.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",b[b.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",b[b.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",b[b.SAMPLES=32937]="SAMPLES",b[b.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",b[b.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",b[b.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",b[b.DONT_CARE=4352]="DONT_CARE",b[b.FASTEST=4353]="FASTEST",b[b.NICEST=4354]="NICEST",b[b.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",b[b.BYTE=5120]="BYTE",b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",b[b.SHORT=5122]="SHORT",b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",b[b.INT=5124]="INT",b[b.UNSIGNED_INT=5125]="UNSIGNED_INT",b[b.FLOAT=5126]="FLOAT",b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",b[b.ALPHA=6406]="ALPHA",b[b.RGB=6407]="RGB",b[b.RGBA=6408]="RGBA",b[b.LUMINANCE=6409]="LUMINANCE",b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",b[b.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",b[b.VERTEX_SHADER=35633]="VERTEX_SHADER",b[b.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",b[b.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",b[b.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",b[b.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",b[b.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",b[b.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",b[b.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",b[b.SHADER_TYPE=35663]="SHADER_TYPE",b[b.DELETE_STATUS=35712]="DELETE_STATUS",b[b.LINK_STATUS=35714]="LINK_STATUS",b[b.VALIDATE_STATUS=35715]="VALIDATE_STATUS",b[b.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",b[b.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",b[b.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",b[b.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",b[b.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",b[b.NEVER=512]="NEVER",b[b.LESS=513]="LESS",b[b.EQUAL=514]="EQUAL",b[b.LEQUAL=515]="LEQUAL",b[b.GREATER=516]="GREATER",b[b.NOTEQUAL=517]="NOTEQUAL",b[b.GEQUAL=518]="GEQUAL",b[b.ALWAYS=519]="ALWAYS",b[b.KEEP=7680]="KEEP",b[b.REPLACE=7681]="REPLACE",b[b.INCR=7682]="INCR",b[b.DECR=7683]="DECR",b[b.INVERT=5386]="INVERT",b[b.INCR_WRAP=34055]="INCR_WRAP",b[b.DECR_WRAP=34056]="DECR_WRAP",b[b.VENDOR=7936]="VENDOR",b[b.RENDERER=7937]="RENDERER",b[b.VERSION=7938]="VERSION",b[b.NEAREST=9728]="NEAREST",b[b.LINEAR=9729]="LINEAR",b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",b[b.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",b[b.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",b[b.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",b[b.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",b[b.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",b[b.TEXTURE_2D=3553]="TEXTURE_2D",b[b.TEXTURE=5890]="TEXTURE",b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",b[b.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",b[b.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",b[b.TEXTURE0=33984]="TEXTURE0",b[b.TEXTURE1=33985]="TEXTURE1",b[b.TEXTURE2=33986]="TEXTURE2",b[b.TEXTURE3=33987]="TEXTURE3",b[b.TEXTURE4=33988]="TEXTURE4",b[b.TEXTURE5=33989]="TEXTURE5",b[b.TEXTURE6=33990]="TEXTURE6",b[b.TEXTURE7=33991]="TEXTURE7",b[b.TEXTURE8=33992]="TEXTURE8",b[b.TEXTURE9=33993]="TEXTURE9",b[b.TEXTURE10=33994]="TEXTURE10",b[b.TEXTURE11=33995]="TEXTURE11",b[b.TEXTURE12=33996]="TEXTURE12",b[b.TEXTURE13=33997]="TEXTURE13",b[b.TEXTURE14=33998]="TEXTURE14",b[b.TEXTURE15=33999]="TEXTURE15",b[b.TEXTURE16=34e3]="TEXTURE16",b[b.TEXTURE17=34001]="TEXTURE17",b[b.TEXTURE18=34002]="TEXTURE18",b[b.TEXTURE19=34003]="TEXTURE19",b[b.TEXTURE20=34004]="TEXTURE20",b[b.TEXTURE21=34005]="TEXTURE21",b[b.TEXTURE22=34006]="TEXTURE22",b[b.TEXTURE23=34007]="TEXTURE23",b[b.TEXTURE24=34008]="TEXTURE24",b[b.TEXTURE25=34009]="TEXTURE25",b[b.TEXTURE26=34010]="TEXTURE26",b[b.TEXTURE27=34011]="TEXTURE27",b[b.TEXTURE28=34012]="TEXTURE28",b[b.TEXTURE29=34013]="TEXTURE29",b[b.TEXTURE30=34014]="TEXTURE30",b[b.TEXTURE31=34015]="TEXTURE31",b[b.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",b[b.REPEAT=10497]="REPEAT",b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",b[b.FLOAT_VEC2=35664]="FLOAT_VEC2",b[b.FLOAT_VEC3=35665]="FLOAT_VEC3",b[b.FLOAT_VEC4=35666]="FLOAT_VEC4",b[b.INT_VEC2=35667]="INT_VEC2",b[b.INT_VEC3=35668]="INT_VEC3",b[b.INT_VEC4=35669]="INT_VEC4",b[b.BOOL=35670]="BOOL",b[b.BOOL_VEC2=35671]="BOOL_VEC2",b[b.BOOL_VEC3=35672]="BOOL_VEC3",b[b.BOOL_VEC4=35673]="BOOL_VEC4",b[b.FLOAT_MAT2=35674]="FLOAT_MAT2",b[b.FLOAT_MAT3=35675]="FLOAT_MAT3",b[b.FLOAT_MAT4=35676]="FLOAT_MAT4",b[b.SAMPLER_2D=35678]="SAMPLER_2D",b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE",b[b.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",b[b.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",b[b.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",b[b.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",b[b.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",b[b.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",b[b.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",b[b.COMPILE_STATUS=35713]="COMPILE_STATUS",b[b.LOW_FLOAT=36336]="LOW_FLOAT",b[b.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",b[b.HIGH_FLOAT=36338]="HIGH_FLOAT",b[b.LOW_INT=36339]="LOW_INT",b[b.MEDIUM_INT=36340]="MEDIUM_INT",b[b.HIGH_INT=36341]="HIGH_INT",b[b.FRAMEBUFFER=36160]="FRAMEBUFFER",b[b.RENDERBUFFER=36161]="RENDERBUFFER",b[b.RGBA4=32854]="RGBA4",b[b.RGB5_A1=32855]="RGB5_A1",b[b.RGB565=36194]="RGB565",b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",b[b.STENCIL_INDEX=6401]="STENCIL_INDEX",b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8",b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL",b[b.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",b[b.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",b[b.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",b[b.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",b[b.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",b[b.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",b[b.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",b[b.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",b[b.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",b[b.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",b[b.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",b[b.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",b[b.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",b[b.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",b[b.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",b[b.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",b[b.NONE=0]="NONE",b[b.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",b[b.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",b[b.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",b[b.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",b[b.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",b[b.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",b[b.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",b[b.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",b[b.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",b[b.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",b[b.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",b[b.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",b[b.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",b[b.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(U||(U={}))},69530:function(Qe,D,g){"use strict";g.d(D,{Z:function(){return Ve}});var U=g(55770),b=g(6610),p=g(5991),E=g(96156),Z=g(3473),V=g(11700),H=g.n(V),I=g(14293),L=g.n(I),_e=g(68929),xe=g.n(_e),Re=g(86700),$e=g(28660),Rt=g.n($e),Lt=g(7648),zt=g(72302),St=g(92364),Et,at,ur,ee,fr;function At(It,hr){var Jt=Object.keys(It);if(Object.getOwnPropertySymbols){var Fr=Object.getOwnPropertySymbols(It);hr&&(Fr=Fr.filter(function(fe){return Object.getOwnPropertyDescriptor(It,fe).enumerable})),Jt.push.apply(Jt,Fr)}return Jt}function Je(It){for(var hr=1;hr<arguments.length;hr++){var Jt=arguments[hr]!=null?arguments[hr]:{};hr%2?At(Object(Jt),!0).forEach(function(Fr){(0,E.Z)(It,Fr,Jt[Fr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(It,Object.getOwnPropertyDescriptors(Jt)):At(Object(Jt)).forEach(function(Fr){Object.defineProperty(It,Fr,Object.getOwnPropertyDescriptor(Jt,Fr))})}return It}var Pt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ve=(Et=(0,Re.b2)(),at=(0,Re.f3)(zt.v.IShaderModuleService),Et(ur=(ee=function(){function It(){(0,b.Z)(this,It),(0,U.Z)(this,"shaderModuleService",fr,this),(0,E.Z)(this,"rendererService",void 0),(0,E.Z)(this,"config",void 0),(0,E.Z)(this,"quad",Pt),(0,E.Z)(this,"enabled",!0),(0,E.Z)(this,"renderToScreen",!1),(0,E.Z)(this,"model",void 0),(0,E.Z)(this,"name",void 0),(0,E.Z)(this,"optionsToUpdate",{})}return(0,p.Z)(It,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(Jt){this.name=Jt}},{key:"getType",value:function(){return St.G.PostProcessing}},{key:"init",value:function(Jt,Fr){this.config=Fr,this.rendererService=Jt.getContainer().get(zt.v.IRendererService);var fe=this.rendererService,Fe=fe.createAttribute,me=fe.createBuffer,bt=fe.createModel,vt=this.setupShaders(),Zt=vt.vs,Ut=vt.fs,Rr=vt.uniforms;this.model=bt({vs:Zt,fs:Ut,attributes:{a_Position:Fe({buffer:me({data:[-4,-4,4,-4,0,4],type:Lt.gl.FLOAT}),size:2})},uniforms:Je(Je({u_Texture:null},Rr),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(Jt){var Fr=this,fe=Jt.multiPassRenderer.getPostProcessor(),Fe=this.rendererService,me=Fe.useFramebuffer,bt=Fe.getViewportSize,vt=Fe.clear,Zt=bt(),Ut=Zt.width,Rr=Zt.height;me(this.renderToScreen?null:fe.getWriteFBO(),function(){vt({framebuffer:fe.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),Fr.model.draw({uniforms:Je({u_Texture:fe.getReadFBO(),u_ViewportSize:[Ut,Rr]},Fr.convertOptionsToUniforms(Fr.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(Jt){this.enabled=Jt}},{key:"setRenderToScreen",value:function(Jt){this.renderToScreen=Jt}},{key:"updateOptions",value:function(Jt){this.optionsToUpdate=Je(Je({},this.optionsToUpdate),Jt)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(Jt){var Fr={};return Object.keys(Jt).forEach(function(fe){L()(Jt[fe])||(Fr["u_".concat(H()(xe()(fe)))]=Jt[fe])}),Fr}}]),It}(),fr=(0,Z.Z)(ee.prototype,"shaderModuleService",[at],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee))||ur)},19793:function(Qe,D,g){"use strict";g.d(D,{P:function(){return U}});var U=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(Qe,D,g){"use strict";g.d(D,{v:function(){return U}});var U={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(Qe,D,g){"use strict";var U=g(74691),b=null;function p(Ve){return b.indexOf(Ve)}var E=2,Z=4,V=64,H=128,I=256,L=512,_e=8192,xe=16384,Re=32768,$e=null,Rt=131072,Lt=262144,zt=524288,St=1048576,Et=2097152,at=4194304,ur=8388608,ee=16777216,fr=null;function At(Ve,It){return Ve=_clamp(Math.floor(Ve),0,255),It=_clamp(Math.floor(It),0,255),256*Ve+It}function Je(Ve){var It=Ve.color,hr=Ve.radius,Jt=Ve.tileX,Fr=Ve.tileY,fe=Ve.shape,Fe=Ve.opacity,me=Ve.stroke,bt=Ve.strokeWidth,vt=Ve.strokeOpacity,Zt=[],Ut=[],Rr=[],ln=[At(It[0],It[1]),At(It[2],It[3])],pn=[At(me[0],me[1]),At(me[2],me[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Vi){var ar=_slicedToArray(Vi,2),pe=ar[0],Pe=ar[1];Zt.push([].concat(ln,[(pe+1)*ur+(Pe+1)*Et+getShapeIndex(fe)*Rt+hr,(Jt+512)*zt+(Fr+512)*V])),Ut.push([].concat(pn,[bt,vt])),Rr.push([Fe,0,0,0])}),{packedBuffer:Zt,packedBuffer2:Ut,packedBuffer3:Rr}}function Pt(Ve,It){if(Ve===0&&!It)return 0;if(Ve===1&&It)return 4294967295;var hr=It?1:0,Jt=Math.floor(Ve*127);return Jt*fr+hr*ee+Jt*Rt+hr*$e+Jt*L+hr*I+Jt*E+hr}},72278:function(Qe,D,g){"use strict";g.d(D,{zP:function(){return xy},JE:function(){return _0},ns:function(){return _y}});var U=g(67294),b=(0,U.createContext)({});function p(){return(0,U.useContext)(b)}var E=g(58881),Z=g(28481),V=g(6610),H=g(5991),I=g(96156),L=g(63349),_e=g(10379),xe=g(46070),Re=g(77608),$e=g(6901),Rt=g(26729);function Lt(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function zt(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Lt(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Lt(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function St(i){var c=Et();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Et(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var at;(function(i){i.TOPRIGHT="topright",i.TOPLEFT="topleft",i.BOTTOMRIGHT="bottomright",i.BOTTOMLEFT="bottomleft"})(at||(at={}));var ur=0,ee=function(i){(0,_e.Z)(o,i);var c=St(o);function o(s){var l;return(0,V.Z)(this,o),l=c.call(this),(0,I.Z)((0,L.Z)(l),"controlOption",void 0),(0,I.Z)((0,L.Z)(l),"container",void 0),(0,I.Z)((0,L.Z)(l),"sceneContainer",void 0),(0,I.Z)((0,L.Z)(l),"mapsService",void 0),(0,I.Z)((0,L.Z)(l),"renderService",void 0),(0,I.Z)((0,L.Z)(l),"layerService",void 0),(0,I.Z)((0,L.Z)(l),"controlService",void 0),(0,I.Z)((0,L.Z)(l),"isShow",void 0),l.controlOption=zt(zt({},l.getDefault()),s||{}),l}return(0,H.Z)(o,[{key:"getDefault",value:function(){return{position:at.TOPRIGHT,name:"".concat(ur++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",d=this.controlService;return d&&d.removeControl(this),this.controlOption.position=l,d&&d.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(E.vK.IMapService),this.renderService=l.get(E.vK.IRendererService),this.layerService=l.get(E.vK.ILayerService),this.controlService=l.get(E.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var d=this.container,x=this.controlOption.position,A=this.controlService.controlCorners[x];return $e.SO.addClass(d,"l7-control"),x.indexOf("bottom")!==-1?A.insertBefore(d,A.firstChild):A.appendChild(d),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;$e.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;$e.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;$e.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var d=this.mapsService.getContainer();d!==null&&d.focus()}}}]),o}(Rt.EventEmitter);function fr(i){var c=At();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function At(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Je=function(i){(0,_e.Z)(o,i);var c=fr(o);function o(s){var l;return(0,V.Z)(this,o),l=c.call(this,s),(0,I.Z)((0,L.Z)(l),"layerControlInputs",void 0),(0,I.Z)((0,L.Z)(l),"layers",void 0),(0,I.Z)((0,L.Z)(l),"lastZIndex",void 0),(0,I.Z)((0,L.Z)(l),"handlingClick",void 0),(0,I.Z)((0,L.Z)(l),"layersLink",void 0),(0,I.Z)((0,L.Z)(l),"baseLayersList",void 0),(0,I.Z)((0,L.Z)(l),"separator",void 0),(0,I.Z)((0,L.Z)(l),"overlaysList",void 0),(0,I.Z)((0,L.Z)(l),"form",void 0),l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,$e.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,L.Z)(l)),l}return(0,H.Z)(o,[{key:"getDefault",value:function(){return{collapsed:!0,position:E.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(d){d.layer.on("remove",l.onLayerChange),d.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,d){return this.addLayer(l,d,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),d=l.height;$e.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var x=d-(this.container.offsetTop+50);return x<this.form.clientHeight?($e.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=x+"px"):$e.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return $e.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(d){d.layer.off("remove",l.onLayerChange),d.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",d=this.container=$e.SO.create("div",l),x=this.controlOption.collapsed;d.setAttribute("aria-haspopup","true");var A=this.form=$e.SO.create("form",l+"-list");x&&(this.mapsService.on("click",this.collapse),d.addEventListener("mouseenter",this.expand),d.addEventListener("mouseleave",this.collapse)),this.layersLink=$e.SO.create("a",l+"-toggle",d);var O=this.layersLink;O.title="Layers",x||this.expand(),this.baseLayersList=$e.SO.create("div",l+"-base",A),this.separator=$e.SO.create("div",l+"-separator",A),this.overlaysList=$e.SO.create("div",l+"-overlays",A),d.appendChild(A)}},{key:"initLayers",value:function(){var l=this,d=this.controlOption,x=d.baseLayers,A=x===void 0?{}:x,O=d.overlayers,B=O===void 0?{}:O;Object.keys(A).forEach(function(re,Q){l.addLayer(A[re],re,!1)}),Object.keys(B).forEach(function(re,Q){l.addLayer(B[re],re,!0)})}},{key:"update",value:function(){if(!this.container)return this;$e.SO.empty(this.baseLayersList),$e.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,d,x,A,O=0;for(x=0;x<this.layers.length;x++)A=this.layers[x],this.addItem(A),d=d||A.overlay,l=l||!A.overlay,O+=A.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&O>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=d&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,d,x,A=this.mapsService.getZoom(),O=l.length-1;O>=0;O--)if(d=l[O],x=this.layerService.getLayer(d.layerId),x&&x.inited){var B=x.getMinZoom(),re=x.getMaxZoom();d.disabled=A<B||A>re}}},{key:"addLayer",value:function(l,d,x){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:d,overlay:x});var A=this.controlOption,O=A.sortLayers,B=A.sortFunction,re=A.autoZIndex;O&&this.layers.sort(function(Q,ge){return B(Q.layer,ge.layer,Q.name,ge.name)}),re&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var d=this.layerService.getLayer(l.target.layerId),x=d!=null&&d.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;x&&this.emit(x,d)}},{key:"createRadioElement",value:function(l,d){var x='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(d?' checked="checked"':"")+"/>",A=document.createElement("div");return A.innerHTML=x,A.firstChild}},{key:"addItem",value:function(l){var d=document.createElement("label"),x=this.layerService.getLayer(l.layer.id),A=x&&x.inited&&l.layer.isVisible(),O;l.overlay?(O=document.createElement("input"),O.type="checkbox",O.className="l7-control-layers-selector",O.defaultChecked=A):O=this.createRadioElement("l7-base-layers",A),this.layerControlInputs.push(O),O.layerId=l.layer.id,O.addEventListener("click",this.onInputClick);var B=document.createElement("span");B.innerHTML=" "+l.name;var re=document.createElement("div");d.appendChild(re),re.appendChild(O),re.appendChild(B);var Q=l.overlay?this.overlaysList:this.baseLayersList;return Q.appendChild(d),this.checkDisabledLayers(),d}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,d,x,A=[],O=[];this.handlingClick=!0;for(var B=l.length-1;B>=0;B--)d=l[B],x=this.layerService.getLayer(d.layerId),d.checked?A.push(x):d.checked||O.push(x);O.forEach(function(re){re.hide()}),A.forEach(function(re){re.show()}),this.handlingClick=!1}}]),o}(ee);function Pt(i){var c=Ve();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Ve(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var It=function(i){(0,_e.Z)(o,i);var c=Pt(o);function o(){return(0,V.Z)(this,o),c.apply(this,arguments)}return(0,H.Z)(o,[{key:"getDefault",value:function(){return{position:at.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",d=$e.SO.create("div",l),x=$e.SO.create("a","l7-ctrl-logo");return x.target="_blank",x.rel="noopener nofollow",x.href="https://antv.alipay.com/l7",x.setAttribute("aria-label","AntV logo"),x.setAttribute("rel","noopener nofollow"),d.appendChild(x),d}},{key:"onRemove",value:function(){return null}}]),o}(ee);function hr(i){var c=Jt();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Jt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Fr=function(i){(0,_e.Z)(o,i);var c=hr(o);function o(s){var l;return(0,V.Z)(this,o),l=c.call(this,s),(0,I.Z)((0,L.Z)(l),"mScale",void 0),(0,I.Z)((0,L.Z)(l),"iScale",void 0),(0,$e.Ev)(["update"],(0,L.Z)(l)),l}return(0,H.Z)(o,[{key:"getDefault",value:function(){return{position:at.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",d=$e.SO.create("div",l);this.addScales(l+"-line",d);var x=this.controlOption.updateWhenIdle;return this.mapsService.on(x?"moveend":"mapmove",this.update),this.mapsService.on(x?"zoomend":"zoomchange",this.update),this.update(),d}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,d=this.controlOption.maxWidth,x=l.getSize()[1]/2,A=l.containerToLngLat([0,x]),O=l.containerToLngLat([d,x]),B=(0,$e.yM)([A.lng,A.lat],[O.lng,O.lat]);this.updateScales(B)}},{key:"updateScales",value:function(l){var d=this.controlOption,x=d.metric,A=d.imperial;x&&l&&this.updateMetric(l),A&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var d=this.getRoundNum(l),x=d<1e3?d+" m":d/1e3+" km";this.updateScale(this.mScale,x,d/l)}},{key:"updateImperial",value:function(l){var d=l*3.2808399,x,A,O;d>5280?(x=d/5280,A=this.getRoundNum(x),this.updateScale(this.iScale,A+" mi",A/x)):(O=this.getRoundNum(d),this.updateScale(this.iScale,O+" ft",O/d))}},{key:"updateScale",value:function(l,d,x){var A=this.controlOption.maxWidth;l.style.width=Math.round(A*x)+"px",l.innerHTML=d}},{key:"getRoundNum",value:function(l){var d=Math.pow(10,(Math.floor(l)+"").length-1),x=l/d;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:1,d*x}},{key:"addScales",value:function(l,d){var x=this.controlOption,A=x.metric,O=x.imperial;A&&(this.mScale=$e.SO.create("div",l,d)),O&&(this.iScale=$e.SO.create("div",l,d))}}]),o}(ee);function fe(i){var c=Fe();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Fe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var me=function(i){(0,_e.Z)(o,i);var c=fe(o);function o(s){var l;return(0,V.Z)(this,o),l=c.call(this,s),(0,I.Z)((0,L.Z)(l),"disabled",void 0),(0,I.Z)((0,L.Z)(l),"zoomInButton",void 0),(0,I.Z)((0,L.Z)(l),"zoomOutButton",void 0),(0,$e.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,L.Z)(l)),l}return(0,H.Z)(o,[{key:"getDefault",value:function(){return{position:at.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",d=$e.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",d,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",d,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),d}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,d,x,A,O){var B=$e.SO.create("a",x,A);return B.innerHTML=l,B.title=d,B.href="javascript:void(0)",B.addEventListener("click",O),B}},{key:"updateDisabled",value:function(){var l=this.mapsService,d="l7-disabled";$e.SO.removeClass(this.zoomInButton,d),$e.SO.removeClass(this.zoomOutButton,d),(this.disabled||l.getZoom()<=l.getMinZoom())&&$e.SO.addClass(this.zoomOutButton,d),(this.disabled||l.getZoom()>=l.getMaxZoom())&&$e.SO.addClass(this.zoomInButton,d)}}]),o}(ee);function bt(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function vt(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?bt(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):bt(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Zt(i){var c=Ut();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Ut(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Rr=function(i){(0,_e.Z)(o,i);var c=Zt(o);function o(s){var l;return(0,V.Z)(this,o),l=c.call(this),(0,I.Z)((0,L.Z)(l),"markerOption",void 0),(0,I.Z)((0,L.Z)(l),"defaultMarker",void 0),(0,I.Z)((0,L.Z)(l),"popup",void 0),(0,I.Z)((0,L.Z)(l),"mapsService",void 0),(0,I.Z)((0,L.Z)(l),"sceneSerive",void 0),(0,I.Z)((0,L.Z)(l),"lngLat",void 0),(0,I.Z)((0,L.Z)(l),"scene",void 0),(0,I.Z)((0,L.Z)(l),"added",!1),(0,I.Z)((0,L.Z)(l),"eventHandle",function(d){l.emit(d.type,{target:d,data:l.markerOption.extData,lngLat:l.lngLat})}),l.markerOption=vt(vt({},l.getDefault()),s),(0,$e.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,L.Z)(l)),l.init(),l}return(0,H.Z)(o,[{key:"getDefault",value:function(){return{element:void 0,anchor:$e.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(E.vK.IMapService),this.sceneSerive=l.get(E.vK.ISceneService);var d=this.markerOption,x=d.element,A=d.draggable;return this.mapsService.getMarkerContainer().appendChild(x),this.registerMarkerEvent(x),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&$e.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var d=this;if(!this.added)return this.once("added",function(){d.setElement(l)}),this;var x=this.markerOption.element;return x&&$e.SO.remove(x),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var d=this.popup;return d?(d.isOpen()||d.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var d=this.popup;return d&&d.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,x=l.anchor;this.updatePosition(),$e.SO.setTransform(d,"".concat($e.rQ[x]))}}},{key:"onMapClick",value:function(l){var d=this.markerOption.element;this.popup&&d&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,x=l.offsets,A=this.lngLat,O=A.lng,B=A.lat,re=this.mapsService.getBounds(),Q=this.mapsService.lngLatToContainer([O,B]);if(d){d.style.display="block";var ge=this.mapsService.getContainer(),Ze=0,_t=0;if(ge&&(Ze=ge.scrollWidth,_t=ge.scrollHeight),Math.abs(re[0][0])>180||Math.abs(re[1][0])>180){if(Q.x>Ze){var Ht=this.mapsService.lngLatToContainer([O-360,B]);Q.x=Ht.x}if(Q.x<0){var _r=this.mapsService.lngLatToContainer([O+360,B]);Q.x=_r.x}}(Q.x>Ze||Q.x<0||Q.y>_t||Q.y<0)&&(d.style.display="none"),d.style.left=Q.x+x[0]+"px",d.style.top=Q.y-x[1]+"px"}}}},{key:"init",value:function(){var l=this,d=this.markerOption.element,x=this.markerOption,A=x.color,O=x.anchor;if(!d){this.defaultMarker=!0,d=$e.SO.create("div"),this.markerOption.element=d;var B=document.createElementNS("http://www.w3.org/2000/svg","svg");B.setAttributeNS(null,"display","block"),B.setAttributeNS(null,"height","48px"),B.setAttributeNS(null,"width","48px"),B.setAttributeNS(null,"viewBox","0 0 1024 1024");var re=document.createElementNS("http://www.w3.org/2000/svg","path");re.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),re.setAttributeNS(null,"fill",A),B.appendChild(re),d.appendChild(B)}$e.SO.addClass(d,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(Q){var ge,Ze,_t=((ge=l.markerOption)===null||ge===void 0?void 0:ge.style)&&((Ze=l.markerOption)===null||Ze===void 0?void 0:Ze.style[Q]);d&&(d.style[Q]=_t)}),d.addEventListener("click",function(Q){l.onMapClick(Q)}),d.addEventListener("click",this.eventHandle),(0,$e.zi)(d,O,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),o}(Rt.EventEmitter),ln=g(82492),pn=g.n(ln),Vi=g(69848),ar=g.n(Vi);function pe(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Pe(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?pe(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):pe(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Ge(i){var c=ke();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function ke(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ft=function(i){(0,_e.Z)(o,i);var c=Ge(o);function o(s){var l,d;return(0,V.Z)(this,o),d=c.call(this),(0,I.Z)((0,L.Z)(d),"markers",[]),(0,I.Z)((0,L.Z)(d),"markerLayerOption",void 0),(0,I.Z)((0,L.Z)(d),"clusterIndex",void 0),(0,I.Z)((0,L.Z)(d),"points",[]),(0,I.Z)((0,L.Z)(d),"clusterMarkers",[]),(0,I.Z)((0,L.Z)(d),"mapsService",void 0),(0,I.Z)((0,L.Z)(d),"scene",void 0),(0,I.Z)((0,L.Z)(d),"zoom",void 0),(0,I.Z)((0,L.Z)(d),"bbox",void 0),d.markerLayerOption=pn()(d.getDefault(),s),(0,$e.Ev)(["update"],(0,L.Z)(d)),d.zoom=((l=d.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,d}return(0,H.Z)(o,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(E.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var d=this.markerLayerOption.cluster;d&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var d=this.markers.indexOf(l);d>-1&&this.markers.splice(d,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(d){d.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,d){var x=l.getLnglat(),A=x.lng,O=x.lat,B={geometry:{type:"Point",coordinates:[A,O]},properties:Pe(Pe({},l.getExtData()),{},{marker_id:d})};this.points.push(B)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,d=l.radius,x=l.minZoom,A=x===void 0?0:x,O=l.maxZoom;this.clusterIndex=new(ar())({radius:d,minZoom:A,maxZoom:O}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,d){var x=this,A=l[0].concat(l[1]),O=this.clusterIndex.getClusters(A,d);this.clusterMarkers.forEach(function(B){B.remove()}),this.clusterMarkers=[],O.forEach(function(B){var re,Q=x.markerLayerOption.clusterOption,ge=Q.field,Ze=Q.method;if(B.properties&&(re=B.properties)!==null&&re!==void 0&&re.cluster_id){var _t,Ht=x.getLeaves((_t=B.properties)===null||_t===void 0?void 0:_t.cluster_id);if(B.properties.clusterData=Ht,ge&&Ze){var _r=Ht==null?void 0:Ht.map(function(Xn){var Ci=(0,I.Z)({},ge,Xn.properties[ge]);return Ci}),Er=$e.a5.getColumn(_r,ge),Vr=$e.a5.getSatByColumn(Ze,Er),_n="point_"+Ze;B.properties[_n]=Vr.toFixed(2)}}var Rn=x.clusterMarker(B);x.clusterMarkers.push(Rn),Rn.addTo(x.scene)})}},{key:"getLeaves",value:function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,d,x):null}},{key:"clusterMarker",value:function(l){var d=this.markerLayerOption.clusterOption,x=d,A=x.element,O=A===void 0?this.generateElement.bind(this):A,B=new Rr({element:O(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return B}},{key:"normalMarker",value:function(l){var d=l.properties.marker_id;return this.markers[d]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),d=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,$e.oO)(this.bbox,d))&&(this.bbox=(0,$e.yA)(d,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var d=$e.SO.create("div","l7-marker-cluster"),x=$e.SO.create("div","",d),A=$e.SO.create("span","",x),O=this.markerLayerOption.clusterOption,B=O.field,re=O.method;l.properties.point_count=l.properties.point_count||1;var Q=B&&re?l.properties["point_"+re]||l.properties[B]:l.properties.point_count;return A.textContent=Q,d}}]),o}(Rt.EventEmitter);function ir(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function T(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?ir(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):ir(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function G(i){var c=Se();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Se(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Be=function(i){(0,_e.Z)(o,i);var c=G(o);function o(s){var l;return(0,V.Z)(this,o),l=c.call(this),(0,I.Z)((0,L.Z)(l),"popupOption",void 0),(0,I.Z)((0,L.Z)(l),"mapsService",void 0),(0,I.Z)((0,L.Z)(l),"sceneSerive",void 0),(0,I.Z)((0,L.Z)(l),"lngLat",void 0),(0,I.Z)((0,L.Z)(l),"content",void 0),(0,I.Z)((0,L.Z)(l),"closeButton",void 0),(0,I.Z)((0,L.Z)(l),"timeoutInstance",void 0),(0,I.Z)((0,L.Z)(l),"container",void 0),(0,I.Z)((0,L.Z)(l),"tip",void 0),(0,I.Z)((0,L.Z)(l),"scene",void 0),l.popupOption=T(T({},l.getdefault()),s),(0,$e.Ev)(["update","onClickClose","remove"],(0,L.Z)(l)),l}return(0,H.Z)(o,[{key:"addTo",value:function(l){var d=this;return this.mapsService=l.get(E.vK.IMapService),this.sceneSerive=l.get(E.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){d.mapsService.on("click",d.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var d=window.document.createDocumentFragment(),x=window.document.createElement("body"),A;for(x.innerHTML=l;A=x.firstChild,!!A;)d.appendChild(A);return this.setDOMContent(d)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&$e.SO.remove(this.content),this.content=$e.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=$e.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,d,x){var A=window.document.createElement(l);return d!==void 0&&(A.className=d),x&&x.appendChild(A),A}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:$e.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,d=this.lngLat,x=this.popupOption,A=x.className,O=x.maxWidth,B=x.anchor;if(!(!this.mapsService||!d||!this.content)){var re=this.mapsService.getMarkerContainer();if(!this.container&&re){this.container=this.creatDom("div","l7-popup",re),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),A&&A.split(" ").forEach(function(ge){return l.container.classList.add(ge)});var Q=this.popupOption.stopPropagation;Q&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(ge){l.container.addEventListener(ge,function(Ze){Ze.stopPropagation()})})}O&&this.container.style.maxWidth!==O&&(this.container.style.maxWidth=O),this.updatePosition(),$e.SO.setTransform(this.container,"".concat($e.rQ[B])),(0,$e.zi)(this.container,B,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,d=l.lng,x=l.lat,A=this.popupOption.offsets,O=this.mapsService.lngLatToContainer([d,x]);this.container.style.left=O.x+A[0]+"px",this.container.style.top=O.y-A[1]+"px"}}}]),o}(Rt.EventEmitter);function et(i,c){if(c||(c=document),!!c){var o=c.head||c.getElementsByTagName("head")[0];if(!o){o=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(o,s):c.documentElement.appendChild(o)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=i:l.appendChild(c.createTextNode(i)),o.appendChild(l),l}}et(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`);var tt=g(92137),Ct=g(87757),jt=g.n(Ct),Mt=g(86700),Qt=g(88307),ne=g.n(Qt),Kt=g(28660),Dr=function(){function i(c,o){(0,V.Z)(this,i),(0,I.Z)(this,"attribute",void 0),(0,I.Z)(this,"buffer",void 0);var s=o.buffer,l=o.offset,d=o.stride,x=o.normalized,A=o.size,O=o.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:d||0,normalized:x||!1,divisor:O||0},A&&(this.attribute.size=A)}return(0,H.Z)(i,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(o){this.buffer.subData(o)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),i}(),Mr,nt,xt,ht,vr,Zr,Ur,tn,jr,wr,Dn,Zn,bi,Hi,qi=(Mr={},(0,I.Z)(Mr,E.gl.POINTS,"points"),(0,I.Z)(Mr,E.gl.LINES,"lines"),(0,I.Z)(Mr,E.gl.LINE_LOOP,"line loop"),(0,I.Z)(Mr,E.gl.LINE_STRIP,"line strip"),(0,I.Z)(Mr,E.gl.TRIANGLES,"triangles"),(0,I.Z)(Mr,E.gl.TRIANGLE_FAN,"triangle fan"),(0,I.Z)(Mr,E.gl.TRIANGLE_STRIP,"triangle strip"),Mr),ki=(nt={},(0,I.Z)(nt,E.gl.STATIC_DRAW,"static"),(0,I.Z)(nt,E.gl.DYNAMIC_DRAW,"dynamic"),(0,I.Z)(nt,E.gl.STREAM_DRAW,"stream"),nt),Oi=(xt={},(0,I.Z)(xt,E.gl.BYTE,"int8"),(0,I.Z)(xt,E.gl.UNSIGNED_INT,"int16"),(0,I.Z)(xt,E.gl.INT,"int32"),(0,I.Z)(xt,E.gl.UNSIGNED_BYTE,"uint8"),(0,I.Z)(xt,E.gl.UNSIGNED_SHORT,"uint16"),(0,I.Z)(xt,E.gl.UNSIGNED_INT,"uint32"),(0,I.Z)(xt,E.gl.FLOAT,"float"),xt),$=(ht={},(0,I.Z)(ht,E.gl.ALPHA,"alpha"),(0,I.Z)(ht,E.gl.LUMINANCE,"luminance"),(0,I.Z)(ht,E.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,I.Z)(ht,E.gl.RGB,"rgb"),(0,I.Z)(ht,E.gl.RGBA,"rgba"),(0,I.Z)(ht,E.gl.RGBA4,"rgba4"),(0,I.Z)(ht,E.gl.RGB5_A1,"rgb5 a1"),(0,I.Z)(ht,E.gl.RGB565,"rgb565"),(0,I.Z)(ht,E.gl.DEPTH_COMPONENT,"depth"),(0,I.Z)(ht,E.gl.DEPTH_STENCIL,"depth stencil"),ht),ce=(vr={},(0,I.Z)(vr,E.gl.DONT_CARE,"dont care"),(0,I.Z)(vr,E.gl.NICEST,"nice"),(0,I.Z)(vr,E.gl.FASTEST,"fast"),vr),ve=(Zr={},(0,I.Z)(Zr,E.gl.NEAREST,"nearest"),(0,I.Z)(Zr,E.gl.LINEAR,"linear"),(0,I.Z)(Zr,E.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,I.Z)(Zr,E.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,I.Z)(Zr,E.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,I.Z)(Zr,E.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Zr),j=(Ur={},(0,I.Z)(Ur,E.gl.REPEAT,"repeat"),(0,I.Z)(Ur,E.gl.CLAMP_TO_EDGE,"clamp"),(0,I.Z)(Ur,E.gl.MIRRORED_REPEAT,"mirror"),Ur),se=(tn={},(0,I.Z)(tn,E.gl.NONE,"none"),(0,I.Z)(tn,E.gl.BROWSER_DEFAULT_WEBGL,"browser"),tn),de=(jr={},(0,I.Z)(jr,E.gl.NEVER,"never"),(0,I.Z)(jr,E.gl.ALWAYS,"always"),(0,I.Z)(jr,E.gl.LESS,"less"),(0,I.Z)(jr,E.gl.LEQUAL,"lequal"),(0,I.Z)(jr,E.gl.GREATER,"greater"),(0,I.Z)(jr,E.gl.GEQUAL,"gequal"),(0,I.Z)(jr,E.gl.EQUAL,"equal"),(0,I.Z)(jr,E.gl.NOTEQUAL,"notequal"),jr),Me=(wr={},(0,I.Z)(wr,E.gl.FUNC_ADD,"add"),(0,I.Z)(wr,E.gl.MIN_EXT,"min"),(0,I.Z)(wr,E.gl.MAX_EXT,"max"),(0,I.Z)(wr,E.gl.FUNC_SUBTRACT,"subtract"),(0,I.Z)(wr,E.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),wr),ue=(Dn={},(0,I.Z)(Dn,E.gl.ZERO,"zero"),(0,I.Z)(Dn,E.gl.ONE,"one"),(0,I.Z)(Dn,E.gl.SRC_COLOR,"src color"),(0,I.Z)(Dn,E.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,I.Z)(Dn,E.gl.SRC_ALPHA,"src alpha"),(0,I.Z)(Dn,E.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,I.Z)(Dn,E.gl.DST_COLOR,"dst color"),(0,I.Z)(Dn,E.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,I.Z)(Dn,E.gl.DST_ALPHA,"dst alpha"),(0,I.Z)(Dn,E.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,I.Z)(Dn,E.gl.CONSTANT_COLOR,"constant color"),(0,I.Z)(Dn,E.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,I.Z)(Dn,E.gl.CONSTANT_ALPHA,"constant alpha"),(0,I.Z)(Dn,E.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,I.Z)(Dn,E.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),Dn),Te=(Zn={},(0,I.Z)(Zn,E.gl.NEVER,"never"),(0,I.Z)(Zn,E.gl.ALWAYS,"always"),(0,I.Z)(Zn,E.gl.LESS,"less"),(0,I.Z)(Zn,E.gl.LEQUAL,"lequal"),(0,I.Z)(Zn,E.gl.GREATER,"greater"),(0,I.Z)(Zn,E.gl.GEQUAL,"gequal"),(0,I.Z)(Zn,E.gl.EQUAL,"equal"),(0,I.Z)(Zn,E.gl.NOTEQUAL,"notequal"),Zn),mt=(bi={},(0,I.Z)(bi,E.gl.ZERO,"zero"),(0,I.Z)(bi,E.gl.KEEP,"keep"),(0,I.Z)(bi,E.gl.REPLACE,"replace"),(0,I.Z)(bi,E.gl.INVERT,"invert"),(0,I.Z)(bi,E.gl.INCR,"increment"),(0,I.Z)(bi,E.gl.DECR,"decrement"),(0,I.Z)(bi,E.gl.INCR_WRAP,"increment wrap"),(0,I.Z)(bi,E.gl.DECR_WRAP,"decrement wrap"),bi),br=(Hi={},(0,I.Z)(Hi,E.gl.FRONT,"front"),(0,I.Z)(Hi,E.gl.BACK,"back"),Hi),Yt=function(){function i(c,o){(0,V.Z)(this,i),(0,I.Z)(this,"buffer",void 0);var s=o.data,l=o.usage,d=o.type;this.buffer=c.buffer({data:s,usage:ki[l||E.gl.STATIC_DRAW],type:Oi[d||E.gl.UNSIGNED_BYTE]})}return(0,H.Z)(i,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(o){var s=o.data,l=o.offset;this.buffer.subdata(s,l)}}]),i}(),nr=function(){function i(c,o){(0,V.Z)(this,i),(0,I.Z)(this,"elements",void 0);var s=o.data,l=o.usage,d=o.type,x=o.count;this.elements=c.elements({data:s,usage:ki[l||E.gl.STATIC_DRAW],type:Oi[d||E.gl.UNSIGNED_BYTE],count:x})}return(0,H.Z)(i,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(o){var s=o.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),i}(),kr=function(){function i(c,o){(0,V.Z)(this,i),(0,I.Z)(this,"framebuffer",void 0);var s=o.width,l=o.height,d=o.color,x=o.colors,A=o.depth,O=o.stencil,B={width:s,height:l};Array.isArray(x)&&(B.colors=x.map(function(re){return re.get()})),d&&typeof d!="boolean"&&(B.color=d.get()),this.framebuffer=c.framebuffer(B)}return(0,H.Z)(i,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(o){var s=o.width,l=o.height;this.framebuffer.resize(s,l)}}]),i}(),Mn=g(90484),Pn=g(36719),tr=g.n(Pn),Sn=g(68630),on=g.n(Sn);function cn(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function wi(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?cn(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):cn(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var xn=function(){function i(c,o){(0,V.Z)(this,i),(0,I.Z)(this,"reGl",void 0),(0,I.Z)(this,"destroyed",!1),(0,I.Z)(this,"drawCommand",void 0),(0,I.Z)(this,"drawParams",void 0),(0,I.Z)(this,"options",void 0),(0,I.Z)(this,"uniforms",{}),this.reGl=c;var s=o.vs,l=o.fs,d=o.attributes,x=o.uniforms,A=o.primitive,O=o.count,B=o.elements,re=o.depth,Q=o.blend,ge=o.stencil,Ze=o.cull,_t=o.instances,Ht={};this.options=o,x&&(this.uniforms=this.extractUniforms(x),Object.keys(x).forEach(function(Vr){Ht[Vr]=c.prop(Vr)}));var _r={};Object.keys(d).forEach(function(Vr){_r[Vr]=d[Vr].get()});var Er={attributes:_r,frag:l,uniforms:Ht,vert:s,primitive:qi[A===void 0?E.gl.TRIANGLES:A]};_t&&(Er.instances=_t),O&&(Er.count=O),B&&(Er.elements=B.get()),this.initDepthDrawParams({depth:re},Er),this.initBlendDrawParams({blend:Q},Er),this.initStencilDrawParams({stencil:ge},Er),this.initCullDrawParams({cull:Ze},Er),this.drawCommand=c(Er),this.drawParams=Er}return(0,H.Z)(i,[{key:"addUniforms",value:function(o){this.uniforms=wi(wi({},this.uniforms),this.extractUniforms(o))}},{key:"draw",value:function(o){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=wi(wi({},this.uniforms),this.extractUniforms(o.uniforms||{})),l={};Object.keys(s).forEach(function(d){var x=(0,Mn.Z)(s[d]);x==="boolean"||x==="number"||Array.isArray(s[d])||s[d].BYTES_PER_ELEMENT?l[d]=s[d]:l[d]=s[d].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(o){o.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(o,s){var l=o.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:de[l.func||E.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(o,s){var l=o.blend;if(l){var d=l.enable,x=l.func,A=l.equation,O=l.color,B=O===void 0?[0,0,0,0]:O;s.blend={enable:!!d,func:{srcRGB:ue[x&&x.srcRGB||E.gl.SRC_ALPHA],srcAlpha:ue[x&&x.srcAlpha||E.gl.SRC_ALPHA],dstRGB:ue[x&&x.dstRGB||E.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:ue[x&&x.dstAlpha||E.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Me[A&&A.rgb||E.gl.FUNC_ADD],alpha:Me[A&&A.alpha||E.gl.FUNC_ADD]},color:B}}}},{key:"initStencilDrawParams",value:function(o,s){var l=o.stencil;if(l){var d=l.enable,x=l.mask,A=x===void 0?-1:x,O=l.func,B=O===void 0?{cmp:E.gl.ALWAYS,ref:0,mask:-1}:O,re=l.opFront,Q=re===void 0?{fail:E.gl.KEEP,zfail:E.gl.KEEP,zpass:E.gl.KEEP}:re,ge=l.opBack,Ze=ge===void 0?{fail:E.gl.KEEP,zfail:E.gl.KEEP,zpass:E.gl.KEEP}:ge;s.stencil={enable:!!d,mask:A,func:wi(wi({},B),{},{cmp:Te[B.cmp]}),opFront:{fail:mt[Q.fail],zfail:mt[Q.zfail],zpass:mt[Q.zpass]},opBack:{fail:mt[Ze.fail],zfail:mt[Ze.zfail],zpass:mt[Ze.zpass]}}}}},{key:"initCullDrawParams",value:function(o,s){var l=o.cull;if(l){var d=l.enable,x=l.face,A=x===void 0?E.gl.BACK:x;s.cull={enable:!!d,face:br[A]}}}},{key:"extractUniforms",value:function(o){var s=this,l={};return Object.keys(o).forEach(function(d){s.extractUniformsRecursively(d,o[d],l,"")}),l}},{key:"extractUniformsRecursively",value:function(o,s,l,d){var x=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||tr()(s)||s===""||"resize"in s){l["".concat(d&&d+".").concat(o)]=s;return}on()(s)&&Object.keys(s).forEach(function(A){x.extractUniformsRecursively(A,s[A],l,"".concat(d&&d+".").concat(o))}),Array.isArray(s)&&s.forEach(function(A,O){Object.keys(A).forEach(function(B){x.extractUniformsRecursively(B,A[B],l,"".concat(d&&d+".").concat(o,"[").concat(O,"]"))})})}}]),i}(),Li=function(){function i(c,o){(0,V.Z)(this,i),(0,I.Z)(this,"texture",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0);var s=o.data,l=o.type,d=l===void 0?E.gl.UNSIGNED_BYTE:l,x=o.width,A=o.height,O=o.flipY,B=O===void 0?!1:O,re=o.format,Q=re===void 0?E.gl.RGBA:re,ge=o.mipmap,Ze=ge===void 0?!1:ge,_t=o.wrapS,Ht=_t===void 0?E.gl.CLAMP_TO_EDGE:_t,_r=o.wrapT,Er=_r===void 0?E.gl.CLAMP_TO_EDGE:_r,Vr=o.aniso,_n=Vr===void 0?0:Vr,Rn=o.alignment,Xn=Rn===void 0?1:Rn,Ci=o.premultiplyAlpha,$n=Ci===void 0?!1:Ci,Pi=o.mag,ua=Pi===void 0?E.gl.NEAREST:Pi,xa=o.min,pi=xa===void 0?E.gl.NEAREST:xa,Ia=o.colorSpace,qa=Ia===void 0?E.gl.BROWSER_DEFAULT_WEBGL:Ia;this.width=x,this.height=A;var Cu={width:x,height:A,type:Oi[d],format:$[Q],wrapS:j[Ht],wrapT:j[Er],mag:ve[ua],min:ve[pi],alignment:Xn,flipY:B,colorSpace:se[qa],premultiplyAlpha:$n,aniso:_n};s&&(Cu.data=s),typeof Ze=="number"?Cu.mipmap=ce[Ze]:typeof Ze=="boolean"&&(Cu.mipmap=Ze),this.texture=c.texture(Cu)}return(0,H.Z)(i,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(o)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(o){var s=o.width,l=o.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),i}(),$i,ai,Ji=($i=(0,Mt.b2)(),$i(ai=function(){function i(){var c=this;(0,V.Z)(this,i),(0,I.Z)(this,"extensionObject",void 0),(0,I.Z)(this,"gl",void 0),(0,I.Z)(this,"$container",void 0),(0,I.Z)(this,"canvas",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDirty",void 0),(0,I.Z)(this,"createModel",function(o){return new xn(c.gl,o)}),(0,I.Z)(this,"createAttribute",function(o){return new Dr(c.gl,o)}),(0,I.Z)(this,"createBuffer",function(o){return new Yt(c.gl,o)}),(0,I.Z)(this,"createElements",function(o){return new nr(c.gl,o)}),(0,I.Z)(this,"createTexture2D",function(o){return new Li(c.gl,o)}),(0,I.Z)(this,"createFramebuffer",function(o){return new kr(c.gl,o)}),(0,I.Z)(this,"useFramebuffer",function(o,s){c.gl({framebuffer:o?o.get():null})(s)}),(0,I.Z)(this,"clear",function(o){var s=o.color,l=o.depth,d=o.stencil,x=o.framebuffer,A=x===void 0?null:x,O={color:s,depth:l,stencil:d};O.framebuffer=A===null?A:A.get(),c.gl.clear(O)}),(0,I.Z)(this,"viewport",function(o){var s=o.x,l=o.y,d=o.width,x=o.height;c.gl._gl.viewport(s,l,d,x),c.width=d,c.height=x,c.gl._refresh()}),(0,I.Z)(this,"readPixels",function(o){var s=o.framebuffer,l=o.x,d=o.y,x=o.width,A=o.height,O={x:l,y:d,width:x,height:A};return s&&(O.framebuffer=s.get()),c.gl.read(O)}),(0,I.Z)(this,"getViewportSize",function(){return{width:c.gl._gl.drawingBufferWidth,height:c.gl._gl.drawingBufferHeight}}),(0,I.Z)(this,"getContainer",function(){var o;return(o=c.canvas)===null||o===void 0?void 0:o.parentElement}),(0,I.Z)(this,"getCanvas",function(){return c.canvas}),(0,I.Z)(this,"getGLContext",function(){return c.gl._gl}),(0,I.Z)(this,"destroy",function(){c.gl.destroy()})}return(0,H.Z)(i,[{key:"init",value:function(){var c=(0,tt.Z)(jt().mark(function s(l,d){var x=this;return jt().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return this.canvas=l,O.next=3,new Promise(function(B,re){ne()({canvas:x.canvas,attributes:{alpha:!0,antialias:d.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(ge,Ze){(ge||!Ze)&&re(ge),B(Ze)}})});case 3:this.gl=O.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return O.stop()}},s,this)}));function o(s,l){return c.apply(this,arguments)}return o}()},{key:"testExtension",value:function(o){return!!this.getGLContext().getExtension(o)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var o=this.getGLContext();o.disable(o.CULL_FACE)}},{key:"setDirty",value:function(o){this.isDirty=o}},{key:"getDirty",value:function(){return this.isDirty}}]),i}())||ai);function Ni(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Ai(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Ni(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Ni(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var ha=function(){function i(c){(0,V.Z)(this,i),(0,I.Z)(this,"sceneService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"controlService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"markerService",void 0),(0,I.Z)(this,"popupService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"container",void 0);var o=c.id,s=c.map,l=(0,E.Hp)();this.container=l,s.setContainer(l,o),l.bind(E.vK.IRendererService).to(Ji).inSingletonScope(),this.sceneService=l.get(E.vK.ISceneService),this.mapService=l.get(E.vK.IMapService),this.iconService=l.get(E.vK.IIconService),this.fontService=l.get(E.vK.IFontService),this.controlService=l.get(E.vK.IControlService),this.layerService=l.get(E.vK.ILayerService),this.markerService=l.get(E.vK.IMarkerService),this.interactionService=l.get(E.vK.IInteractionService),this.popupService=l.get(E.vK.IPopupService),this.initComponent(o),this.sceneService.init(c),this.initControl()}return(0,H.Z)(i,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(o){return this.sceneService.exportPng(o)}},{key:"exportMap",value:function(o){return this.sceneService.exportPng(o)}},{key:"registerRenderService",value:function(o){var s=this;if(this.sceneService.loaded){var l=new o(this);l.init()}else this.on("loaded",function(){var d=new o(s);d.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(o){var s=(0,E.e7)(this.container);o.setContainer(s),this.sceneService.addLayer(o)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(o){return this.layerService.getLayer(o)}},{key:"getLayerByName",value:function(o){return this.layerService.getLayerByName(o)}},{key:"removeLayer",value:function(o){this.layerService.remove(o)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(o,s){this.fontService.addIconFont(o,s)}},{key:"addIconFonts",value:function(o){var s=this;o.forEach(function(l){var d=(0,Z.Z)(l,2),x=d[0],A=d[1];s.fontService.addIconFont(x,A)})}},{key:"addFontFace",value:function(o,s){this.sceneService.addFontFace(o,s)}},{key:"addImage",value:function(o,s){this.iconService.addImage(o,s)}},{key:"hasImage",value:function(o){return this.iconService.hasImage(o)}},{key:"removeImage",value:function(o){this.iconService.removeImage(o)}},{key:"addIconFontGlyphs",value:function(o,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(o){this.controlService.addControl(o,this.container)}},{key:"removeControl",value:function(o){this.controlService.removeControl(o)}},{key:"getControlByName",value:function(o){return this.controlService.getControlByName(o)}},{key:"addMarker",value:function(o){this.markerService.addMarker(o)}},{key:"addMarkerLayer",value:function(o){this.markerService.addMarkerLayer(o)}},{key:"removeMarkerLayer",value:function(o){this.markerService.removeMarkerLayer(o)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(o){this.popupService.addPopup(o)}},{key:"on",value:function(o,s){E.SceneEventList.indexOf(o)===-1?this.mapService.on(o,s):this.sceneService.on(o,s)}},{key:"once",value:function(o,s){E.SceneEventList.indexOf(o)===-1?this.mapService.once(o,s):this.sceneService.once(o,s)}},{key:"off",value:function(o,s){E.SceneEventList.indexOf(o)===-1?this.mapService.off(o,s):this.sceneService.off(o,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(o){return this.mapService.getCenter(o)}},{key:"setCenter",value:function(o,s){return this.mapService.setCenter(o,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(o){return this.mapService.setPitch(o)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(o){this.mapService.setRotation(o)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(o){this.mapService.panTo(o)}},{key:"panBy",value:function(o){this.mapService.panBy(o)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(o){this.mapService.setZoom(o)}},{key:"fitBounds",value:function(o,s){var l=this.sceneService.getSceneConfig(),d=l.fitBoundsOptions,x=l.animate;this.mapService.fitBounds(o,s||Ai(Ai({},d),{},{animate:x}))}},{key:"setZoomAndCenter",value:function(o,s){this.mapService.setZoomAndCenter(o,s)}},{key:"setMapStyle",value:function(o){this.mapService.setMapStyle(o)}},{key:"setMapStatus",value:function(o){this.mapService.setMapStatus(o)}},{key:"pixelToLngLat",value:function(o){return this.mapService.pixelToLngLat(o)}},{key:"lngLatToPixel",value:function(o){return this.mapService.lngLatToPixel(o)}},{key:"containerToLngLat",value:function(o){return this.mapService.containerToLngLat(o)}},{key:"lngLatToContainer",value:function(o){return this.mapService.lngLatToContainer(o)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(o,s){this.container.bind(E.vK.IPostProcessingPass).to(o).whenTargetNamed(s)}},{key:"initComponent",value:function(o){this.controlService.init({container:$e.SO.getContainer(o)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var o=this.sceneService.getSceneConfig(),s=o.logoVisible,l=o.logoPosition;s&&this.addControl(new It({position:l}))}}]),i}(),Ca=g(81253),ii=g(55770),ti=g(3473),Xi=g(13218),va=g.n(Xi),Vo=g(23560),ba=g.n(Vo),gi=g(46343),Bs,nu,Aa,Io,zi;function Ka(i){return i.map(function(c){return typeof c=="string"&&(c=[c,{}]),c})}var Go=(Bs=(0,Mt.b2)(),nu=(0,Mt.f3)(E.vK.IGlobalConfigService),Bs(Aa=(Io=function(){function i(){(0,V.Z)(this,i),(0,ii.Z)(this,"configService",zi,this),(0,I.Z)(this,"enabled",void 0)}return(0,H.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.rendererService,x=s.postProcessingPassFactory,A=s.normalPassFactory;o.hooks.init.tap("MultiPassRendererPlugin",function(){var O=o.getLayerConfig(),B=O.enableMultiPassRenderer,re=O.passes,Q=re===void 0?[]:re;l.enabled=!!B&&o.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(o.multiPassRenderer=l.createMultiPassRenderer(o,Q,x,A),o.multiPassRenderer.setRenderFlag(!0))}),o.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(o,s,l,d){var x=o.multiPassRenderer,A=o.getLayerConfig(),O=A.enablePicking,B=A.enableTAA;return O&&x.add(d("pixelPicking")),x}}]),i}(),zi=(0,ti.Z)(Io.prototype,"configService",[nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Io))||Aa),ea,To=(ea={},(0,I.Z)(ea,E.BlendType.additive,{enable:!0,func:{srcRGB:E.gl.ONE,dstRGB:E.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(ea,E.BlendType.none,{enable:!1}),(0,I.Z)(ea,E.BlendType.normal,{enable:!0,func:{srcRGB:E.gl.SRC_ALPHA,dstRGB:E.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(ea,E.BlendType.subtractive,{enable:!0,func:{srcRGB:E.gl.ONE,dstRGB:E.gl.ONE,srcAlpha:E.gl.ZERO,dstAlpha:E.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:E.gl.FUNC_SUBTRACT,alpha:E.gl.FUNC_SUBTRACT}}),(0,I.Z)(ea,E.BlendType.max,{enable:!0,func:{srcRGB:E.gl.ONE,dstRGB:E.gl.ONE},equation:{rgb:E.gl.MAX_EXT}}),(0,I.Z)(ea,E.BlendType.min,{enable:!0,func:{srcRGB:E.gl.ONE,dstRGB:E.gl.ONE},equation:{rgb:E.gl.MIN_EXT}}),ea),Oo=g(47037),co=g.n(Oo),fo=g(81763),Yi=g.n(fo),Da=g(1469),ka=g.n(Da),fs=1024;function Sa(i,c,o,s,l){c.updateStyleAttribute(i,o,s,l)}function be(i,c){i.opacity&&Ne("opacity",c,i.opacity),i.strokeWidth&&Ne("strokeWidth",c,i.strokeWidth),i.strokeOpacity&&Ne("strokeOpacity",c,i.strokeOpacity),i.stroke&&rr("stroke",c,i.stroke),i.offsets&&pt("offsets",c,i.offsets),i.textOffset&&pt("textOffset",c,i.textOffset)}function Ne(i,c,o){co()(o)?Sa(i,c,o,function(s){return s}):Yi()(o)?Sa(i,c,[o],void 0):ka()(o)&&o.length===2?co()(o[0])&&ba()(o[1])||co()(o[0])&&ka()(o[1])&&Yi()(o[1][0])&&Yi()(o[1][1])?Sa(i,c,o[0],o[1]):Sa(i,c,[1],void 0):Sa(i,c,[1],void 0)}function pt(i,c,o){co()(o)?Sa(i,c,o,function(s){return s}):ka()(o)&&o.length===2&&co()(o[0])&&ba()(o[1])?Sa(i,c,o[0],o[1]):ka()(o)&&o.length===2&&Yi()(o[0])&&Yi()(o[1])?Sa(i,c,o,void 0):Sa(i,c,[0,0],void 0)}function rr(i,c,o){co()(o)?Sa(i,c,o,void 0):ka()(o)&&o.length===2&&(co()(o[0])&&ba()(o[1])||co()(o[0])&&ka()(o[1])&&o[1].length>0)?Sa(i,c,o[0],o[1]):Sa(i,c,"#fff",void 0)}var Xr,Kn,vi,Ga,ao;function oo(i,c){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=hs(i))||c&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(B){throw B},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){o=o.call(i)},n:function(){var B=o.next();return d=B.done,B},e:function(B){x=!0,A=B},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(x)throw A}}}}function hs(i,c){if(!!i){if(typeof i=="string")return Xs(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Xs(i,c)}}function Xs(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function ws(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function _o(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?ws(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):ws(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function rs(i){var c=Ho();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Ho(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Lo=0,xo=(Xr=(0,E.yT)(E.vK.IGlobalConfigService),Kn=(0,E.yT)(E.vK.IShaderModuleService),vi=function(i){(0,_e.Z)(o,i);var c=rs(o);function o(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,V.Z)(this,o),s=c.call(this),(0,I.Z)((0,L.Z)(s),"id","".concat(Lo++)),(0,I.Z)((0,L.Z)(s),"name","".concat(Lo)),(0,I.Z)((0,L.Z)(s),"type",void 0),(0,I.Z)((0,L.Z)(s),"visible",!0),(0,I.Z)((0,L.Z)(s),"zIndex",0),(0,I.Z)((0,L.Z)(s),"minZoom",void 0),(0,I.Z)((0,L.Z)(s),"maxZoom",void 0),(0,I.Z)((0,L.Z)(s),"inited",!1),(0,I.Z)((0,L.Z)(s),"layerModelNeedUpdate",!1),(0,I.Z)((0,L.Z)(s),"pickedFeatureID",null),(0,I.Z)((0,L.Z)(s),"selectedFeatureID",null),(0,I.Z)((0,L.Z)(s),"styleNeedUpdate",!1),(0,I.Z)((0,L.Z)(s),"rendering",void 0),(0,I.Z)((0,L.Z)(s),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,I.Z)((0,L.Z)(s),"hooks",{init:new gi.oI,afterInit:new gi.oI,beforeRender:new gi.oI,beforeRenderData:new gi.gg,afterRender:new gi.ni,beforePickingEncode:new gi.ni,afterPickingEncode:new gi.ni,beforeHighlight:new gi.ni(["pickedColor"]),afterHighlight:new gi.ni,beforeSelect:new gi.ni(["pickedColor"]),afterSelect:new gi.ni,beforeDestroy:new gi.ni,afterDestroy:new gi.ni}),(0,I.Z)((0,L.Z)(s),"models",[]),(0,I.Z)((0,L.Z)(s),"multiPassRenderer",void 0),(0,I.Z)((0,L.Z)(s),"plugins",void 0),(0,I.Z)((0,L.Z)(s),"sourceOption",void 0),(0,I.Z)((0,L.Z)(s),"layerModel",void 0),(0,ii.Z)((0,L.Z)(s),"configService",Ga,(0,L.Z)(s)),(0,ii.Z)((0,L.Z)(s),"shaderModuleService",ao,(0,L.Z)(s)),(0,I.Z)((0,L.Z)(s),"cameraService",void 0),(0,I.Z)((0,L.Z)(s),"coordinateService",void 0),(0,I.Z)((0,L.Z)(s),"iconService",void 0),(0,I.Z)((0,L.Z)(s),"fontService",void 0),(0,I.Z)((0,L.Z)(s),"pickingService",void 0),(0,I.Z)((0,L.Z)(s),"rendererService",void 0),(0,I.Z)((0,L.Z)(s),"layerService",void 0),(0,I.Z)((0,L.Z)(s),"interactionService",void 0),(0,I.Z)((0,L.Z)(s),"mapService",void 0),(0,I.Z)((0,L.Z)(s),"styleAttributeService",void 0),(0,I.Z)((0,L.Z)(s),"layerSource",void 0),(0,I.Z)((0,L.Z)(s),"postProcessingPassFactory",void 0),(0,I.Z)((0,L.Z)(s),"normalPassFactory",void 0),(0,I.Z)((0,L.Z)(s),"animateOptions",{enable:!1}),(0,I.Z)((0,L.Z)(s),"container",void 0),(0,I.Z)((0,L.Z)(s),"encodedData",void 0),(0,I.Z)((0,L.Z)(s),"configSchema",void 0),(0,I.Z)((0,L.Z)(s),"currentPickId",null),(0,I.Z)((0,L.Z)(s),"rawConfig",void 0),(0,I.Z)((0,L.Z)(s),"needUpdateConfig",void 0),(0,I.Z)((0,L.Z)(s),"pendingStyleAttributes",[]),(0,I.Z)((0,L.Z)(s),"scaleOptions",{}),(0,I.Z)((0,L.Z)(s),"animateStartTime",void 0),(0,I.Z)((0,L.Z)(s),"aniamateStatus",!1),(0,I.Z)((0,L.Z)(s),"sourceEvent",function(){s.dataState.dataSourceNeedUpdate=!0;var d=s.getLayerConfig(),x=d.autoFit,A=d.fitBoundsOptions;x&&s.fitBounds(A),s.emit("dataUpdate"),s.reRender()}),s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,H.Z)(o,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=_o(_o({},this.needUpdateConfig),l);else{var d=this.container.get(E.vK.SceneID);be(l,this),this.configService.setLayerConfig(d,this.id,_o(_o(_o({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,d=this.container.get(E.vK.SceneID),x=this.rawConfig.enableMultiPassRenderer,A=x===void 0?!1:x;this.configService.setLayerConfig(d,this.id,{enableMultiPassRenderer:A}),this.iconService=this.container.get(E.vK.IIconService),this.fontService=this.container.get(E.vK.IFontService),this.rendererService=this.container.get(E.vK.IRendererService),this.layerService=this.container.get(E.vK.ILayerService),this.interactionService=this.container.get(E.vK.IInteractionService),this.pickingService=this.container.get(E.vK.IPickingService),this.mapService=this.container.get(E.vK.IMapService),this.cameraService=this.container.get(E.vK.ICameraService),this.coordinateService=this.container.get(E.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(E.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(E.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(E.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(E.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(Q){var ge=Q.attributeName,Ze=Q.attributeField,_t=Q.attributeValues,Ht=Q.updateOptions;l.styleAttributeService.updateStyleAttribute(ge,{scale:_o({field:Ze},l.splitValuesAndCallbackInAttribute(_t,l.getLayerConfig()[ge]))},Ht)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(E.vK.ILayerPlugin);var O=oo(this.plugins),B;try{for(O.s();!(B=O.n()).done;){var re=B.value;re.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(Q){O.e(Q)}finally{O.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(_o(_o({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),d=l.animateOption;d!=null&&d.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,d,x){return this.updateStyleAttribute("color",l,d,x),this}},{key:"texture",value:function(l,d,x){return this.updateStyleAttribute("texture",l,d,x),this}},{key:"rotate",value:function(l,d,x){return this.updateStyleAttribute("rotate",l,d,x),this}},{key:"size",value:function(l,d,x){return this.updateStyleAttribute("size",l,d,x),this}},{key:"filter",value:function(l,d,x){return this.updateStyleAttribute("filter",l,d,x),this}},{key:"shape",value:function(l,d,x){return this.updateStyleAttribute("shape",l,d,x),this}},{key:"label",value:function(l,d,x){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:d,updateOptions:x}),this}},{key:"animate",value:function(l){var d={};return va()(l)?(d.enable=!0,d=_o(_o({},d),l)):d.enable=l,this.updateLayerConfig({animateOption:d}),this}},{key:"source",value:function(l,d){return this.sourceOption={data:l,options:d},this}},{key:"setData",value:function(l,d){var x=this;return this.inited?this.layerSource.setData(l,d):this.on("inited",function(){x.layerSource.setData(l,d)}),this}},{key:"style",value:function(l){var d=this,x=l.passes,A=(0,Ca.Z)(l,["passes"]);return x&&Ka(x).forEach(function(O){var B=d.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(O[0]);B&&B.updateOptions(O[1])}),this.rawConfig=_o(_o({},this.rawConfig),A),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,d){return va()(l)?this.scaleOptions=_o(_o({},this.scaleOptions),l):this.scaleOptions[l]=d,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(l){var d={};return d.enableHighlight=va()(l)?!0:l,va()(l)?(d.enableHighlight=!0,l.color&&(d.highlightColor=l.color)):d.enableHighlight=!!l,this.updateLayerConfig(d),this}},{key:"setActive",value:function(l,d){var x=this;if(va()(l)){var A=l.x,O=A===void 0?0:A,B=l.y,re=B===void 0?0:B;this.updateLayerConfig({highlightColor:va()(d)?d.color:this.getLayerConfig().highlightColor}),this.pick({x:O,y:re})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:va()(d)?d.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,$e.Z6)(l)).then(function(){setTimeout(function(){x.reRender()},1)})}},{key:"select",value:function(l){var d={};return d.enableSelect=va()(l)?!0:l,va()(l)?(d.enableSelect=!0,l.color&&(d.selectColor=l.color)):d.enableSelect=!!l,this.updateLayerConfig(d),this}},{key:"setSelect",value:function(l,d){var x=this;if(va()(l)){var A=l.x,O=A===void 0?0:A,B=l.y,re=B===void 0?0:B;this.updateLayerConfig({selectColor:va()(d)?d.color:this.getLayerConfig().selectColor}),this.pick({x:O,y:re})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:va()(d)?d.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,$e.Z6)(l)).then(function(){setTimeout(function(){x.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),d=this.getLayerConfig(),x=d.visible,A=d.minZoom,O=A===void 0?-Infinity:A,B=d.maxZoom,re=B===void 0?Infinity:B;return!!x&&l>=O&&l<=re}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),d=l.minZoom;return d}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),d=l.maxZoom;return d}},{key:"get",value:function(l){var d=this.getLayerConfig();return d[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var d=this.getSource(),x=d.extent,A=x.some(function(O){return Math.abs(O)===Infinity});return A?this:(this.mapService.fitBounds([[x[0],x[1]],[x[2],x[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var d=this.mapService.getZoom();this.layerSource.updateClusterData(d)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(l){var d=this.styleAttributeService.getLayerAttributeScale(l);if(d){if(d.ticks){var x=d.ticks().map(function(O){return(0,I.Z)({value:O},l,d(O))});return x}else if(d.invertExtent){var A=d.range().map(function(O){return(0,I.Z)({value:d.invertExtent(O)},l,O)});return A}}else return[]}},{key:"pick",value:function(l){var d=l.x,x=l.y;this.interactionService.triggerHover({x:d,y:x})}},{key:"boxSelect",value:function(l,d){this.pickingService.boxPickLayer(this,l,d)}},{key:"buildLayerModel",value:function(l){var d=l.moduleName,x=l.vertexShader,A=l.fragmentShader,O=l.triangulation,B=l.segmentNumber,re=(0,Ca.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"]);this.shaderModuleService.registerModule(d,{vs:x,fs:A});var Q=this.shaderModuleService.getModule(d),ge=Q.vs,Ze=Q.fs,_t=Q.uniforms,Ht=this.rendererService.createModel,_r=this.styleAttributeService.createAttributesAndIndices(this.encodedData,O,B),Er=_r.attributes,Vr=_r.elements;return Ht(_o({attributes:Er,uniforms:_t,fs:Ze,vs:ge,elements:Vr,blend:To[E.BlendType.normal]},re))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var d=this.getLayerConfig(),x=d.enableHighlight,A=x===void 0?!0:x,O=d.enableSelect,B=O===void 0?!0:O,re=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&B&&(re=!0),l==="mousemove"&&(A||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(re=!0),this.isVisible()&&re}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:l.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(l,d,x,A){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:_o({field:d},this.splitValuesAndCallbackInAttribute(x,this.getLayerConfig()[d]))},A):this.pendingStyleAttributes.push({attributeName:l,attributeField:d,attributeValues:x,updateOptions:A})}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,d){return{values:ba()(l)?void 0:l||d,callback:ba()(l)?l:void 0}}}]),o}(Rt.EventEmitter),Ga=(0,ti.Z)(vi.prototype,"configService",[Xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ao=(0,ti.Z)(vi.prototype,"shaderModuleService",[Kn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vi),Si=g(85061),Ds=g(18446),ns=g.n(Ds),ps=g(2650),wa,vo,ju,Sl,wu;function Ul(i,c){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=Vu(i))||c&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(B){throw B},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){o=o.call(i)},n:function(){var B=o.next();return d=B.done,B},e:function(B){x=!0,A=B},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(x)throw A}}}}function Vu(i,c){if(!!i){if(typeof i=="string")return Tu(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Tu(i,c)}}function Tu(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}var Na=(wa=(0,E.yT)(E.vK.IGlobalConfigService),vo=(0,E.yT)(E.vK.IShaderModuleService),ju=function(){function i(c){(0,V.Z)(this,i),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"createTexture2D",void 0),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"dataTexture",void 0),(0,I.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,I.Z)(this,"rowCount",void 0),(0,I.Z)(this,"cacheStyleProperties",void 0),(0,I.Z)(this,"cellLength",void 0),(0,I.Z)(this,"cellProperties",void 0),(0,I.Z)(this,"cellTypeLayout",void 0),(0,I.Z)(this,"stylePropertyesExist",void 0),(0,I.Z)(this,"dataTextureTest",void 0),(0,ii.Z)(this,"configService",Sl,this),(0,ii.Z)(this,"shaderModuleService",wu,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"styleAttributeService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"layerService",void 0),this.layer=c,this.rendererService=c.getContainer().get(E.vK.IRendererService),this.styleAttributeService=c.getContainer().get(E.vK.IStyleAttributeService),this.mapService=c.getContainer().get(E.vK.IMapService),this.iconService=c.getContainer().get(E.vK.IIconService),this.fontService=c.getContainer().get(E.vK.IFontService),this.cameraService=c.getContainer().get(E.vK.ICameraService),this.layerService=c.getContainer().get(E.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var o=this.rendererService.createTexture2D;this.createTexture2D=o,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:E.gl.NEAREST,min:E.gl.NEAREST,width:1,height:1}))}return(0,H.Z)(i,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(o){var s=!1;return ns()(o.opacity,this.cacheStyleProperties.opacity)||(s=!0,this.cacheStyleProperties.opacity=o.opacity),ns()(o.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(s=!0,this.cacheStyleProperties.strokeOpacity=o.strokeOpacity),ns()(o.strokeWidth,this.cacheStyleProperties.strokeWidth)||(s=!0,this.cacheStyleProperties.strokeWidth=o.strokeWidth),ns()(o.stroke,this.cacheStyleProperties.stroke)||(s=!0,this.cacheStyleProperties.stroke=o.stroke),ns()(o.offsets,this.cacheStyleProperties.offsets)||(s=!0,this.cacheStyleProperties.offsets=o.offsets),this.dataTexture===void 0&&(s=!0),s}},{key:"judgeStyleAttributes",value:function(o){this.clearLastCalRes(),o.opacity!==void 0&&!Yi()(o.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),o.strokeOpacity!==void 0&&!Yi()(o.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),o.strokeWidth!==void 0&&!Yi()(o.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),o.stroke!==void 0&&!this.isStaticColor(o.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),o.offsets!==void 0&&!this.isOffsetStatic(o.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(o){return co()(o)?!!(0,ps.ZP)(o):!1}},{key:"getStrokeColor",value:function(o){if(this.isStaticColor(o)){var s=(0,$e.CI)(o);return s[0]=s[0]?s[0]:0,s[1]=s[1]?s[1]:0,s[2]=s[2]?s[2]:0,s[3]=s[3]?s[3]:0,s}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(o){return!!(ka()(o)&&o.length===2&&Yi()(o[0])&&Yi()(o[1]))}},{key:"patchMod",value:function(o,s){for(var l=0;l<s;l++)o.push(-1)}},{key:"patchData",value:function(o,s,l){var d=Ul(l),x;try{for(d.s();!(x=d.n()).done;){var A=x.value,O=A.attr,B=A.count,re=s[O];re?O==="stroke"?o.push.apply(o,(0,Si.Z)((0,$e.CI)(re))):O==="offsets"?this.isOffsetStatic(re)?o.push(-re[0],re[1]):o.push(0,0):o.push(Yi()(re)?re:1):this.patchMod(o,B)}}catch(Q){d.e(Q)}finally{d.f()}}},{key:"calDataFrame",value:function(o,s,l){for(var d=s.length,x=Math.ceil(d*o/this.DATA_TEXTURE_WIDTH),A=x*this.DATA_TEXTURE_WIDTH,O=[],B=0;B<d;B++){var re=s[B];this.patchData(O,re,l)}for(var Q=O.length;Q<A;Q++)O.push(-1);return{data:O,width:this.DATA_TEXTURE_WIDTH,height:x}}},{key:"getBlend",value:function(){var o=this.layer.getLayerConfig(),s=o.blend,l=s===void 0?"normal":s;return To[E.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.duration||4,o.interval||.2,o.trailLength||.1]}},{key:"startModelAnimate",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),i}(),Sl=(0,ti.Z)(ju.prototype,"configService",[wa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wu=(0,ti.Z)(ju.prototype,"shaderModuleService",[vo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ju),Gu=g(9187),m=g.n(Gu),w=g(31437),W=w.Ue(),R=w.Ue(),le=w.Ue(),Le=w.Ue(),ct=w.Ue();function Nt(i,c,o,s,l){w.IH(i,o,s),w.Fv(i,i),c=w.al(-i[1],i[0]);var d=w.al(-o[1],o[0]);return[l/w.AK(c,d),c]}function kt(i,c){return w.t8(i,-c[1],c[0])}function Tr(i,c,o){return w.lu(i,c,o),w.Fv(i,i),i}function Gr(i,c){return i[0]===c[0]&&i[1]===c[1]}function Jn(i){for(var c=new Map,o=0;o<i.length;o++){var s=i[0].toString()+"-"+i[1].toString();c.get(s)?(i.splice(o,1),o++):c.set(s,s)}return i}var Mi=function(){function i(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,V.Z)(this,i),(0,I.Z)(this,"complex",void 0),(0,I.Z)(this,"join",void 0),(0,I.Z)(this,"cap",void 0),(0,I.Z)(this,"miterLimit",void 0),(0,I.Z)(this,"thickness",void 0),(0,I.Z)(this,"normal",void 0),(0,I.Z)(this,"lastFlip",-1),(0,I.Z)(this,"miter",w.al(0,0)),(0,I.Z)(this,"started",!1),(0,I.Z)(this,"dash",!1),(0,I.Z)(this,"totalDistance",0),this.join=c.join||"miter",this.cap=c.cap||"butt",this.miterLimit=c.miterLimit||10,this.thickness=c.thickness||1,this.dash=c.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,H.Z)(i,[{key:"extrude_gaode2",value:function(o,s){var l=this.complex;if(o.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var d=o.length,x=l.startIndex,A=1;A<d;A++){var O=o[A-1],B=s[A-1],re=o[A],Q=s[A],ge=A<o.length-1?o[A+1]:null,Ze=A<s.length-1?s[A+1]:null,_t=this.segment_gaode2(l,x,O,re,ge,B,Q,Ze);x+=_t}if(this.dash)for(var Ht=0;Ht<l.positions.length/6;Ht++)l.positions[Ht*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(o){var s=this.complex;if(o.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=o.length,d=s.startIndex,x=1;x<l;x++){var A=o[x-1],O=o[x],B=x<o.length-1?o[x+1]:null,re=this.segment(s,d,A,O,B);d+=re}if(this.dash)for(var Q=0;Q<s.positions.length/6;Q++)s.positions[Q*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(o,s,l,d,x,A,O,B){var re=0,Q=o.indices,ge=o.positions,Ze=o.normals,_t=this.cap==="square",Ht=this.join==="bevel",_r=(0,$e.Z)([O[0],O[1]]),Er=(0,$e.Z)([A[0],A[1]]);Tr(le,d,l);var Vr=0;if(this.dash&&(Vr=this.lineSegmentDistance(_r,Er),this.totalDistance+=Vr),this.normal||(this.normal=w.Ue(),kt(this.normal,le)),!this.started)if(this.started=!0,_t){var _n=w.Ue(),Rn=w.Ue();w.IH(_n,this.normal,le),w.IH(Rn,this.normal,le),Ze.push(Rn[0],Rn[1],0),Ze.push(_n[0],_n[1],0),ge.push(l[0],l[1],0,this.totalDistance-Vr,-this.thickness,0),ge.push(l[0],l[1],0,this.totalDistance-Vr,this.thickness,0)}else this.extrusions(ge,Ze,l,this.normal,this.thickness,this.totalDistance-Vr);if(Q.push(s+0,s+1,s+2),x){Gr(d,x)&&w.IH(x,d,w.Fv(x,w.$X(x,d,l))),Tr(Le,x,d);var $n=Nt(ct,w.Ue(),le,Le,this.thickness),Pi=(0,Z.Z)($n,2),ua=Pi[0],xa=Pi[1],pi=w.AK(ct,this.normal)<0?-1:1,Ia=Ht;if(!Ia&&this.join==="miter"){var qa=ua;qa>this.miterLimit&&(Ia=!0)}Ia?(Ze.push(this.normal[0],this.normal[1],0),Ze.push(xa[0],xa[1],0),ge.push(d[0],d[1],0,this.totalDistance,-this.thickness*pi,0),ge.push(d[0],d[1],0,this.totalDistance,this.thickness*pi,0),Q.push.apply(Q,(0,Si.Z)(this.lastFlip!==-pi?[s,s+2,s+3]:[s+2,s+1,s+3])),Q.push(s+2,s+3,s+4),kt(W,Le),w.JG(this.normal,W),Ze.push(this.normal[0],this.normal[1],0),ge.push(d[0],d[1],0,this.totalDistance,-this.thickness*pi,0),re+=3):(this.extrusions(ge,Ze,d,xa,ua,this.totalDistance),Q.push.apply(Q,(0,Si.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),pi=-1,w.JG(this.normal,xa),re+=2),this.lastFlip=pi}else{if(kt(this.normal,le),_t){var Xn=w.Ue(),Ci=w.Ue();w.lu(Ci,le,this.normal),w.IH(Xn,le,this.normal),Ze.push(Ci[0],Ci[1],0),Ze.push(Xn[0],Xn[1],0),ge.push(d[0],d[1],0,this.totalDistance,this.thickness,0),ge.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(ge,Ze,d,this.normal,this.thickness,this.totalDistance);Q.push.apply(Q,(0,Si.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),re+=2}return re}},{key:"segment",value:function(o,s,l,d,x){var A=0,O=o.indices,B=o.positions,re=o.normals,Q=this.cap==="square",ge=this.join==="bevel",Ze=(0,$e.Z)([d[0],d[1]]),_t=(0,$e.Z)([l[0],l[1]]);Tr(le,Ze,_t);var Ht=0;if(this.dash&&(Ht=this.lineSegmentDistance(Ze,_t),this.totalDistance+=Ht),this.normal||(this.normal=w.Ue(),kt(this.normal,le)),!this.started)if(this.started=!0,Q){var _r=w.Ue(),Er=w.Ue();w.IH(_r,this.normal,le),w.IH(Er,this.normal,le),re.push(Er[0],Er[1],0),re.push(_r[0],_r[1],0),B.push(l[0],l[1],0,this.totalDistance-Ht,-this.thickness,0),B.push(l[0],l[1],0,this.totalDistance-Ht,this.thickness,0)}else this.extrusions(B,re,l,this.normal,this.thickness,this.totalDistance-Ht);if(O.push(s+0,s+1,s+2),x){var Rn=(0,$e.Z)([x[0],x[1]]);Gr(Ze,Rn)&&w.IH(Rn,Ze,w.Fv(Rn,w.$X(Rn,Ze,_t))),Tr(Le,Rn,Ze);var Xn=Nt(ct,w.Ue(),le,Le,this.thickness),Ci=(0,Z.Z)(Xn,2),$n=Ci[0],Pi=Ci[1],ua=w.AK(ct,this.normal)<0?-1:1,xa=ge;if(!xa&&this.join==="miter"){var pi=$n;pi>this.miterLimit&&(xa=!0)}xa?(re.push(this.normal[0],this.normal[1],0),re.push(Pi[0],Pi[1],0),B.push(d[0],d[1],0,this.totalDistance,-this.thickness*ua,0),B.push(d[0],d[1],0,this.totalDistance,this.thickness*ua,0),O.push.apply(O,(0,Si.Z)(this.lastFlip!==-ua?[s,s+2,s+3]:[s+2,s+1,s+3])),O.push(s+2,s+3,s+4),kt(W,Le),w.JG(this.normal,W),re.push(this.normal[0],this.normal[1],0),B.push(d[0],d[1],0,this.totalDistance,-this.thickness*ua,0),A+=3):(this.extrusions(B,re,d,Pi,$n,this.totalDistance),O.push.apply(O,(0,Si.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),ua=-1,w.JG(this.normal,Pi),A+=2),this.lastFlip=ua}else{if(kt(this.normal,le),Q){var Vr=w.Ue(),_n=w.Ue();w.lu(_n,le,this.normal),w.IH(Vr,le,this.normal),re.push(_n[0],_n[1],0),re.push(Vr[0],Vr[1],0),B.push(d[0],d[1],0,this.totalDistance,this.thickness,0),B.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(B,re,d,this.normal,this.thickness,this.totalDistance);O.push.apply(O,(0,Si.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),A+=2}return A}},{key:"extrusions",value:function(o,s,l,d,x,A){s.push(d[0],d[1],0),s.push(d[0],d[1],0),o.push(l[0],l[1],0,A,-x,0),o.push(l[0],l[1],0,A,x,0)}},{key:"lineSegmentDistance",value:function(o,s){var l=s[0]-o[0],d=s[1]-o[1];return Math.sqrt(l*l+d*d)}}]),i}();function ci(i){if(Yi()(i[0]))return i;if(Yi()(i[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Yi()(i[0][0][0])){var c=i,o=0,s=0,l=0;return c.forEach(function(d){d.forEach(function(x){o+=x[0],s+=x[1],l++})}),[o/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var Ti=g(77160);function Ui(i){var c=i[0][0],o=i[0][i[0].length-1];c[0]===o[0]&&c[1]===o[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var s=i[0].length,l=m().flatten(i),d=l.vertices,x=l.dimensions,A=[],O=[],B=0;B<d.length/x;B++)x===2?A.push(d[B*2],d[B*2+1],1):A.push(d[B*3],d[B*3+1],1);var re=m()(l.vertices,l.holes,l.dimensions);O.push.apply(O,(0,Si.Z)(re));for(var Q=function(_t){var Ht=l.vertices.slice(_t*x,(_t+1)*x),_r=l.vertices.slice((_t+1)*x,(_t+2)*x);_r.length===0&&(_r=l.vertices.slice(0,x));var Er=A.length/3;A.push(Ht[0],Ht[1],1,_r[0],_r[1],1,Ht[0],Ht[1],0,_r[0],_r[1],0),O.push.apply(O,(0,Si.Z)([0,2,1,2,3,1].map(function(Vr){return Vr+Er})))},ge=0;ge<s;ge++)Q(ge);return{positions:A,index:O}}function Fa(i){var c=m().flatten(i),o=m()(c.vertices,c.holes,c.dimensions);return{positions:c.vertices,index:o}}function ta(i){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=i[0][0],s=i[0][i[0].length-1];o[0]===s[0]&&o[1]===s[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var l=i[0].length,d=m().flatten(i),x=d.vertices,A=d.dimensions,O=[],B=[],re=[],Q=0;Q<x.length/A;Q++)A===2?O.push(x[Q*2],x[Q*2+1],1,-1,-1):O.push(x[Q*3],x[Q*3+1],1,-1,-1),re.push(0,0,1);var ge=m()(d.vertices,d.holes,d.dimensions);B.push.apply(B,(0,Si.Z)(ge));for(var Ze=function(_r){var Er=d.vertices.slice(_r*A,(_r+1)*A),Vr=d.vertices.slice((_r+1)*A,(_r+2)*A);Vr.length===0&&(Vr=d.vertices.slice(0,A));var _n=O.length/5;O.push(Er[0],Er[1],1,0,0,Vr[0],Vr[1],1,.1,0,Er[0],Er[1],0,0,.8,Vr[0],Vr[1],0,.1,.8);var Rn=ds([Vr[0],Vr[1],1],[Er[0],Er[1],0],[Er[0],Er[1],1],c);re.push.apply(re,(0,Si.Z)(Rn).concat((0,Si.Z)(Rn),(0,Si.Z)(Rn),(0,Si.Z)(Rn))),B.push.apply(B,(0,Si.Z)([1,2,0,3,2,1].map(function(Xn){return Xn+_n})))},_t=0;_t<l;_t++)Ze(_t);return{positions:O,index:B,normals:re}}function ds(i,c,o){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=Ti.create(),d=Ti.create(),x=Ti.create();s&&(i=(0,$e.vP)(i),c=(0,$e.vP)(c),o=(0,$e.vP)(o));var A=Ti.fromValues.apply(Ti,(0,Si.Z)(i)),O=Ti.fromValues.apply(Ti,(0,Si.Z)(c)),B=Ti.fromValues.apply(Ti,(0,Si.Z)(o));Ti.sub(l,B,O),Ti.sub(d,A,O),Ti.cross(x,l,d);var re=Ti.create();return Ti.normalize(re,x),re}var bo,Ts;(function(i){i.CYLINDER="cylinder",i.SQUARECOLUMN="squareColumn",i.TRIANGLECOLUMN="triangleColumn",i.HEXAGONCOLUMN="hexagonColumn",i.PENTAGONCOLUMN="pentagonColumn"})(Ts||(Ts={}));var iu;(function(i){i.CIRCLE="circle",i.SQUARE="square",i.TRIANGLE="triangle",i.HEXAGON="hexagon",i.PENTAGON="pentagon"})(iu||(iu={}));function Ns(i){for(var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=Math.PI*2/i,s=[],l=0;l<i;l++)s.push(o*l+c*Math.PI/12);var d=s.map(function(x){var A=Math.sin(x+Math.PI/4),O=Math.cos(x+Math.PI/4);return[A,O,0]});return d}function il(){return Ns(30)}function Ys(){return Ns(4)}function Ks(){return Ns(3)}function $s(){return Ns(6,1)}function so(){return Ns(5)}var Au=(bo={},(0,I.Z)(bo,iu.CIRCLE,il),(0,I.Z)(bo,iu.HEXAGON,$s),(0,I.Z)(bo,iu.TRIANGLE,Ks),(0,I.Z)(bo,iu.SQUARE,Ys),(0,I.Z)(bo,iu.PENTAGON,so),(0,I.Z)(bo,Ts.CYLINDER,il),(0,I.Z)(bo,Ts.HEXAGONCOLUMN,$s),(0,I.Z)(bo,Ts.TRIANGLECOLUMN,Ks),(0,I.Z)(bo,Ts.SQUARECOLUMN,Ys),(0,I.Z)(bo,Ts.PENTAGONCOLUMN,so),bo),al={};function is(i){var c=ci(i.coordinates);return{vertices:[].concat((0,Si.Z)(c),(0,Si.Z)(c),(0,Si.Z)(c),(0,Si.Z)(c)),indices:[0,1,2,2,3,0],size:c.length}}function Zl(i){var c=i.shape,o=fc(c,!1),s=o.positions,l=o.index,d=o.normals;return{vertices:s,indices:l,normals:d,size:5}}function au(i){var c=ci(i.coordinates);return{vertices:(0,Si.Z)(c),indices:[0],size:c.length}}function zs(i){var c=i.coordinates,o=i.originCoordinates,s=i.version,l=new Mi({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var d=c;Array.isArray(d[0][0])||(d=[c]);var x=o;Array.isArray(x[0][0])||(x=[o]);for(var A=0;A<d.length;A++){var O=d[A],B=x[A];l.extrude_gaode2(O,B)}}else{var re=c;Array.isArray(re[0][0])||(re=[c]),re.forEach(function(ge){l.extrude(ge)})}var Q=l.complex;return{vertices:Q.positions,indices:Q.indices,normals:Q.normals,size:6}}function cc(i){var c=i.coordinates,o=m().flatten(c),s=o.vertices,l=o.dimensions,d=o.holes;return{indices:m()(s,d,l),vertices:s,size:l}}function Pu(i){var c=i.coordinates,o=ta(c,!0),s=o.positions,l=o.index,d=o.normals;return{vertices:s,indices:l,normals:d,size:5}}function Pa(i){var c=i.shape,o=Cl(c),s=o.positions,l=o.index;return{vertices:s,indices:l,size:3}}function Hu(i){var c=i.coordinates,o=[].concat((0,Si.Z)(c[0]),[0,0,1,c[1][0],c[0][1],0,1,1],(0,Si.Z)(c[1]),[0,1,0],(0,Si.Z)(c[0]),[0,0,1],(0,Si.Z)(c[1]),[0,1,0,c[0][0],c[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:o,indices:s,size:5}}function jl(i,c){for(var o=c||30,s=i.coordinates,l=[],d=[],x=function(B){l.push(B,1,B,s[0][0],s[0][1],s[1][0],s[1][1],B,-1,B,s[0][0],s[0][1],s[1][0],s[1][1]),B!==o-1&&d.push.apply(d,(0,Si.Z)([0,1,2,1,3,2].map(function(re){return B*2+re})))},A=0;A<o;A++)x(A);return{vertices:l,indices:d,size:7}}function Mu(i){var c=i.coordinates;c.length===2&&c.push(0);var o=i.size,s=vu(-1,1),l=vu(1,1),d=vu(-1,-1),x=vu(1,-1),A=[].concat((0,Si.Z)(c),(0,Si.Z)(s),(0,Si.Z)(c),(0,Si.Z)(d),(0,Si.Z)(c),(0,Si.Z)(x),(0,Si.Z)(c),(0,Si.Z)(l)),O=[0,1,2,3,0,2];return{vertices:A,indices:O,size:5}}function fc(i){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(al&&al[i])return al[i];var o=Au[i]?Au[i]():Au.cylinder(),s=ta([o],c);return al[i]=s,s}function hf(i,c){for(var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(i.length/o*3),d,x,A,O=vec3.create(),B=vec3.create(),re=vec3.create(),Q=0,ge=c.length;Q<ge;Q+=3){d=c[Q+0]*3,x=c[Q+1]*3,A=c[Q+2]*3;var Ze=[i[d],i[d+1]],_t=[i[x],i[x+1]],Ht=[i[A],i[A+1]];s&&(Ze=lngLatToMeters(Ze),_t=lngLatToMeters(_t),Ht=lngLatToMeters(Ht));var _r=Ze,Er=_slicedToArray(_r,2),Vr=Er[0],_n=Er[1],Rn=vec3.fromValues(Vr,_n,i[d+2]),Xn=_t,Ci=_slicedToArray(Xn,2),$n=Ci[0],Pi=Ci[1],ua=vec3.fromValues($n,Pi,i[x+2]),xa=Ht,pi=_slicedToArray(xa,2),Ia=pi[0],qa=pi[1],Cu=vec3.fromValues(Ia,qa,i[A+2]);vec3.sub(O,Cu,ua),vec3.sub(B,Rn,ua),vec3.cross(re,O,B),l[d]+=O[0],l[d+1]+=O[1],l[d+2]+=O[2],l[x]+=O[0],l[x+1]+=O[1],l[x+2]+=O[2],l[A]+=O[0],l[A+1]+=O[1],l[A+2]+=O[2]}return El(l),l}function El(i){for(var c=0,o=i.length;c<o;c+=3){var s=vec3.fromValues(i[c],i[c+1],i[c+2]),l=vec3.create();vec3.normalize(l,s),i.set(l,c)}}function hc(i){var c=i[0][0],o=i[0][i[0].length-1];return c[0]===o[0]&&c[1]===o[1]}function Cl(i){var c=["cylinder","triangleColumn","hexagonColumn","squareColumn"],o=Au[i]?Au[i]():Au.circle(),s=c.indexOf(i)===-1?Fa([o]):Ui([o]);return s}function vu(i,c){var o=(i+1)/2,s=(c+1)/2;return[o,s]}function ol(i){var c=sl();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function sl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Wu=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ul=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Xu=function(i){(0,_e.Z)(o,i);var c=ol(o);function o(){return(0,V.Z)(this,o),c.apply(this,arguments)}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.baseColor,O=A===void 0?"rgb(16,16,16)":A,B=l.brightColor,re=B===void 0?"rgb(255,176,38)":B,Q=l.windowColor,ge=Q===void 0?"rgb(30,60,89)":Q,Ze=l.time,_t=Ze===void 0?0:Ze;return{u_opacity:x,u_baseColor:(0,$e.CI)(O),u_brightColor:(0,$e.CI)(re),u_windowColor:(0,$e.CI)(ge),u_time:this.layer.getLayerAnimateTime()||_t}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:ul,fragmentShader:Wu,triangulation:Pu})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:E.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x,A,O,B){return B}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.size,re=B===void 0?10:B;return Array.isArray(re)?[re[0]]:[re]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(d,x,A,O){var B=d.size;return[A[3],A[4]]}}})}}]),o}(Na);function Us(i){var c=pc();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function pc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var dc=function(i){(0,_e.Z)(o,i);var c=Us(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","PolygonLayer"),s}return(0,H.Z)(o,[{key:"buildModels",value:function(){this.layerModel=new Xu(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),o}(xo);function kc(i){var c=Yu();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Yu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var wl=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Vl=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,vc=function(i){(0,_e.Z)(o,i);var c=kc(o);function o(){return(0,V.Z)(this,o),c.apply(this,arguments)}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:x||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:wl,fragmentShader:Vl,triangulation:Pa,depth:{enable:!1},primitive:E.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:E.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),o}(Na);function Gl(i){var c=Hl();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Hl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Iu=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,Ou=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Wl=function(i){(0,_e.Z)(o,i);var c=Gl(o);function o(){return(0,V.Z)(this,o),c.apply(this,arguments)}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:x||1,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:Iu,fragmentShader:Ou,triangulation:Zl,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.size;return Array.isArray(B)?[B[0]]:[B]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:E.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x,A,O,B){return B}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:E.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),o}(Na),Ha=g(85975);function mu(i,c){for(var o=[],s=[],l=[],d=i+1,x=c+1,A=i/2,O=c/2,B=0;B<x;B++)for(var re=B-O,Q=0;Q<d;Q++){var ge=Q-A;s.push(ge/A,-re/O,0),l.push(Q/i),l.push(1-B/c)}for(var Ze=0;Ze<c;Ze++)for(var _t=0;_t<i;_t++){var Ht=_t+d*Ze,_r=_t+d*(Ze+1),Er=_t+1+d*(Ze+1),Vr=_t+1+d*Ze;o.push(Ht,_r,Vr),o.push(_r,Er,Vr)}return{vertices:s,indices:o,uvs:l}}var Xl,ll;function Yl(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Lu(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Yl(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Yl(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Kc(i){var c=cl();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function cl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var to=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,fl=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,Ku=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,ou=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,ra=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,za=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,_s=(Xl=(0,Mt.b2)(),Xl(ll=function(i){(0,_e.Z)(o,i);var c=Kc(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"colorTexture",void 0),(0,I.Z)((0,L.Z)(s),"heatmapFramerBuffer",void 0),(0,I.Z)((0,L.Z)(s),"intensityModel",void 0),(0,I.Z)((0,L.Z)(s),"colorModel",void 0),(0,I.Z)((0,L.Z)(s),"shapeType",void 0),s}return(0,H.Z)(o,[{key:"render",value:function(){var l=this,d=this.rendererService,x=d.clear,A=d.useFramebuffer;A(this.heatmapFramerBuffer,function(){x({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,d=this.rendererService,x=d.createFramebuffer,A=d.clear,O=d.getViewportSize,B=d.createTexture2D,re=d.useFramebuffer,Q=this.styleAttributeService.getLayerStyleAttribute("shape"),ge=(Q==null||(l=Q.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=ge,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=ge==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Ze=this.layer.getLayerConfig(),_t=Ze.rampColors,Ht=(0,$e.Cl)(_t),_r=O(),Er=_r.width,Vr=_r.height;return this.heatmapFramerBuffer=x({color:B({width:Math.floor(Er/4),height:Math.floor(Vr/4),wrapS:E.gl.CLAMP_TO_EDGE,wrapT:E.gl.CLAMP_TO_EDGE,min:E.gl.LINEAR,mag:E.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:E.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(d,x,A,O){return[A[3],A[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.size,re=B===void 0?1:B;return[re]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:ra,fragmentShader:ou,triangulation:Mu,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:E.gl.ONE,srcAlpha:1,dstRGB:E.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:za,fs:Ku});var l=this.shaderModuleService.getModule("heatmapColor"),d=l.vs,x=l.fs,A=l.uniforms,O=this.rendererService,B=O.createAttribute,re=O.createElements,Q=O.createBuffer,ge=O.createModel;return ge({vs:d,fs:x,attributes:{a_Position:B({buffer:Q({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:E.gl.FLOAT}),size:3}),a_Uv:B({buffer:Q({data:[0,1,1,1,0,0,1,0],type:E.gl.FLOAT}),size:2})},uniforms:Lu({},A),depth:{enable:!1},blend:this.getBlend(),count:6,elements:re({data:[0,2,1,2,3,1],type:E.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.intensity,A=x===void 0?10:x,O=l.radius,B=O===void 0?5:O;this.intensityModel.draw({uniforms:{u_opacity:d||1,u_radius:B,u_intensity:A}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=Ha.create();Ha.invert(x,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Si.Z)(x)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,d=l(),x=d.width,A=d.height,O=mu(x/4,A/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:fl,fs:to});var B=this.shaderModuleService.getModule("heatmap3dColor"),re=B.vs,Q=B.fs,ge=B.uniforms,Ze=this.rendererService,_t=Ze.createAttribute,Ht=Ze.createElements,_r=Ze.createBuffer,Er=Ze.createModel;return Er({vs:re,fs:Q,attributes:{a_Position:_t({buffer:_r({data:O.vertices,type:E.gl.FLOAT}),size:3}),a_Uv:_t({buffer:_r({data:O.uvs,type:E.gl.FLOAT}),size:2})},primitive:E.gl.TRIANGLES,uniforms:Lu({},ge),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:E.gl.SRC_ALPHA,srcAlpha:1,dstRGB:E.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Ht({data:O.indices,type:E.gl.UNSIGNED_INT,count:O.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var d=this.layer.getLayerConfig(),x=d.rampColors,A=(0,$e.Cl)(x);this.colorTexture=l({data:new Uint8Array(A.data),width:A.width,height:A.height,wrapS:E.gl.CLAMP_TO_EDGE,wrapT:E.gl.CLAMP_TO_EDGE,min:E.gl.NEAREST,mag:E.gl.NEAREST,flipY:!1})}}]),o}(Na))||ll);function Kl(i){var c=yu();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function yu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var $l=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,$c=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Jc=function(i){(0,_e.Z)(o,i);var c=Kl(o);function o(){return(0,V.Z)(this,o),c.apply(this,arguments)}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.coverage,A=l.angle;return{u_opacity:d||1,u_coverage:x||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:$c,fragmentShader:$l,triangulation:Pa,depth:{enable:!1},primitive:E.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:E.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x){var A=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[A[0],A[1],0]}}})}}]),o}(Na),Tl={heatmap:_s,heatmap3d:_s,grid:vc,grid3d:Wl,hexagon:Jc},Al=Tl;function Ru(i){var c=Ro();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Ro(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Pl=function(i){(0,_e.Z)(o,i);var c=Ru(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","HeatMapLayer"),s}return(0,H.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Al[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,d=this.getModelType();return d==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(x){return x.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),x=this.getLayerConfig(),A=x.shape3d,O=this.getSource(),B=O.data.type,re=(d==null||(l=d.scale)===null||l===void 0?void 0:l.field)||"heatmap";return re==="heatmap"||re==="heatmap3d"?"heatmap":B==="hexagon"?(A==null?void 0:A.indexOf(re))===-1?"hexagon":"grid3d":B==="grid"?(A==null?void 0:A.indexOf(re))===-1?"grid":"grid3d":"heatmap"}}]),o}(xo);function Zs(i){var c=So();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function So(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var kn=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,ho=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,gu=function(i){(0,_e.Z)(o,i);var c=Zs(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),s}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,d=this.layer.getSource(),x=this.rendererService.createTexture2D;return this.texture=x({height:0,width:0}),d.data.images.then(function(A){l.texture=x({data:A[0],width:A[0].width,height:A[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:ho,fragmentShader:kn,triangulation:Hu,primitive:E.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(d,x,A,O){return[A[3],A[4]]}}})}}]),o}(Na),hl={image:gu},Js=hl;function As(i){var c=mc();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function mc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var mn=function(i){(0,_e.Z)(o,i);var c=As(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","ImageLayer"),s}return(0,H.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Js[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={image:{}};return d[l]}},{key:"getModelType",value:function(){return"image"}}]),o}(xo);function Jl(i){var c=Ql();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Ql(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Du=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - \u7528\u4E8E\u5408\u5E76\u5355\u4E2A\u7684 varying \u53D8\u91CF

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = v_dataset.r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = v_dataset.b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float d_texCount = v_dataset.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = 1.0 - fract(arcRadio * d_texCount + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = v_dataset.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,ja=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - \u7528\u4E8E\u5408\u5E76\u5355\u4E2A\u7684 varying \u53D8\u91CF

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_dataset.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_dataset.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_dataset.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_dataset.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Ps={solid:0,dash:1},ql=function(i){(0,_e.Z)(o,i);var c=Jl(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:E.gl.NEAREST,min:E.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.sourceColor,A=l.targetColor,O=l.textureBlend,B=O===void 0?"normal":O,re=l.lineType,Q=re===void 0?"solid":re,ge=l.dashArray,Ze=ge===void 0?[10,5]:ge,_t=l.forward,Ht=_t===void 0?!0:_t,_r=l.lineTexture,Er=_r===void 0?!1:_r,Vr=l.iconStep,_n=Vr===void 0?100:Vr,Rn=l.segmentNumber,Xn=Rn===void 0?30:Rn;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Ci=this.layer.getEncodedData(),$n=this.calDataFrame(this.cellLength,Ci,this.cellProperties),Pi=$n.data,ua=$n.width,xa=$n.height;this.rowCount=xa,this.dataTexture=this.cellLength>0&&Pi.length>0?this.createTexture2D({flipY:!0,data:Pi,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:ua,height:xa}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}Ze.length===2&&Ze.push(0,0);var pi=0,Ia=[0,0,0,0],qa=[0,0,0,0];return x&&A&&(Ia=(0,$e.CI)(x),qa=(0,$e.CI)(A),pi=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Yi()(d)?d:1,u_textureBlend:B==="normal"?0:1,segmentNumber:Xn,u_line_type:Ps[Q||"solid"],u_dash_array:Ze,u_blur:.9,u_lineDir:Ht?1:-1,u_texture:this.texture,u_line_texture:Er?1:0,u_icon_step:_n,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:pi,u_sourceColor:Ia,u_targetColor:qa}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),d=l.segmentNumber,x=d===void 0?30:d;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:ja,fragmentShader:Du,triangulation:jl,depth:{enable:!1},blend:this.getBlend(),segmentNumber:x})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(x,A,O,B){var re=x.size,Q=re===void 0?1:re;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:E.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(x,A,O,B){return[O[3],O[4],O[5],O[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(x,A,O,B){var re=l.iconService.getIconMap(),Q=x.texture,ge=re[Q]||{x:0,y:0},Ze=ge.x,_t=ge.y;return[Ze,_t]}}})}}]),o}(Na);function _u(i){var c=Ms();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Ms(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var xu=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec4 v_dataset; // \u6570\u636E\u96C6

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_dataset.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Fc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

varying vec4 v_dataset; // \u6570\u636E\u96C6

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_dataset.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel(u_icon_step);
    v_dataset.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_dataset.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Ml={solid:0,dash:1},yc=function(i){(0,_e.Z)(o,i);var c=_u(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:E.gl.NEAREST,min:E.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.sourceColor,A=l.targetColor,O=l.textureBlend,B=O===void 0?"normal":O,re=l.lineType,Q=re===void 0?"solid":re,ge=l.dashArray,Ze=ge===void 0?[10,5]:ge,_t=l.lineTexture,Ht=_t===void 0?!1:_t,_r=l.iconStep,Er=_r===void 0?100:_r,Vr=l.segmentNumber,_n=Vr===void 0?30:Vr;Ze.length===2&&Ze.push(0,0);var Rn=0,Xn=[0,0,0,0],Ci=[0,0,0,0];if(x&&A&&(Xn=(0,$e.CI)(x),Ci=(0,$e.CI)(A),Rn=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var $n=this.layer.getEncodedData(),Pi=this.calDataFrame(this.cellLength,$n,this.cellProperties),ua=Pi.data,xa=Pi.width,pi=Pi.height;this.rowCount=pi,this.dataTexture=this.cellLength>0&&ua.length>0?this.createTexture2D({flipY:!0,data:ua,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:xa,height:pi}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Yi()(d)?d:1,u_textureBlend:B==="normal"?0:1,segmentNumber:_n,u_line_type:Ml[Q]||0,u_dash_array:Ze,u_texture:this.texture,u_line_texture:Ht?1:0,u_icon_step:Er,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Rn,u_sourceColor:Xn,u_targetColor:Ci}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:Fc,fragmentShader:xu,triangulation:jl,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(x,A,O,B){var re=x.size,Q=re===void 0?1:re;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:E.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(x,A,O,B){return[O[3],O[4],O[5],O[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(x,A,O,B){var re=l.iconService.getIconMap(),Q=x.texture,ge=re[Q]||{x:0,y:0},Ze=ge.x,_t=ge.y;return[Ze,_t]}}})}}]),o}(Na);function gc(i){var c=Qs();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Qs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Is=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec4 v_dataset; // \u6570\u636E\u96C6

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = v_dataset.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_dataset.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_dataset.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,na=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

varying vec4 v_dataset; // \u6570\u636E\u96C6

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_dataset.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_dataset.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_dataset.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,bu={solid:0,dash:1},qs=function(i){(0,_e.Z)(o,i);var c=gc(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:E.gl.NEAREST,min:E.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.sourceColor,A=l.targetColor,O=l.textureBlend,B=O===void 0?"normal":O,re=l.lineType,Q=re===void 0?"solid":re,ge=l.dashArray,Ze=ge===void 0?[10,5]:ge,_t=l.lineTexture,Ht=_t===void 0?!1:_t,_r=l.iconStep,Er=_r===void 0?100:_r,Vr=l.segmentNumber,_n=Vr===void 0?30:Vr;Ze.length===2&&Ze.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Rn=0,Xn=[0,0,0,0],Ci=[0,0,0,0];if(x&&A&&(Xn=(0,$e.CI)(x),Ci=(0,$e.CI)(A),Rn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var $n=this.layer.getEncodedData(),Pi=this.calDataFrame(this.cellLength,$n,this.cellProperties),ua=Pi.data,xa=Pi.width,pi=Pi.height;this.rowCount=pi,this.dataTexture=this.cellLength>0&&ua.length>0?this.createTexture2D({flipY:!0,data:ua,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:xa,height:pi}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Yi()(d)?d:1,u_textureBlend:B==="normal"?0:1,segmentNumber:_n,u_line_type:bu[Q]||0,u_dash_array:Ze,u_texture:this.texture,u_line_texture:Ht?1:0,u_icon_step:Er,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Rn,u_sourceColor:Xn,u_targetColor:Ci}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:na,fragmentShader:Is,triangulation:jl,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(x,A,O,B){var re=x.size,Q=re===void 0?1:re;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:E.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(x,A,O,B){return[O[3],O[4],O[5],O[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(x,A,O,B){var re=l.iconService.getIconMap(),Q=x.texture,ge=re[Q]||{x:0,y:0},Ze=ge.x,_t=ge.y;return[Ze,_t]}}})}}]),o}(Na);function No(i){var c=$u();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function $u(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var su=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - distance_ratio/distance/pixelLen/texV

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,uu=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - distance_ratio/distance/pixelLen/texV
// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset.r = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset.g = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset.b = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset.a = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Eo={solid:0,dash:1},ku=function(i){(0,_e.Z)(o,i);var c=No(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:E.gl.NEAREST,min:E.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.sourceColor,A=l.targetColor,O=l.textureBlend,B=O===void 0?"normal":O,re=l.lineType,Q=re===void 0?"solid":re,ge=l.dashArray,Ze=ge===void 0?[10,5,0,0]:ge,_t=l.lineTexture,Ht=_t===void 0?!1:_t,_r=l.iconStep,Er=_r===void 0?100:_r;Ze.length===2&&Ze.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Vr=0,_n=[0,0,0,0],Rn=[0,0,0,0];if(x&&A&&(_n=(0,$e.CI)(x),Rn=(0,$e.CI)(A),Vr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Xn=this.layer.getEncodedData(),Ci=this.calDataFrame(this.cellLength,Xn,this.cellProperties),$n=Ci.data,Pi=Ci.width,ua=Ci.height;this.rowCount=ua,this.dataTexture=this.cellLength>0&&$n.length>0?this.createTexture2D({flipY:!0,data:$n,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:Pi,height:ua}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Yi()(d)?d:1,u_textureBlend:B==="normal"?0:1,u_line_type:Eo[Q],u_dash_array:Ze,u_texture:this.texture,u_line_texture:Ht?1:0,u_icon_step:Er,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Vr,u_sourceColor:_n,u_targetColor:Rn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:uu,fragmentShader:su,triangulation:zs,primitive:E.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.layer.getLayerConfig(),x=d.lineType,A=x===void 0?"solid":x;this.styleAttributeService.registerStyleAttribute({name:"distance",type:E.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(B,re,Q,ge){return[Q[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:E.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(B,re,Q,ge){return[Q[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(B,re,Q,ge){var Ze=B.size,_t=Ze===void 0?1:Ze;return Array.isArray(_t)?[_t[0],_t[1]]:[_t,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:E.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(B,re,Q,ge,Ze){return Ze}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:E.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(B,re,Q,ge){return[Q[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(B,re,Q,ge){var Ze=l.iconService.getIconMap(),_t=B.texture,Ht=Ze[_t]||{x:0,y:0},_r=Ht.x,Er=Ht.y;return[_r,Er]}}})}},{key:"loadImage",value:function(l){return new Promise(function(d,x){if(l instanceof HTMLImageElement){d(l);return}var A=new Image;A.crossOrigin="anonymous",A.onload=function(){d(A)},A.onerror=function(){x(new Error("Could not load image at "+l))},A.src=l instanceof File?URL.createObjectURL(l):l})}}]),o}(Na),ni={arc:ql,arc3d:yc,greatcircle:qs,line:ku},Hn=ni;function Il(i){var c=as();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function as(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var js=function(i){(0,_e.Z)(o,i);var c=Il(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","LineLayer"),s}return(0,H.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Hn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return d[l]}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),x=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return x||"line"}}]),o}(xo);function Wo(i){var c=lu();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function lu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var _c=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ec=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,Qi=function(i){(0,_e.Z)(o,i);var c=Wo(o);function o(){return(0,V.Z)(this,o),c.apply(this,arguments)}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x})){this.judgeStyleAttributes({opacity:x});var A=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,A,this.cellProperties),B=O.data,re=O.width,Q=O.height;this.rowCount=Q,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:re,height:Q}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Yi()(x)?x:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:ec,fragmentShader:_c,triangulation:Zl,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x,A,O){var B=d.size;if(B){var re=[];return Array.isArray(B)&&(re=B.length===2?[B[0],B[0],B[1]]:B),Array.isArray(B)||(re=[B]),re}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:E.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x,A,O,B){return B}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:E.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x){var A=ci(d.coordinates);return[A[0],A[1],0]}}})}}]),o}(Na);function Do(i){var c=Bc();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Bc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var xs=`#define Animate 0.0

uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

}
`,Ol=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,bs=function(i){(0,_e.Z)(o,i);var c=Do(o);function o(){return(0,V.Z)(this,o),c.apply(this,arguments)}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.strokeOpacity,O=A===void 0?1:A,B=l.strokeWidth,re=B===void 0?0:B,Q=l.stroke,ge=Q===void 0?"rgba(0,0,0,0)":Q,Ze=l.offsets,_t=Ze===void 0?[0,0]:Ze;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x,strokeOpacity:O,strokeWidth:re,stroke:ge,offsets:_t})){this.judgeStyleAttributes({opacity:x,strokeOpacity:O,strokeWidth:re,stroke:ge,offsets:_t});var Ht=this.layer.getEncodedData(),_r=this.calDataFrame(this.cellLength,Ht,this.cellProperties),Er=_r.data,Vr=_r.width,_n=_r.height;this.rowCount=_n,this.dataTexture=this.cellLength>0&&Er.length>0?this.createTexture2D({flipY:!0,data:Er,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:Vr,height:_n}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Yi()(x)?x:1,u_stroke_opacity:Yi()(O)?O:1,u_stroke_width:Yi()(re)?re:0,u_stroke_color:this.getStrokeColor(ge),u_offsets:this.isOffsetStatic(_t)?_t:[0,0]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),is)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:Ol,fragmentShader:xs,triangulation:is,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:E.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(x,A,O,B){var re=[1,1,-1,1,-1,-1,1,-1],Q=B%4*2;return[re[Q],re[Q+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(x,A,O,B){var re=x.size,Q=re===void 0?5:re;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:E.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(x,A,O,B){var re=x.shape,Q=re===void 0?2:re,ge=l.layer.getLayerConfig().shape2d,Ze=ge.indexOf(Q);return[Ze]}}})}}]),o}(Na);function vs(i){var c=pl();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function pl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var cu=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,tc=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Ju=function(i){(0,_e.Z)(o,i);var c=vs(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),s}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:tc,fragmentShader:cu,triangulation:au,primitive:E.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(x,A,O,B){var re=x.size;return Array.isArray(re)?[re[0]]:[re]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(x,A,O,B){var re=l.fontService.mapping,Q=x.shape,ge=l.fontService.getGlyph(Q),Ze=re[ge],_t=Ze.x,Ht=Ze.y;return[_t,Ht]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.texture=l({data:d,mag:E.gl.LINEAR,min:E.gl.LINEAR,width:d.width,height:d.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),x=d.fontWeight,A=x===void 0?"normal":x,O=d.fontFamily,B=O===void 0?"sans-serif":O,re=this.layer.getEncodedData(),Q=[];re.forEach(function(ge){var Ze=ge.shape,_t=Ze===void 0?"":Ze;_t=_t.toString();var Ht=l.fontService.getGlyph(_t);Q.indexOf(Ht)===-1&&Q.push(Ht)}),this.fontService.setFontOptions({characterSet:Q,fontWeight:A,fontFamily:B,fontSize:48})}}]),o}(Na);function dl(i){var c=Nc();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Nc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ll=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,vl=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,xc=function(i){(0,_e.Z)(o,i);var c=dl(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.renderLayers();return}s.texture=A({data:s.iconService.getCanvas(),mag:E.gl.LINEAR,min:E.gl.LINEAR,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=l.offsets,A=x===void 0?[0,0]:x;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:A})){this.judgeStyleAttributes({opacity:d,offsets:A});var O=this.layer.getEncodedData(),B=this.calDataFrame(this.cellLength,O,this.cellProperties),re=B.data,Q=B.width,ge=B.height;this.rowCount=ge,this.dataTexture=this.cellLength>0&&re.length>0?this.createTexture2D({flipY:!0,data:re,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:Q,height:ge}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Yi()(d)?d:1,u_offsets:this.isOffsetStatic(A)?A:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:vl,fragmentShader:Ll,triangulation:au,primitive:E.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(x,A,O,B){var re=x.size,Q=re===void 0?5:re;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(x,A,O,B){var re=l.iconService.getIconMap(),Q=x.shape,ge=re[Q]||{x:0,y:0},Ze=ge.x,_t=ge.y;return[Ze,_t]}}})}}]),o}(Na);function Qu(i){var c=Fu();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Fu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var rc=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Bu=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Vs(i){var c=i.coordinates;return{vertices:(0,Si.Z)(c),indices:[0],size:c.length}}var bc=function(i){(0,_e.Z)(o,i);var c=Qu(o);function o(){return(0,V.Z)(this,o),c.apply(this,arguments)}return(0,H.Z)(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.offsets,O=A===void 0?[0,0]:A;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x,offsets:O})){this.judgeStyleAttributes({opacity:x,offsets:O});var B=this.layer.getEncodedData(),re=this.calDataFrame(this.cellLength,B,this.cellProperties),Q=re.data,ge=re.width,Ze=re.height;this.rowCount=Ze,this.dataTexture=this.cellLength>0&&Q.length>0?this.createTexture2D({flipY:!0,data:Q,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:ge,height:Ze}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Yi()(x)?x:1,u_offsets:this.isOffsetStatic(O)?O:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:Bu,fragmentShader:rc,triangulation:Vs,depth:{enable:!1},primitive:E.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.size,re=B===void 0?1:B;return Array.isArray(re)?[re[0]]:[re]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:E.BlendType.additive}}}]),o}(Na),Nu=g(98333);function nc(i,c){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=qu(i))||c&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(B){throw B},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){o=o.call(i)},n:function(){var B=o.next();return d=B.done,B},e:function(B){x=!0,A=B},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(x)throw A}}}}function qu(i,c){if(!!i){if(typeof i=="string")return n(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return n(i,c)}}function n(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}var u=function(){function i(c,o,s){(0,V.Z)(this,i),(0,I.Z)(this,"boxCells",[]),(0,I.Z)(this,"xCellCount",void 0),(0,I.Z)(this,"yCellCount",void 0),(0,I.Z)(this,"boxKeys",void 0),(0,I.Z)(this,"bboxes",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"xScale",void 0),(0,I.Z)(this,"yScale",void 0),(0,I.Z)(this,"boxUid",void 0);var l=this.boxCells;this.xCellCount=Math.ceil(c/s),this.yCellCount=Math.ceil(o/s);for(var d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=c,this.height=o,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/o,this.boxUid=0}return(0,H.Z)(i,[{key:"insert",value:function(o,s,l,d,x){this.forEachCell(s,l,d,x,this.insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(x)}},{key:"query",value:function(o,s,l,d,x){return this.queryHitTest(o,s,l,d,!1,x)}},{key:"hitTest",value:function(o,s,l,d,x){return this.queryHitTest(o,s,l,d,!0,x)}},{key:"insertBoxCell",value:function(o,s,l,d,x,A){this.boxCells[x].push(A)}},{key:"queryHitTest",value:function(o,s,l,d,x,A){if(l<0||o>this.width||d<0||s>this.height)return x?!1:[];var O=[];if(o<=0&&s<=0&&this.width<=l&&this.height<=d){if(x)return!0;for(var B=0;B<this.boxKeys.length;B++)O.push({key:this.boxKeys[B],x1:this.bboxes[B*4],y1:this.bboxes[B*4+1],x2:this.bboxes[B*4+2],y2:this.bboxes[B*4+3]});return A?O.filter(A):O}var re={hitTest:x,seenUids:{box:{},circle:{}}};return this.forEachCell(o,s,l,d,this.queryCell,O,re,A),x?O.length>0:O}},{key:"queryCell",value:function(o,s,l,d,x,A,O,B){var re=O.seenUids,Q=this.boxCells[x];if(Q!==null){var ge=this.bboxes,Ze=nc(Q),_t;try{for(Ze.s();!(_t=Ze.n()).done;){var Ht=_t.value;if(!re.box[Ht]){re.box[Ht]=!0;var _r=Ht*4;if(o<=ge[_r+2]&&s<=ge[_r+3]&&l>=ge[_r+0]&&d>=ge[_r+1]&&(!B||B(this.boxKeys[Ht]))){if(O.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[Ht],x1:ge[_r],y1:ge[_r+1],x2:ge[_r+2],y2:ge[_r+3]})}}}}catch(Er){Ze.e(Er)}finally{Ze.f()}}return!1}},{key:"forEachCell",value:function(o,s,l,d,x,A,O,B){for(var re=this.convertToXCellCoord(o),Q=this.convertToYCellCoord(s),ge=this.convertToXCellCoord(l),Ze=this.convertToYCellCoord(d),_t=re;_t<=ge;_t++)for(var Ht=Q;Ht<=Ze;Ht++){var _r=this.xCellCount*Ht+_t;if(x.call(this,o,s,l,d,_r,A,O,B))return}}},{key:"convertToXCellCoord",value:function(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}},{key:"convertToYCellCoord",value:function(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}}]),i}(),a=u,h=function(){function i(c,o){(0,V.Z)(this,i),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"grid",void 0),(0,I.Z)(this,"viewportPadding",100),(0,I.Z)(this,"screenRightBoundary",void 0),(0,I.Z)(this,"screenBottomBoundary",void 0),(0,I.Z)(this,"gridRightBoundary",void 0),(0,I.Z)(this,"gridBottomBoundary",void 0),this.width=c,this.height=o,this.viewportPadding=Math.max(c,o),this.grid=new a(c+this.viewportPadding,o+this.viewportPadding,25),this.screenRightBoundary=c+this.viewportPadding,this.screenBottomBoundary=o+this.viewportPadding,this.gridRightBoundary=c+2*this.viewportPadding,this.gridBottomBoundary=o+2*this.viewportPadding}return(0,H.Z)(i,[{key:"placeCollisionBox",value:function(o){var s=o.x1+o.anchorPointX+this.viewportPadding,l=o.y1+o.anchorPointY+this.viewportPadding,d=o.x2+o.anchorPointX+this.viewportPadding,x=o.y2+o.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,d,x)||this.grid.hitTest(s,l,d,x)?{box:[]}:{box:[s,l,d,x]}}},{key:"insertCollisionBox",value:function(o,s){var l={featureIndex:s};this.grid.insert(l,o[0],o[1],o[2],o[3])}},{key:"project",value:function(o,s,l){var d=Nu.al(s,l,0,1),x=Nu.Ue(),A=Ha.fromValues.apply(Ha,(0,Si.Z)(o));return Nu.fF(x,d,A),{x:(x[0]/x[3]+1)/2*this.width+this.viewportPadding,y:(-x[1]/x[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(o,s,l,d){return l>=0&&o<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}}]),i}();function _(i,c){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=C(i))||c&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(B){throw B},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){o=o.call(i)},n:function(){var B=o.next();return d=B.done,B},e:function(B){x=!0,A=B},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(x)throw A}}}}function C(i,c){if(!!i){if(typeof i=="string")return P(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return P(i,c)}}function P(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function N(i){var c=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0;break;default:c=.5}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0;break;default:o=.5}return{horizontalAlign:c,verticalAlign:o}}function K(i,c,o,s,l){if(!!l){var d=i[s],x=d.glyph;if(x)for(var A=c[x].advance*d.scale,O=(i[s].x+A)*l,B=o;B<=s;B++)i[B].x-=O}}function oe(i,c,o,s,l,d,x){var A=(c-o)*l,O=(-s*x+.5)*d,B=_(i),re;try{for(B.s();!(re=B.n()).done;){var Q=re.value;Q.x+=A,Q.y+=O}}catch(ge){B.e(ge)}finally{B.f()}}function Ce(i,c,o,s,l,d,x){var A=-8,O=0,B=A,re=0,Q=i.positionedGlyphs,ge=d==="right"?1:d==="left"?0:.5,Ze=Q.length;o.forEach(function(Vr){if(Vr.split("").forEach(function(Rn){var Xn=c[Rn],Ci=0;Xn&&(Q.push({glyph:Rn,x:O,y:B+Ci,vertical:!1,scale:1,metrics:Xn}),O+=Xn.advance+x)}),Q.length!==Ze){var _n=O-x;re=Math.max(_n,re),K(Q,c,Ze,Q.length-1,ge)}O=0,B+=s});var _t=N(l),Ht=_t.horizontalAlign,_r=_t.verticalAlign;oe(Q,ge,Ht,_r,re,s,o.length);var Er=B-A;i.top+=-_r*Er,i.bottom=i.top+Er,i.left+=-Ht*re,i.right=i.left+re}function we(i,c,o,s,l,d,x){var A=-8,O=0,B=A,re=0,Q=i.positionedGlyphs,ge=d==="right"?1:d==="left"?0:.5,Ze=Q.length;o.forEach(function(Vr){var _n=c[Vr],Rn=0;if(_n&&(Q.push({glyph:Vr,x:O,y:B+Rn,vertical:!1,scale:1,metrics:_n}),O+=_n.advance+x),Q.length!==Ze){var Xn=O-x;re=Math.max(Xn,re),K(Q,c,Ze,Q.length-1,ge)}O=0,B+=s});var _t=N(l),Ht=_t.horizontalAlign,_r=_t.verticalAlign;oe(Q,ge,Ht,_r,re,s,o.length);var Er=B-A;i.top+=-_r*Er,i.bottom=i.top+Er,i.left+=-Ht*re,i.right=i.left+re}function Ie(i,c,o,s,l,d){var x=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],A=arguments.length>7?arguments[7]:void 0,O=i.split(`
`),B=[],re={positionedGlyphs:B,top:x[1],bottom:x[1],left:x[0],right:x[0],lineCount:O.length,text:i};return A?we(re,c,O,o,s,l,d):Ce(re,c,O,o,s,l,d),B.length?re:!1}function Ke(i){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],o=arguments.length>2?arguments[2]:void 0,s=i.positionedGlyphs,l=s===void 0?[]:s,d=[],x=_(l),A;try{for(x.s();!(A=x.n()).done;){var O=A.value,B=O.metrics,re=4,Q=B.advance*O.scale/2,ge=o?[O.x+Q,O.y]:[0,0],Ze=o?[0,0]:[O.x+Q+c[0],O.y+c[1]],_t=(0-re)*O.scale-Q+Ze[0],Ht=(0-re)*O.scale+Ze[1],_r=_t+B.width*O.scale,Er=Ht+B.height*O.scale,Vr={x:_t,y:Ht},_n={x:_r,y:Ht},Rn={x:_t,y:Er},Xn={x:_r,y:Er};d.push({tl:Vr,tr:_n,bl:Rn,br:Xn,tex:B,glyphOffset:ge})}}catch(Ci){x.e(Ci)}finally{x.f()}return d}function We(i,c){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=ot(i))||c&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(B){throw B},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){o=o.call(i)},n:function(){var B=o.next();return d=B.done,B},e:function(B){x=!0,A=B},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(x)throw A}}}}function ot(i,c){if(!!i){if(typeof i=="string")return je(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return je(i,c)}}function je(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function st(i){var c=wt();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function wt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Wt=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,gr=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function cr(i){var c=this,o=i.id,s=[],l=[];if(!c.glyphInfoMap||!c.glyphInfoMap[o])return{vertices:[],indices:[],size:7};var d=c.glyphInfoMap[o].centroid,x=d.length===2?[d[0],d[1],0]:d;return c.glyphInfoMap[o].glyphQuads.forEach(function(A,O){s.push.apply(s,(0,Si.Z)(x).concat([A.tex.x,A.tex.y+A.tex.height,A.tl.x,A.tl.y],(0,Si.Z)(x),[A.tex.x+A.tex.width,A.tex.y+A.tex.height,A.tr.x,A.tr.y],(0,Si.Z)(x),[A.tex.x+A.tex.width,A.tex.y,A.br.x,A.br.y],(0,Si.Z)(x),[A.tex.x,A.tex.y,A.bl.x,A.bl.y])),l.push(0+O*4,1+O*4,2+O*4,2+O*4,3+O*4,0+O*4)}),{vertices:s,indices:l,size:7}}var xr=function(i){(0,_e.Z)(o,i);var c=st(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"glyphInfo",void 0),(0,I.Z)((0,L.Z)(s),"glyphInfoMap",{}),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"currentZoom",-1),(0,I.Z)((0,L.Z)(s),"extent",void 0),(0,I.Z)((0,L.Z)(s),"textureHeight",0),(0,I.Z)((0,L.Z)(s),"textCount",0),(0,I.Z)((0,L.Z)(s),"preTextStyle",{}),(0,I.Z)((0,L.Z)(s),"buildModels",function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),s.reBuildModel(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:gr,fragmentShader:Wt,triangulation:cr.bind((0,L.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]}),s}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.stroke,O=A===void 0?"#fff":A,B=l.strokeWidth,re=B===void 0?0:B,Q=l.textAnchor,ge=Q===void 0?"center":Q,Ze=l.textAllowOverlap,_t=Ze===void 0?!1:Ze,Ht=l.halo,_r=Ht===void 0?.5:Ht,Er=l.gamma,Vr=Er===void 0?2:Er,_n=this.fontService,Rn=_n.canvas,Xn=_n.mapping;if(Object.keys(Xn).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Xn).length),this.preTextStyle={textAnchor:ge,textAllowOverlap:_t},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x,strokeWidth:re,stroke:O})){this.judgeStyleAttributes({opacity:x,strokeWidth:re,stroke:O});var Ci=this.layer.getEncodedData(),$n=this.calDataFrame(this.cellLength,Ci,this.cellProperties),Pi=$n.data,ua=$n.width,xa=$n.height;this.rowCount=xa,this.dataTexture=this.cellLength>0&&Pi.length>0?this.createTexture2D({flipY:!0,data:Pi,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:ua,height:xa}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Yi()(x)?x:1,u_stroke_width:Yi()(re)?re:0,u_stroke_color:this.getStrokeColor(O),u_sdf_map:this.texture,u_halo_blur:_r,u_gamma_scale:Vr,u_sdf_map_size:[Rn.width,Rn.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),d=l.textAnchor,x=d===void 0?"center":d,A=l.textAllowOverlap,O=A===void 0?!0:A;return this.preTextStyle={textAnchor:x,textAllowOverlap:O},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),d=l.textAllowOverlap,x=d===void 0?!1:d,A=this.mapService.getZoom(),O=this.mapService.getBounds(),B=(0,$e.oO)(this.extent,O);return!x&&(Math.abs(this.currentZoom-A)>1||!B)||x!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:E.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.rotate,re=B===void 0?0:B;return Array.isArray(re)?[re[0]]:[re]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:E.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(d,x,A,O){return[A[5],A[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.size,re=B===void 0?12:B;return Array.isArray(re)?[re[0]]:[re]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:E.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(d,x,A,O){return[A[3],A[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,$e.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,x=d===void 0?"400":d,A=l.fontFamily,O=A===void 0?"sans-serif":A,B=this.layer.getEncodedData(),re=[];B.forEach(function(Q){var ge=Q.shape,Ze=ge===void 0?"":ge;Ze=Ze.toString();var _t=We(Ze),Ht;try{for(_t.s();!(Ht=_t.n()).done;){var _r=Ht.value;re.indexOf(_r)===-1&&re.push(_r)}}catch(Er){_t.e(Er)}finally{_t.f()}}),this.fontService.setFontOptions({characterSet:re,fontWeight:x,fontFamily:O,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,x=d===void 0?"400":d,A=l.fontFamily,O=A===void 0?"sans-serif":A,B=this.layer.getEncodedData(),re=[];B.forEach(function(Q){var ge=Q.shape,Ze=ge===void 0?"":ge;Ze=Ze.toString(),re.indexOf(Ze)===-1&&re.push(Ze)}),this.fontService.setFontOptions({characterSet:re,fontWeight:x,fontFamily:O,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var d=this,x=this.fontService.mapping,A=this.layer.getLayerConfig(),O=A.spacing,B=O===void 0?2:O,re=A.textAnchor,Q=re===void 0?"center":re,ge=this.layer.getEncodedData();this.glyphInfo=ge.map(function(Ze){var _t=Ze.shape,Ht=_t===void 0?"":_t,_r=Ze.id,Er=Ze.size,Vr=Er===void 0?1:Er,_n=Ze.textOffset,Rn=_n===void 0?[0,0]:_n,Xn=Ie(Ht.toString(),x,Vr,Q,"center",B,Rn,l),Ci=Ke(Xn,Rn,!1);return Ze.shaping=Xn,Ze.glyphQuads=Ci,Ze.centroid=ci(Ze.coordinates),Ze.originCentroid=Ze.version==="GAODE2.x"?ci(Ze.originCoordinates):Ze.originCentroid=Ze.centroid,d.glyphInfoMap[_r]={shaping:Xn,glyphQuads:Ci,centroid:ci(Ze.coordinates)},Ze})}},{key:"filterGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),x=d.padding,A=x===void 0?[4,4]:x,O=d.textAllowOverlap,B=O===void 0?!1:O;if(!B){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var re=this.rendererService.getViewportSize(),Q=re.width,ge=re.height,Ze=new h(Q,ge),_t=this.glyphInfo.filter(function(Ht){var _r=Ht.shaping,Er=Ht.id,Vr=Er===void 0?0:Er,_n=Ht.version==="GAODE2.x"?Ht.originCentroid:Ht.centroid,Rn=Ht.size,Xn=Rn/24,Ci=l.mapService.lngLatToContainer(_n),$n=Ze.placeCollisionBox({x1:_r.left*Xn-A[0],x2:_r.right*Xn+A[0],y1:_r.top*Xn-A[1],y2:_r.bottom*Xn+A[1],anchorPointX:Ci.x,anchorPointY:Ci.y}),Pi=$n.box;return Pi&&Pi.length?(Ze.insertCollisionBox(Pi,Vr),!0):!1});_t.forEach(function(Ht){l.glyphInfoMap[Ht.id]=Ht})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),d=l.iconfont,x=d===void 0?!1:d;x?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(x)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.textureHeight=d.height,this.texture&&this.texture.destroy(),this.texture=l({data:d,mag:E.gl.LINEAR,min:E.gl.LINEAR,width:d.width,height:d.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:gr,fragmentShader:Wt,triangulation:cr.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),o}(Na),zr={fill:bs,image:xc,normal:bc,extrude:Qi,text:xr,icon:Ju},an=zr;function Qr(i){var c=Cn();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Cn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ei=function(i){(0,_e.Z)(o,i);var c=Qr(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","PointLayer"),s}return(0,H.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new an[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return d[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),x=d.shape2d,A=d.shape3d,O=this.iconService.getIconMap(),B=l.find(function(Q){return Q.hasOwnProperty("shape")});if(B){var re=B.shape;return re==="dot"?"normal":(x==null?void 0:x.indexOf(re))!==-1?"fill":(A==null?void 0:A.indexOf(re))!==-1?"extrude":O.hasOwnProperty(re)?"image":this.fontService.getGlyph(re)!==""?"icon":"text"}else return"normal"}}]),o}(xo);function fi(i){var c=ri();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function ri(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ia=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Nn=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,_i=function(i){(0,_e.Z)(o,i);var c=fi(o);function o(){return(0,V.Z)(this,o),c.apply(this,arguments)}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x})){this.judgeStyleAttributes({opacity:x});var A=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,A,this.cellProperties),B=O.data,re=O.width,Q=O.height;this.rowCount=Q,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:re,height:Q}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Yi()(x)?x:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:Nn,fragmentShader:ia,triangulation:Pu})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:E.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:E.gl.STATIC_DRAW,data:[],type:E.gl.FLOAT},size:3,update:function(d,x,A,O,B){return B}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:E.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(d,x,A,O){var B=d.size,re=B===void 0?10:B;return Array.isArray(re)?[re[0]]:[re]}}})}}]),o}(Na);function Zi(i){var c=q();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function q(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var te=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,k=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,F=function(i){(0,_e.Z)(o,i);var c=Zi(o);function o(){return(0,V.Z)(this,o),c.apply(this,arguments)}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:x})){this.judgeStyleAttributes({opacity:x});var A=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,A,this.cellProperties),B=O.data,re=O.width,Q=O.height;this.rowCount=Q,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:re,height:Q}):this.createTexture2D({flipY:!0,data:[1],format:E.gl.LUMINANCE,type:E.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Yi()(x)?x:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:k,fragmentShader:te,triangulation:cc,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),o}(Na),ie={fill:F,line:ku,extrude:_i,text:xr,point_fill:bs,point_image:xc,point_normal:bc,point_extrude:Qi},Ae=ie;function ft(i){var c=Vt();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Vt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Tt=function(i){(0,_e.Z)(o,i);var c=ft(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","PolygonLayer"),s}return(0,H.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Ae[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),x=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return x==="fill"?"fill":x==="extrude"?"extrude":x==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),x=d.shape2d,A=d.shape3d,O=this.iconService.getIconMap(),B=l.find(function(Q){return Q.hasOwnProperty("shape")});if(B){var re=B.shape;return re==="dot"?"point_normal":(x==null?void 0:x.indexOf(re))!==-1?"point_fill":(A==null?void 0:A.indexOf(re))!==-1?"point_extrude":O.hasOwnProperty(re)?"point_image":"text"}else return"fill"}}]),o}(xo);function qt(i){var c=Lr();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function Lr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var In=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Fn=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,oi=function(i){(0,_e.Z)(o,i);var c=qt(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"texture",void 0),(0,I.Z)((0,L.Z)(s),"colorTexture",void 0),s}return(0,H.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,x=d===void 0?1:d,A=l.clampLow,O=A===void 0?!0:A,B=l.clampHigh,re=B===void 0?!0:B,Q=l.noDataValue,ge=Q===void 0?-9999999:Q,Ze=l.domain,_t=Ze===void 0?[0,1]:Ze;return this.updateColorTexure(),{u_opacity:x||1,u_texture:this.texture,u_domain:_t,u_clampLow:O,u_clampHigh:typeof re!="undefined"?re:O,u_noDataValue:ge,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),d=this.rendererService.createTexture2D,x=l.data.dataArray[0];this.texture=d({data:x.data,width:x.width,height:x.height,format:E.gl.LUMINANCE,type:E.gl.FLOAT});var A=this.layer.getLayerConfig(),O=A.rampColors,B=(0,$e.Cl)(O);return this.colorTexture=d({data:B.data,width:B.width,height:B.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Fn,fragmentShader:In,triangulation:Hu,primitive:E.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:E.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:2,update:function(d,x,A,O){return[A[3],A[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,d=this.layer.getLayerConfig(),x=d.rampColors,A=(0,$e.Cl)(x);this.colorTexture=l({data:A.data,width:A.width,height:A.height,flipY:!1})}}]),o}(Na),ui={raster:oi,raster3d:oi},mi=ui;function Gi(i){var c=ma();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function ma(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ya=function(i){(0,_e.Z)(o,i);var c=Gi(o);function o(){var s;(0,V.Z)(this,o);for(var l=arguments.length,d=new Array(l),x=0;x<l;x++)d[x]=arguments[x];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,L.Z)(s),"type","RasterLayer"),s}return(0,H.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new mi[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={raster:{},raster3d:{}};return d[l]}},{key:"getModelType",value:function(){return"raster"}}]),o}(xo),ro=g(50361),Oa=g.n(ro),mo,Ma,ga,aa,pa,Ua,Za,ko,ji;function Xo(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Fo(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Xo(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Xo(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var Yo=(mo=(0,Mt.b2)(),Ma=(0,Mt.f3)(E.vK.IGlobalConfigService),ga=(0,Mt.f3)(E.vK.IMapService),aa=(0,Mt.f3)(E.vK.IFontService),mo(pa=(Ua=function(){function i(){(0,V.Z)(this,i),(0,ii.Z)(this,"configService",Za,this),(0,ii.Z)(this,"mapService",ko,this),(0,ii.Z)(this,"fontService",ji,this)}return(0,H.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(o,{styleAttributeService:d})}),o.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return o.dataState.dataMappingNeedUpdate=!1,l.generateMaping(o,{styleAttributeService:d}),!0}),o.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!o.layerModelNeedUpdate){var x=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),O=o.getSource().data.dataArray,B=x.filter(function(Q){return Q.needRemapping}),re=O;A!=null&&A.needRemapping&&A!==null&&A!==void 0&&A.scale&&(re=O.filter(function(Q){return l.applyAttributeMapping(A,Q)[0]})),B.length&&(A!=null&&A.needRemapping?(o.setEncodedData(l.mapping(x,re)),A.needRemapping=!1):o.setEncodedData(l.mapping(B,re,o.getEncodedData())),o.emit("remapping",null))}})}},{key:"generateMaping",value:function(o,s){var l=this,d=s.styleAttributeService,x=d.getLayerStyleAttributes()||[],A=d.getLayerStyleAttribute("filter"),O=o.getSource().data.dataArray,B=O;A!=null&&A.scale&&(B=O.filter(function(re){return l.applyAttributeMapping(A,re)[0]})),o.setEncodedData(this.mapping(x,B))}},{key:"mapping",value:function(o,s,l){var d=this,x=s.map(function(A,O){var B=l?l[O]:{},re=Fo({id:A._id,coordinates:A.coordinates},B);return o.filter(function(Q){return Q.scale!==void 0}).forEach(function(Q){var ge=d.applyAttributeMapping(Q,A);Q.needRemapping=!1,Q.name==="color"&&(ge=ge.map(function(Ze){return(0,$e.CI)(Ze)})),re[Q.name]=Array.isArray(ge)&&ge.length===1?ge[0]:ge,Q.name==="shape"&&(re.shape=d.fontService.getIconFontKey(re[Q.name]))}),re});return x.length>0&&this.mapService.version==="GAODE2.x"&&(typeof x[0].coordinates[0]=="number"?x.filter(function(A){return!A.originCoordinates}).map(function(A){A.version="GAODE2.x",A.originCoordinates=Oa()(A.coordinates),A.coordinates=d.mapService.lngLatToCoord(A.coordinates)}):x.filter(function(A){return!A.originCoordinates}).map(function(A){A.version="GAODE2.x",A.originCoordinates=Oa()(A.coordinates),A.coordinates=d.mapService.lngLatToCoords(A.coordinates)})),x}},{key:"applyAttributeMapping",value:function(o,s){var l;if(!o.scale)return[];var d=(o==null||(l=o.scale)===null||l===void 0?void 0:l.scalers)||[],x=[];return d.forEach(function(A){var O,B=A.field;(s.hasOwnProperty(B)||((O=o.scale)===null||O===void 0?void 0:O.type)==="variable")&&x.push(s[B])}),o.mapping?o.mapping(x):[]}}]),i}(),Za=(0,ti.Z)(Ua.prototype,"configService",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ko=(0,ti.Z)(Ua.prototype,"mapService",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ji=(0,ti.Z)(Ua.prototype,"fontService",[aa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ua))||pa),Sc={},zu={},el=function(c){return zu[c]},fu=function(c,o){zu[c]=o},Rl=function(c){return Sc[c]},Gs=function(c,o){Sc[c]=o},ml={},yl={},hu=34,Ao=10,Qc=13;function qc(i){return new Function("d","return {"+i.map(function(c,o){return JSON.stringify(c)+": d["+o+'] || ""'}).join(",")+"}")}function pf(i,c){var o=qc(i);return function(s,l){return c(o(s),l,i)}}function Rf(i){var c=Object.create(null),o=[];return i.forEach(function(s){for(var l in s)l in c||o.push(c[l]=l)}),o}function eu(i,c){var o=i+"",s=o.length;return s<c?new Array(c-s+1).join(0)+o:o}function ef(i){return i<0?"-"+eu(-i,6):i>9999?"+"+eu(i,6):eu(i,4)}function Ec(i){var c=i.getUTCHours(),o=i.getUTCMinutes(),s=i.getUTCSeconds(),l=i.getUTCMilliseconds();return isNaN(i)?"Invalid Date":ef(i.getUTCFullYear(),4)+"-"+eu(i.getUTCMonth()+1,2)+"-"+eu(i.getUTCDate(),2)+(l?"T"+eu(c,2)+":"+eu(o,2)+":"+eu(s,2)+"."+eu(l,3)+"Z":s?"T"+eu(c,2)+":"+eu(o,2)+":"+eu(s,2)+"Z":o||c?"T"+eu(c,2)+":"+eu(o,2)+"Z":"")}function _p(i){var c=new RegExp('["'+i+`
\r]`),o=i.charCodeAt(0);function s(Q,ge){var Ze,_t,Ht=l(Q,function(_r,Er){if(Ze)return Ze(_r,Er-1);_t=_r,Ze=ge?pf(_r,ge):qc(_r)});return Ht.columns=_t||[],Ht}function l(Q,ge){var Ze=[],_t=Q.length,Ht=0,_r=0,Er,Vr=_t<=0,_n=!1;Q.charCodeAt(_t-1)===Ao&&--_t,Q.charCodeAt(_t-1)===Qc&&--_t;function Rn(){if(Vr)return yl;if(_n)return _n=!1,ml;var Ci,$n=Ht,Pi;if(Q.charCodeAt($n)===hu){for(;Ht++<_t&&Q.charCodeAt(Ht)!==hu||Q.charCodeAt(++Ht)===hu;);return(Ci=Ht)>=_t?Vr=!0:(Pi=Q.charCodeAt(Ht++))===Ao?_n=!0:Pi===Qc&&(_n=!0,Q.charCodeAt(Ht)===Ao&&++Ht),Q.slice($n+1,Ci-1).replace(/""/g,'"')}for(;Ht<_t;){if((Pi=Q.charCodeAt(Ci=Ht++))===Ao)_n=!0;else if(Pi===Qc)_n=!0,Q.charCodeAt(Ht)===Ao&&++Ht;else if(Pi!==o)continue;return Q.slice($n,Ci)}return Vr=!0,Q.slice($n,_t)}for(;(Er=Rn())!==yl;){for(var Xn=[];Er!==ml&&Er!==yl;)Xn.push(Er),Er=Rn();ge&&(Xn=ge(Xn,_r++))==null||Ze.push(Xn)}return Ze}function d(Q,ge){return Q.map(function(Ze){return ge.map(function(_t){return re(Ze[_t])}).join(i)})}function x(Q,ge){return ge==null&&(ge=Rf(Q)),[ge.map(re).join(i)].concat(d(Q,ge)).join(`
`)}function A(Q,ge){return ge==null&&(ge=Rf(Q)),d(Q,ge).join(`
`)}function O(Q){return Q.map(B).join(`
`)}function B(Q){return Q.map(re).join(i)}function re(Q){return Q==null?"":Q instanceof Date?Ec(Q):c.test(Q+="")?'"'+Q.replace(/"/g,'""')+'"':Q}return{parse:s,parseRows:l,format:x,formatBody:A,formatRows:O,formatRow:B,formatValue:re}}var Dl=_p(","),nh=Dl.parse,Cc=Dl.parseRows,df=Dl.format,Vp=Dl.formatBody,vf=Dl.formatRows,kh=Dl.formatRow,Gp=Dl.formatValue,xp=g(6563),ih=g.n(xp);function Fh(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Df(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Fh(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Fh(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Bh(i,c){var o=c.x,s=c.y,l=c.x1,d=c.y1,x=c.coordinates,A=[];return i.forEach(function(O,B){var re=[];if(o&&s&&(re=[parseFloat(O[o]),parseFloat(O[s])]),o&&s&&l&&d){var Q=[parseFloat(O[o]),parseFloat(O[s])],ge=[parseFloat(O[l]),parseFloat(O[d])];re=[Q,ge]}if(x){var Ze="Polygon";Array.isArray(x[0])||(Ze="Point"),Array.isArray(x[0])&&!Array.isArray(x[0][0])&&(Ze="LineString");var _t={type:Ze,coordinates:(0,Si.Z)(O[x])};ih()(_t,!0),re=_t.coordinates}var Ht=Df(Df({},O),{},{_id:B,coordinates:re});A.push(Ht)}),{dataArray:A}}function tf(i,c){var o=nh(i);return Bh(o,c)}var Nh=g(40271);function os(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return i.geometry.coordinates;if(i.type==="Point")return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function kf(i){if(Array.isArray(i))return i;if(i.type==="Feature"){if(i.geometry!==null)return i.geometry.coordinates}else if(i.coordinates)return i.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function zh(i){if(i.length>1&&isNumber(i[0])&&isNumber(i[1]))return!0;if(Array.isArray(i[0])&&i[0].length)return zh(i[0]);throw new Error("coordinates must only contain numbers")}function ah(i,c,o){if(!c||!o)throw new Error("type and name required");if(!i||i.type!==c)throw new Error("Invalid input to "+o+": must be a "+c+", given "+i.type)}function oh(i,c,o){if(!i)throw new Error("No feature passed");if(!o)throw new Error(".featureOf() requires a name");if(!i||i.type!=="Feature"||!i.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!i.geometry||i.geometry.type!==c)throw new Error("Invalid input to "+o+": must be a "+c+", given "+i.geometry.type)}function rf(i,c,o){if(!i)throw new Error("No featureCollection passed");if(!o)throw new Error(".collectionOf() requires a name");if(!i||i.type!=="FeatureCollection")throw new Error("Invalid input to "+o+", FeatureCollection required");for(var s=0,l=i.features;s<l.length;s++){var d=l[s];if(!d||d.type!=="Feature"||!d.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!d.geometry||d.geometry.type!==c)throw new Error("Invalid input to "+o+": must be a "+c+", given "+d.geometry.type)}}function Ff(i){return i.type==="Feature"?i.geometry:i}function Bf(i,c){return i.type==="FeatureCollection"?"FeatureCollection":i.type==="GeometryCollection"?"GeometryCollection":i.type==="Feature"&&i.geometry!==null?i.geometry.type:i.type}function gl(i,c,o){if(i!==null)for(var s,l,d,x,A,O,B,re=0,Q=0,ge,Ze=i.type,_t=Ze==="FeatureCollection",Ht=Ze==="Feature",_r=_t?i.features.length:1,Er=0;Er<_r;Er++){B=_t?i.features[Er].geometry:Ht?i.geometry:i,ge=B?B.type==="GeometryCollection":!1,A=ge?B.geometries.length:1;for(var Vr=0;Vr<A;Vr++){var _n=0,Rn=0;if(x=ge?B.geometries[Vr]:B,x!==null){O=x.coordinates;var Xn=x.type;switch(re=o&&(Xn==="Polygon"||Xn==="MultiPolygon")?1:0,Xn){case null:break;case"Point":if(c(O,Q,Er,_n,Rn)===!1)return!1;Q++,_n++;break;case"LineString":case"MultiPoint":for(s=0;s<O.length;s++){if(c(O[s],Q,Er,_n,Rn)===!1)return!1;Q++,Xn==="MultiPoint"&&_n++}Xn==="LineString"&&_n++;break;case"Polygon":case"MultiLineString":for(s=0;s<O.length;s++){for(l=0;l<O[s].length-re;l++){if(c(O[s][l],Q,Er,_n,Rn)===!1)return!1;Q++}Xn==="MultiLineString"&&_n++,Xn==="Polygon"&&Rn++}Xn==="Polygon"&&_n++;break;case"MultiPolygon":for(s=0;s<O.length;s++){for(Rn=0,l=0;l<O[s].length;l++){for(d=0;d<O[s][l].length-re;d++){if(c(O[s][l][d],Q,Er,_n,Rn)===!1)return!1;Q++}Rn++}_n++}break;case"GeometryCollection":for(s=0;s<x.geometries.length;s++)if(gl(x.geometries[s],c,o)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Nf(i,c,o,s){var l=o;return gl(i,function(d,x,A,O,B){x===0&&o===void 0?l=d:l=c(l,d,x,A,O,B)},s),l}function nf(i,c){var o;switch(i.type){case"FeatureCollection":for(o=0;o<i.features.length&&c(i.features[o].properties,o)!==!1;o++);break;case"Feature":c(i.properties,0);break}}function sh(i,c,o){var s=o;return nf(i,function(l,d){d===0&&o===void 0?s=l:s=c(s,l,d)}),s}function wc(i,c){if(i.type==="Feature")c(i,0);else if(i.type==="FeatureCollection")for(var o=0;o<i.features.length&&c(i.features[o],o)!==!1;o++);}function Uh(i,c,o){var s=o;return wc(i,function(l,d){d===0&&o===void 0?s=l:s=c(s,l,d)}),s}function mf(i){var c=[];return gl(i,function(o){c.push(o)}),c}function yf(i,c){var o,s,l,d,x,A,O,B,re,Q,ge=0,Ze=i.type==="FeatureCollection",_t=i.type==="Feature",Ht=Ze?i.features.length:1;for(o=0;o<Ht;o++){for(A=Ze?i.features[o].geometry:_t?i.geometry:i,B=Ze?i.features[o].properties:_t?i.properties:{},re=Ze?i.features[o].bbox:_t?i.bbox:void 0,Q=Ze?i.features[o].id:_t?i.id:void 0,O=A?A.type==="GeometryCollection":!1,x=O?A.geometries.length:1,l=0;l<x;l++){if(d=O?A.geometries[l]:A,d===null){if(c(null,ge,B,re,Q)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(c(d,ge,B,re,Q)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<d.geometries.length;s++)if(c(d.geometries[s],ge,B,re,Q)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ge++}}function gf(i,c,o){var s=o;return yf(i,function(l,d,x,A,O){d===0&&o===void 0?s=l:s=c(s,l,d,x,A,O)}),s}function kl(i,c){yf(i,function(o,s,l,d,x){var A=o===null?null:o.type;switch(A){case null:case"Point":case"LineString":case"Polygon":return c((0,Nh.zL)(o,l,{bbox:d,id:x}),s,0)===!1?!1:void 0}var O;switch(A){case"MultiPoint":O="Point";break;case"MultiLineString":O="LineString";break;case"MultiPolygon":O="Polygon";break}for(var B=0;B<o.coordinates.length;B++){var re=o.coordinates[B],Q={type:O,coordinates:re};if(c((0,Nh.zL)(Q,l),s,B)===!1)return!1}})}function Su(i,c,o){var s=o;return kl(i,function(l,d,x){d===0&&x===0&&o===void 0?s=l:s=c(s,l,d,x)}),s}function _f(i,c){kl(i,function(o,s,l){var d=0;if(!!o.geometry){var x=o.geometry.type;if(!(x==="Point"||x==="MultiPoint")){var A,O=0,B=0,re=0;if(gl(o,function(Q,ge,Ze,_t,Ht){if(A===void 0||s>O||_t>B||Ht>re){A=Q,O=s,B=_t,re=Ht,d=0;return}var _r=lineString([A,Q],o.properties);if(c(_r,s,l,Ht,d)===!1)return!1;d++,A=Q})===!1)return!1}}})}function zf(i,c,o){var s=o,l=!1;return _f(i,function(d,x,A,O,B){l===!1&&o===void 0?s=d:s=c(s,d,x,A,O,B),l=!0}),s}function xf(i,c){if(!i)throw new Error("geojson is required");kl(i,function(o,s,l){if(o.geometry!==null){var d=o.geometry.type,x=o.geometry.coordinates;switch(d){case"LineString":if(c(o,s,l,0,0)===!1)return!1;break;case"Polygon":for(var A=0;A<x.length;A++)if(c(lineString(x[A],o.properties),s,l,A)===!1)return!1;break}}})}function Zh(i,c,o){var s=o;return xf(i,function(l,d,x,A){d===0&&o===void 0?s=l:s=c(s,l,d,x,A)}),s}function bf(i,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var o=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.segmentIndex||0,x=c.properties,A;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),x=x||i.features[o].properties,A=i.features[o].geometry;break;case"Feature":x=x||i.properties,A=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=i;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var O=A.coordinates;switch(A.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=O.length+d-1),lineString([O[d],O[d+1]],x,c);case"Polygon":return l<0&&(l=O.length+l),d<0&&(d=O[l].length+d-1),lineString([O[l][d],O[l][d+1]],x,c);case"MultiLineString":return s<0&&(s=O.length+s),d<0&&(d=O[s].length+d-1),lineString([O[s][d],O[s][d+1]],x,c);case"MultiPolygon":return s<0&&(s=O.length+s),l<0&&(l=O[s].length+l),d<0&&(d=O[s][l].length-d-1),lineString([O[s][l][d],O[s][l][d+1]],x,c)}throw new Error("geojson is invalid")}function _l(i,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var o=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.coordIndex||0,x=c.properties,A;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),x=x||i.features[o].properties,A=i.features[o].geometry;break;case"Feature":x=x||i.properties,A=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=i;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var O=A.coordinates;switch(A.type){case"Point":return point(O,x,c);case"MultiPoint":return s<0&&(s=O.length+s),point(O[s],x,c);case"LineString":return d<0&&(d=O.length+d),point(O[d],x,c);case"Polygon":return l<0&&(l=O.length+l),d<0&&(d=O[l].length+d),point(O[l][d],x,c);case"MultiLineString":return s<0&&(s=O.length+s),d<0&&(d=O[s].length+d),point(O[s][d],x,c);case"MultiPolygon":return s<0&&(s=O.length+s),l<0&&(l=O[s].length+l),d<0&&(d=O[s][l].length-d),point(O[s][l][d],x,c)}throw new Error("geojson is invalid")}function uh(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Uf(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?uh(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):uh(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function jh(i,c){var o=[],s={};if(i.features=i.features.filter(function(d){var x=d.geometry;return d!=null&&x&&x.type&&x.coordinates&&x.coordinates.length>0}),ih()(i,!0),i.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return kl(i,function(d,x){var A=kf(d),O=x,B=Uf(Uf({},d.properties),{},{coordinates:A,_id:O});o.push(B)}),{dataArray:o,featureKeys:s}}function lh(i,c){var o=c.extent,s=new Promise(function(d){bp(i,function(x){d(x)})}),l={images:s,_id:1,dataArray:[{_id:0,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return l}function bp(i,c){var o=i,s=[];if(typeof o=="string")(0,$e.gJ)({url:o},function(x,A){s.push(A),c(s)});else{var l=o.length,d=0;o.forEach(function(x){(0,$e.gJ)({url:x},function(A,O){d++,s.push(O),d===l&&c(s)})})}return lh}function Tc(i,c){var o=c.extent,s=c.width,l=c.height,d=c.min,x=c.max,A={_id:1,dataArray:[{_id:1,data:Array.from(i),width:s,height:l,min:d,max:x,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return A}var zc=g(30236),Vh=g.n(zc);function Sf(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function af(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Sf(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Sf(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Uu(i,c){var o=c.radius,s=o===void 0?40:o,l=c.maxZoom,d=l===void 0?18:l,x=c.minZoom,A=x===void 0?0:x,O=c.zoom,B=O===void 0?2:O;if(i.pointIndex){var re=i.pointIndex.getClusters(i.extent,Math.floor(B));return i.dataArray=Sp(re),i}var Q=new(ar())({radius:s,minZoom:A,maxZoom:d}),ge={type:"FeatureCollection",features:[]};return ge.features=i.dataArray.map(function(Ze){return{type:"Feature",geometry:{type:"Point",coordinates:Ze.coordinates},properties:af({},Ze)}}),Q.load(ge.features),Q}function Sp(i){return i.map(function(c,o){return af({coordinates:c.geometry.coordinates,_id:o+1},c.properties)})}function Fl(i){if(i.length===0)throw new Error("max requires at least one data point");for(var c=i[0],o=1;o<i.length;o++)i[o]>c&&(c=i[o]);return c}function Gh(i){if(i.length===0)throw new Error("min requires at least one data point");for(var c=i[0],o=1;o<i.length;o++)i[o]<c&&(c=i[o]);return c}function xl(i){if(i.length===0)return 0;for(var c=i[0],o=0,s,l=1;l<i.length;l++)s=c+i[l]*1,Math.abs(c)>=Math.abs(i[l])?o+=c-s+i[l]:o+=i[l]-s+c,c=s;return c+o*1}function ic(i){if(i.length===0)throw new Error("mean requires at least one data point");return xl(i)/i.length}var Hh={min:Gh,max:Fl,mean:ic,sum:xl};function ch(i,c){return i.map(function(o){return o[c]*1})}function Ef(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function fh(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Ef(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Ef(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function ms(i){var c=zo();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function zo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function ss(i,c){if(Array.isArray(c))return c}var pu=function(i){(0,_e.Z)(o,i);var c=ms(o);function o(s,l){var d;return(0,V.Z)(this,o),d=c.call(this),(0,I.Z)((0,L.Z)(d),"data",void 0),(0,I.Z)((0,L.Z)(d),"extent",void 0),(0,I.Z)((0,L.Z)(d),"hooks",{init:new gi.ni}),(0,I.Z)((0,L.Z)(d),"parser",{type:"geojson"}),(0,I.Z)((0,L.Z)(d),"transforms",[]),(0,I.Z)((0,L.Z)(d),"cluster",!1),(0,I.Z)((0,L.Z)(d),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,I.Z)((0,L.Z)(d),"mapService",void 0),(0,I.Z)((0,L.Z)(d),"invalidExtent",!1),(0,I.Z)((0,L.Z)(d),"originData",void 0),(0,I.Z)((0,L.Z)(d),"rawData",void 0),(0,I.Z)((0,L.Z)(d),"cfg",{}),(0,I.Z)((0,L.Z)(d),"clusterIndex",void 0),d.originData=s,d.initCfg(l),d.hooks.init.tap("parser",function(){d.excuteParser()}),d.hooks.init.tap("cluster",function(){d.initCluster()}),d.hooks.init.tap("transform",function(){d.executeTrans()}),d.init(),d}return(0,H.Z)(o,[{key:"setData",value:function(l,d){this.rawData=l,this.originData=l,this.initCfg(d),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var d=this,x=this.clusterOptions,A=x.method,O=A===void 0?"sum":A,B=x.field,re=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,re.forEach(function(Q){Q.id||(Q.properties.point_count=1)}),(B||ba()(O))&&(re=re.map(function(Q){var ge=Q.id;if(ge){var Ze=d.clusterIndex.getLeaves(ge,Infinity),_t=Ze.map(function(Er){return Er.properties}),Ht;if(co()(O)&&B){var _r=ch(_t,B);Ht=Hh[O](_r)}ba()(O)&&(Ht=O(_t)),Q.properties.stat=Ht}else Q.properties.point_count=1;return Q})),this.data=el("geojson")({type:"FeatureCollection",features:re}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var d=this.parser.type,x=d===void 0?"geojson":d;if(x==="geojson"&&!this.cluster){var A=l<this.originData.features.length?this.originData.features[l]:"null",O=Oa()(A);if(this.transforms.length!==0){var B=this.data.dataArray.find(function(re){return re._id===l});O.properties=B}return O}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,d){var x=this.data.dataArray.find(function(A){return A[l]===name});return x==null?void 0:x._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var d=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(d=(0,$e.yA)((0,$e.ds)(this.extent),l)),d[0].concat(d[1])}},{key:"initCfg",value:function(l){this.cfg=Vh()(this.cfg,l,ss);var d=this.cfg;d&&(d.parser&&(this.parser=d.parser),d.transforms&&(this.transforms=d.transforms),this.cluster=d.cluster||!1,d.clusterOptions&&(this.cluster=!0,this.clusterOptions=fh(fh({},this.clusterOptions),d.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,d=l.type||"geojson",x=el(d);this.data=x(this.originData,l),this.extent=(0,$e.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,d=this.transforms;d.forEach(function(x){var A=x.type,O=Rl(A)(l.data,x);Object.assign(l.data,O)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=Uu(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),o}(Rt.EventEmitter);function hh(i,c){var o=c.callback;return o&&(i.dataArray=i.dataArray.filter(o)),i}function Wh(i,c){var o=typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!o){if(Array.isArray(i)||(o=Xh(i))||c&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(B){throw B},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,x=!1,A;return{s:function(){o=o.call(i)},n:function(){var B=o.next();return d=B.done,B},e:function(B){x=!0,A=B},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(x)throw A}}}}function Xh(i,c){if(!!i){if(typeof i=="string")return Yh(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Yh(i,c)}}function Yh(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}var ph=6378e3;function Kh(i,c){var o=i.dataArray,s=c.size,l=s===void 0?10:s,d=l/(2*Math.PI*ph)*(256<<20)/2,x=$h(o,l),A=x.gridHash,O=x.gridOffset,B=Jh(A,O,c);return{yOffset:d,xOffset:d,radius:d,type:"grid",dataArray:B}}function $h(i,c){var o=Infinity,s=-Infinity,l,d=Wh(i),x;try{for(d.s();!(x=d.n()).done;){var A=x.value;l=A.coordinates[1],Number.isFinite(l)&&(o=l<o?l:o,s=l>s?l:s)}}catch(_n){d.e(_n)}finally{d.f()}var O=(o+s)/2,B=Ep(c,O);if(B.xOffset<=0||B.yOffset<=0)return{gridHash:{},gridOffset:B};var re={},Q=Wh(i),ge;try{for(Q.s();!(ge=Q.n()).done;){var Ze=ge.value,_t=Ze.coordinates[1],Ht=Ze.coordinates[0];if(Number.isFinite(_t)&&Number.isFinite(Ht)){var _r=Math.floor((_t+90)/B.yOffset),Er=Math.floor((Ht+180)/B.xOffset),Vr="".concat(_r,"-").concat(Er);re[Vr]=re[Vr]||{count:0,points:[]},re[Vr].count+=1,re[Vr].points.push(Ze)}}}catch(_n){Q.e(_n)}finally{Q.f()}return{gridHash:re,gridOffset:B}}function Ep(i,c){var o=Cp(i),s=Cf(c,i);return{yOffset:o,xOffset:s}}function Cp(i){return i/ph*(180/Math.PI)}function Cf(i,c){return c/ph*(180/Math.PI)/Math.cos(i*Math.PI/180)}function Jh(i,c,o){return Object.keys(i).reduce(function(s,l,d){var x=l.split("-"),A=parseInt(x[0],10),O=parseInt(x[1],10),B={};if(o.field&&o.method){var re=$e.a5.getColumn(i[l].points,o.field);B[o.method]=$e.a5.statMap[o.method](re)}return Object.assign(B,{_id:d,coordinates:(0,$e.Z)([-180+c.xOffset*(O+.5),-90+c.yOffset*(A+.5)]),rawData:i[l].points,count:i[l].count}),s.push(B),s},[])}var Ac=Math.PI/3,wf=[0,Ac,2*Ac,3*Ac,4*Ac,5*Ac];function $a(i){return i[0]}function Qh(i){return i[1]}function ac(){var i=0,c=0,o=1,s=1,l=$a,d=Qh,x,A,O;function B(Q){var ge={},Ze=[],_t,Ht=Q.length;for(_t=0;_t<Ht;++_t)if(!(isNaN(Er=+l.call(null,_r=Q[_t],_t,Q))||isNaN(Vr=+d.call(null,_r,_t,Q)))){var _r,Er,Vr,_n=Math.round(Vr=Vr/O),Rn=Math.round(Er=Er/A-(_n&1)/2),Xn=Vr-_n;if(Math.abs(Xn)*3>1){var Ci=Er-Rn,$n=Rn+(Er<Rn?-1:1)/2,Pi=_n+(Vr<_n?-1:1),ua=Er-$n,xa=Vr-Pi;Ci*Ci+Xn*Xn>ua*ua+xa*xa&&(Rn=$n+(_n&1?1:-1)/2,_n=Pi)}var pi=Rn+"-"+_n,Ia=ge[pi];Ia?Ia.push(_r):(Ze.push(Ia=ge[pi]=[_r]),Ia.x=(Rn+(_n&1)/2)*A,Ia.y=_n*O)}return Ze}function re(Q){var ge=0,Ze=0;return wf.map(function(_t){var Ht=Math.sin(_t)*Q,_r=-Math.cos(_t)*Q,Er=Ht-ge,Vr=_r-Ze;return ge=Ht,Ze=_r,[Er,Vr]})}return B.hexagon=function(Q){return"m"+re(Q==null?x:+Q).join("l")+"z"},B.centers=function(){for(var Q=[],ge=Math.round(c/O),Ze=Math.round(i/A),_t=ge*O;_t<s+x;_t+=O,++ge)for(var Ht=Ze*A+(ge&1)*A/2;Ht<o+A/2;Ht+=A)Q.push([Ht,_t]);return Q},B.mesh=function(){var Q=re(x).slice(0,4).join("l");return B.centers().map(function(ge){return"M"+ge+"m"+Q}).join("")},B.x=function(Q){return arguments.length?(l=Q,B):l},B.y=function(Q){return arguments.length?(d=Q,B):d},B.radius=function(Q){return arguments.length?(x=+Q,A=x*2*Math.sin(Ac),O=x*1.5,B):x},B.size=function(Q){return arguments.length?(i=c=0,o=+Q[0],s=+Q[1],B):[o-i,s-c]},B.extent=function(Q){return arguments.length?(i=+Q[0][0],c=+Q[0][1],o=+Q[1][0],s=+Q[1][1],B):[[i,c],[o,s]]},B.radius(1)}function Pc(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function dh(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Pc(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Pc(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var X=6378e3;function Oe(i,c){var o=i.dataArray,s=c.size,l=s===void 0?10:s,d=c.method,x=d===void 0?"sum":d,A=l/(2*Math.PI*X)*(256<<20)/2,O=o.map(function(ge){var Ze=(0,$e.Z)(ge.coordinates),_t=(0,Z.Z)(Ze,2),Ht=_t[0],_r=_t[1];return dh(dh({},ge),{},{coordinates:[Ht,_r]})}),B=ac().radius(A).x(function(ge){return ge.coordinates[0]}).y(function(ge){return ge.coordinates[1]}),re=B(O),Q={dataArray:re.map(function(ge,Ze){var _t;if(c.field&&x){var Ht=$e.a5.getColumn(ge,c.field);ge[x]=$e.a5.statMap[x](Ht)}return _t={},(0,I.Z)(_t,c.method,ge[x]),(0,I.Z)(_t,"count",ge.length),(0,I.Z)(_t,"rawData",ge),(0,I.Z)(_t,"coordinates",[ge.x,ge.y]),(0,I.Z)(_t,"_id",Ze),_t}),radius:A,xOffset:A,yOffset:A,type:"hexagon"};return Q}function qe(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function lr(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?qe(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):qe(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Ir(i,c){var o=c.sourceField,s=c.targetField,l=c.data,d={};return l.forEach(function(x){d[x[o]]=x}),i.dataArray=i.dataArray.map(function(x){var A=x[s];return lr(lr({},x),d[A])}),i}function or(i,c){var o=c.callback;return o&&(i.dataArray=i.dataArray.map(o)),i}var Cr=g(4771),Nr=pu;fu("geojson",jh),fu("image",lh),fu("csv",tf),fu("json",Bh),fu("raster",Tc),Gs("cluster",Uu),Gs("filter",hh),Gs("join",Ir),Gs("map",or),Gs("grid",Kh),Gs("hexagon",Oe);var Hr,Kr,Jr=(Hr=(0,Mt.b2)(),Hr(Kr=function(){function i(){(0,V.Z)(this,i),(0,I.Z)(this,"mapService",void 0)}return(0,H.Z)(i,[{key:"apply",value:function(o){var s=this;this.mapService=o.getContainer().get(E.vK.IMapService),o.hooks.init.tap("DataSourcePlugin",function(){var l=o.getSource();if(!l){var d=o.sourceOption,x=d.data,A=d.options;o.setSource(new Nr(x,A))}s.updateClusterData(o)}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(o),d=o.dataState.dataSourceNeedUpdate;return o.dataState.dataSourceNeedUpdate=!1,l||d})}},{key:"updateClusterData",value:function(o){var s=o.getSource(),l=s.cluster,d=s.clusterOptions,x=d.zoom,A=x===void 0?0:x,O=d.maxZoom,B=O===void 0?16:O,re=this.mapService.getZoom()-1,Q=o.dataState.dataSourceNeedUpdate;return l&&(Q||Math.abs(A-re)>1)&&B>A?(s.updateClusterData(Math.floor(re)),!0):!1}}]),i}())||Kr),rn=g(44908),dn=g.n(rn),Wr=g(14293),en=g.n(Wr);function Bt(i,c){return i<c?-1:i>c?1:i>=c?0:NaN}function yr(i){return i.length===1&&(i=Yr(i)),{left:function(c,o,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;i(c[d],o)<0?s=d+1:l=d}return s},right:function(c,o,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;i(c[d],o)>0?l=d:s=d+1}return s}}}function Yr(i){return function(c,o){return Bt(i(c),o)}}var wn=yr(Bt),Ar=wn.right,En=wn.left,qr=Ar;function li(i,c){var o=i.length,s=-1,l,d,x;if(c==null){for(;++s<o;)if((l=i[s])!=null&&l>=l)for(d=x=l;++s<o;)(l=i[s])!=null&&(d>l&&(d=l),x<l&&(x=l))}else for(;++s<o;)if((l=c(i[s],s,i))!=null&&l>=l)for(d=x=l;++s<o;)(l=c(i[s],s,i))!=null&&(d>l&&(d=l),x<l&&(x=l));return[d,x]}var Pr=Array.prototype,Sr=Pr.slice,Wn=Pr.map,hn=Math.sqrt(50),$r=Math.sqrt(10),yn=Math.sqrt(2);function bn(i,c,o){var s,l=-1,d,x,A;if(c=+c,i=+i,o=+o,i===c&&o>0)return[i];if((s=c<i)&&(d=i,i=c,c=d),(A=Ri(i,c,o))===0||!isFinite(A))return[];if(A>0)for(i=Math.ceil(i/A),c=Math.floor(c/A),x=new Array(d=Math.ceil(c-i+1));++l<d;)x[l]=(i+l)*A;else for(i=Math.floor(i*A),c=Math.ceil(c*A),x=new Array(d=Math.ceil(i-c+1));++l<d;)x[l]=(i-l)/A;return s&&x.reverse(),x}function Ri(i,c,o){var s=(c-i)/Math.max(0,o),l=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,l);return l>=0?(d>=hn?10:d>=$r?5:d>=yn?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=hn?10:d>=$r?5:d>=yn?2:1)}function Ii(i,c,o){var s=Math.abs(c-i)/Math.max(0,o),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/l;return d>=hn?l*=10:d>=$r?l*=5:d>=yn&&(l*=2),c<i?-l:l}function An(){var i=identity,c=extent,o=sturges;function s(l){var d,x=l.length,A,O=new Array(x);for(d=0;d<x;++d)O[d]=i(l[d],d,l);var B=c(O),re=B[0],Q=B[1],ge=o(O,re,Q);Array.isArray(ge)||(ge=tickStep(re,Q,ge),ge=range(Math.ceil(re/ge)*ge,Q,ge));for(var Ze=ge.length;ge[0]<=re;)ge.shift(),--Ze;for(;ge[Ze-1]>Q;)ge.pop(),--Ze;var _t=new Array(Ze+1),Ht;for(d=0;d<=Ze;++d)Ht=_t[d]=[],Ht.x0=d>0?ge[d-1]:re,Ht.x1=d<Ze?ge[d]:Q;for(d=0;d<x;++d)A=O[d],re<=A&&A<=Q&&_t[bisect(ge,A,0,Ze)].push(l[d]);return _t}return s.value=function(l){return arguments.length?(i=typeof l=="function"?l:constant(l),s):i},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):o},s}function Tn(i,c,o){return i=map.call(i,number).sort(ascending),Math.ceil((o-c)/(2*(quantile(i,.75)-quantile(i,.25))*Math.pow(i.length,-1/3)))}function Ei(i){return i===null?NaN:+i}function Bi(i,c,o){if(o==null&&(o=Ei),!!(s=i.length)){if((c=+c)<=0||s<2)return+o(i[0],0,i);if(c>=1)return+o(i[s-1],s-1,i);var s,l=(s-1)*c,d=Math.floor(l),x=+o(i[d],d,i),A=+o(i[d+1],d+1,i);return x+(A-x)*(l-d)}}var Fi="$";function po(){}po.prototype=Co.prototype={constructor:po,has:function(i){return Fi+i in this},get:function(i){return this[Fi+i]},set:function(i,c){return this[Fi+i]=c,this},remove:function(i){var c=Fi+i;return c in this&&delete this[c]},clear:function(){for(var i in this)i[0]===Fi&&delete this[i]},keys:function(){var i=[];for(var c in this)c[0]===Fi&&i.push(c.slice(1));return i},values:function(){var i=[];for(var c in this)c[0]===Fi&&i.push(this[c]);return i},entries:function(){var i=[];for(var c in this)c[0]===Fi&&i.push({key:c.slice(1),value:this[c]});return i},size:function(){var i=0;for(var c in this)c[0]===Fi&&++i;return i},empty:function(){for(var i in this)if(i[0]===Fi)return!1;return!0},each:function(i){for(var c in this)c[0]===Fi&&i(this[c],c.slice(1),this)}};function Co(i,c){var o=new po;if(i instanceof po)i.each(function(A,O){o.set(O,A)});else if(Array.isArray(i)){var s=-1,l=i.length,d;if(c==null)for(;++s<l;)o.set(s,i[s]);else for(;++s<l;)o.set(c(d=i[s],s,i),d)}else if(i)for(var x in i)o.set(x,i[x]);return o}var oa=Co;function Os(){var i=[],c=[],o,s,l;function d(A,O,B,re){if(O>=i.length)return o!=null&&A.sort(o),s!=null?s(A):A;for(var Q=-1,ge=A.length,Ze=i[O++],_t,Ht,_r=map(),Er,Vr=B();++Q<ge;)(Er=_r.get(_t=Ze(Ht=A[Q])+""))?Er.push(Ht):_r.set(_t,[Ht]);return _r.each(function(_n,Rn){re(Vr,Rn,d(_n,O,B,re))}),Vr}function x(A,O){if(++O>i.length)return A;var B,re=c[O-1];return s!=null&&O>=i.length?B=A.entries():(B=[],A.each(function(Q,ge){B.push({key:ge,values:x(Q,O)})})),re!=null?B.sort(function(Q,ge){return re(Q.key,ge.key)}):B}return l={object:function(A){return d(A,0,uo,ys)},map:function(A){return d(A,0,Uo,us)},entries:function(A){return x(d(A,0,Uo,us),0)},key:function(A){return i.push(A),l},sortKeys:function(A){return c[i.length-1]=A,l},sortValues:function(A){return o=A,l},rollup:function(A){return s=A,l}}}function uo(){return{}}function ys(i,c,o){i[c]=o}function Uo(){return map()}function us(i,c,o){i.set(c,o)}function Ko(){}var wo=oa.prototype;Ko.prototype=Zo.prototype={constructor:Ko,has:wo.has,add:function(i){return i+="",this[Fi+i]=i,this},remove:wo.remove,clear:wo.clear,values:wo.keys,size:wo.size,empty:wo.empty,each:wo.each};function Zo(i,c){var o=new Ko;if(i instanceof Ko)i.each(function(d){o.add(d)});else if(i){var s=-1,l=i.length;if(c==null)for(;++s<l;)o.add(i[s]);else for(;++s<l;)o.add(c(i[s],s,i))}return o}var Wi=null,$o=Array.prototype,Ea=$o.map,no=$o.slice;function di(i,c){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(c).domain(i);break}return this}function la(i,c){switch(arguments.length){case 0:break;case 1:this.interpolator(i);break;default:this.interpolator(c).domain(i);break}return this}var Wa={name:"implicit"};function lo(){var i=oa(),c=[],o=[],s=Wa;function l(d){var x=d+"",A=i.get(x);if(!A){if(s!==Wa)return s;i.set(x,A=c.push(d))}return o[(A-1)%o.length]}return l.domain=function(d){if(!arguments.length)return c.slice();c=[],i=oa();for(var x=-1,A=d.length,O,B;++x<A;)i.has(B=(O=d[x])+"")||i.set(B,c.push(O));return l},l.range=function(d){return arguments.length?(o=no.call(d),l):o.slice()},l.unknown=function(d){return arguments.length?(s=d,l):s},l.copy=function(){return lo(c,o).unknown(s)},di.apply(l,arguments),l}function tl(){var i=ordinal().unknown(void 0),c=i.domain,o=i.range,s=[0,1],l,d,x=!1,A=0,O=0,B=.5;delete i.unknown;function re(){var Q=c().length,ge=s[1]<s[0],Ze=s[ge-0],_t=s[1-ge];l=(_t-Ze)/Math.max(1,Q-A+O*2),x&&(l=Math.floor(l)),Ze+=(_t-Ze-l*(Q-A))*B,d=l*(1-A),x&&(Ze=Math.round(Ze),d=Math.round(d));var Ht=sequence(Q).map(function(_r){return Ze+l*_r});return o(ge?Ht.reverse():Ht)}return i.domain=function(Q){return arguments.length?(c(Q),re()):c()},i.range=function(Q){return arguments.length?(s=[+Q[0],+Q[1]],re()):s.slice()},i.rangeRound=function(Q){return s=[+Q[0],+Q[1]],x=!0,re()},i.bandwidth=function(){return d},i.step=function(){return l},i.round=function(Q){return arguments.length?(x=!!Q,re()):x},i.padding=function(Q){return arguments.length?(A=Math.min(1,O=+Q),re()):A},i.paddingInner=function(Q){return arguments.length?(A=Math.min(1,Q),re()):A},i.paddingOuter=function(Q){return arguments.length?(O=+Q,re()):O},i.align=function(Q){return arguments.length?(B=Math.max(0,Math.min(1,Q)),re()):B},i.copy=function(){return tl(c(),s).round(x).paddingInner(A).paddingOuter(O).align(B)},initRange.apply(re(),arguments)}function Ye(i){var c=i.copy;return i.padding=i.paddingOuter,delete i.paddingInner,delete i.paddingOuter,i.copy=function(){return Ye(c())},i}function dr(){return Ye(tl.apply(null,arguments).paddingInner(1))}var er=g(26257),Bn=g(73626);function ca(i,c){return i=+i,c=+c,function(o){return Math.round(i*(1-o)+c*o)}}function ze(i){return function(){return i}}function Ee(i){return+i}var ut=[0,1];function Ot(i){return i}function sr(i,c){return(c-=i=+i)?function(o){return(o-i)/c}:ze(isNaN(c)?NaN:.5)}function yt(i){var c=i[0],o=i[i.length-1],s;return c>o&&(s=c,c=o,o=s),function(l){return Math.max(c,Math.min(o,l))}}function dt(i,c,o){var s=i[0],l=i[1],d=c[0],x=c[1];return l<s?(s=sr(l,s),d=o(x,d)):(s=sr(s,l),d=o(d,x)),function(A){return d(s(A))}}function lt(i,c,o){var s=Math.min(i.length,c.length)-1,l=new Array(s),d=new Array(s),x=-1;for(i[s]<i[0]&&(i=i.slice().reverse(),c=c.slice().reverse());++x<s;)l[x]=sr(i[x],i[x+1]),d[x]=o(c[x],c[x+1]);return function(A){var O=qr(i,A,1,s)-1;return d[O](l[O](A))}}function De(i,c){return c.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function it(){var i=ut,c=ut,o=er.Z,s,l,d,x=Ot,A,O,B;function re(){return A=Math.min(i.length,c.length)>2?lt:dt,O=B=null,Q}function Q(ge){return isNaN(ge=+ge)?d:(O||(O=A(i.map(s),c,o)))(s(x(ge)))}return Q.invert=function(ge){return x(l((B||(B=A(c,i.map(s),Bn.Z)))(ge)))},Q.domain=function(ge){return arguments.length?(i=Ea.call(ge,Ee),x===Ot||(x=yt(i)),re()):i.slice()},Q.range=function(ge){return arguments.length?(c=no.call(ge),re()):c.slice()},Q.rangeRound=function(ge){return c=no.call(ge),o=ca,re()},Q.clamp=function(ge){return arguments.length?(x=ge?yt(i):Ot,Q):x!==Ot},Q.interpolate=function(ge){return arguments.length?(o=ge,re()):o},Q.unknown=function(ge){return arguments.length?(d=ge,Q):d},function(ge,Ze){return s=ge,l=Ze,re()}}function Ue(i,c){return it()(i,c)}var Gt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Xt(i){if(!(c=Gt.exec(i)))throw new Error("invalid format: "+i);var c;return new Br({fill:c[1],align:c[2],sign:c[3],symbol:c[4],zero:c[5],width:c[6],comma:c[7],precision:c[8]&&c[8].slice(1),trim:c[9],type:c[10]})}Xt.prototype=Br.prototype;function Br(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}Br.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function fn(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function sn(i,c){if((o=(i=c?i.toExponential(c-1):i.toExponential()).indexOf("e"))<0)return null;var o,s=i.slice(0,o);return[s.length>1?s[0]+s.slice(2):s,+i.slice(o+1)]}function gn(i){return i=sn(Math.abs(i)),i?i[1]:NaN}function un(i,c){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(gn(c)/3)))*3-gn(Math.abs(i)))}function Yn(i,c){return function(o,s){for(var l=o.length,d=[],x=0,A=i[0],O=0;l>0&&A>0&&(O+A+1>s&&(A=Math.max(1,s-O)),d.push(o.substring(l-=A,l+A)),!((O+=A+1)>s));)A=i[x=(x+1)%i.length];return d.reverse().join(c)}}function On(i){return function(c){return c.replace(/[0-9]/g,function(o){return i[+o]})}}function jn(i){e:for(var c=i.length,o=1,s=-1,l;o<c;++o)switch(i[o]){case".":s=l=o;break;case"0":s===0&&(s=o),l=o;break;default:if(!+i[o])break e;s>0&&(s=0);break}return s>0?i.slice(0,s)+i.slice(l+1):i}var Vn;function Gn(i,c){var o=sn(i,c);if(!o)return i+"";var s=o[0],l=o[1],d=l-(Vn=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,x=s.length;return d===x?s:d>x?s+new Array(d-x+1).join("0"):d>0?s.slice(0,d)+"."+s.slice(d):"0."+new Array(1-d).join("0")+sn(i,Math.max(0,c+d-1))[0]}function hi(i,c){var o=sn(i,c);if(!o)return i+"";var s=o[0],l=o[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var Xa={"%":function(i,c){return(i*100).toFixed(c)},b:function(i){return Math.round(i).toString(2)},c:function(i){return i+""},d:fn,e:function(i,c){return i.toExponential(c)},f:function(i,c){return i.toFixed(c)},g:function(i,c){return i.toPrecision(c)},o:function(i){return Math.round(i).toString(8)},p:function(i,c){return hi(i*100,c)},r:hi,s:Gn,X:function(i){return Math.round(i).toString(16).toUpperCase()},x:function(i){return Math.round(i).toString(16)}};function Bo(i){return i}var bl=Array.prototype.map,Ja=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function La(i){var c=i.grouping===void 0||i.thousands===void 0?Bo:Yn(bl.call(i.grouping,Number),i.thousands+""),o=i.currency===void 0?"":i.currency[0]+"",s=i.currency===void 0?"":i.currency[1]+"",l=i.decimal===void 0?".":i.decimal+"",d=i.numerals===void 0?Bo:On(bl.call(i.numerals,String)),x=i.percent===void 0?"%":i.percent+"",A=i.minus===void 0?"-":i.minus+"",O=i.nan===void 0?"NaN":i.nan+"";function B(Q){Q=Xt(Q);var ge=Q.fill,Ze=Q.align,_t=Q.sign,Ht=Q.symbol,_r=Q.zero,Er=Q.width,Vr=Q.comma,_n=Q.precision,Rn=Q.trim,Xn=Q.type;Xn==="n"?(Vr=!0,Xn="g"):Xa[Xn]||(_n===void 0&&(_n=12),Rn=!0,Xn="g"),(_r||ge==="0"&&Ze==="=")&&(_r=!0,ge="0",Ze="=");var Ci=Ht==="$"?o:Ht==="#"&&/[boxX]/.test(Xn)?"0"+Xn.toLowerCase():"",$n=Ht==="$"?s:/[%p]/.test(Xn)?x:"",Pi=Xa[Xn],ua=/[defgprs%]/.test(Xn);_n=_n===void 0?6:/[gprs]/.test(Xn)?Math.max(1,Math.min(21,_n)):Math.max(0,Math.min(20,_n));function xa(pi){var Ia=Ci,qa=$n,Cu,vp,mp;if(Xn==="c")qa=Pi(pi)+qa,pi="";else{pi=+pi;var yp=pi<0||1/pi<0;if(pi=isNaN(pi)?O:Pi(Math.abs(pi),_n),Rn&&(pi=jn(pi)),yp&&+pi==0&&_t!=="+"&&(yp=!1),Ia=(yp?_t==="("?_t:A:_t==="-"||_t==="("?"":_t)+Ia,qa=(Xn==="s"?Ja[8+Vn/3]:"")+qa+(yp&&_t==="("?")":""),ua){for(Cu=-1,vp=pi.length;++Cu<vp;)if(mp=pi.charCodeAt(Cu),48>mp||mp>57){qa=(mp===46?l+pi.slice(Cu+1):pi.slice(Cu))+qa,pi=pi.slice(0,Cu);break}}}Vr&&!_r&&(pi=c(pi,Infinity));var gp=Ia.length+pi.length+qa.length,Yc=gp<Er?new Array(Er-gp+1).join(ge):"";switch(Vr&&_r&&(pi=c(Yc+pi,Yc.length?Er-qa.length:Infinity),Yc=""),Ze){case"<":pi=Ia+pi+qa+Yc;break;case"=":pi=Ia+Yc+pi+qa;break;case"^":pi=Yc.slice(0,gp=Yc.length>>1)+Ia+pi+qa+Yc.slice(gp);break;default:pi=Yc+Ia+pi+qa;break}return d(pi)}return xa.toString=function(){return Q+""},xa}function re(Q,ge){var Ze=B((Q=Xt(Q),Q.type="f",Q)),_t=Math.max(-8,Math.min(8,Math.floor(gn(ge)/3)))*3,Ht=Math.pow(10,-_t),_r=Ja[8+_t/3];return function(Er){return Ze(Ht*Er)+_r}}return{format:B,formatPrefix:re}}var Ss,Zu,Eu;vh({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function vh(i){return Ss=La(i),Zu=Ss.format,Eu=Ss.formatPrefix,Ss}function rl(i,c){return i=Math.abs(i),c=Math.abs(c)-i,Math.max(0,gn(c)-gn(i))+1}function Zf(i){return Math.max(0,-gn(Math.abs(i)))}function Tf(i,c,o,s){var l=Ii(i,c,o),d;switch(s=Xt(s==null?",f":s),s.type){case"s":{var x=Math.max(Math.abs(i),Math.abs(c));return s.precision==null&&!isNaN(d=un(l,x))&&(s.precision=d),Eu(s,x)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(d=rl(l,Math.max(Math.abs(i),Math.abs(c))))&&(s.precision=d-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(d=Zf(l))&&(s.precision=d-(s.type==="%")*2);break}}return Zu(s)}function Mc(i){var c=i.domain;return i.ticks=function(o){var s=c();return bn(s[0],s[s.length-1],o==null?10:o)},i.tickFormat=function(o,s){var l=c();return Tf(l[0],l[l.length-1],o==null?10:o,s)},i.nice=function(o){o==null&&(o=10);var s=c(),l=0,d=s.length-1,x=s[l],A=s[d],O;return A<x&&(O=x,x=A,A=O,O=l,l=d,d=O),O=Ri(x,A,o),O>0?(x=Math.floor(x/O)*O,A=Math.ceil(A/O)*O,O=Ri(x,A,o)):O<0&&(x=Math.ceil(x*O)/O,A=Math.floor(A*O)/O,O=Ri(x,A,o)),O>0?(s[l]=Math.floor(x/O)*O,s[d]=Math.ceil(A/O)*O,c(s)):O<0&&(s[l]=Math.ceil(x*O)/O,s[d]=Math.floor(A*O)/O,c(s)),i},i}function wp(){var i=Ue(Ot,Ot);return i.copy=function(){return De(i,wp())},di.apply(i,arguments),Mc(i)}function ls(i){var c;function o(s){return isNaN(s=+s)?c:s}return o.invert=o,o.domain=o.range=function(s){return arguments.length?(i=Ea.call(s,Ee),o):i.slice()},o.unknown=function(s){return arguments.length?(c=s,o):c},o.copy=function(){return ls(i).unknown(c)},i=arguments.length?Ea.call(i,Ee):[0,1],Mc(o)}function jf(i,c){i=i.slice();var o=0,s=i.length-1,l=i[o],d=i[s],x;return d<l&&(x=o,o=s,s=x,x=l,l=d,d=x),i[o]=c.floor(l),i[s]=c.ceil(d),i}function Ic(i){return Math.log(i)}function mh(i){return Math.exp(i)}function qh(i){return-Math.log(-i)}function Tp(i){return-Math.exp(-i)}function Vf(i){return isFinite(i)?+("1e"+i):i<0?0:i}function Uc(i){return i===10?Vf:i===Math.E?Math.exp:function(c){return Math.pow(i,c)}}function Hp(i){return i===Math.E?Math.log:i===10&&Math.log10||i===2&&Math.log2||(i=Math.log(i),function(c){return Math.log(c)/i})}function Ap(i){return function(c){return-i(-c)}}function Cd(i){var c=i(Ic,mh),o=c.domain,s=10,l,d;function x(){return l=Hp(s),d=Uc(s),o()[0]<0?(l=Ap(l),d=Ap(d),i(qh,Tp)):i(Ic,mh),c}return c.base=function(A){return arguments.length?(s=+A,x()):s},c.domain=function(A){return arguments.length?(o(A),x()):o()},c.ticks=function(A){var O=o(),B=O[0],re=O[O.length-1],Q;(Q=re<B)&&(ge=B,B=re,re=ge);var ge=l(B),Ze=l(re),_t,Ht,_r,Er=A==null?10:+A,Vr=[];if(!(s%1)&&Ze-ge<Er){if(ge=Math.round(ge)-1,Ze=Math.round(Ze)+1,B>0){for(;ge<Ze;++ge)for(Ht=1,_t=d(ge);Ht<s;++Ht)if(_r=_t*Ht,!(_r<B)){if(_r>re)break;Vr.push(_r)}}else for(;ge<Ze;++ge)for(Ht=s-1,_t=d(ge);Ht>=1;--Ht)if(_r=_t*Ht,!(_r<B)){if(_r>re)break;Vr.push(_r)}}else Vr=bn(ge,Ze,Math.min(Ze-ge,Er)).map(d);return Q?Vr.reverse():Vr},c.tickFormat=function(A,O){if(O==null&&(O=s===10?".0e":","),typeof O!="function"&&(O=Zu(O)),A===Infinity)return O;A==null&&(A=10);var B=Math.max(1,s*A/c.ticks().length);return function(re){var Q=re/d(Math.round(l(re)));return Q*s<s-.5&&(Q*=s),Q<=B?O(re):""}},c.nice=function(){return o(jf(o(),{floor:function(A){return d(Math.floor(l(A)))},ceil:function(A){return d(Math.ceil(l(A)))}}))},c}function Es(){var i=Cd(it()).domain([1,10]);return i.copy=function(){return De(i,Es()).base(i.base())},di.apply(i,arguments),i}function Zc(i){return function(c){return Math.sign(c)*Math.log1p(Math.abs(c/i))}}function Pp(i){return function(c){return Math.sign(c)*Math.expm1(Math.abs(c))*i}}function e(i){var c=1,o=i(Zc(c),Pp(c));return o.constant=function(s){return arguments.length?i(Zc(c=+s),Pp(c)):c},linearish(o)}function t(){var i=e(transformer());return i.copy=function(){return copy(i,t()).constant(i.constant())},initRange.apply(i,arguments)}function r(i){return function(c){return c<0?-Math.pow(-c,i):Math.pow(c,i)}}function f(i){return i<0?-Math.sqrt(-i):Math.sqrt(i)}function v(i){return i<0?-i*i:i*i}function y(i){var c=i(Ot,Ot),o=1;function s(){return o===1?i(Ot,Ot):o===.5?i(f,v):i(r(o),r(1/o))}return c.exponent=function(l){return arguments.length?(o=+l,s()):o},Mc(c)}function S(){var i=y(it());return i.copy=function(){return De(i,S()).exponent(i.exponent())},di.apply(i,arguments),i}function M(){return S.apply(null,arguments).exponent(.5)}function z(){var i=[],c=[],o=[],s;function l(){var x=0,A=Math.max(1,c.length);for(o=new Array(A-1);++x<A;)o[x-1]=Bi(i,x/A);return d}function d(x){return isNaN(x=+x)?s:c[qr(o,x)]}return d.invertExtent=function(x){var A=c.indexOf(x);return A<0?[NaN,NaN]:[A>0?o[A-1]:i[0],A<o.length?o[A]:i[i.length-1]]},d.domain=function(x){if(!arguments.length)return i.slice();i=[];for(var A=0,O=x.length,B;A<O;++A)B=x[A],B!=null&&!isNaN(B=+B)&&i.push(B);return i.sort(Bt),l()},d.range=function(x){return arguments.length?(c=no.call(x),l()):c.slice()},d.unknown=function(x){return arguments.length?(s=x,d):s},d.quantiles=function(){return o.slice()},d.copy=function(){return z().domain(i).range(c).unknown(s)},di.apply(d,arguments)}function Y(){var i=0,c=1,o=1,s=[.5],l=[0,1],d;function x(O){return O<=O?l[qr(s,O,0,o)]:d}function A(){var O=-1;for(s=new Array(o);++O<o;)s[O]=((O+1)*c-(O-o)*i)/(o+1);return x}return x.domain=function(O){return arguments.length?(i=+O[0],c=+O[1],A()):[i,c]},x.range=function(O){return arguments.length?(o=(l=no.call(O)).length-1,A()):l.slice()},x.invertExtent=function(O){var B=l.indexOf(O);return B<0?[NaN,NaN]:B<1?[i,s[0]]:B>=o?[s[o-1],c]:[s[B-1],s[B]]},x.unknown=function(O){return arguments.length&&(d=O),x},x.thresholds=function(){return s.slice()},x.copy=function(){return Y().domain([i,c]).range(l).unknown(d)},di.apply(Mc(x),arguments)}function J(){var i=[.5],c=[0,1],o,s=1;function l(d){return d<=d?c[qr(i,d,0,s)]:o}return l.domain=function(d){return arguments.length?(i=no.call(d),s=Math.min(i.length,c.length-1),l):i.slice()},l.range=function(d){return arguments.length?(c=no.call(d),s=Math.min(i.length,c.length-1),l):c.slice()},l.invertExtent=function(d){var x=c.indexOf(d);return[i[x-1],i[x]]},l.unknown=function(d){return arguments.length?(o=d,l):o},l.copy=function(){return J().domain(i).range(c).unknown(o)},di.apply(l,arguments)}var ae=new Date,he=new Date;function ye(i,c,o,s){function l(d){return i(d=arguments.length===0?new Date:new Date(+d)),d}return l.floor=function(d){return i(d=new Date(+d)),d},l.ceil=function(d){return i(d=new Date(d-1)),c(d,1),i(d),d},l.round=function(d){var x=l(d),A=l.ceil(d);return d-x<A-d?x:A},l.offset=function(d,x){return c(d=new Date(+d),x==null?1:Math.floor(x)),d},l.range=function(d,x,A){var O=[],B;if(d=l.ceil(d),A=A==null?1:Math.floor(A),!(d<x)||!(A>0))return O;do O.push(B=new Date(+d)),c(d,A),i(d);while(B<d&&d<x);return O},l.filter=function(d){return ye(function(x){if(x>=x)for(;i(x),!d(x);)x.setTime(x-1)},function(x,A){if(x>=x)if(A<0)for(;++A<=0;)for(;c(x,-1),!d(x););else for(;--A>=0;)for(;c(x,1),!d(x););})},o&&(l.count=function(d,x){return ae.setTime(+d),he.setTime(+x),i(ae),i(he),Math.floor(o(ae,he))},l.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?l.filter(s?function(x){return s(x)%d==0}:function(x){return l.count(0,x)%d==0}):l}),l}var He=ye(function(i){i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,c){i.setFullYear(i.getFullYear()+c)},function(i,c){return c.getFullYear()-i.getFullYear()},function(i){return i.getFullYear()});He.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:ye(function(c){c.setFullYear(Math.floor(c.getFullYear()/i)*i),c.setMonth(0,1),c.setHours(0,0,0,0)},function(c,o){c.setFullYear(c.getFullYear()+o*i)})};var Xe=He,gt=He.range,rt=ye(function(i){i.setDate(1),i.setHours(0,0,0,0)},function(i,c){i.setMonth(i.getMonth()+c)},function(i,c){return c.getMonth()-i.getMonth()+(c.getFullYear()-i.getFullYear())*12},function(i){return i.getMonth()}),Dt=rt,$t=rt.range,pr=1e3,mr=6e4,Or=36e5,nn=864e5,vn=6048e5;function Qn(i){return ye(function(c){c.setDate(c.getDate()-(c.getDay()+7-i)%7),c.setHours(0,0,0,0)},function(c,o){c.setDate(c.getDate()+o*7)},function(c,o){return(o-c-(o.getTimezoneOffset()-c.getTimezoneOffset())*mr)/vn})}var Ln=Qn(0),si=Qn(1),zn=Qn(2),sa=Qn(3),xi=Qn(4),qn=Qn(5),fa=Qn(6),Ki=Ln.range,Ta=si.range,yi=zn.range,Ba=sa.range,Po=xi.range,Jo=qn.range,jo=fa.range,yo=ye(function(i){i.setHours(0,0,0,0)},function(i,c){i.setDate(i.getDate()+c)},function(i,c){return(c-i-(c.getTimezoneOffset()-i.getTimezoneOffset())*mr)/nn},function(i){return i.getDate()-1}),Mo=yo,Ls=yo.range,gs=ye(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*pr-i.getMinutes()*mr)},function(i,c){i.setTime(+i+c*Or)},function(i,c){return(c-i)/Or},function(i){return i.getHours()}),tu=gs,ks=gs.range,Hs=ye(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*pr)},function(i,c){i.setTime(+i+c*mr)},function(i,c){return(c-i)/mr},function(i){return i.getMinutes()}),Qo=Hs,Fs=Hs.range,da=ye(function(i){i.setTime(i-i.getMilliseconds())},function(i,c){i.setTime(+i+c*pr)},function(i,c){return(c-i)/pr},function(i){return i.getUTCSeconds()}),io=da,Qa=da.range,_a=ye(function(){},function(i,c){i.setTime(+i+c)},function(i,c){return c-i});_a.every=function(i){return i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?ye(function(c){c.setTime(Math.floor(c/i)*i)},function(c,o){c.setTime(+c+o*i)},function(c,o){return(o-c)/i}):_a};var du=_a,ru=_a.range;function Va(i){return ye(function(c){c.setUTCDate(c.getUTCDate()-(c.getUTCDay()+7-i)%7),c.setUTCHours(0,0,0,0)},function(c,o){c.setUTCDate(c.getUTCDate()+o*7)},function(c,o){return(o-c)/vn})}var qo=Va(0),Cs=Va(1),Ra=Va(2),Oc=Va(3),Ws=Va(4),Lc=Va(5),es=Va(6),jc=qo.range,oc=Cs.range,yh=Ra.range,Gf=Oc.range,gh=Ws.range,of=Lc.range,_h=es.range,xh=ye(function(i){i.setUTCHours(0,0,0,0)},function(i,c){i.setUTCDate(i.getUTCDate()+c)},function(i,c){return(c-i)/nn},function(i){return i.getUTCDate()-1}),Af=xh,ep=xh.range,Hf=ye(function(i){i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,c){i.setUTCFullYear(i.getUTCFullYear()+c)},function(i,c){return c.getUTCFullYear()-i.getUTCFullYear()},function(i){return i.getUTCFullYear()});Hf.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:ye(function(c){c.setUTCFullYear(Math.floor(c.getUTCFullYear()/i)*i),c.setUTCMonth(0,1),c.setUTCHours(0,0,0,0)},function(c,o){c.setUTCFullYear(c.getUTCFullYear()+o*i)})};var sf=Hf,uf=Hf.range;function Pf(i){if(0<=i.y&&i.y<100){var c=new Date(-1,i.m,i.d,i.H,i.M,i.S,i.L);return c.setFullYear(i.y),c}return new Date(i.y,i.m,i.d,i.H,i.M,i.S,i.L)}function lf(i){if(0<=i.y&&i.y<100){var c=new Date(Date.UTC(-1,i.m,i.d,i.H,i.M,i.S,i.L));return c.setUTCFullYear(i.y),c}return new Date(Date.UTC(i.y,i.m,i.d,i.H,i.M,i.S,i.L))}function Bl(i,c,o){return{y:i,m:c,d:o,H:0,M:0,S:0,L:0}}function Wf(i){var c=i.dateTime,o=i.date,s=i.time,l=i.periods,d=i.days,x=i.shortDays,A=i.months,O=i.shortMonths,B=Vc(l),re=Gc(l),Q=Vc(d),ge=Gc(d),Ze=Vc(x),_t=Gc(x),Ht=Vc(A),_r=Gc(A),Er=Vc(O),Vr=Gc(O),_n={a:yp,A:gp,b:Yc,B:Fy,c:null,d:Op,e:Op,f:sp,g:lp,G:Dc,H:ap,I:Rc,j:op,L:Jf,m:up,M:Lp,p:By,q:Ny,Q:zp,s:th,S:Yp,u:Ah,U:Kp,V:$p,w:Jp,W:Qp,x:null,X:null,y:nl,Y:qp,Z:Ad,"%":fp},Rn={a:zy,A:Uy,b:Zy,B:jy,c:null,d:Dp,e:Dp,f:eh,g:ad,G:od,H:Mf,I:Qf,j:qf,L:If,m:ed,M:td,p:Vy,q:Gy,Q:zp,s:th,S:rd,u:nd,U:kp,V:Hc,w:id,W:Fp,x:null,X:null,y:Bp,Y:Np,Z:sd,"%":fp},Xn={a:xa,A:pi,b:Ia,B:qa,c:Cu,d:np,e:np,f:sc,g:Kf,G:cf,H:ip,I:ip,j:Xp,L:ts,m:Wp,M:wd,p:ua,q:Mp,Q:ff,s:Ip,S:Th,u:Xf,U:rp,V:Yf,w:tp,W:wh,x:vp,X:mp,y:Kf,Y:cf,Z:$f,"%":Td};_n.x=Ci(o,_n),_n.X=Ci(s,_n),_n.c=Ci(c,_n),Rn.x=Ci(o,Rn),Rn.X=Ci(s,Rn),Rn.c=Ci(c,Rn);function Ci(Di,eo){return function(go){var Un=[],zl=-1,cs=0,uc=Di.length,lc,Dh,vm;for(go instanceof Date||(go=new Date(+go));++zl<uc;)Di.charCodeAt(zl)===37&&(Un.push(Di.slice(cs,zl)),(Dh=bh[lc=Di.charAt(++zl)])!=null?lc=Di.charAt(++zl):Dh=lc==="e"?" ":"0",(vm=eo[lc])&&(lc=vm(go,Dh)),Un.push(lc),cs=zl+1);return Un.push(Di.slice(cs,zl)),Un.join("")}}function $n(Di,eo){return function(go){var Un=Bl(1900,void 0,1),zl=Pi(Un,Di,go+="",0),cs,uc;if(zl!=go.length)return null;if("Q"in Un)return new Date(Un.Q);if("s"in Un)return new Date(Un.s*1e3+("L"in Un?Un.L:0));if(eo&&!("Z"in Un)&&(Un.Z=0),"p"in Un&&(Un.H=Un.H%12+Un.p*12),Un.m===void 0&&(Un.m="q"in Un?Un.q:0),"V"in Un){if(Un.V<1||Un.V>53)return null;"w"in Un||(Un.w=1),"Z"in Un?(cs=lf(Bl(Un.y,0,1)),uc=cs.getUTCDay(),cs=uc>4||uc===0?Cs.ceil(cs):Cs(cs),cs=Af.offset(cs,(Un.V-1)*7),Un.y=cs.getUTCFullYear(),Un.m=cs.getUTCMonth(),Un.d=cs.getUTCDate()+(Un.w+6)%7):(cs=Pf(Bl(Un.y,0,1)),uc=cs.getDay(),cs=uc>4||uc===0?si.ceil(cs):si(cs),cs=Mo.offset(cs,(Un.V-1)*7),Un.y=cs.getFullYear(),Un.m=cs.getMonth(),Un.d=cs.getDate()+(Un.w+6)%7)}else("W"in Un||"U"in Un)&&("w"in Un||(Un.w="u"in Un?Un.u%7:"W"in Un?1:0),uc="Z"in Un?lf(Bl(Un.y,0,1)).getUTCDay():Pf(Bl(Un.y,0,1)).getDay(),Un.m=0,Un.d="W"in Un?(Un.w+6)%7+Un.W*7-(uc+5)%7:Un.w+Un.U*7-(uc+6)%7);return"Z"in Un?(Un.H+=Un.Z/100|0,Un.M+=Un.Z%100,lf(Un)):Pf(Un)}}function Pi(Di,eo,go,Un){for(var zl=0,cs=eo.length,uc=go.length,lc,Dh;zl<cs;){if(Un>=uc)return-1;if(lc=eo.charCodeAt(zl++),lc===37){if(lc=eo.charAt(zl++),Dh=Xn[lc in bh?eo.charAt(zl++):lc],!Dh||(Un=Dh(Di,go,Un))<0)return-1}else if(lc!=go.charCodeAt(Un++))return-1}return Un}function ua(Di,eo,go){var Un=B.exec(eo.slice(go));return Un?(Di.p=re[Un[0].toLowerCase()],go+Un[0].length):-1}function xa(Di,eo,go){var Un=Ze.exec(eo.slice(go));return Un?(Di.w=_t[Un[0].toLowerCase()],go+Un[0].length):-1}function pi(Di,eo,go){var Un=Q.exec(eo.slice(go));return Un?(Di.w=ge[Un[0].toLowerCase()],go+Un[0].length):-1}function Ia(Di,eo,go){var Un=Er.exec(eo.slice(go));return Un?(Di.m=Vr[Un[0].toLowerCase()],go+Un[0].length):-1}function qa(Di,eo,go){var Un=Ht.exec(eo.slice(go));return Un?(Di.m=_r[Un[0].toLowerCase()],go+Un[0].length):-1}function Cu(Di,eo,go){return Pi(Di,c,eo,go)}function vp(Di,eo,go){return Pi(Di,o,eo,go)}function mp(Di,eo,go){return Pi(Di,s,eo,go)}function yp(Di){return x[Di.getDay()]}function gp(Di){return d[Di.getDay()]}function Yc(Di){return O[Di.getMonth()]}function Fy(Di){return A[Di.getMonth()]}function By(Di){return l[+(Di.getHours()>=12)]}function Ny(Di){return 1+~~(Di.getMonth()/3)}function zy(Di){return x[Di.getUTCDay()]}function Uy(Di){return d[Di.getUTCDay()]}function Zy(Di){return O[Di.getUTCMonth()]}function jy(Di){return A[Di.getUTCMonth()]}function Vy(Di){return l[+(Di.getUTCHours()>=12)]}function Gy(Di){return 1+~~(Di.getUTCMonth()/3)}return{format:function(Di){var eo=Ci(Di+="",_n);return eo.toString=function(){return Di},eo},parse:function(Di){var eo=$n(Di+="",!1);return eo.toString=function(){return Di},eo},utcFormat:function(Di){var eo=Ci(Di+="",Rn);return eo.toString=function(){return Di},eo},utcParse:function(Di){var eo=$n(Di+="",!0);return eo.toString=function(){return Di},eo}}}var bh={"-":"",_:" ","0":"0"},Rs=/^\s*\d+/,Sh=/^%/,Eh=/[\\^$*+?|[\]().{}]/g;function Ya(i,c,o){var s=i<0?"-":"",l=(s?-i:i)+"",d=l.length;return s+(d<o?new Array(o-d+1).join(c)+l:l)}function Ch(i){return i.replace(Eh,"\\$&")}function Vc(i){return new RegExp("^(?:"+i.map(Ch).join("|")+")","i")}function Gc(i){for(var c={},o=-1,s=i.length;++o<s;)c[i[o].toLowerCase()]=o;return c}function tp(i,c,o){var s=Rs.exec(c.slice(o,o+1));return s?(i.w=+s[0],o+s[0].length):-1}function Xf(i,c,o){var s=Rs.exec(c.slice(o,o+1));return s?(i.u=+s[0],o+s[0].length):-1}function rp(i,c,o){var s=Rs.exec(c.slice(o,o+2));return s?(i.U=+s[0],o+s[0].length):-1}function Yf(i,c,o){var s=Rs.exec(c.slice(o,o+2));return s?(i.V=+s[0],o+s[0].length):-1}function wh(i,c,o){var s=Rs.exec(c.slice(o,o+2));return s?(i.W=+s[0],o+s[0].length):-1}function cf(i,c,o){var s=Rs.exec(c.slice(o,o+4));return s?(i.y=+s[0],o+s[0].length):-1}function Kf(i,c,o){var s=Rs.exec(c.slice(o,o+2));return s?(i.y=+s[0]+(+s[0]>68?1900:2e3),o+s[0].length):-1}function $f(i,c,o){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(c.slice(o,o+6));return s?(i.Z=s[1]?0:-(s[2]+(s[3]||"00")),o+s[0].length):-1}function Mp(i,c,o){var s=Rs.exec(c.slice(o,o+1));return s?(i.q=s[0]*3-3,o+s[0].length):-1}function Wp(i,c,o){var s=Rs.exec(c.slice(o,o+2));return s?(i.m=s[0]-1,o+s[0].length):-1}function np(i,c,o){var s=Rs.exec(c.slice(o,o+2));return s?(i.d=+s[0],o+s[0].length):-1}function Xp(i,c,o){var s=Rs.exec(c.slice(o,o+3));return s?(i.m=0,i.d=+s[0],o+s[0].length):-1}function ip(i,c,o){var s=Rs.exec(c.slice(o,o+2));return s?(i.H=+s[0],o+s[0].length):-1}function wd(i,c,o){var s=Rs.exec(c.slice(o,o+2));return s?(i.M=+s[0],o+s[0].length):-1}function Th(i,c,o){var s=Rs.exec(c.slice(o,o+2));return s?(i.S=+s[0],o+s[0].length):-1}function ts(i,c,o){var s=Rs.exec(c.slice(o,o+3));return s?(i.L=+s[0],o+s[0].length):-1}function sc(i,c,o){var s=Rs.exec(c.slice(o,o+6));return s?(i.L=Math.floor(s[0]/1e3),o+s[0].length):-1}function Td(i,c,o){var s=Sh.exec(c.slice(o,o+1));return s?o+s[0].length:-1}function ff(i,c,o){var s=Rs.exec(c.slice(o));return s?(i.Q=+s[0],o+s[0].length):-1}function Ip(i,c,o){var s=Rs.exec(c.slice(o));return s?(i.s=+s[0],o+s[0].length):-1}function Op(i,c){return Ya(i.getDate(),c,2)}function ap(i,c){return Ya(i.getHours(),c,2)}function Rc(i,c){return Ya(i.getHours()%12||12,c,2)}function op(i,c){return Ya(1+Mo.count(Xe(i),i),c,3)}function Jf(i,c){return Ya(i.getMilliseconds(),c,3)}function sp(i,c){return Jf(i,c)+"000"}function up(i,c){return Ya(i.getMonth()+1,c,2)}function Lp(i,c){return Ya(i.getMinutes(),c,2)}function Yp(i,c){return Ya(i.getSeconds(),c,2)}function Ah(i){var c=i.getDay();return c===0?7:c}function Kp(i,c){return Ya(Ln.count(Xe(i)-1,i),c,2)}function Rp(i){var c=i.getDay();return c>=4||c===0?xi(i):xi.ceil(i)}function $p(i,c){return i=Rp(i),Ya(xi.count(Xe(i),i)+(Xe(i).getDay()===4),c,2)}function Jp(i){return i.getDay()}function Qp(i,c){return Ya(si.count(Xe(i)-1,i),c,2)}function nl(i,c){return Ya(i.getFullYear()%100,c,2)}function lp(i,c){return i=Rp(i),Ya(i.getFullYear()%100,c,2)}function qp(i,c){return Ya(i.getFullYear()%1e4,c,4)}function Dc(i,c){var o=i.getDay();return i=o>=4||o===0?xi(i):xi.ceil(i),Ya(i.getFullYear()%1e4,c,4)}function Ad(i){var c=i.getTimezoneOffset();return(c>0?"-":(c*=-1,"+"))+Ya(c/60|0,"0",2)+Ya(c%60,"0",2)}function Dp(i,c){return Ya(i.getUTCDate(),c,2)}function Mf(i,c){return Ya(i.getUTCHours(),c,2)}function Qf(i,c){return Ya(i.getUTCHours()%12||12,c,2)}function qf(i,c){return Ya(1+Af.count(sf(i),i),c,3)}function If(i,c){return Ya(i.getUTCMilliseconds(),c,3)}function eh(i,c){return If(i,c)+"000"}function ed(i,c){return Ya(i.getUTCMonth()+1,c,2)}function td(i,c){return Ya(i.getUTCMinutes(),c,2)}function rd(i,c){return Ya(i.getUTCSeconds(),c,2)}function nd(i){var c=i.getUTCDay();return c===0?7:c}function kp(i,c){return Ya(qo.count(sf(i)-1,i),c,2)}function cp(i){var c=i.getUTCDay();return c>=4||c===0?Ws(i):Ws.ceil(i)}function Hc(i,c){return i=cp(i),Ya(Ws.count(sf(i),i)+(sf(i).getUTCDay()===4),c,2)}function id(i){return i.getUTCDay()}function Fp(i,c){return Ya(Cs.count(sf(i)-1,i),c,2)}function Bp(i,c){return Ya(i.getUTCFullYear()%100,c,2)}function ad(i,c){return i=cp(i),Ya(i.getUTCFullYear()%100,c,2)}function Np(i,c){return Ya(i.getUTCFullYear()%1e4,c,4)}function od(i,c){var o=i.getUTCDay();return i=o>=4||o===0?Ws(i):Ws.ceil(i),Ya(i.getUTCFullYear()%1e4,c,4)}function sd(){return"+0000"}function fp(){return"%"}function zp(i){return+i}function th(i){return Math.floor(+i/1e3)}var Of,Ph,Pd,ud,Md;Id({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Id(i){return Of=Wf(i),Ph=Of.format,Pd=Of.parse,ud=Of.utcFormat,Md=Of.utcParse,Of}var Mh=1e3,Ih=Mh*60,Oh=Ih*60,Lh=Oh*24,Od=Lh*7,ld=Lh*30,Nl=Lh*365;function hp(i){return new Date(i)}function cd(i){return i instanceof Date?+i:+new Date(+i)}function rh(i,c,o,s,l,d,x,A,O){var B=Ue(Ot,Ot),re=B.invert,Q=B.domain,ge=O(".%L"),Ze=O(":%S"),_t=O("%I:%M"),Ht=O("%I %p"),_r=O("%a %d"),Er=O("%b %d"),Vr=O("%B"),_n=O("%Y"),Rn=[[x,1,Mh],[x,5,5*Mh],[x,15,15*Mh],[x,30,30*Mh],[d,1,Ih],[d,5,5*Ih],[d,15,15*Ih],[d,30,30*Ih],[l,1,Oh],[l,3,3*Oh],[l,6,6*Oh],[l,12,12*Oh],[s,1,Lh],[s,2,2*Lh],[o,1,Od],[c,1,ld],[c,3,3*ld],[i,1,Nl]];function Xn($n){return(x($n)<$n?ge:d($n)<$n?Ze:l($n)<$n?_t:s($n)<$n?Ht:c($n)<$n?o($n)<$n?_r:Er:i($n)<$n?Vr:_n)($n)}function Ci($n,Pi,ua,xa){if($n==null&&($n=10),typeof $n=="number"){var pi=Math.abs(ua-Pi)/$n,Ia=yr(function(qa){return qa[2]}).right(Rn,pi);Ia===Rn.length?(xa=Ii(Pi/Nl,ua/Nl,$n),$n=i):Ia?(Ia=Rn[pi/Rn[Ia-1][2]<Rn[Ia][2]/pi?Ia-1:Ia],xa=Ia[1],$n=Ia[0]):(xa=Math.max(Ii(Pi,ua,$n),1),$n=A)}return xa==null?$n:$n.every(xa)}return B.invert=function($n){return new Date(re($n))},B.domain=function($n){return arguments.length?Q(Ea.call($n,cd)):Q().map(hp)},B.ticks=function($n,Pi){var ua=Q(),xa=ua[0],pi=ua[ua.length-1],Ia=pi<xa,qa;return Ia&&(qa=xa,xa=pi,pi=qa),qa=Ci($n,xa,pi,Pi),qa=qa?qa.range(xa,pi+1):[],Ia?qa.reverse():qa},B.tickFormat=function($n,Pi){return Pi==null?Xn:O(Pi)},B.nice=function($n,Pi){var ua=Q();return($n=Ci($n,ua[0],ua[ua.length-1],Pi))?Q(jf(ua,$n)):B},B.copy=function(){return De(B,rh(i,c,o,s,l,d,x,A,O))},B}function fd(){return di.apply(rh(Xe,Dt,Ln,Mo,tu,Qo,io,du,Ph).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Hy(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function hd(){var i=0,c=1,o,s,l,d,x=identity,A=!1,O;function B(re){return isNaN(re=+re)?O:x(l===0?.5:(re=(d(re)-o)*l,A?Math.max(0,Math.min(1,re)):re))}return B.domain=function(re){return arguments.length?(o=d(i=+re[0]),s=d(c=+re[1]),l=o===s?0:1/(s-o),B):[i,c]},B.clamp=function(re){return arguments.length?(A=!!re,B):A},B.interpolator=function(re){return arguments.length?(x=re,B):x},B.unknown=function(re){return arguments.length?(O=re,B):O},function(re){return d=re,o=re(i),s=re(c),l=o===s?0:1/(s-o),B}}function pd(i,c){return c.domain(i.domain()).interpolator(i.interpolator()).clamp(i.clamp()).unknown(i.unknown())}function mm(){var i=linearish(hd()(identity));return i.copy=function(){return pd(i,mm())},initInterpolator.apply(i,arguments)}function ym(){var i=loggish(hd()).domain([1,10]);return i.copy=function(){return pd(i,ym()).base(i.base())},initInterpolator.apply(i,arguments)}function gm(){var i=symlogish(hd());return i.copy=function(){return pd(i,gm()).constant(i.constant())},initInterpolator.apply(i,arguments)}function Ud(){var i=powish(hd());return i.copy=function(){return pd(i,Ud()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function Wy(){return Ud.apply(null,arguments).exponent(.5)}function _m(){var i=[],c=identity;function o(s){if(!isNaN(s=+s))return c((bisect(i,s)-1)/(i.length-1))}return o.domain=function(s){if(!arguments.length)return i.slice();i=[];for(var l=0,d=s.length,x;l<d;++l)x=s[l],x!=null&&!isNaN(x=+x)&&i.push(x);return i.sort(ascending),o},o.interpolator=function(s){return arguments.length?(c=s,o):c},o.copy=function(){return _m(c).domain(i)},initInterpolator.apply(o,arguments)}function dd(){var i=0,c=.5,o=1,s,l,d,x,A,O=identity,B,re=!1,Q;function ge(Ze){return isNaN(Ze=+Ze)?Q:(Ze=.5+((Ze=+B(Ze))-l)*(Ze<l?x:A),O(re?Math.max(0,Math.min(1,Ze)):Ze))}return ge.domain=function(Ze){return arguments.length?(s=B(i=+Ze[0]),l=B(c=+Ze[1]),d=B(o=+Ze[2]),x=s===l?0:.5/(l-s),A=l===d?0:.5/(d-l),ge):[i,c,o]},ge.clamp=function(Ze){return arguments.length?(re=!!Ze,ge):re},ge.interpolator=function(Ze){return arguments.length?(O=Ze,ge):O},ge.unknown=function(Ze){return arguments.length?(Q=Ze,ge):Q},function(Ze){return B=Ze,s=Ze(i),l=Ze(c),d=Ze(o),x=s===l?0:.5/(l-s),A=l===d?0:.5/(d-l),ge}}function xm(){var i=linearish(dd()(identity));return i.copy=function(){return copy(i,xm())},initInterpolator.apply(i,arguments)}function bm(){var i=loggish(dd()).domain([.1,1,10]);return i.copy=function(){return copy(i,bm()).base(i.base())},initInterpolator.apply(i,arguments)}function Sm(){var i=symlogish(dd());return i.copy=function(){return copy(i,Sm()).constant(i.constant())},initInterpolator.apply(i,arguments)}function Zd(){var i=powish(dd());return i.copy=function(){return copy(i,Zd()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function Xy(){return Zd.apply(null,arguments).exponent(.5)}var Wc,jd,Vd,Gd,Ld,Hd,Em=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Cm=(Wc={},(0,I.Z)(Wc,E.ScaleTypes.LINEAR,wp),(0,I.Z)(Wc,E.ScaleTypes.POWER,S),(0,I.Z)(Wc,E.ScaleTypes.LOG,Es),(0,I.Z)(Wc,E.ScaleTypes.IDENTITY,ls),(0,I.Z)(Wc,E.ScaleTypes.TIME,fd),(0,I.Z)(Wc,E.ScaleTypes.QUANTILE,z),(0,I.Z)(Wc,E.ScaleTypes.QUANTIZE,Y),(0,I.Z)(Wc,E.ScaleTypes.THRESHOLD,J),(0,I.Z)(Wc,E.ScaleTypes.CAT,lo),Wc),wm=(jd=(0,Mt.b2)(),Vd=(0,Mt.f3)(E.vK.IGlobalConfigService),jd(Gd=(Ld=function(){function i(){(0,V.Z)(this,i),(0,ii.Z)(this,"configService",Hd,this),(0,I.Z)(this,"scaleCache",{}),(0,I.Z)(this,"scaleOptions",{})}return(0,H.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var x=d.getLayerStyleAttributes(),A=o.getSource().data.dataArray;A.length!==0&&l.caculateScalesForAttributes(x||[],A)}),o.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var x=d.getLayerStyleAttributes(),A=o.getSource().data.dataArray;return l.caculateScalesForAttributes(x||[],A),o.layerModelNeedUpdate=!0,!0}),o.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!o.layerModelNeedUpdate){l.scaleOptions=o.getScaleOptions();var x=d.getLayerStyleAttributes();if(x){var A=o.getSource().data.dataArray;if(A.length===0)return;var O=x.filter(function(B){return B.needRescale});O.length&&l.caculateScalesForAttributes(O,A)}}})}},{key:"isNumber",value:function(o){return!isNaN(parseFloat(o))&&isFinite(o)}},{key:"caculateScalesForAttributes",value:function(o,s){var l=this;this.scaleCache={},o.forEach(function(d){if(d.scale){var x=d.scale,A=d.name;x.names=l.parseFields(d.scale.field||[]);var O=[];x.names.forEach(function(B){O.push(l.getOrCreateScale(B,d,s))}),O.some(function(B){return B.type===E.StyleScaleType.VARIABLE})?(x.type=E.StyleScaleType.VARIABLE,O.forEach(function(B){if(!x.callback){var re;if(x.values&&x.values!=="text"){var Q;if(((Q=B.option)===null||Q===void 0?void 0:Q.type)==="linear"&&x.values.length>2){var ge=B.scale.ticks(x.values.length);A==="color"&&B.scale.domain(ge)}B.scale.range(x.values)}else((re=B.option)===null||re===void 0?void 0:re.type)==="cat"&&B.scale.range(B.option.domain)}})):(x.type=E.StyleScaleType.CONSTANT,x.defaultValues=O.map(function(B,re){return B.scale(x.names[re])})),x.scalers=O.map(function(B){return{field:B.field,func:B.scale,option:B.option}}),d.needRescale=!1}})}},{key:"getOrCreateScale",value:function(o,s,l){var d,x=[o,s.name].join("_"),A=(d=s.scale)===null||d===void 0?void 0:d.values,O=this.createScale(o,s.name,A,l);return O}},{key:"parseFields",value:function(o){return Array.isArray(o)?o:co()(o)?o.split("*"):[o]}},{key:"createScale",value:function(o,s,l,d){var x,A,O=this.scaleOptions[s]&&((x=this.scaleOptions[s])===null||x===void 0?void 0:x.field)===o?this.scaleOptions[s]:this.scaleOptions[o],B={field:o,scale:void 0,type:E.StyleScaleType.VARIABLE,option:O};if(!d||!d.length)return O&&O.type?B.scale=this.createDefaultScale(O):(B.scale=lo([o]),B.type=E.StyleScaleType.CONSTANT),B;var re=(A=d.find(function(Ze){return!en()(Ze[o])}))===null||A===void 0?void 0:A[o];if(this.isNumber(o)||en()(re)&&!O)B.scale=lo([o]),B.type=E.StyleScaleType.CONSTANT;else{var Q=O&&O.type||this.getDefaultType(re);l==="text"&&(Q=E.ScaleTypes.CAT);var ge=this.createDefaultScaleConfig(Q,o,d);Object.assign(ge,O),B.scale=this.createDefaultScale(ge),B.option=ge}return B}},{key:"getDefaultType",value:function(o){var s=E.ScaleTypes.LINEAR;return typeof o=="string"&&(s=Em.test(o)?E.ScaleTypes.TIME:E.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(o,s,l){var d={type:o},x=(l==null?void 0:l.map(function(A){return A[s]}))||[];return o!==E.ScaleTypes.CAT&&o!==E.ScaleTypes.QUANTILE?d.domain=li(x):o===E.ScaleTypes.CAT?d.domain=dn()(x):o===E.ScaleTypes.QUANTILE&&(d.domain=x),d}},{key:"createDefaultScale",value:function(o){var s=o.type,l=o.domain,d=Cm[s]();return l&&d.domain(l),d}}]),i}(),Hd=(0,ti.Z)(Ld.prototype,"configService",[Vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ld))||Gd),Wd,Xd,Yd,Kd,vd,$d,Jd;function Qd(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Tm(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Qd(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Qd(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var Am=(Wd=(0,Mt.b2)(),Xd=(0,Mt.f3)(E.vK.ICameraService),Yd=(0,Mt.f3)(E.vK.IRendererService),Wd(Kd=(vd=function(){function i(){(0,V.Z)(this,i),(0,ii.Z)(this,"cameraService",$d,this),(0,ii.Z)(this,"rendererService",Jd,this)}return(0,H.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){o.models.forEach(function(s){s.addUniforms(Tm({},o.layerModel.getAnimateUniforms()))})})}}]),i}(),$d=(0,ti.Z)(vd.prototype,"cameraService",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jd=(0,ti.Z)(vd.prototype,"rendererService",[Yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vd))||Kd),qd,ev,Pm=(qd=(0,Mt.b2)(),qd(ev=function(){function i(){(0,V.Z)(this,i)}return(0,H.Z)(i,[{key:"apply",value:function(o){o.hooks.init.tap("LayerModelPlugin",function(){o.prepareBuildModel(),o.buildModels(),o.styleNeedUpdate=!1}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return o.prepareBuildModel(),o.clearModels(),o.buildModels(),o.layerModelNeedUpdate=!1,!1})}}]),i}())||ev),tv,rv,Mm=(tv=(0,Mt.b2)(),tv(rv=function(){function i(){(0,V.Z)(this,i)}return(0,H.Z)(i,[{key:"apply",value:function(o){o.hooks.afterInit.tap("LayerStylePlugin",function(){o.updateLayerConfig({});var s=o.getLayerConfig(),l=s.autoFit,d=s.fitBoundsOptions;l&&setTimeout(function(){o.fitBounds(d)},100)})}}]),i}())||rv),nv,iv;function av(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Up(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?av(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):av(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var ov={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Im={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Om={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Lm={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},Yy=null;function Rm(i){var c={u_DirectionalLights:new Array(3).fill(Up({},Om)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Up({},Lm)),u_NumOfSpotLights:0};return(!i||!i.length)&&(i=[Im]),i.forEach(function(o,s){var l=o.type,d=l===void 0?"directional":l,x=(0,Ca.Z)(o,["type"]),A=ov[d].lights,O=ov[d].num,B=c[O];c[A][B]=Up(Up({},c[A][B]),x),c[O]++}),c}var Dm=(nv=(0,Mt.b2)(),nv(iv=function(){function i(){(0,V.Z)(this,i)}return(0,H.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LightingPlugin",function(){var s=o.getLayerConfig(),l=s.enableLighting;l&&o.models.forEach(function(d){return d.addUniforms(Up({},Rm()))})})}}]),i}())||iv),sv,uv,md={NONE:0,ENCODE:1,HIGHLIGHT:2},km=(sv=(0,Mt.b2)(),sv(uv=function(){function i(){(0,V.Z)(this,i)}return(0,H.Z)(i,[{key:"apply",value:function(o,s){var l=s.rendererService,d=s.styleAttributeService;o.hooks.init.tap("PixelPickingPlugin",function(){var x=o.getLayerConfig(),A=x.enablePicking;d.registerStyleAttribute({name:"pickingColor",type:E.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:E.gl.FLOAT},size:3,update:function(B,re){var Q=B.id;return A?(0,$e.Z6)(Q):[0,0,0]}}})}),o.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var x=o.getLayerConfig(),A=x.enablePicking;A&&o.isVisible()&&o.models.forEach(function(O){return O.addUniforms({u_PickingStage:md.ENCODE})})}),o.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var x=o.getLayerConfig(),A=x.enablePicking;A&&o.isVisible()&&o.models.forEach(function(O){return O.addUniforms({u_PickingStage:md.HIGHLIGHT})})}),o.hooks.beforeHighlight.tap("PixelPickingPlugin",function(x){var A=o.getLayerConfig(),O=A.highlightColor,B=typeof O=="string"?(0,$e.CI)(O):O||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,$e.W0)(new Uint8Array(x))}),o.models.forEach(function(re){return re.addUniforms({u_PickingStage:md.HIGHLIGHT,u_PickingColor:x,u_HighlightColor:B.map(function(Q){return Q*255})})})}),o.hooks.beforeSelect.tap("PixelPickingPlugin",function(x){var A=o.getLayerConfig(),O=A.selectColor,B=typeof O=="string"?(0,$e.CI)(O):O||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,$e.W0)(new Uint8Array(x))}),o.models.forEach(function(re){return re.addUniforms({u_PickingStage:md.HIGHLIGHT,u_PickingColor:x,u_HighlightColor:B.map(function(Q){return Q*255})})})})}}]),i}())||uv),lv,cv,Fm=(lv=(0,Mt.b2)(),lv(cv=function(){function i(){(0,V.Z)(this,i)}return(0,H.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(d)})}},{key:"registerBuiltinAttributes",value:function(o){o.registerStyleAttribute({name:"position",type:E.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:E.gl.FLOAT},size:3,update:function(l,d,x){return x.length===2?[x[0],x[1],0]:[x[0],x[1],x[2]]}}}),o.registerStyleAttribute({name:"filter",type:E.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(l,d){var x=l.filter;return x?[1]:[0]}}}),o.registerStyleAttribute({name:"color",type:E.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:4,update:function(l,d){var x=l.color;return!x||!x.length?[1,1,1,1]:x}}}),o.registerStyleAttribute({name:"vertexId",type:E.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:E.gl.DYNAMIC_DRAW,data:[],type:E.gl.FLOAT},size:1,update:function(l,d,x,A){return[d]}}})}}]),i}())||cv),fv,hv,pv,dv,vv,mv,pp,yv,gv,_v,xv,Bm=(fv=(0,Mt.b2)(),hv=(0,Mt.f3)(E.vK.ICameraService),pv=(0,Mt.f3)(E.vK.ICoordinateSystemService),dv=(0,Mt.f3)(E.vK.IRendererService),vv=(0,Mt.f3)(E.vK.IMapService),fv(mv=(pp=function(){function i(){(0,V.Z)(this,i),(0,ii.Z)(this,"cameraService",yv,this),(0,ii.Z)(this,"coordinateSystemService",gv,this),(0,ii.Z)(this,"rendererService",_v,this),(0,ii.Z)(this,"mapService",xv,this)}return(0,H.Z)(i,[{key:"apply",value:function(o){var s=this,l=this.mapService.version,d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],x=[0,0];o.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(d=s.mapService.map.customCoords.getMVPMatrix(),x=s.mapService.getCustomCoordCenter());var A=s.rendererService.getViewportSize(),O=A.width,B=A.height;o.models.forEach(function(re){var Q;re.addUniforms((Q={},(0,I.Z)(Q,E.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,I.Z)(Q,E.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,I.Z)(Q,E.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,I.Z)(Q,E.CameraUniform.Zoom,s.cameraService.getZoom()),(0,I.Z)(Q,E.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,I.Z)(Q,E.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,I.Z)(Q,E.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,I.Z)(Q,E.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,I.Z)(Q,E.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,I.Z)(Q,E.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,I.Z)(Q,E.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,I.Z)(Q,E.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,I.Z)(Q,E.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,I.Z)(Q,E.CoordinateUniform.Mvp,d),(0,I.Z)(Q,"u_SceneCenterMKT",x),(0,I.Z)(Q,"u_ViewportSize",[O,B]),(0,I.Z)(Q,"u_DevicePixelRatio",window.devicePixelRatio),(0,I.Z)(Q,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,I.Z)(Q,"u_PickingBuffer",o.getLayerConfig().pickingBuffer||0),Q))})})}}]),i}(),yv=(0,ti.Z)(pp.prototype,"cameraService",[hv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gv=(0,ti.Z)(pp.prototype,"coordinateSystemService",[pv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_v=(0,ti.Z)(pp.prototype,"rendererService",[dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xv=(0,ti.Z)(pp.prototype,"mapService",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pp))||mv),bv,Sv,Nm=(bv=(0,Mt.b2)(),bv(Sv=function(){function i(){(0,V.Z)(this,i)}return(0,H.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("UpdateModelPlugin",function(){o.layerModel&&o.layerModel.needUpdate()})}}]),i}())||Sv),Ev,Cv,zm=(Ev=(0,Mt.b2)(),Ev(Cv=function(){function i(){(0,V.Z)(this,i)}return(0,H.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(o,{styleAttributeService:d})}),o.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){o.layerModelNeedUpdate||l.updateStyleAtrribute(o,{styleAttributeService:d})})}},{key:"updateStyleAtrribute",value:function(o,s){var l=s.styleAttributeService,d=l.getLayerStyleAttributes()||[],x=l.getLayerStyleAttribute("filter"),A=l.getLayerStyleAttribute("shape");if(x&&x.needRegenerateVertices||A&&A.needRegenerateVertices){o.layerModelNeedUpdate=!0,d.forEach(function(O){return O.needRegenerateVertices=!1});return}d.filter(function(O){return O.needRegenerateVertices}).forEach(function(O){l.updateAttributeByFeatureRange(O.name,o.getEncodedData(),O.featureRange.startIndex,O.featureRange.endIndex),O.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(o,s){var l=s.styleAttributeService,d=l.getLayerStyleAttributes()||[];d.filter(function(x){return x.needRegenerateVertices}).forEach(function(x){l.updateAttributeByFeatureRange(x.name,o.getEncodedData(),x.featureRange.startIndex,x.featureRange.endIndex),x.needRegenerateVertices=!1})}}]),i}())||Cv);E.nC.bind(E.vK.ILayerPlugin).to(Jr).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Fm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(wm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Yo).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Mm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(zm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Nm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Go).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Bm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Am).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Dm).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(km).inRequestScope(),E.nC.bind(E.vK.ILayerPlugin).to(Pm).inRequestScope();var Ky="2.5.22";function wv(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function $y(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?wv(Object(o),!0).forEach(function(s){Um(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):wv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Um(i,c,o){return c in i?Object.defineProperty(i,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[c]=o,i}function Jy(i,c){return Gm(i)||Vm(i,c)||jm(i,c)||Zm()}function Zm(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jm(i,c){if(!!i){if(typeof i=="string")return Tv(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Tv(i,c)}}function Tv(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function Vm(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,x,A;try{for(o=o.call(i);!(l=(x=o.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function Gm(i){if(Array.isArray(i))return i}var Qy=null,qy=null,Av,Rd,Pv;function Mv(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Iv(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Mv(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Mv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var Hm=(Av=(0,E.yT)(E.vK.IGlobalConfigService),Rd=function(){function i(c){(0,V.Z)(this,i),(0,ii.Z)(this,"configService",Pv,this),(0,I.Z)(this,"config",void 0),this.config=c}return(0,H.Z)(i,[{key:"setContainer",value:function(o,s){o.bind(E.vK.MapConfig).toConstantValue(Iv(Iv({},this.config),{},{id:s})),o.bind(E.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),i}(),Pv=(0,ti.Z)(Rd.prototype,"configService",[Av],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd),Wm=g(6158),Xm=g.n(Wm),Dd;(function(i){i["GAODE1.x"]="GAODE1.x",i["GAODE2.x"]="GAODE2.x",i.MAPBOX="MAPBOX",i.L7MAP="L7MAP"})(Dd||(Dd={}));function Zp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function yd(i,c){var o=Nu.fF([],c,i);return Nu.bA(o,o,1/o[3]),o}function eg(i,c){var o=i%c;return o<0?c+o:o}function tg(i,c,o){return o*c+(1-o)*i}function Rh(i,c){if(!i)throw new Error(c||"viewport-mercator-project: assertion failed.")}var Xc=Math.PI,Ov=Xc/4,Lf=Xc/180,Lv=180/Xc,kd=512,Fd=4003e4,Ym=1.5;function Rv(i){return Math.pow(2,i)}function Km(i){return Math.log2(i)}function gd(i,c){var o=(0,Z.Z)(i,2),s=o[0],l=o[1];Rh(Number.isFinite(s)&&Number.isFinite(c)),Rh(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),c*=kd;var d=s*Lf,x=l*Lf,A=c*(d+Xc)/(2*Xc),O=c*(Xc-Math.log(Math.tan(Ov+x*.5)))/(2*Xc);return[A,O]}function Bd(i,c){var o=(0,Z.Z)(i,2),s=o[0],l=o[1];c*=kd;var d=s/c*(2*Xc)-Xc,x=2*(Math.atan(Math.exp(Xc-l/c*(2*Xc)))-Ov);return[d*Lv,x*Lv]}function rg(i){var c=i.latitude;assert(Number.isFinite(c));var o=Math.cos(c*Lf);return Km(Fd*o)-9}function Dv(i){var c=i.latitude,o=i.longitude,s=i.zoom,l=i.scale,d=i.highPrecision,x=d===void 0?!1:d;l=l!==void 0?l:Rv(s),Rh(Number.isFinite(c)&&Number.isFinite(o)&&Number.isFinite(l));var A={},O=kd*l,B=Math.cos(c*Lf),re=O/360,Q=re/B,ge=O/Fd/B;if(A.pixelsPerMeter=[ge,-ge,ge],A.metersPerPixel=[1/ge,-1/ge,1/ge],A.pixelsPerDegree=[re,-Q,ge],A.degreesPerPixel=[1/re,-1/Q,1/ge],x){var Ze=Lf*Math.tan(c*Lf)/B,_t=re*Ze/2,Ht=O/Fd*Ze,_r=Ht/Q*ge;A.pixelsPerDegree2=[0,-_t,Ht],A.pixelsPerMeter2=[_r,0,_r]}return A}function ng(i,c){var o=_slicedToArray(i,3),s=o[0],l=o[1],d=o[2],x=_slicedToArray(c,3),A=x[0],O=x[1],B=x[2],re=1,Q=Dv({longitude:s,latitude:l,scale:re,highPrecision:!0}),ge=Q.pixelsPerMeter,Ze=Q.pixelsPerMeter2,_t=gd(i,re);_t[0]+=A*(ge[0]+Ze[0]*O),_t[1]+=O*(ge[1]+Ze[1]*O);var Ht=Bd(_t,re),_r=(d||0)+(B||0);return Number.isFinite(d)||Number.isFinite(B)?[Ht[0],Ht[1],_r]:Ht}function $m(i){var c=i.height,o=i.pitch,s=i.bearing,l=i.altitude,d=i.center,x=d===void 0?null:d,A=i.flipY,O=A===void 0?!1:A,B=Zp();return Ha.translate(B,B,[0,0,-l]),Ha.scale(B,B,[1,1,1/c]),Ha.rotateX(B,B,-o*Lf),Ha.rotateZ(B,B,s*Lf),O&&Ha.scale(B,B,[1,-1,1]),x&&Ha.translate(B,B,Ti.negate([],x)),B}function Jm(i){var c=i.width,o=i.height,s=i.altitude,l=s===void 0?Ym:s,d=i.pitch,x=d===void 0?0:d,A=i.nearZMultiplier,O=A===void 0?1:A,B=i.farZMultiplier,re=B===void 0?1:B,Q=x*Lf,ge=Math.atan(.5/l),Ze=Math.sin(ge)*l/Math.sin(Math.PI/2-Q-ge),_t=Math.cos(Math.PI/2-Q)*Ze+l;return{fov:2*Math.atan(o/2/l),aspect:c/o,focalDistance:l,near:O,far:_t*re}}function Qm(i){var c=i.width,o=i.height,s=i.pitch,l=i.altitude,d=i.nearZMultiplier,x=i.farZMultiplier,A=Jm({width:c,height:o,altitude:l,pitch:s,nearZMultiplier:d,farZMultiplier:x}),O=A.fov,B=A.aspect,re=A.near,Q=A.far,ge=Ha.perspective([],O,B,re,Q);return ge}function qm(i,c){var o=(0,Z.Z)(i,3),s=o[0],l=o[1],d=o[2],x=d===void 0?0:d;return Rh(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(x)),yd(c,[s,l,x,1])}function kv(i,c){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,Z.Z)(i,3),l=s[0],d=s[1],x=s[2];if(Rh(Number.isFinite(l)&&Number.isFinite(d),"invalid pixel coordinate"),Number.isFinite(x)){var A=yd(c,[l,d,x,1]);return A}var O=yd(c,[l,d,0,1]),B=yd(c,[l,d,1,1]),re=O[2],Q=B[2],ge=re===Q?0:((o||0)-re)/(Q-re);return w.t7([],O,B,ge)}var Fv=Zp(),e0=function(){function i(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=c.width,s=c.height,l=c.viewMatrix,d=l===void 0?Fv:l,x=c.projectionMatrix,A=x===void 0?Fv:x;(0,V.Z)(this,i),this.width=o||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=d,this.projectionMatrix=A;var O=Zp();Ha.multiply(O,O,this.projectionMatrix),Ha.multiply(O,O,this.viewMatrix),this.viewProjectionMatrix=O;var B=Zp();Ha.scale(B,B,[this.width/2,-this.height/2,1]),Ha.translate(B,B,[1,-1,0]),Ha.multiply(B,B,this.viewProjectionMatrix);var re=Ha.invert(Zp(),B);if(!re)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=B,this.pixelUnprojectionMatrix=re,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,H.Z)(i,[{key:"equals",value:function(o){return o instanceof i?o.width===this.width&&o.height===this.height&&Ha.equals(o.projectionMatrix,this.projectionMatrix)&&Ha.equals(o.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,x=this.projectPosition(o),A=qm(x,this.pixelProjectionMatrix),O=(0,Z.Z)(A,2),B=O[0],re=O[1],Q=d?re:this.height-re;return o.length===2?[B,Q]:[B,Q,A[2]]}},{key:"unproject",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,x=s.targetZ,A=(0,Z.Z)(o,3),O=A[0],B=A[1],re=A[2],Q=d?B:this.height-B,ge=x&&x*this.pixelsPerMeter,Ze=kv([O,Q,re],this.pixelUnprojectionMatrix,ge),_t=this.unprojectPosition(Ze),Ht=(0,Z.Z)(_t,3),_r=Ht[0],Er=Ht[1],Vr=Ht[2];return Number.isFinite(re)?[_r,Er,Vr]:Number.isFinite(x)?[_r,Er,x]:[_r,Er]}},{key:"projectPosition",value:function(o){var s=this.projectFlat(o),l=(0,Z.Z)(s,2),d=l[0],x=l[1],A=(o[2]||0)*this.pixelsPerMeter;return[d,x,A]}},{key:"unprojectPosition",value:function(o){var s=this.unprojectFlat(o),l=(0,Z.Z)(s,2),d=l[0],x=l[1],A=(o[2]||0)/this.pixelsPerMeter;return[d,x,A]}},{key:"projectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}},{key:"unprojectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}}]),i}();function t0(i){var c=i.width,o=i.height,s=i.bounds,l=i.minExtent,d=l===void 0?0:l,x=i.maxZoom,A=x===void 0?24:x,O=i.padding,B=O===void 0?0:O,re=i.offset,Q=re===void 0?[0,0]:re,ge=(0,Z.Z)(s,2),Ze=(0,Z.Z)(ge[0],2),_t=Ze[0],Ht=Ze[1],_r=(0,Z.Z)(ge[1],2),Er=_r[0],Vr=_r[1];if(Number.isFinite(B)){var _n=B;B={top:_n,bottom:_n,left:_n,right:_n}}else Rh(Number.isFinite(B.top)&&Number.isFinite(B.bottom)&&Number.isFinite(B.left)&&Number.isFinite(B.right));var Rn=new Bv({width:c,height:o,longitude:0,latitude:0,zoom:0}),Xn=Rn.project([_t,Vr]),Ci=Rn.project([Er,Ht]),$n=[Math.max(Math.abs(Ci[0]-Xn[0]),d),Math.max(Math.abs(Ci[1]-Xn[1]),d)],Pi=[c-B.left-B.right-Math.abs(Q[0])*2,o-B.top-B.bottom-Math.abs(Q[1])*2];Rh(Pi[0]>0&&Pi[1]>0);var ua=Pi[0]/$n[0],xa=Pi[1]/$n[1],pi=(B.right-B.left)/2/ua,Ia=(B.bottom-B.top)/2/xa,qa=[(Ci[0]+Xn[0])/2+pi,(Ci[1]+Xn[1])/2+Ia],Cu=Rn.unproject(qa),vp=Rn.zoom+Math.log2(Math.abs(Math.min(ua,xa)));return{longitude:Cu[0],latitude:Cu[1],zoom:Math.min(vp,A)}}var Bv=function(i){(0,_e.Z)(c,i);function c(){var o,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,d=s.height,x=s.latitude,A=x===void 0?0:x,O=s.longitude,B=O===void 0?0:O,re=s.zoom,Q=re===void 0?0:re,ge=s.pitch,Ze=ge===void 0?0:ge,_t=s.bearing,Ht=_t===void 0?0:_t,_r=s.altitude,Er=_r===void 0?1.5:_r,Vr=s.nearZMultiplier,_n=s.farZMultiplier;(0,V.Z)(this,c),l=l||1,d=d||1;var Rn=Rv(Q);Er=Math.max(.75,Er);var Xn=gd([B,A],Rn);Xn[2]=0;var Ci=Qm({width:l,height:d,pitch:Ze,bearing:Ht,altitude:Er,nearZMultiplier:Vr||1/d,farZMultiplier:_n||1.01}),$n=$m({height:d,center:Xn,pitch:Ze,bearing:Ht,altitude:Er,flipY:!0});return o=(0,xe.Z)(this,(0,Re.Z)(c).call(this,{width:l,height:d,viewMatrix:$n,projectionMatrix:Ci})),o.latitude=A,o.longitude=B,o.zoom=Q,o.pitch=Ze,o.bearing=Ht,o.altitude=Er,o.scale=Rn,o.center=Xn,o.pixelsPerMeter=Dv((0,L.Z)((0,L.Z)(o))).pixelsPerMeter[2],Object.freeze((0,L.Z)((0,L.Z)(o))),o}return(0,H.Z)(c,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return gd(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Bd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,d=s.pos,x=kv(d,this.pixelUnprojectionMatrix),A=gd(l,this.scale),O=w.IH([],A,w.tk([],x)),B=w.IH([],this.center,O);return Bd(B,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,d=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:d})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=this.width,x=this.height,A=t0(Object.assign({width:d,height:x,bounds:s},l)),O=A.longitude,B=A.latitude,re=A.zoom;return new c({width:d,height:x,longitude:O,latitude:B,zoom:re})}}]),c}(e0),r0=function(){function i(){(0,V.Z)(this,i),(0,I.Z)(this,"viewport",void 0)}return(0,H.Z)(i,[{key:"syncWithMapCamera",value:function(o){var s=o.center,l=o.zoom,d=o.pitch,x=o.bearing,A=o.viewportHeight,O=o.viewportWidth;this.viewport=new Bv({width:O,height:A,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:d,bearing:x})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(o,s){return this.viewport.projectFlat(o,s)}}]),i}(),Nv={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},zv,Uv,Zv,jv,Vv,Gv,dp,Hv,Wv,Xv,Yv;function Kv(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function n0(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Kv(Object(o),!0).forEach(function(s){(0,I.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Kv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function i0(i,c){if(c||(c=document),!!c){var o=c.head||c.getElementsByTagName("head")[0];if(!o){o=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(o,s):c.documentElement.appendChild(o)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=i:l.appendChild(c.createTextNode(i)),o.appendChild(l),l}}i0(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Xm();var $v={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},a0=0,o0=12,Jv="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",s0=(zv=(0,Mt.b2)(),Uv=(0,Mt.f3)(E.vK.MapConfig),Zv=(0,Mt.f3)(E.vK.IGlobalConfigService),jv=(0,Mt.f3)(E.vK.ICoordinateSystemService),Vv=(0,Mt.f3)(E.vK.IEventEmitter),zv(Gv=(dp=function(){function i(){var c=this;(0,V.Z)(this,i),(0,I.Z)(this,"version",Dd.MAPBOX),(0,I.Z)(this,"map",void 0),(0,ii.Z)(this,"config",Hv,this),(0,ii.Z)(this,"configService",Wv,this),(0,ii.Z)(this,"coordinateSystemService",Xv,this),(0,ii.Z)(this,"eventEmitter",Yv,this),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"markerContainer",void 0),(0,I.Z)(this,"cameraChangedCallback",void 0),(0,I.Z)(this,"$mapContainer",void 0),(0,I.Z)(this,"handleCameraChanged",function(){var o=c.map.getCenter().wrap(),s=o.lat,l=o.lng;c.viewport.syncWithMapCamera({bearing:c.map.getBearing(),center:[l,s],viewportHeight:c.map.transform.height,pitch:c.map.getPitch(),viewportWidth:c.map.transform.width,zoom:c.map.getZoom(),cameraHeight:0});var d=c.config.offsetZoom,x=d===void 0?o0:d;c.viewport.getZoom()>x?c.coordinateSystemService.setCoordinateSystem(E.CoordinateSystem.LNGLAT_OFFSET):c.coordinateSystemService.setCoordinateSystem(E.CoordinateSystem.LNGLAT),c.cameraChangedCallback(c.viewport)})}return(0,H.Z)(i,[{key:"addMarkerContainer",value:function(){var o=this.map.getCanvasContainer();this.markerContainer=$e.SO.create("div","l7-marker-container",o),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(o,s){E.MapServiceEvent.indexOf(o)!==-1?this.eventEmitter.on(o,s):this.map.on($v[o]||o,s)}},{key:"off",value:function(o,s){this.map.off($v[o]||o,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var o=this.map.transform;return[o.width,o.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(o){return this.map.setZoom(o)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(o){this.map.setCenter(o)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(o){this.map.setBearing(o)}},{key:"zoomIn",value:function(o,s){this.map.zoomIn(o,s)}},{key:"zoomOut",value:function(o,s){this.map.zoomOut(o,s)}},{key:"setPitch",value:function(o){return this.map.setPitch(o)}},{key:"panTo",value:function(o){this.map.panTo(o)}},{key:"panBy",value:function(o){this.panTo(o)}},{key:"fitBounds",value:function(o,s){this.map.fitBounds(o,s)}},{key:"setMaxZoom",value:function(o){this.map.setMaxZoom(o)}},{key:"setMinZoom",value:function(o){this.map.setMinZoom(o)}},{key:"setMapStatus",value:function(o){o.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),o.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),o.dragEnable===!1&&this.map.dragPan.disable(),o.dragEnable===!0&&this.map.dragPan.enable(),o.rotateEnable===!1&&this.map.dragRotate.disable(),o.rotateEnable===!0&&this.map.dragRotate.enable(),o.keyboardEnable===!1&&this.map.keyboard.disable(),o.keyboardEnable===!0&&this.map.keyboard.enable(),o.zoomEnable===!1&&this.map.scrollZoom.disable(),o.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(o,s){this.map.flyTo({zoom:o,center:s})}},{key:"setMapStyle",value:function(o){this.map.setStyle(this.getMapStyle(o))}},{key:"pixelToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToPixel",value:function(o){return this.map.project(o)}},{key:"containerToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToContainer",value:function(o){return this.map.project(o)}},{key:"lngLatToMercator",value:function(o,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),d=l.x,x=d===void 0?0:d,A=l.y,O=A===void 0?0:A,B=l.z,re=B===void 0?0:B;return{x,y:O,z:re}}},{key:"getModelMatrix",value:function(o,s,l){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],x=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},A=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),O=A.meterInMercatorCoordinateUnits(),B=Ha.create();return Ha.translate(B,B,Ti.fromValues(A.x-x.x,A.y-x.y,A.z||0-x.z)),Ha.scale(B,B,Ti.fromValues(O*d[0],-O*d[1],O*d[2])),Ha.rotateX(B,B,l[0]),Ha.rotateY(B,B,l[1]),Ha.rotateZ(B,B,l[2]),B}},{key:"init",value:function(){var c=(0,tt.Z)(jt().mark(function s(){var l,d,x,A,O,B,re,Q,ge,Ze,_t,Ht,_r;return jt().wrap(function(Vr){for(;;)switch(Vr.prev=Vr.next){case 0:l=this.config,d=l.id,x=d===void 0?"map":d,A=l.attributionControl,O=A===void 0?!1:A,B=l.style,re=B===void 0?"light":B,Q=l.token,ge=Q===void 0?Jv:Q,Ze=l.rotation,_t=Ze===void 0?0:Ze,Ht=l.mapInstance,_r=(0,Ca.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new r0,!Ht&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),ge===Jv&&re!=="blank"&&!window.mapboxgl.accessToken&&!Ht&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Ht&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=ge),Ht?(this.map=Ht,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(x),this.map=new window.mapboxgl.Map(n0({container:this.$mapContainer,style:this.getMapStyle(re),attributionControl:O,bearing:_t},_r))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Vr.stop()}},s,this)}));function o(){return c.apply(this,arguments)}return o}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(o){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),x=1;x<l;x++)d[x-1]=arguments[x];(s=this.eventEmitter).emit.apply(s,[o].concat(d))}},{key:"once",value:function(o){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),x=1;x<l;x++)d[x-1]=arguments[x];(s=this.eventEmitter).once.apply(s,[o].concat(d))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(o){var s=this.map.getCanvas(),l=o==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(o){this.cameraChangedCallback=o}},{key:"creatAmapContainer",value:function(o){var s=o;typeof o=="string"&&(s=document.getElementById(o));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+a0++,s.appendChild(l),l}},{key:"getMapStyle",value:function(o){return typeof o!="string"?o:Nv[o]?Nv[o]:o}}]),i}(),Hv=(0,ti.Z)(dp.prototype,"config",[Uv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wv=(0,ti.Z)(dp.prototype,"configService",[Zv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xv=(0,ti.Z)(dp.prototype,"coordinateSystemService",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yv=(0,ti.Z)(dp.prototype,"eventEmitter",[Vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dp))||Gv);function u0(i){var c=l0();return function(){var s=(0,Re.Z)(i),l;if(c){var d=(0,Re.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,xe.Z)(this,l)}}function l0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function c0(i,c){if(c||(c=document),!!c){var o=c.head||c.getElementsByTagName("head")[0];if(!o){o=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(o,s):c.documentElement.appendChild(o)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=i:l.appendChild(c.createTextNode(i)),o.appendChild(l),l}}c0(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var f0=function(i){(0,_e.Z)(o,i);var c=u0(o);function o(){return(0,V.Z)(this,o),c.apply(this,arguments)}return(0,H.Z)(o,[{key:"getServiceConstructor",value:function(){return s0}}]),o}(Hm);function Qv(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function qv(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Qv(Object(o),!0).forEach(function(s){h0(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Qv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function h0(i,c,o){return c in i?Object.defineProperty(i,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[c]=o,i}function p0(i,c){return y0(i)||m0(i,c)||v0(i,c)||d0()}function d0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function v0(i,c){if(!!i){if(typeof i=="string")return em(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return em(i,c)}}function em(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function m0(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,x,A;try{for(o=o.call(i);!(l=(x=o.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function y0(i){if(Array.isArray(i))return i}var g0=U.memo(function(i){var c=i.style,o=i.className,s=i.map,l=i.option,d=i.onSceneLoaded,x=(0,U.createRef)(),A=(0,U.useState)(),O=p0(A,2),B=O[0],re=O[1];return(0,U.useEffect)(function(){var Q=new ha(qv(qv({id:x.current},l),{},{map:new f0(s)}));return Q.on("loaded",function(){re(Q),d&&d(Q)}),function(){Q.destroy()}},[]),(0,U.useEffect)(function(){B&&s.style&&B.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,U.useEffect)(function(){B&&s.zoom&&B.setZoom(s.zoom)},[s.zoom]),(0,U.useEffect)(function(){B&&s.center&&B.setCenter(s.center)},[JSON.stringify(s.center)]),(0,U.useEffect)(function(){B&&s.pitch!==void 0&&B.setPitch(s.pitch||0)},[s.pitch]),(0,U.useEffect)(function(){B&&s.rotation&&B.setRotation(s.rotation)},[s.rotation]),U.createElement(b.Provider,{value:B},(0,U.createElement)("div",{ref:x,style:c,className:o},B&&i.children))}),_0=g0;function tm(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function ig(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?tm(Object(o),!0).forEach(function(s){x0(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):tm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function x0(i,c,o){return c in i?Object.defineProperty(i,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[c]=o,i}function ag(i,c){return C0(i)||E0(i,c)||S0(i,c)||b0()}function b0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S0(i,c){if(!!i){if(typeof i=="string")return rm(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return rm(i,c)}}function rm(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function E0(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,x,A;try{for(o=o.call(i);!(l=(x=o.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function C0(i){if(Array.isArray(i))return i}var og=null,sg=null;function nm(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function ug(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?nm(Object(o),!0).forEach(function(s){w0(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):nm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function w0(i,c,o){return c in i?Object.defineProperty(i,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[c]=o,i}function lg(i,c){return M0(i)||P0(i,c)||A0(i,c)||T0()}function T0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A0(i,c){if(!!i){if(typeof i=="string")return im(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return im(i,c)}}function im(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function P0(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,x,A;try{for(o=o.call(i);!(l=(x=o.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function M0(i){if(Array.isArray(i))return i}var cg=null,fg=null;function hg(i,c){return R0(i)||L0(i,c)||O0(i,c)||I0()}function I0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function O0(i,c){if(!!i){if(typeof i=="string")return am(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return am(i,c)}}function am(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function L0(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,x,A;try{for(o=o.call(i);!(l=(x=o.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function R0(i){if(Array.isArray(i))return i}var pg=null,dg=null;function om(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function vg(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?om(Object(o),!0).forEach(function(s){D0(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):om(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function D0(i,c,o){return c in i?Object.defineProperty(i,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[c]=o,i}function mg(i,c){if(i==null)return{};var o=k0(i,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,s)||(o[s]=i[s]))}return o}function k0(i,c){if(i==null)return{};var o={},s=Object.keys(i),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(o[l]=i[l]);return o}var yg=null,sm=g(73935);function F0(i,c){return U0(i)||z0(i,c)||N0(i,c)||B0()}function B0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function N0(i,c){if(!!i){if(typeof i=="string")return um(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return um(i,c)}}function um(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function z0(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,x,A;try{for(o=o.call(i);!(l=(x=o.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function U0(i){if(Array.isArray(i))return i}var Z0=U.useEffect,j0=U.useState;function gg(i){var c=i.className,o=i.style,s=i.children,l=i.position,d=useSceneValue(),x=j0(function(){return document.createElement("div")}),A=F0(x,1),O=A[0];return Z0(function(){var B=new Control({position:l});return B.onAdd=function(){if(c&&(O.className=c),o){var re=Object.keys(o).map(function(Q){return"".concat(Q,":").concat(o[Q])}).join(";");O.style.cssText=re}return O},d.addControl(B),function(){d.removeControl(B)}},[]),createPortal(s,O)}var lm=(0,U.createContext)({});function _g(){return useContext(lm)}var V0=U.useEffect,G0=U.memo(function(c){var o=c.layer,s=c.active;return V0(function(){o.active(s.option)},[JSON.stringify(s)]),null}),H0=U.useEffect,W0=U.memo(function(c){var o=c.layer,s=c.animate;return H0(function(){o.animate(s)},[JSON.stringify(s)]),null}),X0=U.useEffect,Y0=U.memo(function(c){var o=c.layer,s=c.color;return X0(function(){s.field?o.color(s.field,s.values):o.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),K0=U.useEffect,$0=U.memo(function(c){var o=c.layer,s=c.filter;return K0(function(){s.field&&o.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),J0=U.useEffect,Q0=U.memo(function(c){var o=c.layer,s=c.scale;return J0(function(){o.scale(s.values)},[s.values]),null}),q0=U.useEffect,ey=U.memo(function(c){var o=c.layer,s=c.select;return q0(function(){o.select(s.option)},[JSON.stringify(s)]),null}),ty=U.useEffect,ry=U.memo(function(c){var o=c.layer,s=c.shape;return ty(function(){s.field?o.shape(s.field,s.values):o.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),ny=U.useEffect,iy=U.memo(function(c){var o=c.layer,s=c.size;return ny(function(){s.field?o.size(s.field,s.values):o.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),ay=["data"];function oy(i,c){if(i==null)return{};var o=sy(i,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,s)||(o[s]=i[s]))}return o}function sy(i,c){if(i==null)return{};var o={},s=Object.keys(i),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(o[l]=i[l]);return o}var uy=U.useEffect,ly=U.memo(function(c){var o=c.layer,s=c.source,l=s.data,d=oy(s,ay);return uy(function(){o.inited?o.setData(l,d):o.source(l,d),d.autoFit&&o.fitBounds(d&&d.fitBoundsOptions)},[l,JSON.stringify(d)]),null}),cy=U.useEffect,fy=U.memo(function(c){var o=c.layer,s=c.style;return cy(function(){o.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function hy(i,c){return yy(i)||vy(i,c)||dy(i,c)||py()}function py(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dy(i,c){if(!!i){if(typeof i=="string")return cm(i,c);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return cm(i,c)}}function cm(i,c){(c==null||c>i.length)&&(c=i.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=i[o];return s}function vy(i,c){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,x,A;try{for(o=o.call(i);!(l=(x=o.next()).done)&&(s.push(x.value),!(c&&s.length===c));l=!0);}catch(O){d=!0,A=O}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw A}}return s}}function yy(i){if(Array.isArray(i))return i}var jp=U.useEffect,gy=U.useState;function fm(i,c){var o=c.source,s=c.color,l=c.shape,d=c.style,x=c.size,A=c.scale,O=c.active,B=c.select,re=c.filter,Q=c.animate,ge=c.options,Ze=c.onLayerLoaded,_t=p(),Ht=gy(function(){var Vr;switch(i){case"polygonLayer":Vr=new Tt(ge);break;case"lineLayer":Vr=new js(ge);break;case"pointLayer":Vr=new ei(ge);break;case"heatmapLayer":Vr=new Pl(ge);break;case"rasterLayer":Vr=new ya(ge);break;case"imageLayer":Vr=new mn(ge);break;case"citybuildingLayer":Vr=new dc(ge);break;default:Vr=new Tt(ge)}return Vr.on("inited",function(){Ze&&Ze(Vr,_t)}),Vr}),_r=hy(Ht,1),Er=_r[0];return jp(function(){return _t.addLayer(Er),function(){_t.removeLayer(Er)}},[]),jp(function(){Er.inited&&ge&&Er.updateLayerConfig(ge)},[ge==null?void 0:ge.minZoom,ge==null?void 0:ge.maxZoom,ge==null?void 0:ge.visible]),jp(function(){Er.inited&&(ge==null?void 0:ge.zIndex)&&Er.setIndex(ge.zIndex)},[ge==null?void 0:ge.zIndex]),jp(function(){Er.inited&&(ge==null?void 0:ge.blend)&&Er.setBlend(ge.blend)},[ge==null?void 0:ge.blend]),jp(function(){_t.render()}),U.createElement(lm.Provider,{value:Er},U.createElement(ly,{layer:Er,source:o}),A&&U.createElement(Q0,{layer:Er,scale:A}),s&&U.createElement(Y0,{layer:Er,color:s}),x&&U.createElement(iy,{layer:Er,size:x}),l&&U.createElement(ry,{layer:Er,shape:l}),d&&U.createElement(fy,{layer:Er,style:d}),O&&U.createElement(G0,{layer:Er,active:O}),B&&U.createElement(ey,{layer:Er,select:B}),re&&U.createElement($0,{layer:Er,filter:re}),Q&&U.createElement(W0,{layer:Er,animate:Q}),c.children)}var xg=null,bg=null,_y=U.memo(function(c){return fm("pointLayer",c)}),xy=U.memo(function(c){return fm("heatmapLayer",c)}),Sg=null,Eg=null,Cg=null,wg=U.useEffect,Tg=null,Ag=null;function _d(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_d=function(o){return typeof o}:_d=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_d(i)}function hm(i,c){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function xd(i){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?hm(Object(o),!0).forEach(function(s){by(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):hm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function by(i,c,o){return c in i?Object.defineProperty(i,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[c]=o,i}function Sy(i,c){if(!(i instanceof c))throw new TypeError("Cannot call a class as a function")}function pm(i,c){for(var o=0;o<c.length;o++){var s=c[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function Ey(i,c,o){return c&&pm(i.prototype,c),o&&pm(i,o),i}function Cy(i,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(c&&c.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),c&&Nd(i,c)}function Nd(i,c){return Nd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Nd(i,c)}function wy(i){var c=Py();return function(){var s=bd(i),l;if(c){var d=bd(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Ty(this,l)}}function Ty(i,c){return c&&(_d(c)==="object"||typeof c=="function")?c:Ay(i)}function Ay(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function Py(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function bd(i){return bd=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},bd(i)}var Pg=function(i){Cy(o,i);var c=wy(o);function o(s){var l;return Sy(this,o),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return Ey(o,[{key:"componentDidMount",value:function(){var l,d=this.props,x=d.lnglat,A=d.children,O=d.option,B=d.lngLat,re=new Be(xd(xd({},O),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));x&&re.setLnglat(x),B&&re.setLnglat(B),A&&re.setDOMContent(this.el),this.popup=re,this.scene.addPopup(re)}},{key:"componentDidUpdate",value:function(l){var d,x,A,O,B,re,Q=Array.isArray(l.lnglat)?l.lnglat:[l==null||(d=l.lnglat)===null||d===void 0?void 0:d.lng,l==null||(x=l.lnglat)===null||x===void 0?void 0:x.lat],ge=Array.isArray(this.props.lnglat)?this.props.lnglat:[(A=this.props)===null||A===void 0||(O=A.lnglat)===null||O===void 0?void 0:O.lng,(B=this.props)===null||B===void 0||(re=B.lnglat)===null||re===void 0?void 0:re.lat],Ze=Q.toString()!==ge.toString();if(Ze){var _t;this.popup.remove(),this.popup=new Be(xd(xd({},this.props.option),{},{stopPropagation:(_t=this.props.option)===null||_t===void 0?void 0:_t.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return U.createElement(b.Consumer,{},function(d){return d&&(l.scene=d),(0,sm.createPortal)(l.props.children,l.el)})}}]),o}(U.PureComponent);function Sd(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Sd=function(o){return typeof o}:Sd=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Sd(i)}function My(i,c){if(!(i instanceof c))throw new TypeError("Cannot call a class as a function")}function dm(i,c){for(var o=0;o<c.length;o++){var s=c[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function Iy(i,c,o){return c&&dm(i.prototype,c),o&&dm(i,o),i}function Oy(i,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(c&&c.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),c&&zd(i,c)}function zd(i,c){return zd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},zd(i,c)}function Ly(i){var c=ky();return function(){var s=Ed(i),l;if(c){var d=Ed(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return Ry(this,l)}}function Ry(i,c){return c&&(Sd(c)==="object"||typeof c=="function")?c:Dy(i)}function Dy(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function ky(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function Ed(i){return Ed=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Ed(i)}var Mg=function(i){Oy(o,i);var c=Ly(o);function o(s){var l;return My(this,o),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return Iy(o,[{key:"componentDidMount",value:function(){var l=this.props,d=l.lnglat,x=l.children,A=l.option,O=l.onMarkerLoaded,B=new Rr(A);d&&B.setLnglat(d),x&&B.setElement(this.el),this.marker=B,O&&O(B),this.scene.addMarker(B)}},{key:"componentDidUpdate",value:function(l){var d,x=(l==null?void 0:l.lnglat.toString())!==((d=this.props)===null||d===void 0?void 0:d.lnglat.toString());x&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return U.createElement(b.Consumer,{},function(d){return d&&(l.scene=d),(0,sm.createPortal)(l.props.children,l.el)})}}]),o}(U.PureComponent),Ig=U.useEffect,Og=null,Lg=null,Rg=U.useEffect,Dg=null},4771:function(){},6563:function(Qe,D,g){var U=g(31795);Qe.exports=b;function b(I,L){switch(I&&I.type||null){case"FeatureCollection":return I.features=I.features.map(p(b,L)),I;case"GeometryCollection":return I.geometries=I.geometries.map(p(b,L)),I;case"Feature":return I.geometry=b(I.geometry,L),I;case"Polygon":case"MultiPolygon":return E(I,L);default:return I}}function p(I,L){return function(_e){return I(_e,L)}}function E(I,L){return I.type==="Polygon"?I.coordinates=Z(I.coordinates,L):I.type==="MultiPolygon"&&(I.coordinates=I.coordinates.map(p(Z,L))),I}function Z(I,L){L=!!L,I[0]=V(I[0],L);for(var _e=1;_e<I.length;_e++)I[_e]=V(I[_e],!L);return I}function V(I,L){return H(I)===L?I:I.reverse()}function H(I){return U.ring(I)>=0}},6901:function(Qe,D,g){"use strict";g.d(D,{SO:function(){return U},z6:function(){return xt},a5:function(){return b},Z:function(){return Mt},rQ:function(){return Dn},bV:function(){return wr},zi:function(){return Zn},ds:function(){return nt},Ev:function(){return ht},oO:function(){return Mr},W0:function(){return Ur},Z6:function(){return tn},We:function(){return ir},Cl:function(){return jr},gJ:function(){return Ge},vP:function(){return Be},yM:function(){return ne},yA:function(){return Dr},CI:function(){return Zr}});var U={};g.r(U),g.d(U,{DPR:function(){return Je},addClass:function(){return $e},create:function(){return xe},empty:function(){return Et},getClass:function(){return St},getContainer:function(){return H},getViewPortScale:function(){return At},hasClass:function(){return Lt},printCanvas:function(){return fr},remove:function(){return Re},removeClass:function(){return Rt},setClass:function(){return zt},setTransform:function(){return ur},splitWords:function(){return L},triggerResize:function(){return ee},trim:function(){return I}});var b={};g.r(b),g.d(b,{getColumn:function(){return ce},getSatByColumn:function(){return ve},max:function(){return bi},mean:function(){return ki},min:function(){return Hi},mode:function(){return Oi},statMap:function(){return $},sum:function(){return qi}});function p(j){var se=131,de=137,Me=0;j+="x";for(var ue=Math.floor(9007199254740991/de),Te=0;Te<j.length;Te++)Me>ue&&(Me=Math.floor(Me/de)),Me=Me*se+j.charCodeAt(Te);return Me}function E(j){j=j.toString();for(var se=5381,de=j.length;de;)se=se*33^j.charCodeAt(--de);return se>>>0}var Z=g(28481),V=window.document.documentElement.style;function H(j){var se=j;return typeof j=="string"&&(se=document.getElementById(j)),se}function I(j){return j.trim?j.trim():j.replace(/^\s+|\s+$/g,"")}function L(j){return I(j).split(/\s+/)}function _e(j){if(!V)return j[0];for(var se in j)if(j[se]&&j[se]in V)return j[se];return j[0]}function xe(j,se,de){var Me=document.createElement(j);return Me.className=se||"",de&&de.appendChild(Me),Me}function Re(j){var se=j.parentNode;se&&se.removeChild(j)}function $e(j,se){if(j.classList!==void 0)for(var de=L(se),Me=0,ue=de.length;Me<ue;Me++)j.classList.add(de[Me]);else if(!Lt(j,se)){var Te=St(j);zt(j,(Te?Te+" ":"")+se)}}function Rt(j,se){j.classList!==void 0?j.classList.remove(se):zt(j,I((" "+St(j)+" ").replace(" "+se+" "," ")))}function Lt(j,se){if(j.classList!==void 0)return j.classList.contains(se);var de=St(j);return de.length>0&&new RegExp("(^|\\s)"+se+"(\\s|$)").test(de)}function zt(j,se){j instanceof HTMLElement?j.className=se:j.className.baseVal=se}function St(j){return j instanceof SVGElement&&(j=j.correspondingElement),j.className.baseVal===void 0?j.className:j.className.baseVal}function Et(j){for(;j&&j.firstChild;)j.removeChild(j.firstChild)}var at=_e(["transform","WebkitTransform"]);function ur(j,se){j.style[at]=se}function ee(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var j=window.document.createEvent("UIEvents");j.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(j)}}function fr(j){var se=["padding: "+(j.height/2-8)+"px "+j.width/2+"px;","line-height: "+j.height+"px;","background-image: url("+j.toDataURL()+");"];console.log(`%c
`,se.join(""))}function At(){var j,se=document.querySelector('meta[name="viewport"]');if(!se)return 1;var de=(j=se.content)===null||j===void 0?void 0:j.split(","),Me=de.find(function(ue){var Te=ue.split("="),mt=(0,Z.Z)(Te,2),br=mt[0],Yt=mt[1];return br==="initial-scale"});return Me?Me.split("=")[1]*1:1}var Je=At()<1?1:window.devicePixelRatio,Pt=g(6610),Ve=g(5991),It=g(63349),hr=g(10379),Jt=g(46070),Fr=g(77608),fe=g(14665);function Fe(j){return Function.toString.call(j).indexOf("[native code]")!==-1}var me=g(51814);function bt(j,se,de){return(0,me.Z)()?bt=Reflect.construct:bt=function(ue,Te,mt){var br=[null];br.push.apply(br,Te);var Yt=Function.bind.apply(ue,br),nr=new Yt;return mt&&(0,fe.Z)(nr,mt.prototype),nr},bt.apply(null,arguments)}function vt(j){var se=typeof Map=="function"?new Map:void 0;return vt=function(Me){if(Me===null||!Fe(Me))return Me;if(typeof Me!="function")throw new TypeError("Super expression must either be null or a function");if(typeof se!="undefined"){if(se.has(Me))return se.get(Me);se.set(Me,ue)}function ue(){return bt(Me,arguments,(0,Fr.Z)(this).constructor)}return ue.prototype=Object.create(Me.prototype,{constructor:{value:ue,enumerable:!1,writable:!0,configurable:!0}}),(0,fe.Z)(ue,Me)},vt(j)}var Zt=g(96156);function Ut(j){var se=Rr();return function(){var Me=(0,Fr.Z)(j),ue;if(se){var Te=(0,Fr.Z)(this).constructor;ue=Reflect.construct(Me,arguments,Te)}else ue=Me.apply(this,arguments);return(0,Jt.Z)(this,ue)}}function Rr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var ln=function(j){(0,hr.Z)(de,j);var se=Ut(de);function de(Me,ue,Te){var mt;return(0,Pt.Z)(this,de),mt=se.call(this,Me),(0,Zt.Z)((0,It.Z)(mt),"status",void 0),(0,Zt.Z)((0,It.Z)(mt),"url",void 0),mt.status=ue,mt.url=Te,mt.name=mt.constructor.name,mt.message=Me,mt}return(0,Ve.Z)(de,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),de}(vt(Error));function pn(j){var se=new XMLHttpRequest;se.open("GET",j.url,!0);for(var de in j.headers)j.headers.hasOwnProperty(de)&&se.setRequestHeader(de,j.headers[de]);return se.withCredentials=j.credentials==="include",se}var Vi=function(se,de){var Me=pn(se);return Me.setRequestHeader("Accept","application/json"),Me.onerror=function(){de(new Error(Me.statusText))},Me.onload=function(){if(Me.status>=200&&Me.status<300&&Me.response){var ue;try{ue=JSON.parse(Me.response)}catch(Te){return de(Te)}de(null,ue)}else Me.status===401?de(new ln("".concat(Me.statusText),Me.status,se.url)):de(new ln(Me.statusText,Me.status,se.url))},Me.send(),Me},ar=function(se,de){var Me=pn(se);return Me.responseType="arraybuffer",Me.onerror=function(){de(new Error(Me.statusText))},Me.onload=function(){var ue=Me.response;if(ue.byteLength===0&&Me.status===200)return de(new Error("http status 200 returned without content."));Me.status>=200&&Me.status<300&&Me.response?de(null,{data:ue,cacheControl:Me.getResponseHeader("Cache-Control"),expires:Me.getResponseHeader("Expires")}):de(new ln(Me.statusText,Me.status,se.url))},Me.send(),Me};function pe(j){var se=window.document.createElement("a");return se.href=j,se.protocol===window.document.location.protocol&&se.host===window.document.location.host}var Pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ge=function(se,de){return ar(se,function(Me,ue){if(Me)de(Me);else if(ue){var Te=new window.Image;Te.crossOrigin="anonymous";var mt=window.URL||window.webkitURL;Te.onload=function(){de(null,Te),mt.revokeObjectURL(Te.src)};var br=new window.Blob([new Uint8Array(ue.data)],{type:"image/png"});Te.src=ue.data.byteLength?mt.createObjectURL(br):Pe}})},ke=g(40271),Ft=2*Math.PI*6378137/2;function ir(j){var se=[Infinity,Infinity,-Infinity,-Infinity];return j.forEach(function(de){var Me=de.coordinates;T(se,Me)}),se}function T(j,se){return Array.isArray(se[0])?se.forEach(function(de){T(j,de)}):(j[0]>se[0]&&(j[0]=se[0]),j[1]>se[1]&&(j[1]=se[1]),j[2]<se[0]&&(j[2]=se[0]),j[3]<se[1]&&(j[3]=se[1])),j}function G(j,se){return Se(j,se)}function Se(j,se){return Array.isArray(j[0])?j.map(function(de){return Se(de,se)}):se(j)}function Be(j){var se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};j=jt(j,se);var Me=j[0],ue=j[1],Te=Me*Ft/180,mt=Math.log(Math.tan((90+ue)*Math.PI/360))/(Math.PI/180);return mt=mt*Ft/180,de.enable&&(Te=Number(Te.toFixed(de.decimal)),mt=Number(mt.toFixed(de.decimal))),j.length===3?[Te,mt,j[2]]:[Te,mt]}function et(j){var se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,de=j[0],Me=j[1],ue=de/Ft*180,Te=Me/Ft*180;return Te=180/Math.PI*(2*Math.atan(Math.exp(Te*Math.PI/180))-Math.PI/2),se!=null&&(ue=Number(ue.toFixed(se)),Te=Number(Te.toFixed(se))),j.length===3?[ue,Te,j[2]]:[ue,Te]}function tt(j){if(j==null)throw new Error("lng is required");return(j>180||j<-180)&&(j=j%360,j>180&&(j=-360+j),j<-180&&(j=360+j),j===0&&(j=0)),j}function Ct(j){if(j==null)throw new Error("lat is required");return(j>90||j<-90)&&(j=j%180,j>90&&(j=-180+j),j<-90&&(j=180+j),j===0&&(j=0)),j}function jt(j,se){if(se===!1)return j;var de=tt(j[0]),Me=Ct(j[1]);return Me>85&&(Me=85),Me<-85&&(Me=-85),j.length===3?[de,Me,j[2]]:[de,Me]}function Mt(j){var se=85.0511287798,de=Math.max(Math.min(se,j[1]),-se),Me=256<<20,ue=Math.PI/180,Te=j[0]*ue,mt=de*ue;mt=Math.log(Math.tan(Math.PI/4+mt/2));var br=.5/Math.PI,Yt=.5,nr=-.5/Math.PI;return ue=.5,Te=Me*(br*Te+Yt),mt=Me*(nr*mt+ue),[Math.floor(Te),Math.floor(mt)]}function Qt(j){var se=.5/Math.PI,de=.5,Me=-.5/Math.PI,ue=.5,Te=256<<20,mt=_slicedToArray(j,2),br=mt[0],Yt=mt[1];br=(br/Te-de)/se,Yt=(Yt/Te-ue)/Me,Yt=(Math.atan(Math.pow(Math.E,Yt))-Math.PI/4)*2,ue=Math.PI/180;var nr=Yt/ue,kr=br/ue;return[kr,nr]}function ne(j,se,de){var Me=(0,ke.Ht)(se[1]-j[1]),ue=(0,ke.Ht)(se[0]-j[0]),Te=(0,ke.Ht)(j[1]),mt=(0,ke.Ht)(se[1]),br=Math.pow(Math.sin(Me/2),2)+Math.pow(Math.sin(ue/2),2)*Math.cos(Te)*Math.cos(mt);return(0,ke.DL)(2*Math.atan2(Math.sqrt(br),Math.sqrt(1-br)),de="meters")}function Kt(j){var se=Math.PI/180,de=85.0511287798,Me=6378137,ue=Math.max(Math.min(de,j[1]),-de),Te=Math.sin(ue*se),mt=Me*j[0]*se,br=Me*Math.log((1+Te)/(1-Te))/2;return[mt,br]}function Dr(j,se){var de=Math.abs(j[1][1]-j[0][1])*se,Me=Math.abs(j[1][0]-j[0][0])*se;return[[j[0][0]-Me,j[0][1]-de],[j[1][0]+Me,j[1][1]+de]]}function Mr(j,se){return j[0][0]<=se[0][0]&&j[0][1]<=se[0][1]&&j[1][0]>=se[1][0]&&j[1][1]>=se[1][1]}function nt(j){return[[j[0],j[1]],[j[2],j[3]]]}var xt=function(){function j(){var se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,de=arguments.length>1?arguments[1]:void 0;(0,Pt.Z)(this,j),(0,Zt.Z)(this,"limit",void 0),(0,Zt.Z)(this,"cache",void 0),(0,Zt.Z)(this,"destroy",void 0),(0,Zt.Z)(this,"order",void 0),this.limit=se,this.destroy=de||this.defaultDestroy,this.order=[],this.clear()}return(0,Ve.Z)(j,[{key:"clear",value:function(){var de=this;this.order.forEach(function(Me){de.delete(Me)}),this.cache={},this.order=[]}},{key:"get",value:function(de){var Me=this.cache[de];return Me&&(this.deleteOrder(de),this.appendOrder(de)),Me}},{key:"set",value:function(de,Me){this.cache[de]?(this.delete(de),this.cache[de]=Me,this.appendOrder(de)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[de]=Me,this.appendOrder(de))}},{key:"delete",value:function(de){var Me=this.cache[de];Me&&(this.deleteCache(de),this.deleteOrder(de),this.destroy(Me,de))}},{key:"deleteCache",value:function(de){delete this.cache[de]}},{key:"deleteOrder",value:function(de){var Me=this.order.findIndex(function(ue){return ue===de});Me>=0&&this.order.splice(Me,1)}},{key:"appendOrder",value:function(de){this.order.push(de)}},{key:"defaultDestroy",value:function(de,Me){return null}}]),j}();function ht(j,se){j.forEach(function(de){!se[de]||(se[de]=se[de].bind(se))})}var vr=g(2650);function Zr(j){var se=vr.ZP(j),de=[0,0,0,0];return se!=null&&(de[0]=se.r/255,de[1]=se.g/255,de[2]=se.b/255,de[3]=se.opacity),de}function Ur(j){var se=j&&j[0],de=j&&j[1],Me=j&&j[2],ue=se+de*256+Me*65536-1;return ue}function tn(j){return[j+1&255,j+1>>8&255,j+1>>8>>8&255]}function jr(j){var se=document.createElement("canvas"),de=se.getContext("2d");se.width=256,se.height=1;for(var Me=de.createLinearGradient(0,0,256,1),ue=null,Te=j.positions[0],mt=j.positions[j.positions.length-1],br=0;br<j.colors.length;++br){var Yt=(j.positions[br]-Te)/(mt-Te);Me.addColorStop(Yt,j.colors[br])}return de.fillStyle=Me,de.fillRect(0,0,256,1),ue=new Uint8ClampedArray(de.getImageData(0,0,256,1).data),new ImageData(ue,256,1)}var wr;(function(j){j.CENTER="center",j.TOP="top",j["TOP-LEFT"]="top-left",j["TOP-RIGHT"]="top-right",j.BOTTOM="bottom",j["BOTTOM-LEFT"]="bottom-left",j.LEFT="left",j.RIGHT="right"})(wr||(wr={}));var Dn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zn(j,se,de){var Me=j.classList;for(var ue in Dn)Dn.hasOwnProperty(ue)&&Me.remove("l7-".concat(de,"-anchor-").concat(ue));Me.add("l7-".concat(de,"-anchor-").concat(se))}function bi(j){if(j.length===0)throw new Error("max requires at least one data point");for(var se=j[0],de=1;de<j.length;de++)j[de]>se&&(se=j[de]);return se*1}function Hi(j){if(j.length===0)throw new Error("min requires at least one data point");for(var se=j[0],de=1;de<j.length;de++)j[de]<se&&(se=j[de]);return se*1}function qi(j){if(j.length===0)return 0;for(var se=j[0]*1,de=1;de<j.length;de++)se+=j[de]*1;return se}function ki(j){if(j.length===0)throw new Error("mean requires at least one data point");return qi(j)/j.length}function Oi(j){if(j.length===0)throw new Error("mean requires at least one data point");if(j.length<3)return j[0];j.sort();for(var se=j[0],de=NaN,Me=0,ue=1,Te=1;Te<j.length+1;Te++)j[Te]!==se?(ue>Me&&(Me=ue,de=se),ue=1,se=j[Te]):ue++;return de*1}var $={min:Hi,max:bi,mean:ki,sum:qi,mode:Oi};function ce(j,se){return j.map(function(de){return de[se]})}function ve(j,se){return $[j](se)}},3473:function(Qe,D,g){"use strict";g.d(D,{Z:function(){return U}});function U(b,p,E,Z,V){var H={};return Object.keys(Z).forEach(function(I){H[I]=Z[I]}),H.enumerable=!!H.enumerable,H.configurable=!!H.configurable,("value"in H||H.initializer)&&(H.writable=!0),H=E.slice().reverse().reduce(function(I,L){return L(b,p,I)||I},H),V&&H.initializer!==void 0&&(H.value=H.initializer?H.initializer.call(V):void 0,H.initializer=void 0),H.initializer===void 0&&(Object.defineProperty(b,p,H),H=null),H}},66213:function(Qe,D,g){"use strict";g.d(D,{Z:function(){return p}});var U=g(77608);function b(E,Z){for(;!Object.prototype.hasOwnProperty.call(E,Z)&&(E=(0,U.Z)(E),E!==null););return E}function p(E,Z,V){return typeof Reflect!="undefined"&&Reflect.get?p=Reflect.get:p=function(I,L,_e){var xe=b(I,L);if(!!xe){var Re=Object.getOwnPropertyDescriptor(xe,L);return Re.get?Re.get.call(_e):Re.value}},p(E,Z,V||E)}},55770:function(Qe,D,g){"use strict";g.d(D,{Z:function(){return U}});function U(b,p,E,Z){!E||Object.defineProperty(b,p,{enumerable:E.enumerable,configurable:E.configurable,writable:E.writable,value:E.initializer?E.initializer.call(Z):void 0})}},31795:function(Qe,D,g){var U=g(75752);Qe.exports.geometry=b,Qe.exports.ring=E;function b(V){var H=0,I;switch(V.type){case"Polygon":return p(V.coordinates);case"MultiPolygon":for(I=0;I<V.coordinates.length;I++)H+=p(V.coordinates[I]);return H;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(I=0;I<V.geometries.length;I++)H+=b(V.geometries[I]);return H}}function p(V){var H=0;if(V&&V.length>0){H+=Math.abs(E(V[0]));for(var I=1;I<V.length;I++)H-=Math.abs(E(V[I]))}return H}function E(V){var H,I,L,_e,xe,Re,$e,Rt=0,Lt=V.length;if(Lt>2){for($e=0;$e<Lt;$e++)$e===Lt-2?(_e=Lt-2,xe=Lt-1,Re=0):$e===Lt-1?(_e=Lt-1,xe=0,Re=1):(_e=$e,xe=$e+1,Re=$e+2),H=V[_e],I=V[xe],L=V[Re],Rt+=(Z(L[0])-Z(H[0]))*Math.sin(Z(I[1]));Rt=Rt*U.RADIUS*U.RADIUS/2}return Rt}function Z(V){return V*Math.PI/180}},49296:function(Qe){"use strict";Qe.exports=g,Qe.exports.default=g;var D=1e20;function g(Z,V,H,I,L,_e){this.fontSize=Z||24,this.buffer=V===void 0?3:V,this.cutoff=I||.25,this.fontFamily=L||"sans-serif",this.fontWeight=_e||"normal",this.radius=H||8;var xe=this.size=this.fontSize+this.buffer*2,Re=xe+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=xe,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Re*Re),this.gridInner=new Float64Array(Re*Re),this.f=new Float64Array(Re),this.z=new Float64Array(Re+1),this.v=new Uint16Array(Re),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(xe/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function U(Z,V,H,I,L,_e,xe){_e.fill(D,0,V*H),xe.fill(0,0,V*H);for(var Re=(V-I)/2,$e=0;$e<L;$e++)for(var Rt=0;Rt<I;Rt++){var Lt=($e+Re)*V+Rt+Re,zt=Z.data[4*($e*I+Rt)+3]/255;if(zt===1)_e[Lt]=0,xe[Lt]=D;else if(zt===0)_e[Lt]=D,xe[Lt]=0;else{var St=Math.max(0,.5-zt),Et=Math.max(0,zt-.5);_e[Lt]=St*St,xe[Lt]=Et*Et}}}function b(Z,V,H,I,L,_e,xe){for(var Re=0;Re<V*H;Re++){var $e=Math.sqrt(I[Re])-Math.sqrt(L[Re]);Z[Re]=Math.round(255-255*($e/_e+xe))}}g.prototype._draw=function(Z,V){var H=this.ctx.measureText(Z),I=H.width,L=2*this.buffer,_e,xe,Re,$e,Rt,Lt,zt,St;V&&this.useMetrics?(Rt=Math.floor(H.actualBoundingBoxAscent),St=this.buffer+Math.ceil(H.actualBoundingBoxAscent),Lt=this.buffer,zt=this.buffer,xe=Math.min(this.size,Math.ceil(H.actualBoundingBoxRight-H.actualBoundingBoxLeft)),$e=Math.min(this.size-Lt,Math.ceil(H.actualBoundingBoxAscent+H.actualBoundingBoxDescent)),_e=xe+L,Re=$e+L,this.ctx.textBaseline="alphabetic"):(_e=xe=this.size,Re=$e=this.size,Rt=19*this.fontSize/24,Lt=zt=0,St=this.middle,this.ctx.textBaseline="middle");var Et;xe&&$e&&(this.ctx.clearRect(zt,Lt,xe,$e),this.ctx.fillText(Z,this.buffer,St),Et=this.ctx.getImageData(zt,Lt,xe,$e));var at=new Uint8ClampedArray(_e*Re);return U(Et,_e,Re,xe,$e,this.gridOuter,this.gridInner),p(this.gridOuter,_e,Re,this.f,this.v,this.z),p(this.gridInner,_e,Re,this.f,this.v,this.z),b(at,_e,Re,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:at,metrics:{width:xe,height:$e,sdfWidth:_e,sdfHeight:Re,top:Rt,left:0,advance:I}}},g.prototype.draw=function(Z){return this._draw(Z,!1).data},g.prototype.drawWithMetrics=function(Z){return this._draw(Z,!0)};function p(Z,V,H,I,L,_e){for(var xe=0;xe<V;xe++)E(Z,xe,V,H,I,L,_e);for(var Re=0;Re<H;Re++)E(Z,Re*V,1,V,I,L,_e)}function E(Z,V,H,I,L,_e,xe){var Re,$e,Rt,Lt;for(_e[0]=0,xe[0]=-D,xe[1]=D,Re=0;Re<I;Re++)L[Re]=Z[V+Re*H];for(Re=1,$e=0,Rt=0;Re<I;Re++){do Lt=_e[$e],Rt=(L[Re]-L[Lt]+Re*Re-Lt*Lt)/(Re-Lt)/2;while(Rt<=xe[$e]&&--$e>-1);$e++,_e[$e]=Re,xe[$e]=Rt,xe[$e+1]=D}for(Re=0,$e=0;Re<I;Re++){for(;xe[$e+1]<Re;)$e++;Lt=_e[$e],Z[V+Re*H]=L[Lt]+(Re-Lt)*(Re-Lt)}}},40271:function(Qe,D,g){"use strict";g.d(D,{zL:function(){return Z},DL:function(){return at},Ht:function(){return Je}});var U=63710088e-1,b={centimeters:U*100,centimetres:U*100,degrees:U/111325,feet:U*3.28084,inches:U*39.37,kilometers:U/1e3,kilometres:U/1e3,meters:U,metres:U,miles:U/1609.344,millimeters:U*1e3,millimetres:U*1e3,nauticalmiles:U/1852,radians:1,yards:U*1.0936},p={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/U,yards:1.0936133},E={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Z(fe,Fe,me){me===void 0&&(me={});var bt={type:"Feature"};return(me.id===0||me.id)&&(bt.id=me.id),me.bbox&&(bt.bbox=me.bbox),bt.properties=Fe||{},bt.geometry=fe,bt}function V(fe,Fe,me){switch(me===void 0&&(me={}),fe){case"Point":return H(Fe).geometry;case"LineString":return xe(Fe).geometry;case"Polygon":return L(Fe).geometry;case"MultiPoint":return Lt(Fe).geometry;case"MultiLineString":return Rt(Fe).geometry;case"MultiPolygon":return zt(Fe).geometry;default:throw new Error(fe+" is invalid")}}function H(fe,Fe,me){if(me===void 0&&(me={}),!fe)throw new Error("coordinates is required");if(!Array.isArray(fe))throw new Error("coordinates must be an Array");if(fe.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!It(fe[0])||!It(fe[1]))throw new Error("coordinates must contain numbers");var bt={type:"Point",coordinates:fe};return Z(bt,Fe,me)}function I(fe,Fe,me){return me===void 0&&(me={}),$e(fe.map(function(bt){return H(bt,Fe)}),me)}function L(fe,Fe,me){me===void 0&&(me={});for(var bt=0,vt=fe;bt<vt.length;bt++){var Zt=vt[bt];if(Zt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Ut=0;Ut<Zt[Zt.length-1].length;Ut++)if(Zt[Zt.length-1][Ut]!==Zt[0][Ut])throw new Error("First and last Position are not equivalent.")}var Rr={type:"Polygon",coordinates:fe};return Z(Rr,Fe,me)}function _e(fe,Fe,me){return me===void 0&&(me={}),$e(fe.map(function(bt){return L(bt,Fe)}),me)}function xe(fe,Fe,me){if(me===void 0&&(me={}),fe.length<2)throw new Error("coordinates must be an array of two or more positions");var bt={type:"LineString",coordinates:fe};return Z(bt,Fe,me)}function Re(fe,Fe,me){return me===void 0&&(me={}),$e(fe.map(function(bt){return xe(bt,Fe)}),me)}function $e(fe,Fe){Fe===void 0&&(Fe={});var me={type:"FeatureCollection"};return Fe.id&&(me.id=Fe.id),Fe.bbox&&(me.bbox=Fe.bbox),me.features=fe,me}function Rt(fe,Fe,me){me===void 0&&(me={});var bt={type:"MultiLineString",coordinates:fe};return Z(bt,Fe,me)}function Lt(fe,Fe,me){me===void 0&&(me={});var bt={type:"MultiPoint",coordinates:fe};return Z(bt,Fe,me)}function zt(fe,Fe,me){me===void 0&&(me={});var bt={type:"MultiPolygon",coordinates:fe};return Z(bt,Fe,me)}function St(fe,Fe,me){me===void 0&&(me={});var bt={type:"GeometryCollection",geometries:fe};return Z(bt,Fe,me)}function Et(fe,Fe){if(Fe===void 0&&(Fe=0),Fe&&!(Fe>=0))throw new Error("precision must be a positive number");var me=Math.pow(10,Fe||0);return Math.round(fe*me)/me}function at(fe,Fe){Fe===void 0&&(Fe="kilometers");var me=b[Fe];if(!me)throw new Error(Fe+" units is invalid");return fe*me}function ur(fe,Fe){Fe===void 0&&(Fe="kilometers");var me=b[Fe];if(!me)throw new Error(Fe+" units is invalid");return fe/me}function ee(fe,Fe){return At(ur(fe,Fe))}function fr(fe){var Fe=fe%360;return Fe<0&&(Fe+=360),Fe}function At(fe){var Fe=fe%(2*Math.PI);return Fe*180/Math.PI}function Je(fe){var Fe=fe%360;return Fe*Math.PI/180}function Pt(fe,Fe,me){if(Fe===void 0&&(Fe="kilometers"),me===void 0&&(me="kilometers"),!(fe>=0))throw new Error("length must be a positive number");return at(ur(fe,Fe),me)}function Ve(fe,Fe,me){if(Fe===void 0&&(Fe="meters"),me===void 0&&(me="kilometers"),!(fe>=0))throw new Error("area must be a positive number");var bt=E[Fe];if(!bt)throw new Error("invalid original units");var vt=E[me];if(!vt)throw new Error("invalid final units");return fe/bt*vt}function It(fe){return!isNaN(fe)&&fe!==null&&!Array.isArray(fe)}function hr(fe){return!!fe&&fe.constructor===Object}function Jt(fe){if(!fe)throw new Error("bbox is required");if(!Array.isArray(fe))throw new Error("bbox must be an Array");if(fe.length!==4&&fe.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");fe.forEach(function(Fe){if(!It(Fe))throw new Error("bbox must only contain numbers")})}function Fr(fe){if(!fe)throw new Error("id is required");if(["string","number"].indexOf(typeof fe)===-1)throw new Error("id must be a number or a string")}},53645:function(Qe){Qe.exports={"ant-pro-grid-content":"ant-pro-grid-content",wide:"wide"}},9187:function(Qe){"use strict";Qe.exports=D,Qe.exports.default=D;function D(fe,Fe,me){me=me||2;var bt=Fe&&Fe.length,vt=bt?Fe[0]*me:fe.length,Zt=g(fe,0,vt,me,!0),Ut=[];if(!Zt||Zt.next===Zt.prev)return Ut;var Rr,ln,pn,Vi,ar,pe,Pe;if(bt&&(Zt=H(fe,Fe,Zt,me)),fe.length>80*me){Rr=pn=fe[0],ln=Vi=fe[1];for(var Ge=me;Ge<vt;Ge+=me)ar=fe[Ge],pe=fe[Ge+1],ar<Rr&&(Rr=ar),pe<ln&&(ln=pe),ar>pn&&(pn=ar),pe>Vi&&(Vi=pe);Pe=Math.max(pn-Rr,Vi-ln),Pe=Pe!==0?1/Pe:0}return b(Zt,Ut,me,Rr,ln,Pe),Ut}function g(fe,Fe,me,bt,vt){var Zt,Ut;if(vt===Fr(fe,Fe,me,bt)>0)for(Zt=Fe;Zt<me;Zt+=bt)Ut=It(Zt,fe[Zt],fe[Zt+1],Ut);else for(Zt=me-bt;Zt>=Fe;Zt-=bt)Ut=It(Zt,fe[Zt],fe[Zt+1],Ut);return Ut&&at(Ut,Ut.next)&&(hr(Ut),Ut=Ut.next),Ut}function U(fe,Fe){if(!fe)return fe;Fe||(Fe=fe);var me=fe,bt;do if(bt=!1,!me.steiner&&(at(me,me.next)||Et(me.prev,me,me.next)===0)){if(hr(me),me=Fe=me.prev,me===me.next)break;bt=!0}else me=me.next;while(bt||me!==Fe);return Fe}function b(fe,Fe,me,bt,vt,Zt,Ut){if(!!fe){!Ut&&Zt&&Re(fe,bt,vt,Zt);for(var Rr=fe,ln,pn;fe.prev!==fe.next;){if(ln=fe.prev,pn=fe.next,Zt?E(fe,bt,vt,Zt):p(fe)){Fe.push(ln.i/me),Fe.push(fe.i/me),Fe.push(pn.i/me),hr(fe),fe=pn.next,Rr=pn.next;continue}if(fe=pn,fe===Rr){Ut?Ut===1?(fe=Z(U(fe),Fe,me),b(fe,Fe,me,bt,vt,Zt,2)):Ut===2&&V(fe,Fe,me,bt,vt,Zt):b(U(fe),Fe,me,bt,vt,Zt,1);break}}}}function p(fe){var Fe=fe.prev,me=fe,bt=fe.next;if(Et(Fe,me,bt)>=0)return!1;for(var vt=fe.next.next;vt!==fe.prev;){if(zt(Fe.x,Fe.y,me.x,me.y,bt.x,bt.y,vt.x,vt.y)&&Et(vt.prev,vt,vt.next)>=0)return!1;vt=vt.next}return!0}function E(fe,Fe,me,bt){var vt=fe.prev,Zt=fe,Ut=fe.next;if(Et(vt,Zt,Ut)>=0)return!1;for(var Rr=vt.x<Zt.x?vt.x<Ut.x?vt.x:Ut.x:Zt.x<Ut.x?Zt.x:Ut.x,ln=vt.y<Zt.y?vt.y<Ut.y?vt.y:Ut.y:Zt.y<Ut.y?Zt.y:Ut.y,pn=vt.x>Zt.x?vt.x>Ut.x?vt.x:Ut.x:Zt.x>Ut.x?Zt.x:Ut.x,Vi=vt.y>Zt.y?vt.y>Ut.y?vt.y:Ut.y:Zt.y>Ut.y?Zt.y:Ut.y,ar=Rt(Rr,ln,Fe,me,bt),pe=Rt(pn,Vi,Fe,me,bt),Pe=fe.prevZ,Ge=fe.nextZ;Pe&&Pe.z>=ar&&Ge&&Ge.z<=pe;){if(Pe!==fe.prev&&Pe!==fe.next&&zt(vt.x,vt.y,Zt.x,Zt.y,Ut.x,Ut.y,Pe.x,Pe.y)&&Et(Pe.prev,Pe,Pe.next)>=0||(Pe=Pe.prevZ,Ge!==fe.prev&&Ge!==fe.next&&zt(vt.x,vt.y,Zt.x,Zt.y,Ut.x,Ut.y,Ge.x,Ge.y)&&Et(Ge.prev,Ge,Ge.next)>=0))return!1;Ge=Ge.nextZ}for(;Pe&&Pe.z>=ar;){if(Pe!==fe.prev&&Pe!==fe.next&&zt(vt.x,vt.y,Zt.x,Zt.y,Ut.x,Ut.y,Pe.x,Pe.y)&&Et(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.prevZ}for(;Ge&&Ge.z<=pe;){if(Ge!==fe.prev&&Ge!==fe.next&&zt(vt.x,vt.y,Zt.x,Zt.y,Ut.x,Ut.y,Ge.x,Ge.y)&&Et(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.nextZ}return!0}function Z(fe,Fe,me){var bt=fe;do{var vt=bt.prev,Zt=bt.next.next;!at(vt,Zt)&&ur(vt,bt,bt.next,Zt)&&Je(vt,Zt)&&Je(Zt,vt)&&(Fe.push(vt.i/me),Fe.push(bt.i/me),Fe.push(Zt.i/me),hr(bt),hr(bt.next),bt=fe=Zt),bt=bt.next}while(bt!==fe);return U(bt)}function V(fe,Fe,me,bt,vt,Zt){var Ut=fe;do{for(var Rr=Ut.next.next;Rr!==Ut.prev;){if(Ut.i!==Rr.i&&St(Ut,Rr)){var ln=Ve(Ut,Rr);Ut=U(Ut,Ut.next),ln=U(ln,ln.next),b(Ut,Fe,me,bt,vt,Zt),b(ln,Fe,me,bt,vt,Zt);return}Rr=Rr.next}Ut=Ut.next}while(Ut!==fe)}function H(fe,Fe,me,bt){var vt=[],Zt,Ut,Rr,ln,pn;for(Zt=0,Ut=Fe.length;Zt<Ut;Zt++)Rr=Fe[Zt]*bt,ln=Zt<Ut-1?Fe[Zt+1]*bt:fe.length,pn=g(fe,Rr,ln,bt,!1),pn===pn.next&&(pn.steiner=!0),vt.push(Lt(pn));for(vt.sort(I),Zt=0;Zt<vt.length;Zt++)me=L(vt[Zt],me),me=U(me,me.next);return me}function I(fe,Fe){return fe.x-Fe.x}function L(fe,Fe){var me=_e(fe,Fe);if(!me)return Fe;var bt=Ve(me,fe),vt=U(me,me.next);return U(bt,bt.next),Fe===me?vt:Fe}function _e(fe,Fe){var me=Fe,bt=fe.x,vt=fe.y,Zt=-Infinity,Ut;do{if(vt<=me.y&&vt>=me.next.y&&me.next.y!==me.y){var Rr=me.x+(vt-me.y)*(me.next.x-me.x)/(me.next.y-me.y);if(Rr<=bt&&Rr>Zt){if(Zt=Rr,Rr===bt){if(vt===me.y)return me;if(vt===me.next.y)return me.next}Ut=me.x<me.next.x?me:me.next}}me=me.next}while(me!==Fe);if(!Ut)return null;if(bt===Zt)return Ut;var ln=Ut,pn=Ut.x,Vi=Ut.y,ar=Infinity,pe;me=Ut;do bt>=me.x&&me.x>=pn&&bt!==me.x&&zt(vt<Vi?bt:Zt,vt,pn,Vi,vt<Vi?Zt:bt,vt,me.x,me.y)&&(pe=Math.abs(vt-me.y)/(bt-me.x),Je(me,fe)&&(pe<ar||pe===ar&&(me.x>Ut.x||me.x===Ut.x&&xe(Ut,me)))&&(Ut=me,ar=pe)),me=me.next;while(me!==ln);return Ut}function xe(fe,Fe){return Et(fe.prev,fe,Fe.prev)<0&&Et(Fe.next,fe,fe.next)<0}function Re(fe,Fe,me,bt){var vt=fe;do vt.z===null&&(vt.z=Rt(vt.x,vt.y,Fe,me,bt)),vt.prevZ=vt.prev,vt.nextZ=vt.next,vt=vt.next;while(vt!==fe);vt.prevZ.nextZ=null,vt.prevZ=null,$e(vt)}function $e(fe){var Fe,me,bt,vt,Zt,Ut,Rr,ln,pn=1;do{for(me=fe,fe=null,Zt=null,Ut=0;me;){for(Ut++,bt=me,Rr=0,Fe=0;Fe<pn&&(Rr++,bt=bt.nextZ,!!bt);Fe++);for(ln=pn;Rr>0||ln>0&&bt;)Rr!==0&&(ln===0||!bt||me.z<=bt.z)?(vt=me,me=me.nextZ,Rr--):(vt=bt,bt=bt.nextZ,ln--),Zt?Zt.nextZ=vt:fe=vt,vt.prevZ=Zt,Zt=vt;me=bt}Zt.nextZ=null,pn*=2}while(Ut>1);return fe}function Rt(fe,Fe,me,bt,vt){return fe=32767*(fe-me)*vt,Fe=32767*(Fe-bt)*vt,fe=(fe|fe<<8)&16711935,fe=(fe|fe<<4)&252645135,fe=(fe|fe<<2)&858993459,fe=(fe|fe<<1)&1431655765,Fe=(Fe|Fe<<8)&16711935,Fe=(Fe|Fe<<4)&252645135,Fe=(Fe|Fe<<2)&858993459,Fe=(Fe|Fe<<1)&1431655765,fe|Fe<<1}function Lt(fe){var Fe=fe,me=fe;do(Fe.x<me.x||Fe.x===me.x&&Fe.y<me.y)&&(me=Fe),Fe=Fe.next;while(Fe!==fe);return me}function zt(fe,Fe,me,bt,vt,Zt,Ut,Rr){return(vt-Ut)*(Fe-Rr)-(fe-Ut)*(Zt-Rr)>=0&&(fe-Ut)*(bt-Rr)-(me-Ut)*(Fe-Rr)>=0&&(me-Ut)*(Zt-Rr)-(vt-Ut)*(bt-Rr)>=0}function St(fe,Fe){return fe.next.i!==Fe.i&&fe.prev.i!==Fe.i&&!At(fe,Fe)&&(Je(fe,Fe)&&Je(Fe,fe)&&Pt(fe,Fe)&&(Et(fe.prev,fe,Fe.prev)||Et(fe,Fe.prev,Fe))||at(fe,Fe)&&Et(fe.prev,fe,fe.next)>0&&Et(Fe.prev,Fe,Fe.next)>0)}function Et(fe,Fe,me){return(Fe.y-fe.y)*(me.x-Fe.x)-(Fe.x-fe.x)*(me.y-Fe.y)}function at(fe,Fe){return fe.x===Fe.x&&fe.y===Fe.y}function ur(fe,Fe,me,bt){var vt=fr(Et(fe,Fe,me)),Zt=fr(Et(fe,Fe,bt)),Ut=fr(Et(me,bt,fe)),Rr=fr(Et(me,bt,Fe));return!!(vt!==Zt&&Ut!==Rr||vt===0&&ee(fe,me,Fe)||Zt===0&&ee(fe,bt,Fe)||Ut===0&&ee(me,fe,bt)||Rr===0&&ee(me,Fe,bt))}function ee(fe,Fe,me){return Fe.x<=Math.max(fe.x,me.x)&&Fe.x>=Math.min(fe.x,me.x)&&Fe.y<=Math.max(fe.y,me.y)&&Fe.y>=Math.min(fe.y,me.y)}function fr(fe){return fe>0?1:fe<0?-1:0}function At(fe,Fe){var me=fe;do{if(me.i!==fe.i&&me.next.i!==fe.i&&me.i!==Fe.i&&me.next.i!==Fe.i&&ur(me,me.next,fe,Fe))return!0;me=me.next}while(me!==fe);return!1}function Je(fe,Fe){return Et(fe.prev,fe,fe.next)<0?Et(fe,Fe,fe.next)>=0&&Et(fe,fe.prev,Fe)>=0:Et(fe,Fe,fe.prev)<0||Et(fe,fe.next,Fe)<0}function Pt(fe,Fe){var me=fe,bt=!1,vt=(fe.x+Fe.x)/2,Zt=(fe.y+Fe.y)/2;do me.y>Zt!=me.next.y>Zt&&me.next.y!==me.y&&vt<(me.next.x-me.x)*(Zt-me.y)/(me.next.y-me.y)+me.x&&(bt=!bt),me=me.next;while(me!==fe);return bt}function Ve(fe,Fe){var me=new Jt(fe.i,fe.x,fe.y),bt=new Jt(Fe.i,Fe.x,Fe.y),vt=fe.next,Zt=Fe.prev;return fe.next=Fe,Fe.prev=fe,me.next=vt,vt.prev=me,bt.next=me,me.prev=bt,Zt.next=bt,bt.prev=Zt,bt}function It(fe,Fe,me,bt){var vt=new Jt(fe,Fe,me);return bt?(vt.next=bt.next,vt.prev=bt,bt.next.prev=vt,bt.next=vt):(vt.prev=vt,vt.next=vt),vt}function hr(fe){fe.next.prev=fe.prev,fe.prev.next=fe.next,fe.prevZ&&(fe.prevZ.nextZ=fe.nextZ),fe.nextZ&&(fe.nextZ.prevZ=fe.prevZ)}function Jt(fe,Fe,me){this.i=fe,this.x=Fe,this.y=me,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}D.deviation=function(fe,Fe,me,bt){var vt=Fe&&Fe.length,Zt=vt?Fe[0]*me:fe.length,Ut=Math.abs(Fr(fe,0,Zt,me));if(vt)for(var Rr=0,ln=Fe.length;Rr<ln;Rr++){var pn=Fe[Rr]*me,Vi=Rr<ln-1?Fe[Rr+1]*me:fe.length;Ut-=Math.abs(Fr(fe,pn,Vi,me))}var ar=0;for(Rr=0;Rr<bt.length;Rr+=3){var pe=bt[Rr]*me,Pe=bt[Rr+1]*me,Ge=bt[Rr+2]*me;ar+=Math.abs((fe[pe]-fe[Ge])*(fe[Pe+1]-fe[pe+1])-(fe[pe]-fe[Pe])*(fe[Ge+1]-fe[pe+1]))}return Ut===0&&ar===0?0:Math.abs((ar-Ut)/Ut)};function Fr(fe,Fe,me,bt){for(var vt=0,Zt=Fe,Ut=me-bt;Zt<me;Zt+=bt)vt+=(fe[Ut]-fe[Zt])*(fe[Zt+1]+fe[Ut+1]),Ut=Zt;return vt}D.flatten=function(fe){for(var Fe=fe[0][0].length,me={vertices:[],holes:[],dimensions:Fe},bt=0,vt=0;vt<fe.length;vt++){for(var Zt=0;Zt<fe[vt].length;Zt++)for(var Ut=0;Ut<Fe;Ut++)me.vertices.push(fe[vt][Zt][Ut]);vt>0&&(bt+=fe[vt-1].length,me.holes.push(bt))}return me}},67709:function(Qe){function D(U){var b=U.target||U.srcElement;b.__resizeRAF__&&cancelAnimationFrame(b.__resizeRAF__),b.__resizeRAF__=requestAnimationFrame(function(){var p=b.__resizeTrigger__,E=p&&p.__resizeListeners__;E&&E.forEach(function(Z){Z.call(p,U)})})}var g=function(b,p){var E=this,Z=E.document,V,H=Z.attachEvent;typeof navigator!="undefined"&&(V=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function I(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",D)}if(!b.__resizeListeners__)if(b.__resizeListeners__=[],H)b.__resizeTrigger__=b,b.attachEvent("onresize",D);else{getComputedStyle(b).position==="static"&&(b.style.position="relative");var L=b.__resizeTrigger__=Z.createElement("object");L.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),L.setAttribute("class","resize-sensor"),L.setAttribute("tabindex","-1"),L.setAttribute("title",""),L.__resizeElement__=b,L.onload=I,L.type="text/html",V&&b.appendChild(L),L.data="about:blank",V||b.appendChild(L)}b.__resizeListeners__.push(p)};Qe.exports=typeof window=="undefined"?g:g.bind(window),Qe.exports.unbind=function(U,b){var p=document.attachEvent,E=U.__resizeListeners__||[];if(b){var Z=E.indexOf(b);Z!==-1&&E.splice(Z,1)}else E=U.__resizeListeners__=[];if(!E.length){if(p)U.detachEvent("onresize",D);else if(U.__resizeTrigger__){var V=U.__resizeTrigger__.contentDocument,H=V&&V.defaultView;H&&(H.removeEventListener("resize",D),delete H.__resizeTrigger__),U.__resizeTrigger__=!U.removeChild(U.__resizeTrigger__)}delete U.__resizeListeners__}}},26729:function(Qe){"use strict";var D=Object.prototype.hasOwnProperty,g="~";function U(){}Object.create&&(U.prototype=Object.create(null),new U().__proto__||(g=!1));function b(V,H,I){this.fn=V,this.context=H,this.once=I||!1}function p(V,H,I,L,_e){if(typeof I!="function")throw new TypeError("The listener must be a function");var xe=new b(I,L||V,_e),Re=g?g+H:H;return V._events[Re]?V._events[Re].fn?V._events[Re]=[V._events[Re],xe]:V._events[Re].push(xe):(V._events[Re]=xe,V._eventsCount++),V}function E(V,H){--V._eventsCount==0?V._events=new U:delete V._events[H]}function Z(){this._events=new U,this._eventsCount=0}Z.prototype.eventNames=function(){var H=[],I,L;if(this._eventsCount===0)return H;for(L in I=this._events)D.call(I,L)&&H.push(g?L.slice(1):L);return Object.getOwnPropertySymbols?H.concat(Object.getOwnPropertySymbols(I)):H},Z.prototype.listeners=function(H){var I=g?g+H:H,L=this._events[I];if(!L)return[];if(L.fn)return[L.fn];for(var _e=0,xe=L.length,Re=new Array(xe);_e<xe;_e++)Re[_e]=L[_e].fn;return Re},Z.prototype.listenerCount=function(H){var I=g?g+H:H,L=this._events[I];return L?L.fn?1:L.length:0},Z.prototype.emit=function(H,I,L,_e,xe,Re){var $e=g?g+H:H;if(!this._events[$e])return!1;var Rt=this._events[$e],Lt=arguments.length,zt,St;if(Rt.fn){switch(Rt.once&&this.removeListener(H,Rt.fn,void 0,!0),Lt){case 1:return Rt.fn.call(Rt.context),!0;case 2:return Rt.fn.call(Rt.context,I),!0;case 3:return Rt.fn.call(Rt.context,I,L),!0;case 4:return Rt.fn.call(Rt.context,I,L,_e),!0;case 5:return Rt.fn.call(Rt.context,I,L,_e,xe),!0;case 6:return Rt.fn.call(Rt.context,I,L,_e,xe,Re),!0}for(St=1,zt=new Array(Lt-1);St<Lt;St++)zt[St-1]=arguments[St];Rt.fn.apply(Rt.context,zt)}else{var Et=Rt.length,at;for(St=0;St<Et;St++)switch(Rt[St].once&&this.removeListener(H,Rt[St].fn,void 0,!0),Lt){case 1:Rt[St].fn.call(Rt[St].context);break;case 2:Rt[St].fn.call(Rt[St].context,I);break;case 3:Rt[St].fn.call(Rt[St].context,I,L);break;case 4:Rt[St].fn.call(Rt[St].context,I,L,_e);break;default:if(!zt)for(at=1,zt=new Array(Lt-1);at<Lt;at++)zt[at-1]=arguments[at];Rt[St].fn.apply(Rt[St].context,zt)}}return!0},Z.prototype.on=function(H,I,L){return p(this,H,I,L,!1)},Z.prototype.once=function(H,I,L){return p(this,H,I,L,!0)},Z.prototype.removeListener=function(H,I,L,_e){var xe=g?g+H:H;if(!this._events[xe])return this;if(!I)return E(this,xe),this;var Re=this._events[xe];if(Re.fn)Re.fn===I&&(!_e||Re.once)&&(!L||Re.context===L)&&E(this,xe);else{for(var $e=0,Rt=[],Lt=Re.length;$e<Lt;$e++)(Re[$e].fn!==I||_e&&!Re[$e].once||L&&Re[$e].context!==L)&&Rt.push(Re[$e]);Rt.length?this._events[xe]=Rt.length===1?Rt[0]:Rt:E(this,xe)}return this},Z.prototype.removeAllListeners=function(H){var I;return H?(I=g?g+H:H,this._events[I]&&E(this,I)):(this._events=new U,this._eventsCount=0),this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.addListener=Z.prototype.on,Z.prefixed=g,Z.EventEmitter=Z,Qe.exports=Z},85975:function(Qe,D,g){"use strict";g.r(D),g.d(D,{create:function(){return b},clone:function(){return p},copy:function(){return E},fromValues:function(){return Z},set:function(){return V},identity:function(){return H},transpose:function(){return I},invert:function(){return L},adjoint:function(){return _e},determinant:function(){return xe},multiply:function(){return Re},translate:function(){return $e},scale:function(){return Rt},rotate:function(){return Lt},rotateX:function(){return zt},rotateY:function(){return St},rotateZ:function(){return Et},fromTranslation:function(){return at},fromScaling:function(){return ur},fromRotation:function(){return ee},fromXRotation:function(){return fr},fromYRotation:function(){return At},fromZRotation:function(){return Je},fromRotationTranslation:function(){return Pt},fromQuat2:function(){return Ve},getTranslation:function(){return It},getScaling:function(){return hr},getRotation:function(){return Jt},fromRotationTranslationScale:function(){return Fr},fromRotationTranslationScaleOrigin:function(){return fe},fromQuat:function(){return Fe},frustum:function(){return me},perspective:function(){return bt},perspectiveFromFieldOfView:function(){return vt},ortho:function(){return Zt},lookAt:function(){return Ut},targetTo:function(){return Rr},str:function(){return ln},frob:function(){return pn},add:function(){return Vi},subtract:function(){return ar},multiplyScalar:function(){return pe},multiplyScalarAndAdd:function(){return Pe},exactEquals:function(){return Ge},equals:function(){return ke},mul:function(){return Ft},sub:function(){return ir}});var U=g(49685);function b(){var T=new U.WT(16);return U.WT!=Float32Array&&(T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[11]=0,T[12]=0,T[13]=0,T[14]=0),T[0]=1,T[5]=1,T[10]=1,T[15]=1,T}function p(T){var G=new U.WT(16);return G[0]=T[0],G[1]=T[1],G[2]=T[2],G[3]=T[3],G[4]=T[4],G[5]=T[5],G[6]=T[6],G[7]=T[7],G[8]=T[8],G[9]=T[9],G[10]=T[10],G[11]=T[11],G[12]=T[12],G[13]=T[13],G[14]=T[14],G[15]=T[15],G}function E(T,G){return T[0]=G[0],T[1]=G[1],T[2]=G[2],T[3]=G[3],T[4]=G[4],T[5]=G[5],T[6]=G[6],T[7]=G[7],T[8]=G[8],T[9]=G[9],T[10]=G[10],T[11]=G[11],T[12]=G[12],T[13]=G[13],T[14]=G[14],T[15]=G[15],T}function Z(T,G,Se,Be,et,tt,Ct,jt,Mt,Qt,ne,Kt,Dr,Mr,nt,xt){var ht=new U.WT(16);return ht[0]=T,ht[1]=G,ht[2]=Se,ht[3]=Be,ht[4]=et,ht[5]=tt,ht[6]=Ct,ht[7]=jt,ht[8]=Mt,ht[9]=Qt,ht[10]=ne,ht[11]=Kt,ht[12]=Dr,ht[13]=Mr,ht[14]=nt,ht[15]=xt,ht}function V(T,G,Se,Be,et,tt,Ct,jt,Mt,Qt,ne,Kt,Dr,Mr,nt,xt,ht){return T[0]=G,T[1]=Se,T[2]=Be,T[3]=et,T[4]=tt,T[5]=Ct,T[6]=jt,T[7]=Mt,T[8]=Qt,T[9]=ne,T[10]=Kt,T[11]=Dr,T[12]=Mr,T[13]=nt,T[14]=xt,T[15]=ht,T}function H(T){return T[0]=1,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=1,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=1,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}function I(T,G){if(T===G){var Se=G[1],Be=G[2],et=G[3],tt=G[6],Ct=G[7],jt=G[11];T[1]=G[4],T[2]=G[8],T[3]=G[12],T[4]=Se,T[6]=G[9],T[7]=G[13],T[8]=Be,T[9]=tt,T[11]=G[14],T[12]=et,T[13]=Ct,T[14]=jt}else T[0]=G[0],T[1]=G[4],T[2]=G[8],T[3]=G[12],T[4]=G[1],T[5]=G[5],T[6]=G[9],T[7]=G[13],T[8]=G[2],T[9]=G[6],T[10]=G[10],T[11]=G[14],T[12]=G[3],T[13]=G[7],T[14]=G[11],T[15]=G[15];return T}function L(T,G){var Se=G[0],Be=G[1],et=G[2],tt=G[3],Ct=G[4],jt=G[5],Mt=G[6],Qt=G[7],ne=G[8],Kt=G[9],Dr=G[10],Mr=G[11],nt=G[12],xt=G[13],ht=G[14],vr=G[15],Zr=Se*jt-Be*Ct,Ur=Se*Mt-et*Ct,tn=Se*Qt-tt*Ct,jr=Be*Mt-et*jt,wr=Be*Qt-tt*jt,Dn=et*Qt-tt*Mt,Zn=ne*xt-Kt*nt,bi=ne*ht-Dr*nt,Hi=ne*vr-Mr*nt,qi=Kt*ht-Dr*xt,ki=Kt*vr-Mr*xt,Oi=Dr*vr-Mr*ht,$=Zr*Oi-Ur*ki+tn*qi+jr*Hi-wr*bi+Dn*Zn;return $?($=1/$,T[0]=(jt*Oi-Mt*ki+Qt*qi)*$,T[1]=(et*ki-Be*Oi-tt*qi)*$,T[2]=(xt*Dn-ht*wr+vr*jr)*$,T[3]=(Dr*wr-Kt*Dn-Mr*jr)*$,T[4]=(Mt*Hi-Ct*Oi-Qt*bi)*$,T[5]=(Se*Oi-et*Hi+tt*bi)*$,T[6]=(ht*tn-nt*Dn-vr*Ur)*$,T[7]=(ne*Dn-Dr*tn+Mr*Ur)*$,T[8]=(Ct*ki-jt*Hi+Qt*Zn)*$,T[9]=(Be*Hi-Se*ki-tt*Zn)*$,T[10]=(nt*wr-xt*tn+vr*Zr)*$,T[11]=(Kt*tn-ne*wr-Mr*Zr)*$,T[12]=(jt*bi-Ct*qi-Mt*Zn)*$,T[13]=(Se*qi-Be*bi+et*Zn)*$,T[14]=(xt*Ur-nt*jr-ht*Zr)*$,T[15]=(ne*jr-Kt*Ur+Dr*Zr)*$,T):null}function _e(T,G){var Se=G[0],Be=G[1],et=G[2],tt=G[3],Ct=G[4],jt=G[5],Mt=G[6],Qt=G[7],ne=G[8],Kt=G[9],Dr=G[10],Mr=G[11],nt=G[12],xt=G[13],ht=G[14],vr=G[15];return T[0]=jt*(Dr*vr-Mr*ht)-Kt*(Mt*vr-Qt*ht)+xt*(Mt*Mr-Qt*Dr),T[1]=-(Be*(Dr*vr-Mr*ht)-Kt*(et*vr-tt*ht)+xt*(et*Mr-tt*Dr)),T[2]=Be*(Mt*vr-Qt*ht)-jt*(et*vr-tt*ht)+xt*(et*Qt-tt*Mt),T[3]=-(Be*(Mt*Mr-Qt*Dr)-jt*(et*Mr-tt*Dr)+Kt*(et*Qt-tt*Mt)),T[4]=-(Ct*(Dr*vr-Mr*ht)-ne*(Mt*vr-Qt*ht)+nt*(Mt*Mr-Qt*Dr)),T[5]=Se*(Dr*vr-Mr*ht)-ne*(et*vr-tt*ht)+nt*(et*Mr-tt*Dr),T[6]=-(Se*(Mt*vr-Qt*ht)-Ct*(et*vr-tt*ht)+nt*(et*Qt-tt*Mt)),T[7]=Se*(Mt*Mr-Qt*Dr)-Ct*(et*Mr-tt*Dr)+ne*(et*Qt-tt*Mt),T[8]=Ct*(Kt*vr-Mr*xt)-ne*(jt*vr-Qt*xt)+nt*(jt*Mr-Qt*Kt),T[9]=-(Se*(Kt*vr-Mr*xt)-ne*(Be*vr-tt*xt)+nt*(Be*Mr-tt*Kt)),T[10]=Se*(jt*vr-Qt*xt)-Ct*(Be*vr-tt*xt)+nt*(Be*Qt-tt*jt),T[11]=-(Se*(jt*Mr-Qt*Kt)-Ct*(Be*Mr-tt*Kt)+ne*(Be*Qt-tt*jt)),T[12]=-(Ct*(Kt*ht-Dr*xt)-ne*(jt*ht-Mt*xt)+nt*(jt*Dr-Mt*Kt)),T[13]=Se*(Kt*ht-Dr*xt)-ne*(Be*ht-et*xt)+nt*(Be*Dr-et*Kt),T[14]=-(Se*(jt*ht-Mt*xt)-Ct*(Be*ht-et*xt)+nt*(Be*Mt-et*jt)),T[15]=Se*(jt*Dr-Mt*Kt)-Ct*(Be*Dr-et*Kt)+ne*(Be*Mt-et*jt),T}function xe(T){var G=T[0],Se=T[1],Be=T[2],et=T[3],tt=T[4],Ct=T[5],jt=T[6],Mt=T[7],Qt=T[8],ne=T[9],Kt=T[10],Dr=T[11],Mr=T[12],nt=T[13],xt=T[14],ht=T[15],vr=G*Ct-Se*tt,Zr=G*jt-Be*tt,Ur=G*Mt-et*tt,tn=Se*jt-Be*Ct,jr=Se*Mt-et*Ct,wr=Be*Mt-et*jt,Dn=Qt*nt-ne*Mr,Zn=Qt*xt-Kt*Mr,bi=Qt*ht-Dr*Mr,Hi=ne*xt-Kt*nt,qi=ne*ht-Dr*nt,ki=Kt*ht-Dr*xt;return vr*ki-Zr*qi+Ur*Hi+tn*bi-jr*Zn+wr*Dn}function Re(T,G,Se){var Be=G[0],et=G[1],tt=G[2],Ct=G[3],jt=G[4],Mt=G[5],Qt=G[6],ne=G[7],Kt=G[8],Dr=G[9],Mr=G[10],nt=G[11],xt=G[12],ht=G[13],vr=G[14],Zr=G[15],Ur=Se[0],tn=Se[1],jr=Se[2],wr=Se[3];return T[0]=Ur*Be+tn*jt+jr*Kt+wr*xt,T[1]=Ur*et+tn*Mt+jr*Dr+wr*ht,T[2]=Ur*tt+tn*Qt+jr*Mr+wr*vr,T[3]=Ur*Ct+tn*ne+jr*nt+wr*Zr,Ur=Se[4],tn=Se[5],jr=Se[6],wr=Se[7],T[4]=Ur*Be+tn*jt+jr*Kt+wr*xt,T[5]=Ur*et+tn*Mt+jr*Dr+wr*ht,T[6]=Ur*tt+tn*Qt+jr*Mr+wr*vr,T[7]=Ur*Ct+tn*ne+jr*nt+wr*Zr,Ur=Se[8],tn=Se[9],jr=Se[10],wr=Se[11],T[8]=Ur*Be+tn*jt+jr*Kt+wr*xt,T[9]=Ur*et+tn*Mt+jr*Dr+wr*ht,T[10]=Ur*tt+tn*Qt+jr*Mr+wr*vr,T[11]=Ur*Ct+tn*ne+jr*nt+wr*Zr,Ur=Se[12],tn=Se[13],jr=Se[14],wr=Se[15],T[12]=Ur*Be+tn*jt+jr*Kt+wr*xt,T[13]=Ur*et+tn*Mt+jr*Dr+wr*ht,T[14]=Ur*tt+tn*Qt+jr*Mr+wr*vr,T[15]=Ur*Ct+tn*ne+jr*nt+wr*Zr,T}function $e(T,G,Se){var Be=Se[0],et=Se[1],tt=Se[2],Ct,jt,Mt,Qt,ne,Kt,Dr,Mr,nt,xt,ht,vr;return G===T?(T[12]=G[0]*Be+G[4]*et+G[8]*tt+G[12],T[13]=G[1]*Be+G[5]*et+G[9]*tt+G[13],T[14]=G[2]*Be+G[6]*et+G[10]*tt+G[14],T[15]=G[3]*Be+G[7]*et+G[11]*tt+G[15]):(Ct=G[0],jt=G[1],Mt=G[2],Qt=G[3],ne=G[4],Kt=G[5],Dr=G[6],Mr=G[7],nt=G[8],xt=G[9],ht=G[10],vr=G[11],T[0]=Ct,T[1]=jt,T[2]=Mt,T[3]=Qt,T[4]=ne,T[5]=Kt,T[6]=Dr,T[7]=Mr,T[8]=nt,T[9]=xt,T[10]=ht,T[11]=vr,T[12]=Ct*Be+ne*et+nt*tt+G[12],T[13]=jt*Be+Kt*et+xt*tt+G[13],T[14]=Mt*Be+Dr*et+ht*tt+G[14],T[15]=Qt*Be+Mr*et+vr*tt+G[15]),T}function Rt(T,G,Se){var Be=Se[0],et=Se[1],tt=Se[2];return T[0]=G[0]*Be,T[1]=G[1]*Be,T[2]=G[2]*Be,T[3]=G[3]*Be,T[4]=G[4]*et,T[5]=G[5]*et,T[6]=G[6]*et,T[7]=G[7]*et,T[8]=G[8]*tt,T[9]=G[9]*tt,T[10]=G[10]*tt,T[11]=G[11]*tt,T[12]=G[12],T[13]=G[13],T[14]=G[14],T[15]=G[15],T}function Lt(T,G,Se,Be){var et=Be[0],tt=Be[1],Ct=Be[2],jt=Math.hypot(et,tt,Ct),Mt,Qt,ne,Kt,Dr,Mr,nt,xt,ht,vr,Zr,Ur,tn,jr,wr,Dn,Zn,bi,Hi,qi,ki,Oi,$,ce;return jt<U.Ib?null:(jt=1/jt,et*=jt,tt*=jt,Ct*=jt,Mt=Math.sin(Se),Qt=Math.cos(Se),ne=1-Qt,Kt=G[0],Dr=G[1],Mr=G[2],nt=G[3],xt=G[4],ht=G[5],vr=G[6],Zr=G[7],Ur=G[8],tn=G[9],jr=G[10],wr=G[11],Dn=et*et*ne+Qt,Zn=tt*et*ne+Ct*Mt,bi=Ct*et*ne-tt*Mt,Hi=et*tt*ne-Ct*Mt,qi=tt*tt*ne+Qt,ki=Ct*tt*ne+et*Mt,Oi=et*Ct*ne+tt*Mt,$=tt*Ct*ne-et*Mt,ce=Ct*Ct*ne+Qt,T[0]=Kt*Dn+xt*Zn+Ur*bi,T[1]=Dr*Dn+ht*Zn+tn*bi,T[2]=Mr*Dn+vr*Zn+jr*bi,T[3]=nt*Dn+Zr*Zn+wr*bi,T[4]=Kt*Hi+xt*qi+Ur*ki,T[5]=Dr*Hi+ht*qi+tn*ki,T[6]=Mr*Hi+vr*qi+jr*ki,T[7]=nt*Hi+Zr*qi+wr*ki,T[8]=Kt*Oi+xt*$+Ur*ce,T[9]=Dr*Oi+ht*$+tn*ce,T[10]=Mr*Oi+vr*$+jr*ce,T[11]=nt*Oi+Zr*$+wr*ce,G!==T&&(T[12]=G[12],T[13]=G[13],T[14]=G[14],T[15]=G[15]),T)}function zt(T,G,Se){var Be=Math.sin(Se),et=Math.cos(Se),tt=G[4],Ct=G[5],jt=G[6],Mt=G[7],Qt=G[8],ne=G[9],Kt=G[10],Dr=G[11];return G!==T&&(T[0]=G[0],T[1]=G[1],T[2]=G[2],T[3]=G[3],T[12]=G[12],T[13]=G[13],T[14]=G[14],T[15]=G[15]),T[4]=tt*et+Qt*Be,T[5]=Ct*et+ne*Be,T[6]=jt*et+Kt*Be,T[7]=Mt*et+Dr*Be,T[8]=Qt*et-tt*Be,T[9]=ne*et-Ct*Be,T[10]=Kt*et-jt*Be,T[11]=Dr*et-Mt*Be,T}function St(T,G,Se){var Be=Math.sin(Se),et=Math.cos(Se),tt=G[0],Ct=G[1],jt=G[2],Mt=G[3],Qt=G[8],ne=G[9],Kt=G[10],Dr=G[11];return G!==T&&(T[4]=G[4],T[5]=G[5],T[6]=G[6],T[7]=G[7],T[12]=G[12],T[13]=G[13],T[14]=G[14],T[15]=G[15]),T[0]=tt*et-Qt*Be,T[1]=Ct*et-ne*Be,T[2]=jt*et-Kt*Be,T[3]=Mt*et-Dr*Be,T[8]=tt*Be+Qt*et,T[9]=Ct*Be+ne*et,T[10]=jt*Be+Kt*et,T[11]=Mt*Be+Dr*et,T}function Et(T,G,Se){var Be=Math.sin(Se),et=Math.cos(Se),tt=G[0],Ct=G[1],jt=G[2],Mt=G[3],Qt=G[4],ne=G[5],Kt=G[6],Dr=G[7];return G!==T&&(T[8]=G[8],T[9]=G[9],T[10]=G[10],T[11]=G[11],T[12]=G[12],T[13]=G[13],T[14]=G[14],T[15]=G[15]),T[0]=tt*et+Qt*Be,T[1]=Ct*et+ne*Be,T[2]=jt*et+Kt*Be,T[3]=Mt*et+Dr*Be,T[4]=Qt*et-tt*Be,T[5]=ne*et-Ct*Be,T[6]=Kt*et-jt*Be,T[7]=Dr*et-Mt*Be,T}function at(T,G){return T[0]=1,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=1,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=1,T[11]=0,T[12]=G[0],T[13]=G[1],T[14]=G[2],T[15]=1,T}function ur(T,G){return T[0]=G[0],T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=G[1],T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=G[2],T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}function ee(T,G,Se){var Be=Se[0],et=Se[1],tt=Se[2],Ct=Math.hypot(Be,et,tt),jt,Mt,Qt;return Ct<U.Ib?null:(Ct=1/Ct,Be*=Ct,et*=Ct,tt*=Ct,jt=Math.sin(G),Mt=Math.cos(G),Qt=1-Mt,T[0]=Be*Be*Qt+Mt,T[1]=et*Be*Qt+tt*jt,T[2]=tt*Be*Qt-et*jt,T[3]=0,T[4]=Be*et*Qt-tt*jt,T[5]=et*et*Qt+Mt,T[6]=tt*et*Qt+Be*jt,T[7]=0,T[8]=Be*tt*Qt+et*jt,T[9]=et*tt*Qt-Be*jt,T[10]=tt*tt*Qt+Mt,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T)}function fr(T,G){var Se=Math.sin(G),Be=Math.cos(G);return T[0]=1,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=Be,T[6]=Se,T[7]=0,T[8]=0,T[9]=-Se,T[10]=Be,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}function At(T,G){var Se=Math.sin(G),Be=Math.cos(G);return T[0]=Be,T[1]=0,T[2]=-Se,T[3]=0,T[4]=0,T[5]=1,T[6]=0,T[7]=0,T[8]=Se,T[9]=0,T[10]=Be,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}function Je(T,G){var Se=Math.sin(G),Be=Math.cos(G);return T[0]=Be,T[1]=Se,T[2]=0,T[3]=0,T[4]=-Se,T[5]=Be,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=1,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}function Pt(T,G,Se){var Be=G[0],et=G[1],tt=G[2],Ct=G[3],jt=Be+Be,Mt=et+et,Qt=tt+tt,ne=Be*jt,Kt=Be*Mt,Dr=Be*Qt,Mr=et*Mt,nt=et*Qt,xt=tt*Qt,ht=Ct*jt,vr=Ct*Mt,Zr=Ct*Qt;return T[0]=1-(Mr+xt),T[1]=Kt+Zr,T[2]=Dr-vr,T[3]=0,T[4]=Kt-Zr,T[5]=1-(ne+xt),T[6]=nt+ht,T[7]=0,T[8]=Dr+vr,T[9]=nt-ht,T[10]=1-(ne+Mr),T[11]=0,T[12]=Se[0],T[13]=Se[1],T[14]=Se[2],T[15]=1,T}function Ve(T,G){var Se=new U.WT(3),Be=-G[0],et=-G[1],tt=-G[2],Ct=G[3],jt=G[4],Mt=G[5],Qt=G[6],ne=G[7],Kt=Be*Be+et*et+tt*tt+Ct*Ct;return Kt>0?(Se[0]=(jt*Ct+ne*Be+Mt*tt-Qt*et)*2/Kt,Se[1]=(Mt*Ct+ne*et+Qt*Be-jt*tt)*2/Kt,Se[2]=(Qt*Ct+ne*tt+jt*et-Mt*Be)*2/Kt):(Se[0]=(jt*Ct+ne*Be+Mt*tt-Qt*et)*2,Se[1]=(Mt*Ct+ne*et+Qt*Be-jt*tt)*2,Se[2]=(Qt*Ct+ne*tt+jt*et-Mt*Be)*2),Pt(T,G,Se),T}function It(T,G){return T[0]=G[12],T[1]=G[13],T[2]=G[14],T}function hr(T,G){var Se=G[0],Be=G[1],et=G[2],tt=G[4],Ct=G[5],jt=G[6],Mt=G[8],Qt=G[9],ne=G[10];return T[0]=Math.hypot(Se,Be,et),T[1]=Math.hypot(tt,Ct,jt),T[2]=Math.hypot(Mt,Qt,ne),T}function Jt(T,G){var Se=new U.WT(3);hr(Se,G);var Be=1/Se[0],et=1/Se[1],tt=1/Se[2],Ct=G[0]*Be,jt=G[1]*et,Mt=G[2]*tt,Qt=G[4]*Be,ne=G[5]*et,Kt=G[6]*tt,Dr=G[8]*Be,Mr=G[9]*et,nt=G[10]*tt,xt=Ct+ne+nt,ht=0;return xt>0?(ht=Math.sqrt(xt+1)*2,T[3]=.25*ht,T[0]=(Kt-Mr)/ht,T[1]=(Dr-Mt)/ht,T[2]=(jt-Qt)/ht):Ct>ne&&Ct>nt?(ht=Math.sqrt(1+Ct-ne-nt)*2,T[3]=(Kt-Mr)/ht,T[0]=.25*ht,T[1]=(jt+Qt)/ht,T[2]=(Dr+Mt)/ht):ne>nt?(ht=Math.sqrt(1+ne-Ct-nt)*2,T[3]=(Dr-Mt)/ht,T[0]=(jt+Qt)/ht,T[1]=.25*ht,T[2]=(Kt+Mr)/ht):(ht=Math.sqrt(1+nt-Ct-ne)*2,T[3]=(jt-Qt)/ht,T[0]=(Dr+Mt)/ht,T[1]=(Kt+Mr)/ht,T[2]=.25*ht),T}function Fr(T,G,Se,Be){var et=G[0],tt=G[1],Ct=G[2],jt=G[3],Mt=et+et,Qt=tt+tt,ne=Ct+Ct,Kt=et*Mt,Dr=et*Qt,Mr=et*ne,nt=tt*Qt,xt=tt*ne,ht=Ct*ne,vr=jt*Mt,Zr=jt*Qt,Ur=jt*ne,tn=Be[0],jr=Be[1],wr=Be[2];return T[0]=(1-(nt+ht))*tn,T[1]=(Dr+Ur)*tn,T[2]=(Mr-Zr)*tn,T[3]=0,T[4]=(Dr-Ur)*jr,T[5]=(1-(Kt+ht))*jr,T[6]=(xt+vr)*jr,T[7]=0,T[8]=(Mr+Zr)*wr,T[9]=(xt-vr)*wr,T[10]=(1-(Kt+nt))*wr,T[11]=0,T[12]=Se[0],T[13]=Se[1],T[14]=Se[2],T[15]=1,T}function fe(T,G,Se,Be,et){var tt=G[0],Ct=G[1],jt=G[2],Mt=G[3],Qt=tt+tt,ne=Ct+Ct,Kt=jt+jt,Dr=tt*Qt,Mr=tt*ne,nt=tt*Kt,xt=Ct*ne,ht=Ct*Kt,vr=jt*Kt,Zr=Mt*Qt,Ur=Mt*ne,tn=Mt*Kt,jr=Be[0],wr=Be[1],Dn=Be[2],Zn=et[0],bi=et[1],Hi=et[2],qi=(1-(xt+vr))*jr,ki=(Mr+tn)*jr,Oi=(nt-Ur)*jr,$=(Mr-tn)*wr,ce=(1-(Dr+vr))*wr,ve=(ht+Zr)*wr,j=(nt+Ur)*Dn,se=(ht-Zr)*Dn,de=(1-(Dr+xt))*Dn;return T[0]=qi,T[1]=ki,T[2]=Oi,T[3]=0,T[4]=$,T[5]=ce,T[6]=ve,T[7]=0,T[8]=j,T[9]=se,T[10]=de,T[11]=0,T[12]=Se[0]+Zn-(qi*Zn+$*bi+j*Hi),T[13]=Se[1]+bi-(ki*Zn+ce*bi+se*Hi),T[14]=Se[2]+Hi-(Oi*Zn+ve*bi+de*Hi),T[15]=1,T}function Fe(T,G){var Se=G[0],Be=G[1],et=G[2],tt=G[3],Ct=Se+Se,jt=Be+Be,Mt=et+et,Qt=Se*Ct,ne=Be*Ct,Kt=Be*jt,Dr=et*Ct,Mr=et*jt,nt=et*Mt,xt=tt*Ct,ht=tt*jt,vr=tt*Mt;return T[0]=1-Kt-nt,T[1]=ne+vr,T[2]=Dr-ht,T[3]=0,T[4]=ne-vr,T[5]=1-Qt-nt,T[6]=Mr+xt,T[7]=0,T[8]=Dr+ht,T[9]=Mr-xt,T[10]=1-Qt-Kt,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,T}function me(T,G,Se,Be,et,tt,Ct){var jt=1/(Se-G),Mt=1/(et-Be),Qt=1/(tt-Ct);return T[0]=tt*2*jt,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=tt*2*Mt,T[6]=0,T[7]=0,T[8]=(Se+G)*jt,T[9]=(et+Be)*Mt,T[10]=(Ct+tt)*Qt,T[11]=-1,T[12]=0,T[13]=0,T[14]=Ct*tt*2*Qt,T[15]=0,T}function bt(T,G,Se,Be,et){var tt=1/Math.tan(G/2),Ct;return T[0]=tt/Se,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=tt,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[11]=-1,T[12]=0,T[13]=0,T[15]=0,et!=null&&et!==Infinity?(Ct=1/(Be-et),T[10]=(et+Be)*Ct,T[14]=2*et*Be*Ct):(T[10]=-1,T[14]=-2*Be),T}function vt(T,G,Se,Be){var et=Math.tan(G.upDegrees*Math.PI/180),tt=Math.tan(G.downDegrees*Math.PI/180),Ct=Math.tan(G.leftDegrees*Math.PI/180),jt=Math.tan(G.rightDegrees*Math.PI/180),Mt=2/(Ct+jt),Qt=2/(et+tt);return T[0]=Mt,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=Qt,T[6]=0,T[7]=0,T[8]=-((Ct-jt)*Mt*.5),T[9]=(et-tt)*Qt*.5,T[10]=Be/(Se-Be),T[11]=-1,T[12]=0,T[13]=0,T[14]=Be*Se/(Se-Be),T[15]=0,T}function Zt(T,G,Se,Be,et,tt,Ct){var jt=1/(G-Se),Mt=1/(Be-et),Qt=1/(tt-Ct);return T[0]=-2*jt,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=-2*Mt,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=2*Qt,T[11]=0,T[12]=(G+Se)*jt,T[13]=(et+Be)*Mt,T[14]=(Ct+tt)*Qt,T[15]=1,T}function Ut(T,G,Se,Be){var et,tt,Ct,jt,Mt,Qt,ne,Kt,Dr,Mr,nt=G[0],xt=G[1],ht=G[2],vr=Be[0],Zr=Be[1],Ur=Be[2],tn=Se[0],jr=Se[1],wr=Se[2];return Math.abs(nt-tn)<U.Ib&&Math.abs(xt-jr)<U.Ib&&Math.abs(ht-wr)<U.Ib?H(T):(ne=nt-tn,Kt=xt-jr,Dr=ht-wr,Mr=1/Math.hypot(ne,Kt,Dr),ne*=Mr,Kt*=Mr,Dr*=Mr,et=Zr*Dr-Ur*Kt,tt=Ur*ne-vr*Dr,Ct=vr*Kt-Zr*ne,Mr=Math.hypot(et,tt,Ct),Mr?(Mr=1/Mr,et*=Mr,tt*=Mr,Ct*=Mr):(et=0,tt=0,Ct=0),jt=Kt*Ct-Dr*tt,Mt=Dr*et-ne*Ct,Qt=ne*tt-Kt*et,Mr=Math.hypot(jt,Mt,Qt),Mr?(Mr=1/Mr,jt*=Mr,Mt*=Mr,Qt*=Mr):(jt=0,Mt=0,Qt=0),T[0]=et,T[1]=jt,T[2]=ne,T[3]=0,T[4]=tt,T[5]=Mt,T[6]=Kt,T[7]=0,T[8]=Ct,T[9]=Qt,T[10]=Dr,T[11]=0,T[12]=-(et*nt+tt*xt+Ct*ht),T[13]=-(jt*nt+Mt*xt+Qt*ht),T[14]=-(ne*nt+Kt*xt+Dr*ht),T[15]=1,T)}function Rr(T,G,Se,Be){var et=G[0],tt=G[1],Ct=G[2],jt=Be[0],Mt=Be[1],Qt=Be[2],ne=et-Se[0],Kt=tt-Se[1],Dr=Ct-Se[2],Mr=ne*ne+Kt*Kt+Dr*Dr;Mr>0&&(Mr=1/Math.sqrt(Mr),ne*=Mr,Kt*=Mr,Dr*=Mr);var nt=Mt*Dr-Qt*Kt,xt=Qt*ne-jt*Dr,ht=jt*Kt-Mt*ne;return Mr=nt*nt+xt*xt+ht*ht,Mr>0&&(Mr=1/Math.sqrt(Mr),nt*=Mr,xt*=Mr,ht*=Mr),T[0]=nt,T[1]=xt,T[2]=ht,T[3]=0,T[4]=Kt*ht-Dr*xt,T[5]=Dr*nt-ne*ht,T[6]=ne*xt-Kt*nt,T[7]=0,T[8]=ne,T[9]=Kt,T[10]=Dr,T[11]=0,T[12]=et,T[13]=tt,T[14]=Ct,T[15]=1,T}function ln(T){return"mat4("+T[0]+", "+T[1]+", "+T[2]+", "+T[3]+", "+T[4]+", "+T[5]+", "+T[6]+", "+T[7]+", "+T[8]+", "+T[9]+", "+T[10]+", "+T[11]+", "+T[12]+", "+T[13]+", "+T[14]+", "+T[15]+")"}function pn(T){return Math.hypot(T[0],T[1],T[2],T[3],T[4],T[5],T[6],T[7],T[8],T[9],T[10],T[11],T[12],T[13],T[14],T[15])}function Vi(T,G,Se){return T[0]=G[0]+Se[0],T[1]=G[1]+Se[1],T[2]=G[2]+Se[2],T[3]=G[3]+Se[3],T[4]=G[4]+Se[4],T[5]=G[5]+Se[5],T[6]=G[6]+Se[6],T[7]=G[7]+Se[7],T[8]=G[8]+Se[8],T[9]=G[9]+Se[9],T[10]=G[10]+Se[10],T[11]=G[11]+Se[11],T[12]=G[12]+Se[12],T[13]=G[13]+Se[13],T[14]=G[14]+Se[14],T[15]=G[15]+Se[15],T}function ar(T,G,Se){return T[0]=G[0]-Se[0],T[1]=G[1]-Se[1],T[2]=G[2]-Se[2],T[3]=G[3]-Se[3],T[4]=G[4]-Se[4],T[5]=G[5]-Se[5],T[6]=G[6]-Se[6],T[7]=G[7]-Se[7],T[8]=G[8]-Se[8],T[9]=G[9]-Se[9],T[10]=G[10]-Se[10],T[11]=G[11]-Se[11],T[12]=G[12]-Se[12],T[13]=G[13]-Se[13],T[14]=G[14]-Se[14],T[15]=G[15]-Se[15],T}function pe(T,G,Se){return T[0]=G[0]*Se,T[1]=G[1]*Se,T[2]=G[2]*Se,T[3]=G[3]*Se,T[4]=G[4]*Se,T[5]=G[5]*Se,T[6]=G[6]*Se,T[7]=G[7]*Se,T[8]=G[8]*Se,T[9]=G[9]*Se,T[10]=G[10]*Se,T[11]=G[11]*Se,T[12]=G[12]*Se,T[13]=G[13]*Se,T[14]=G[14]*Se,T[15]=G[15]*Se,T}function Pe(T,G,Se,Be){return T[0]=G[0]+Se[0]*Be,T[1]=G[1]+Se[1]*Be,T[2]=G[2]+Se[2]*Be,T[3]=G[3]+Se[3]*Be,T[4]=G[4]+Se[4]*Be,T[5]=G[5]+Se[5]*Be,T[6]=G[6]+Se[6]*Be,T[7]=G[7]+Se[7]*Be,T[8]=G[8]+Se[8]*Be,T[9]=G[9]+Se[9]*Be,T[10]=G[10]+Se[10]*Be,T[11]=G[11]+Se[11]*Be,T[12]=G[12]+Se[12]*Be,T[13]=G[13]+Se[13]*Be,T[14]=G[14]+Se[14]*Be,T[15]=G[15]+Se[15]*Be,T}function Ge(T,G){return T[0]===G[0]&&T[1]===G[1]&&T[2]===G[2]&&T[3]===G[3]&&T[4]===G[4]&&T[5]===G[5]&&T[6]===G[6]&&T[7]===G[7]&&T[8]===G[8]&&T[9]===G[9]&&T[10]===G[10]&&T[11]===G[11]&&T[12]===G[12]&&T[13]===G[13]&&T[14]===G[14]&&T[15]===G[15]}function ke(T,G){var Se=T[0],Be=T[1],et=T[2],tt=T[3],Ct=T[4],jt=T[5],Mt=T[6],Qt=T[7],ne=T[8],Kt=T[9],Dr=T[10],Mr=T[11],nt=T[12],xt=T[13],ht=T[14],vr=T[15],Zr=G[0],Ur=G[1],tn=G[2],jr=G[3],wr=G[4],Dn=G[5],Zn=G[6],bi=G[7],Hi=G[8],qi=G[9],ki=G[10],Oi=G[11],$=G[12],ce=G[13],ve=G[14],j=G[15];return Math.abs(Se-Zr)<=U.Ib*Math.max(1,Math.abs(Se),Math.abs(Zr))&&Math.abs(Be-Ur)<=U.Ib*Math.max(1,Math.abs(Be),Math.abs(Ur))&&Math.abs(et-tn)<=U.Ib*Math.max(1,Math.abs(et),Math.abs(tn))&&Math.abs(tt-jr)<=U.Ib*Math.max(1,Math.abs(tt),Math.abs(jr))&&Math.abs(Ct-wr)<=U.Ib*Math.max(1,Math.abs(Ct),Math.abs(wr))&&Math.abs(jt-Dn)<=U.Ib*Math.max(1,Math.abs(jt),Math.abs(Dn))&&Math.abs(Mt-Zn)<=U.Ib*Math.max(1,Math.abs(Mt),Math.abs(Zn))&&Math.abs(Qt-bi)<=U.Ib*Math.max(1,Math.abs(Qt),Math.abs(bi))&&Math.abs(ne-Hi)<=U.Ib*Math.max(1,Math.abs(ne),Math.abs(Hi))&&Math.abs(Kt-qi)<=U.Ib*Math.max(1,Math.abs(Kt),Math.abs(qi))&&Math.abs(Dr-ki)<=U.Ib*Math.max(1,Math.abs(Dr),Math.abs(ki))&&Math.abs(Mr-Oi)<=U.Ib*Math.max(1,Math.abs(Mr),Math.abs(Oi))&&Math.abs(nt-$)<=U.Ib*Math.max(1,Math.abs(nt),Math.abs($))&&Math.abs(xt-ce)<=U.Ib*Math.max(1,Math.abs(xt),Math.abs(ce))&&Math.abs(ht-ve)<=U.Ib*Math.max(1,Math.abs(ht),Math.abs(ve))&&Math.abs(vr-j)<=U.Ib*Math.max(1,Math.abs(vr),Math.abs(j))}var Ft=Re,ir=ar},98333:function(Qe,D,g){"use strict";g.d(D,{Ue:function(){return b},al:function(){return E},bA:function(){return zt},fF:function(){return Jt}});var U=g(49685);function b(){var pe=new U.WT(4);return U.WT!=Float32Array&&(pe[0]=0,pe[1]=0,pe[2]=0,pe[3]=0),pe}function p(pe){var Pe=new glMatrix.ARRAY_TYPE(4);return Pe[0]=pe[0],Pe[1]=pe[1],Pe[2]=pe[2],Pe[3]=pe[3],Pe}function E(pe,Pe,Ge,ke){var Ft=new U.WT(4);return Ft[0]=pe,Ft[1]=Pe,Ft[2]=Ge,Ft[3]=ke,Ft}function Z(pe,Pe){return pe[0]=Pe[0],pe[1]=Pe[1],pe[2]=Pe[2],pe[3]=Pe[3],pe}function V(pe,Pe,Ge,ke,Ft){return pe[0]=Pe,pe[1]=Ge,pe[2]=ke,pe[3]=Ft,pe}function H(pe,Pe,Ge){return pe[0]=Pe[0]+Ge[0],pe[1]=Pe[1]+Ge[1],pe[2]=Pe[2]+Ge[2],pe[3]=Pe[3]+Ge[3],pe}function I(pe,Pe,Ge){return pe[0]=Pe[0]-Ge[0],pe[1]=Pe[1]-Ge[1],pe[2]=Pe[2]-Ge[2],pe[3]=Pe[3]-Ge[3],pe}function L(pe,Pe,Ge){return pe[0]=Pe[0]*Ge[0],pe[1]=Pe[1]*Ge[1],pe[2]=Pe[2]*Ge[2],pe[3]=Pe[3]*Ge[3],pe}function _e(pe,Pe,Ge){return pe[0]=Pe[0]/Ge[0],pe[1]=Pe[1]/Ge[1],pe[2]=Pe[2]/Ge[2],pe[3]=Pe[3]/Ge[3],pe}function xe(pe,Pe){return pe[0]=Math.ceil(Pe[0]),pe[1]=Math.ceil(Pe[1]),pe[2]=Math.ceil(Pe[2]),pe[3]=Math.ceil(Pe[3]),pe}function Re(pe,Pe){return pe[0]=Math.floor(Pe[0]),pe[1]=Math.floor(Pe[1]),pe[2]=Math.floor(Pe[2]),pe[3]=Math.floor(Pe[3]),pe}function $e(pe,Pe,Ge){return pe[0]=Math.min(Pe[0],Ge[0]),pe[1]=Math.min(Pe[1],Ge[1]),pe[2]=Math.min(Pe[2],Ge[2]),pe[3]=Math.min(Pe[3],Ge[3]),pe}function Rt(pe,Pe,Ge){return pe[0]=Math.max(Pe[0],Ge[0]),pe[1]=Math.max(Pe[1],Ge[1]),pe[2]=Math.max(Pe[2],Ge[2]),pe[3]=Math.max(Pe[3],Ge[3]),pe}function Lt(pe,Pe){return pe[0]=Math.round(Pe[0]),pe[1]=Math.round(Pe[1]),pe[2]=Math.round(Pe[2]),pe[3]=Math.round(Pe[3]),pe}function zt(pe,Pe,Ge){return pe[0]=Pe[0]*Ge,pe[1]=Pe[1]*Ge,pe[2]=Pe[2]*Ge,pe[3]=Pe[3]*Ge,pe}function St(pe,Pe,Ge,ke){return pe[0]=Pe[0]+Ge[0]*ke,pe[1]=Pe[1]+Ge[1]*ke,pe[2]=Pe[2]+Ge[2]*ke,pe[3]=Pe[3]+Ge[3]*ke,pe}function Et(pe,Pe){var Ge=Pe[0]-pe[0],ke=Pe[1]-pe[1],Ft=Pe[2]-pe[2],ir=Pe[3]-pe[3];return Math.hypot(Ge,ke,Ft,ir)}function at(pe,Pe){var Ge=Pe[0]-pe[0],ke=Pe[1]-pe[1],Ft=Pe[2]-pe[2],ir=Pe[3]-pe[3];return Ge*Ge+ke*ke+Ft*Ft+ir*ir}function ur(pe){var Pe=pe[0],Ge=pe[1],ke=pe[2],Ft=pe[3];return Math.hypot(Pe,Ge,ke,Ft)}function ee(pe){var Pe=pe[0],Ge=pe[1],ke=pe[2],Ft=pe[3];return Pe*Pe+Ge*Ge+ke*ke+Ft*Ft}function fr(pe,Pe){return pe[0]=-Pe[0],pe[1]=-Pe[1],pe[2]=-Pe[2],pe[3]=-Pe[3],pe}function At(pe,Pe){return pe[0]=1/Pe[0],pe[1]=1/Pe[1],pe[2]=1/Pe[2],pe[3]=1/Pe[3],pe}function Je(pe,Pe){var Ge=Pe[0],ke=Pe[1],Ft=Pe[2],ir=Pe[3],T=Ge*Ge+ke*ke+Ft*Ft+ir*ir;return T>0&&(T=1/Math.sqrt(T)),pe[0]=Ge*T,pe[1]=ke*T,pe[2]=Ft*T,pe[3]=ir*T,pe}function Pt(pe,Pe){return pe[0]*Pe[0]+pe[1]*Pe[1]+pe[2]*Pe[2]+pe[3]*Pe[3]}function Ve(pe,Pe,Ge,ke){var Ft=Ge[0]*ke[1]-Ge[1]*ke[0],ir=Ge[0]*ke[2]-Ge[2]*ke[0],T=Ge[0]*ke[3]-Ge[3]*ke[0],G=Ge[1]*ke[2]-Ge[2]*ke[1],Se=Ge[1]*ke[3]-Ge[3]*ke[1],Be=Ge[2]*ke[3]-Ge[3]*ke[2],et=Pe[0],tt=Pe[1],Ct=Pe[2],jt=Pe[3];return pe[0]=tt*Be-Ct*Se+jt*G,pe[1]=-(et*Be)+Ct*T-jt*ir,pe[2]=et*Se-tt*T+jt*Ft,pe[3]=-(et*G)+tt*ir-Ct*Ft,pe}function It(pe,Pe,Ge,ke){var Ft=Pe[0],ir=Pe[1],T=Pe[2],G=Pe[3];return pe[0]=Ft+ke*(Ge[0]-Ft),pe[1]=ir+ke*(Ge[1]-ir),pe[2]=T+ke*(Ge[2]-T),pe[3]=G+ke*(Ge[3]-G),pe}function hr(pe,Pe){Pe=Pe||1;var Ge,ke,Ft,ir,T,G;do Ge=glMatrix.RANDOM()*2-1,ke=glMatrix.RANDOM()*2-1,T=Ge*Ge+ke*ke;while(T>=1);do Ft=glMatrix.RANDOM()*2-1,ir=glMatrix.RANDOM()*2-1,G=Ft*Ft+ir*ir;while(G>=1);var Se=Math.sqrt((1-T)/G);return pe[0]=Pe*Ge,pe[1]=Pe*ke,pe[2]=Pe*Ft*Se,pe[3]=Pe*ir*Se,pe}function Jt(pe,Pe,Ge){var ke=Pe[0],Ft=Pe[1],ir=Pe[2],T=Pe[3];return pe[0]=Ge[0]*ke+Ge[4]*Ft+Ge[8]*ir+Ge[12]*T,pe[1]=Ge[1]*ke+Ge[5]*Ft+Ge[9]*ir+Ge[13]*T,pe[2]=Ge[2]*ke+Ge[6]*Ft+Ge[10]*ir+Ge[14]*T,pe[3]=Ge[3]*ke+Ge[7]*Ft+Ge[11]*ir+Ge[15]*T,pe}function Fr(pe,Pe,Ge){var ke=Pe[0],Ft=Pe[1],ir=Pe[2],T=Ge[0],G=Ge[1],Se=Ge[2],Be=Ge[3],et=Be*ke+G*ir-Se*Ft,tt=Be*Ft+Se*ke-T*ir,Ct=Be*ir+T*Ft-G*ke,jt=-T*ke-G*Ft-Se*ir;return pe[0]=et*Be+jt*-T+tt*-Se-Ct*-G,pe[1]=tt*Be+jt*-G+Ct*-T-et*-Se,pe[2]=Ct*Be+jt*-Se+et*-G-tt*-T,pe[3]=Pe[3],pe}function fe(pe){return pe[0]=0,pe[1]=0,pe[2]=0,pe[3]=0,pe}function Fe(pe){return"vec4("+pe[0]+", "+pe[1]+", "+pe[2]+", "+pe[3]+")"}function me(pe,Pe){return pe[0]===Pe[0]&&pe[1]===Pe[1]&&pe[2]===Pe[2]&&pe[3]===Pe[3]}function bt(pe,Pe){var Ge=pe[0],ke=pe[1],Ft=pe[2],ir=pe[3],T=Pe[0],G=Pe[1],Se=Pe[2],Be=Pe[3];return Math.abs(Ge-T)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ge),Math.abs(T))&&Math.abs(ke-G)<=glMatrix.EPSILON*Math.max(1,Math.abs(ke),Math.abs(G))&&Math.abs(Ft-Se)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ft),Math.abs(Se))&&Math.abs(ir-Be)<=glMatrix.EPSILON*Math.max(1,Math.abs(ir),Math.abs(Be))}var vt=null,Zt=null,Ut=null,Rr=null,ln=null,pn=null,Vi=null,ar=function(){var pe=b();return function(Pe,Ge,ke,Ft,ir,T){var G,Se;for(Ge||(Ge=4),ke||(ke=0),Ft?Se=Math.min(Ft*Ge+ke,Pe.length):Se=Pe.length,G=ke;G<Se;G+=Ge)pe[0]=Pe[G],pe[1]=Pe[G+1],pe[2]=Pe[G+2],pe[3]=Pe[G+3],ir(pe,pe,T),Pe[G]=pe[0],Pe[G+1]=pe[1],Pe[G+2]=pe[2],Pe[G+3]=pe[3];return Pe}}()},50840:function(Qe,D,g){var U;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(b,p,E,Z){"use strict";var V=["","webkit","Moz","MS","ms","o"],H=p.createElement("div"),I="function",L=Math.round,_e=Math.abs,xe=Date.now;function Re(be,Ne,pt){return setTimeout(ur(be,pt),Ne)}function $e(be,Ne,pt){return Array.isArray(be)?(Rt(be,pt[Ne],pt),!0):!1}function Rt(be,Ne,pt){var rr;if(!!be)if(be.forEach)be.forEach(Ne,pt);else if(be.length!==Z)for(rr=0;rr<be.length;)Ne.call(pt,be[rr],rr,be),rr++;else for(rr in be)be.hasOwnProperty(rr)&&Ne.call(pt,be[rr],rr,be)}function Lt(be,Ne,pt){var rr="DEPRECATED METHOD: "+Ne+`
`+pt+` AT 
`;return function(){var Xr=new Error("get-stack-trace"),Kn=Xr&&Xr.stack?Xr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",vi=b.console&&(b.console.warn||b.console.log);return vi&&vi.call(b.console,rr,Kn),be.apply(this,arguments)}}var zt;typeof Object.assign!="function"?zt=function(Ne){if(Ne===Z||Ne===null)throw new TypeError("Cannot convert undefined or null to object");for(var pt=Object(Ne),rr=1;rr<arguments.length;rr++){var Xr=arguments[rr];if(Xr!==Z&&Xr!==null)for(var Kn in Xr)Xr.hasOwnProperty(Kn)&&(pt[Kn]=Xr[Kn])}return pt}:zt=Object.assign;var St=Lt(function(Ne,pt,rr){for(var Xr=Object.keys(pt),Kn=0;Kn<Xr.length;)(!rr||rr&&Ne[Xr[Kn]]===Z)&&(Ne[Xr[Kn]]=pt[Xr[Kn]]),Kn++;return Ne},"extend","Use `assign`."),Et=Lt(function(Ne,pt){return St(Ne,pt,!0)},"merge","Use `assign`.");function at(be,Ne,pt){var rr=Ne.prototype,Xr;Xr=be.prototype=Object.create(rr),Xr.constructor=be,Xr._super=rr,pt&&zt(Xr,pt)}function ur(be,Ne){return function(){return be.apply(Ne,arguments)}}function ee(be,Ne){return typeof be==I?be.apply(Ne&&Ne[0]||Z,Ne):be}function fr(be,Ne){return be===Z?Ne:be}function At(be,Ne,pt){Rt(It(Ne),function(rr){be.addEventListener(rr,pt,!1)})}function Je(be,Ne,pt){Rt(It(Ne),function(rr){be.removeEventListener(rr,pt,!1)})}function Pt(be,Ne){for(;be;){if(be==Ne)return!0;be=be.parentNode}return!1}function Ve(be,Ne){return be.indexOf(Ne)>-1}function It(be){return be.trim().split(/\s+/g)}function hr(be,Ne,pt){if(be.indexOf&&!pt)return be.indexOf(Ne);for(var rr=0;rr<be.length;){if(pt&&be[rr][pt]==Ne||!pt&&be[rr]===Ne)return rr;rr++}return-1}function Jt(be){return Array.prototype.slice.call(be,0)}function Fr(be,Ne,pt){for(var rr=[],Xr=[],Kn=0;Kn<be.length;){var vi=Ne?be[Kn][Ne]:be[Kn];hr(Xr,vi)<0&&rr.push(be[Kn]),Xr[Kn]=vi,Kn++}return pt&&(Ne?rr=rr.sort(function(ao,oo){return ao[Ne]>oo[Ne]}):rr=rr.sort()),rr}function fe(be,Ne){for(var pt,rr,Xr=Ne[0].toUpperCase()+Ne.slice(1),Kn=0;Kn<V.length;){if(pt=V[Kn],rr=pt?pt+Xr:Ne,rr in be)return rr;Kn++}return Z}var Fe=1;function me(){return Fe++}function bt(be){var Ne=be.ownerDocument||be;return Ne.defaultView||Ne.parentWindow||b}var vt=/mobile|tablet|ip(ad|hone|od)|android/i,Zt="ontouchstart"in b,Ut=fe(b,"PointerEvent")!==Z,Rr=Zt&&vt.test(navigator.userAgent),ln="touch",pn="pen",Vi="mouse",ar="kinect",pe=25,Pe=1,Ge=2,ke=4,Ft=8,ir=1,T=2,G=4,Se=8,Be=16,et=T|G,tt=Se|Be,Ct=et|tt,jt=["x","y"],Mt=["clientX","clientY"];function Qt(be,Ne){var pt=this;this.manager=be,this.callback=Ne,this.element=be.element,this.target=be.options.inputTarget,this.domHandler=function(rr){ee(be.options.enable,[be])&&pt.handler(rr)},this.init()}Qt.prototype={handler:function(){},init:function(){this.evEl&&At(this.element,this.evEl,this.domHandler),this.evTarget&&At(this.target,this.evTarget,this.domHandler),this.evWin&&At(bt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Je(this.element,this.evEl,this.domHandler),this.evTarget&&Je(this.target,this.evTarget,this.domHandler),this.evWin&&Je(bt(this.element),this.evWin,this.domHandler)}};function ne(be){var Ne,pt=be.options.inputClass;return pt?Ne=pt:Ut?Ne=ce:Rr?Ne=mt:Zt?Ne=kr:Ne=Hi,new Ne(be,Kt)}function Kt(be,Ne,pt){var rr=pt.pointers.length,Xr=pt.changedPointers.length,Kn=Ne&Pe&&rr-Xr==0,vi=Ne&(ke|Ft)&&rr-Xr==0;pt.isFirst=!!Kn,pt.isFinal=!!vi,Kn&&(be.session={}),pt.eventType=Ne,Dr(be,pt),be.emit("hammer.input",pt),be.recognize(pt),be.session.prevInput=pt}function Dr(be,Ne){var pt=be.session,rr=Ne.pointers,Xr=rr.length;pt.firstInput||(pt.firstInput=xt(Ne)),Xr>1&&!pt.firstMultiple?pt.firstMultiple=xt(Ne):Xr===1&&(pt.firstMultiple=!1);var Kn=pt.firstInput,vi=pt.firstMultiple,Ga=vi?vi.center:Kn.center,ao=Ne.center=ht(rr);Ne.timeStamp=xe(),Ne.deltaTime=Ne.timeStamp-Kn.timeStamp,Ne.angle=tn(Ga,ao),Ne.distance=Ur(Ga,ao),Mr(pt,Ne),Ne.offsetDirection=Zr(Ne.deltaX,Ne.deltaY);var oo=vr(Ne.deltaTime,Ne.deltaX,Ne.deltaY);Ne.overallVelocityX=oo.x,Ne.overallVelocityY=oo.y,Ne.overallVelocity=_e(oo.x)>_e(oo.y)?oo.x:oo.y,Ne.scale=vi?wr(vi.pointers,rr):1,Ne.rotation=vi?jr(vi.pointers,rr):0,Ne.maxPointers=pt.prevInput?Ne.pointers.length>pt.prevInput.maxPointers?Ne.pointers.length:pt.prevInput.maxPointers:Ne.pointers.length,nt(pt,Ne);var hs=be.element;Pt(Ne.srcEvent.target,hs)&&(hs=Ne.srcEvent.target),Ne.target=hs}function Mr(be,Ne){var pt=Ne.center,rr=be.offsetDelta||{},Xr=be.prevDelta||{},Kn=be.prevInput||{};(Ne.eventType===Pe||Kn.eventType===ke)&&(Xr=be.prevDelta={x:Kn.deltaX||0,y:Kn.deltaY||0},rr=be.offsetDelta={x:pt.x,y:pt.y}),Ne.deltaX=Xr.x+(pt.x-rr.x),Ne.deltaY=Xr.y+(pt.y-rr.y)}function nt(be,Ne){var pt=be.lastInterval||Ne,rr=Ne.timeStamp-pt.timeStamp,Xr,Kn,vi,Ga;if(Ne.eventType!=Ft&&(rr>pe||pt.velocity===Z)){var ao=Ne.deltaX-pt.deltaX,oo=Ne.deltaY-pt.deltaY,hs=vr(rr,ao,oo);Kn=hs.x,vi=hs.y,Xr=_e(hs.x)>_e(hs.y)?hs.x:hs.y,Ga=Zr(ao,oo),be.lastInterval=Ne}else Xr=pt.velocity,Kn=pt.velocityX,vi=pt.velocityY,Ga=pt.direction;Ne.velocity=Xr,Ne.velocityX=Kn,Ne.velocityY=vi,Ne.direction=Ga}function xt(be){for(var Ne=[],pt=0;pt<be.pointers.length;)Ne[pt]={clientX:L(be.pointers[pt].clientX),clientY:L(be.pointers[pt].clientY)},pt++;return{timeStamp:xe(),pointers:Ne,center:ht(Ne),deltaX:be.deltaX,deltaY:be.deltaY}}function ht(be){var Ne=be.length;if(Ne===1)return{x:L(be[0].clientX),y:L(be[0].clientY)};for(var pt=0,rr=0,Xr=0;Xr<Ne;)pt+=be[Xr].clientX,rr+=be[Xr].clientY,Xr++;return{x:L(pt/Ne),y:L(rr/Ne)}}function vr(be,Ne,pt){return{x:Ne/be||0,y:pt/be||0}}function Zr(be,Ne){return be===Ne?ir:_e(be)>=_e(Ne)?be<0?T:G:Ne<0?Se:Be}function Ur(be,Ne,pt){pt||(pt=jt);var rr=Ne[pt[0]]-be[pt[0]],Xr=Ne[pt[1]]-be[pt[1]];return Math.sqrt(rr*rr+Xr*Xr)}function tn(be,Ne,pt){pt||(pt=jt);var rr=Ne[pt[0]]-be[pt[0]],Xr=Ne[pt[1]]-be[pt[1]];return Math.atan2(Xr,rr)*180/Math.PI}function jr(be,Ne){return tn(Ne[1],Ne[0],Mt)+tn(be[1],be[0],Mt)}function wr(be,Ne){return Ur(Ne[0],Ne[1],Mt)/Ur(be[0],be[1],Mt)}var Dn={mousedown:Pe,mousemove:Ge,mouseup:ke},Zn="mousedown",bi="mousemove mouseup";function Hi(){this.evEl=Zn,this.evWin=bi,this.pressed=!1,Qt.apply(this,arguments)}at(Hi,Qt,{handler:function(Ne){var pt=Dn[Ne.type];pt&Pe&&Ne.button===0&&(this.pressed=!0),pt&Ge&&Ne.which!==1&&(pt=ke),!!this.pressed&&(pt&ke&&(this.pressed=!1),this.callback(this.manager,pt,{pointers:[Ne],changedPointers:[Ne],pointerType:Vi,srcEvent:Ne}))}});var qi={pointerdown:Pe,pointermove:Ge,pointerup:ke,pointercancel:Ft,pointerout:Ft},ki={2:ln,3:pn,4:Vi,5:ar},Oi="pointerdown",$="pointermove pointerup pointercancel";b.MSPointerEvent&&!b.PointerEvent&&(Oi="MSPointerDown",$="MSPointerMove MSPointerUp MSPointerCancel");function ce(){this.evEl=Oi,this.evWin=$,Qt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}at(ce,Qt,{handler:function(Ne){var pt=this.store,rr=!1,Xr=Ne.type.toLowerCase().replace("ms",""),Kn=qi[Xr],vi=ki[Ne.pointerType]||Ne.pointerType,Ga=vi==ln,ao=hr(pt,Ne.pointerId,"pointerId");Kn&Pe&&(Ne.button===0||Ga)?ao<0&&(pt.push(Ne),ao=pt.length-1):Kn&(ke|Ft)&&(rr=!0),!(ao<0)&&(pt[ao]=Ne,this.callback(this.manager,Kn,{pointers:pt,changedPointers:[Ne],pointerType:vi,srcEvent:Ne}),rr&&pt.splice(ao,1))}});var ve={touchstart:Pe,touchmove:Ge,touchend:ke,touchcancel:Ft},j="touchstart",se="touchstart touchmove touchend touchcancel";function de(){this.evTarget=j,this.evWin=se,this.started=!1,Qt.apply(this,arguments)}at(de,Qt,{handler:function(Ne){var pt=ve[Ne.type];if(pt===Pe&&(this.started=!0),!!this.started){var rr=Me.call(this,Ne,pt);pt&(ke|Ft)&&rr[0].length-rr[1].length==0&&(this.started=!1),this.callback(this.manager,pt,{pointers:rr[0],changedPointers:rr[1],pointerType:ln,srcEvent:Ne})}}});function Me(be,Ne){var pt=Jt(be.touches),rr=Jt(be.changedTouches);return Ne&(ke|Ft)&&(pt=Fr(pt.concat(rr),"identifier",!0)),[pt,rr]}var ue={touchstart:Pe,touchmove:Ge,touchend:ke,touchcancel:Ft},Te="touchstart touchmove touchend touchcancel";function mt(){this.evTarget=Te,this.targetIds={},Qt.apply(this,arguments)}at(mt,Qt,{handler:function(Ne){var pt=ue[Ne.type],rr=br.call(this,Ne,pt);!rr||this.callback(this.manager,pt,{pointers:rr[0],changedPointers:rr[1],pointerType:ln,srcEvent:Ne})}});function br(be,Ne){var pt=Jt(be.touches),rr=this.targetIds;if(Ne&(Pe|Ge)&&pt.length===1)return rr[pt[0].identifier]=!0,[pt,pt];var Xr,Kn,vi=Jt(be.changedTouches),Ga=[],ao=this.target;if(Kn=pt.filter(function(oo){return Pt(oo.target,ao)}),Ne===Pe)for(Xr=0;Xr<Kn.length;)rr[Kn[Xr].identifier]=!0,Xr++;for(Xr=0;Xr<vi.length;)rr[vi[Xr].identifier]&&Ga.push(vi[Xr]),Ne&(ke|Ft)&&delete rr[vi[Xr].identifier],Xr++;if(!!Ga.length)return[Fr(Kn.concat(Ga),"identifier",!0),Ga]}var Yt=2500,nr=25;function kr(){Qt.apply(this,arguments);var be=ur(this.handler,this);this.touch=new mt(this.manager,be),this.mouse=new Hi(this.manager,be),this.primaryTouch=null,this.lastTouches=[]}at(kr,Qt,{handler:function(Ne,pt,rr){var Xr=rr.pointerType==ln,Kn=rr.pointerType==Vi;if(!(Kn&&rr.sourceCapabilities&&rr.sourceCapabilities.firesTouchEvents)){if(Xr)Mn.call(this,pt,rr);else if(Kn&&tr.call(this,rr))return;this.callback(Ne,pt,rr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Mn(be,Ne){be&Pe?(this.primaryTouch=Ne.changedPointers[0].identifier,Pn.call(this,Ne)):be&(ke|Ft)&&Pn.call(this,Ne)}function Pn(be){var Ne=be.changedPointers[0];if(Ne.identifier===this.primaryTouch){var pt={x:Ne.clientX,y:Ne.clientY};this.lastTouches.push(pt);var rr=this.lastTouches,Xr=function(){var Kn=rr.indexOf(pt);Kn>-1&&rr.splice(Kn,1)};setTimeout(Xr,Yt)}}function tr(be){for(var Ne=be.srcEvent.clientX,pt=be.srcEvent.clientY,rr=0;rr<this.lastTouches.length;rr++){var Xr=this.lastTouches[rr],Kn=Math.abs(Ne-Xr.x),vi=Math.abs(pt-Xr.y);if(Kn<=nr&&vi<=nr)return!0}return!1}var Sn=fe(H.style,"touchAction"),on=Sn!==Z,cn="compute",wi="auto",xn="manipulation",Li="none",$i="pan-x",ai="pan-y",Ji=ha();function Ni(be,Ne){this.manager=be,this.set(Ne)}Ni.prototype={set:function(be){be==cn&&(be=this.compute()),on&&this.manager.element.style&&Ji[be]&&(this.manager.element.style[Sn]=be),this.actions=be.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var be=[];return Rt(this.manager.recognizers,function(Ne){ee(Ne.options.enable,[Ne])&&(be=be.concat(Ne.getTouchAction()))}),Ai(be.join(" "))},preventDefaults:function(be){var Ne=be.srcEvent,pt=be.offsetDirection;if(this.manager.session.prevented){Ne.preventDefault();return}var rr=this.actions,Xr=Ve(rr,Li)&&!Ji[Li],Kn=Ve(rr,ai)&&!Ji[ai],vi=Ve(rr,$i)&&!Ji[$i];if(Xr){var Ga=be.pointers.length===1,ao=be.distance<2,oo=be.deltaTime<250;if(Ga&&ao&&oo)return}if(!(vi&&Kn)&&(Xr||Kn&&pt&et||vi&&pt&tt))return this.preventSrc(Ne)},preventSrc:function(be){this.manager.session.prevented=!0,be.preventDefault()}};function Ai(be){if(Ve(be,Li))return Li;var Ne=Ve(be,$i),pt=Ve(be,ai);return Ne&&pt?Li:Ne||pt?Ne?$i:ai:Ve(be,xn)?xn:wi}function ha(){if(!on)return!1;var be={},Ne=b.CSS&&b.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(pt){be[pt]=Ne?b.CSS.supports("touch-action",pt):!0}),be}var Ca=1,ii=2,ti=4,Xi=8,va=Xi,Vo=16,ba=32;function gi(be){this.options=zt({},this.defaults,be||{}),this.id=me(),this.manager=null,this.options.enable=fr(this.options.enable,!0),this.state=Ca,this.simultaneous={},this.requireFail=[]}gi.prototype={defaults:{},set:function(be){return zt(this.options,be),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(be){if($e(be,"recognizeWith",this))return this;var Ne=this.simultaneous;return be=Aa(be,this),Ne[be.id]||(Ne[be.id]=be,be.recognizeWith(this)),this},dropRecognizeWith:function(be){return $e(be,"dropRecognizeWith",this)?this:(be=Aa(be,this),delete this.simultaneous[be.id],this)},requireFailure:function(be){if($e(be,"requireFailure",this))return this;var Ne=this.requireFail;return be=Aa(be,this),hr(Ne,be)===-1&&(Ne.push(be),be.requireFailure(this)),this},dropRequireFailure:function(be){if($e(be,"dropRequireFailure",this))return this;be=Aa(be,this);var Ne=hr(this.requireFail,be);return Ne>-1&&this.requireFail.splice(Ne,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(be){return!!this.simultaneous[be.id]},emit:function(be){var Ne=this,pt=this.state;function rr(Xr){Ne.manager.emit(Xr,be)}pt<Xi&&rr(Ne.options.event+Bs(pt)),rr(Ne.options.event),be.additionalEvent&&rr(be.additionalEvent),pt>=Xi&&rr(Ne.options.event+Bs(pt))},tryEmit:function(be){if(this.canEmit())return this.emit(be);this.state=ba},canEmit:function(){for(var be=0;be<this.requireFail.length;){if(!(this.requireFail[be].state&(ba|Ca)))return!1;be++}return!0},recognize:function(be){var Ne=zt({},be);if(!ee(this.options.enable,[this,Ne])){this.reset(),this.state=ba;return}this.state&(va|Vo|ba)&&(this.state=Ca),this.state=this.process(Ne),this.state&(ii|ti|Xi|Vo)&&this.tryEmit(Ne)},process:function(be){},getTouchAction:function(){},reset:function(){}};function Bs(be){return be&Vo?"cancel":be&Xi?"end":be&ti?"move":be&ii?"start":""}function nu(be){return be==Be?"down":be==Se?"up":be==T?"left":be==G?"right":""}function Aa(be,Ne){var pt=Ne.manager;return pt?pt.get(be):be}function Io(){gi.apply(this,arguments)}at(Io,gi,{defaults:{pointers:1},attrTest:function(be){var Ne=this.options.pointers;return Ne===0||be.pointers.length===Ne},process:function(be){var Ne=this.state,pt=be.eventType,rr=Ne&(ii|ti),Xr=this.attrTest(be);return rr&&(pt&Ft||!Xr)?Ne|Vo:rr||Xr?pt&ke?Ne|Xi:Ne&ii?Ne|ti:ii:ba}});function zi(){Io.apply(this,arguments),this.pX=null,this.pY=null}at(zi,Io,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ct},getTouchAction:function(){var be=this.options.direction,Ne=[];return be&et&&Ne.push(ai),be&tt&&Ne.push($i),Ne},directionTest:function(be){var Ne=this.options,pt=!0,rr=be.distance,Xr=be.direction,Kn=be.deltaX,vi=be.deltaY;return Xr&Ne.direction||(Ne.direction&et?(Xr=Kn===0?ir:Kn<0?T:G,pt=Kn!=this.pX,rr=Math.abs(be.deltaX)):(Xr=vi===0?ir:vi<0?Se:Be,pt=vi!=this.pY,rr=Math.abs(be.deltaY))),be.direction=Xr,pt&&rr>Ne.threshold&&Xr&Ne.direction},attrTest:function(be){return Io.prototype.attrTest.call(this,be)&&(this.state&ii||!(this.state&ii)&&this.directionTest(be))},emit:function(be){this.pX=be.deltaX,this.pY=be.deltaY;var Ne=nu(be.direction);Ne&&(be.additionalEvent=this.options.event+Ne),this._super.emit.call(this,be)}});function Ka(){Io.apply(this,arguments)}at(Ka,Io,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Li]},attrTest:function(be){return this._super.attrTest.call(this,be)&&(Math.abs(be.scale-1)>this.options.threshold||this.state&ii)},emit:function(be){if(be.scale!==1){var Ne=be.scale<1?"in":"out";be.additionalEvent=this.options.event+Ne}this._super.emit.call(this,be)}});function Go(){gi.apply(this,arguments),this._timer=null,this._input=null}at(Go,gi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[wi]},process:function(be){var Ne=this.options,pt=be.pointers.length===Ne.pointers,rr=be.distance<Ne.threshold,Xr=be.deltaTime>Ne.time;if(this._input=be,!rr||!pt||be.eventType&(ke|Ft)&&!Xr)this.reset();else if(be.eventType&Pe)this.reset(),this._timer=Re(function(){this.state=va,this.tryEmit()},Ne.time,this);else if(be.eventType&ke)return va;return ba},reset:function(){clearTimeout(this._timer)},emit:function(be){this.state===va&&(be&&be.eventType&ke?this.manager.emit(this.options.event+"up",be):(this._input.timeStamp=xe(),this.manager.emit(this.options.event,this._input)))}});function ea(){Io.apply(this,arguments)}at(ea,Io,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Li]},attrTest:function(be){return this._super.attrTest.call(this,be)&&(Math.abs(be.rotation)>this.options.threshold||this.state&ii)}});function To(){Io.apply(this,arguments)}at(To,Io,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:et|tt,pointers:1},getTouchAction:function(){return zi.prototype.getTouchAction.call(this)},attrTest:function(be){var Ne=this.options.direction,pt;return Ne&(et|tt)?pt=be.overallVelocity:Ne&et?pt=be.overallVelocityX:Ne&tt&&(pt=be.overallVelocityY),this._super.attrTest.call(this,be)&&Ne&be.offsetDirection&&be.distance>this.options.threshold&&be.maxPointers==this.options.pointers&&_e(pt)>this.options.velocity&&be.eventType&ke},emit:function(be){var Ne=nu(be.offsetDirection);Ne&&this.manager.emit(this.options.event+Ne,be),this.manager.emit(this.options.event,be)}});function Oo(){gi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}at(Oo,gi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[xn]},process:function(be){var Ne=this.options,pt=be.pointers.length===Ne.pointers,rr=be.distance<Ne.threshold,Xr=be.deltaTime<Ne.time;if(this.reset(),be.eventType&Pe&&this.count===0)return this.failTimeout();if(rr&&Xr&&pt){if(be.eventType!=ke)return this.failTimeout();var Kn=this.pTime?be.timeStamp-this.pTime<Ne.interval:!0,vi=!this.pCenter||Ur(this.pCenter,be.center)<Ne.posThreshold;this.pTime=be.timeStamp,this.pCenter=be.center,!vi||!Kn?this.count=1:this.count+=1,this._input=be;var Ga=this.count%Ne.taps;if(Ga===0)return this.hasRequireFailures()?(this._timer=Re(function(){this.state=va,this.tryEmit()},Ne.interval,this),ii):va}return ba},failTimeout:function(){return this._timer=Re(function(){this.state=ba},this.options.interval,this),ba},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==va&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function co(be,Ne){return Ne=Ne||{},Ne.recognizers=fr(Ne.recognizers,co.defaults.preset),new Da(be,Ne)}co.VERSION="2.0.7",co.defaults={domEvents:!1,touchAction:cn,enable:!0,inputTarget:null,inputClass:null,preset:[[ea,{enable:!1}],[Ka,{enable:!1},["rotate"]],[To,{direction:et}],[zi,{direction:et},["swipe"]],[Oo],[Oo,{event:"doubletap",taps:2},["tap"]],[Go]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var fo=1,Yi=2;function Da(be,Ne){this.options=zt({},co.defaults,Ne||{}),this.options.inputTarget=this.options.inputTarget||be,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=be,this.input=ne(this),this.touchAction=new Ni(this,this.options.touchAction),ka(this,!0),Rt(this.options.recognizers,function(pt){var rr=this.add(new pt[0](pt[1]));pt[2]&&rr.recognizeWith(pt[2]),pt[3]&&rr.requireFailure(pt[3])},this)}Da.prototype={set:function(be){return zt(this.options,be),be.touchAction&&this.touchAction.update(),be.inputTarget&&(this.input.destroy(),this.input.target=be.inputTarget,this.input.init()),this},stop:function(be){this.session.stopped=be?Yi:fo},recognize:function(be){var Ne=this.session;if(!Ne.stopped){this.touchAction.preventDefaults(be);var pt,rr=this.recognizers,Xr=Ne.curRecognizer;(!Xr||Xr&&Xr.state&va)&&(Xr=Ne.curRecognizer=null);for(var Kn=0;Kn<rr.length;)pt=rr[Kn],Ne.stopped!==Yi&&(!Xr||pt==Xr||pt.canRecognizeWith(Xr))?pt.recognize(be):pt.reset(),!Xr&&pt.state&(ii|ti|Xi)&&(Xr=Ne.curRecognizer=pt),Kn++}},get:function(be){if(be instanceof gi)return be;for(var Ne=this.recognizers,pt=0;pt<Ne.length;pt++)if(Ne[pt].options.event==be)return Ne[pt];return null},add:function(be){if($e(be,"add",this))return this;var Ne=this.get(be.options.event);return Ne&&this.remove(Ne),this.recognizers.push(be),be.manager=this,this.touchAction.update(),be},remove:function(be){if($e(be,"remove",this))return this;if(be=this.get(be),be){var Ne=this.recognizers,pt=hr(Ne,be);pt!==-1&&(Ne.splice(pt,1),this.touchAction.update())}return this},on:function(be,Ne){if(be!==Z&&Ne!==Z){var pt=this.handlers;return Rt(It(be),function(rr){pt[rr]=pt[rr]||[],pt[rr].push(Ne)}),this}},off:function(be,Ne){if(be!==Z){var pt=this.handlers;return Rt(It(be),function(rr){Ne?pt[rr]&&pt[rr].splice(hr(pt[rr],Ne),1):delete pt[rr]}),this}},emit:function(be,Ne){this.options.domEvents&&fs(be,Ne);var pt=this.handlers[be]&&this.handlers[be].slice();if(!(!pt||!pt.length)){Ne.type=be,Ne.preventDefault=function(){Ne.srcEvent.preventDefault()};for(var rr=0;rr<pt.length;)pt[rr](Ne),rr++}},destroy:function(){this.element&&ka(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ka(be,Ne){var pt=be.element;if(!!pt.style){var rr;Rt(be.options.cssProps,function(Xr,Kn){rr=fe(pt.style,Kn),Ne?(be.oldCssProps[rr]=pt.style[rr],pt.style[rr]=Xr):pt.style[rr]=be.oldCssProps[rr]||""}),Ne||(be.oldCssProps={})}}function fs(be,Ne){var pt=p.createEvent("Event");pt.initEvent(be,!0,!0),pt.gesture=Ne,Ne.target.dispatchEvent(pt)}zt(co,{INPUT_START:Pe,INPUT_MOVE:Ge,INPUT_END:ke,INPUT_CANCEL:Ft,STATE_POSSIBLE:Ca,STATE_BEGAN:ii,STATE_CHANGED:ti,STATE_ENDED:Xi,STATE_RECOGNIZED:va,STATE_CANCELLED:Vo,STATE_FAILED:ba,DIRECTION_NONE:ir,DIRECTION_LEFT:T,DIRECTION_RIGHT:G,DIRECTION_UP:Se,DIRECTION_DOWN:Be,DIRECTION_HORIZONTAL:et,DIRECTION_VERTICAL:tt,DIRECTION_ALL:Ct,Manager:Da,Input:Qt,TouchAction:Ni,TouchInput:mt,MouseInput:Hi,PointerEventInput:ce,TouchMouseInput:kr,SingleTouchInput:de,Recognizer:gi,AttrRecognizer:Io,Tap:Oo,Pan:zi,Swipe:To,Pinch:Ka,Rotate:ea,Press:Go,on:At,off:Je,each:Rt,merge:Et,extend:St,assign:zt,inherit:at,bindFn:ur,prefixed:fe});var Sa=typeof b!="undefined"?b:typeof self!="undefined"?self:{};Sa.Hammer=co,U=function(){return co}.call(D,g,D,Qe),U!==Z&&(Qe.exports=U)})(window,document,"Hammer")},7375:function(Qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0});var g=Symbol.for("INJECTION");function U(V,H,I,L){function _e(){return L&&!Reflect.hasMetadata(g,this,H)&&Reflect.defineMetadata(g,I(),this,H),Reflect.hasMetadata(g,this,H)?Reflect.getMetadata(g,this,H):I()}function xe(Re){Reflect.defineMetadata(g,Re,this,H)}Object.defineProperty(V,H,{configurable:!0,enumerable:!0,get:_e,set:xe})}function b(V,H){return function(I){return function(L,_e){var xe=function(){return V.get(I)};U(L,_e,xe,H)}}}D.makePropertyInjectDecorator=b;function p(V,H){return function(I,L){return function(_e,xe){var Re=function(){return V.getNamed(I,L)};U(_e,xe,Re,H)}}}D.makePropertyInjectNamedDecorator=p;function E(V,H){return function(I,L,_e){return function(xe,Re){var $e=function(){return V.getTagged(I,L,_e)};U(xe,Re,$e,H)}}}D.makePropertyInjectTaggedDecorator=E;function Z(V,H){return function(I){return function(L,_e){var xe=function(){return V.getAll(I)};U(L,_e,xe,H)}}}D.makePropertyMultiInjectDecorator=Z},84879:function(Qe,D,g){"use strict";var U;U={value:!0};var b=g(7375);function p(E,Z){Z===void 0&&(Z=!0);var V=b.makePropertyInjectDecorator(E,Z),H=b.makePropertyInjectNamedDecorator(E,Z),I=b.makePropertyInjectTaggedDecorator(E,Z),L=b.makePropertyMultiInjectDecorator(E,Z);return{lazyInject:V,lazyInjectNamed:H,lazyInjectTagged:I,lazyMultiInject:L}}D.Z=p},99934:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.tagProperty=D.tagParameter=D.decorate=void 0;var U=g(16674),b=g(6867);function p(L,_e,xe,Re){var $e=b.TAGGED;Z($e,L,_e,Re,xe)}D.tagParameter=p;function E(L,_e,xe){var Re=b.TAGGED_PROP;Z(Re,L.constructor,_e,xe)}D.tagProperty=E;function Z(L,_e,xe,Re,$e){var Rt={},Lt=typeof $e=="number",zt=$e!==void 0&&Lt?$e.toString():xe;if(Lt&&xe!==void 0)throw new Error(U.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(L,_e)&&(Rt=Reflect.getMetadata(L,_e));var St=Rt[zt];if(!Array.isArray(St))St=[];else for(var Et=0,at=St;Et<at.length;Et++){var ur=at[Et];if(ur.key===Re.key)throw new Error(U.DUPLICATED_METADATA+" "+ur.key.toString())}St.push(Re),Rt[zt]=St,Reflect.defineMetadata(L,Rt,_e)}function V(L,_e){Reflect.decorate(L,_e)}function H(L,_e){return function(xe,Re){_e(xe,Re,L)}}function I(L,_e,xe){typeof xe=="number"?V([H(xe,L)],_e):typeof xe=="string"?Reflect.decorate([L],_e,xe):V([L],_e)}D.decorate=I},5744:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.inject=D.LazyServiceIdentifer=void 0;var U=g(16674),b=g(6867),p=g(47738),E=g(99934),Z=function(){function H(I){this._cb=I}return H.prototype.unwrap=function(){return this._cb()},H}();D.LazyServiceIdentifer=Z;function V(H){return function(I,L,_e){if(H===void 0)throw new Error(U.UNDEFINED_INJECT_ANNOTATION(I.name));var xe=new p.Metadata(b.INJECT_TAG,H);typeof _e=="number"?E.tagParameter(I,L,_e,xe):E.tagProperty(I,L,xe)}}D.inject=V},64315:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.injectable=void 0;var U=g(16674),b=g(6867);function p(){return function(E){if(Reflect.hasOwnMetadata(b.PARAM_TYPES,E))throw new Error(U.DUPLICATED_INJECTABLE_DECORATOR);var Z=Reflect.getMetadata(b.DESIGN_PARAM_TYPES,E)||[];return Reflect.defineMetadata(b.PARAM_TYPES,Z,E),E}}D.injectable=p},71693:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.multiInject=void 0;var U=g(6867),b=g(47738),p=g(99934);function E(Z){return function(V,H,I){var L=new b.Metadata(U.MULTI_INJECT_TAG,Z);typeof I=="number"?p.tagParameter(V,H,I,L):p.tagProperty(V,H,L)}}D.multiInject=E},38085:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.named=void 0;var U=g(6867),b=g(47738),p=g(99934);function E(Z){return function(V,H,I){var L=new b.Metadata(U.NAMED_TAG,Z);typeof I=="number"?p.tagParameter(V,H,I,L):p.tagProperty(V,H,L)}}D.named=E},6515:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.optional=void 0;var U=g(6867),b=g(47738),p=g(99934);function E(){return function(Z,V,H){var I=new b.Metadata(U.OPTIONAL_TAG,!0);typeof H=="number"?p.tagParameter(Z,V,H,I):p.tagProperty(Z,V,I)}}D.optional=E},7014:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.postConstruct=void 0;var U=g(16674),b=g(6867),p=g(47738);function E(){return function(Z,V,H){var I=new p.Metadata(b.POST_CONSTRUCT,V);if(Reflect.hasOwnMetadata(b.POST_CONSTRUCT,Z.constructor))throw new Error(U.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(b.POST_CONSTRUCT,I,Z.constructor)}}D.postConstruct=E},32052:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.tagged=void 0;var U=g(47738),b=g(99934);function p(E,Z){return function(V,H,I){var L=new U.Metadata(E,Z);typeof I=="number"?b.tagParameter(V,H,I,L):b.tagProperty(V,H,L)}}D.tagged=p},55638:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.targetName=void 0;var U=g(6867),b=g(47738),p=g(99934);function E(Z){return function(V,H,I){var L=new b.Metadata(U.NAME_TAG,Z);p.tagParameter(V,H,I,L)}}D.targetName=E},86757:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.unmanaged=void 0;var U=g(6867),b=g(47738),p=g(99934);function E(){return function(Z,V,H){var I=new b.Metadata(U.UNMANAGED_TAG,!0);p.tagParameter(Z,V,H,I)}}D.unmanaged=E},44290:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Binding=void 0;var U=g(28421),b=g(37791),p=function(){function E(Z,V){this.id=b.id(),this.activated=!1,this.serviceIdentifier=Z,this.scope=V,this.type=U.BindingTypeEnum.Invalid,this.constraint=function(H){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return E.prototype.clone=function(){var Z=new E(this.serviceIdentifier,this.scope);return Z.activated=Z.scope===U.BindingScopeEnum.Singleton?this.activated:!1,Z.implementationType=this.implementationType,Z.dynamicValue=this.dynamicValue,Z.scope=this.scope,Z.type=this.type,Z.factory=this.factory,Z.provider=this.provider,Z.constraint=this.constraint,Z.onActivation=this.onActivation,Z.cache=this.cache,Z},E}();D.Binding=p},23184:function(Qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingCount=void 0;var g={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};D.BindingCount=g},16674:function(Qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.STACK_OVERFLOW=D.CIRCULAR_DEPENDENCY_IN_FACTORY=D.POST_CONSTRUCT_ERROR=D.MULTIPLE_POST_CONSTRUCT_METHODS=D.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=D.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=D.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=D.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=D.ARGUMENTS_LENGTH_MISMATCH=D.INVALID_DECORATOR_OPERATION=D.INVALID_TO_SELF_VALUE=D.INVALID_FUNCTION_BINDING=D.INVALID_MIDDLEWARE_RETURN=D.NO_MORE_SNAPSHOTS_AVAILABLE=D.INVALID_BINDING_TYPE=D.NOT_IMPLEMENTED=D.CIRCULAR_DEPENDENCY=D.UNDEFINED_INJECT_ANNOTATION=D.MISSING_INJECT_ANNOTATION=D.MISSING_INJECTABLE_ANNOTATION=D.NOT_REGISTERED=D.CANNOT_UNBIND=D.AMBIGUOUS_MATCH=D.KEY_NOT_FOUND=D.NULL_ARGUMENT=D.DUPLICATED_METADATA=D.DUPLICATED_INJECTABLE_DECORATOR=void 0,D.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",D.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",D.NULL_ARGUMENT="NULL argument",D.KEY_NOT_FOUND="Key Not Found",D.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",D.CANNOT_UNBIND="Could not unbind serviceIdentifier:",D.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",D.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",D.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var g=function(E){return"@inject called with undefined this could mean that the class "+E+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};D.UNDEFINED_INJECT_ANNOTATION=g,D.CIRCULAR_DEPENDENCY="Circular dependency found:",D.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",D.INVALID_BINDING_TYPE="Invalid binding type:",D.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",D.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",D.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",D.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",D.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var U=function(){for(var E=[],Z=0;Z<arguments.length;Z++)E[Z]=arguments[Z];return"The number of constructor arguments in the derived class "+(E[0]+" must be >= than the number of constructor arguments of its base class.")};D.ARGUMENTS_LENGTH_MISMATCH=U,D.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",D.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",D.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",D.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",D.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var b=function(){for(var E=[],Z=0;Z<arguments.length;Z++)E[Z]=arguments[Z];return"@postConstruct error in class "+E[0]+": "+E[1]};D.POST_CONSTRUCT_ERROR=b;var p=function(){for(var E=[],Z=0;Z<arguments.length;Z++)E[Z]=arguments[Z];return"It looks like there is a circular dependency "+("in one of the '"+E[0]+"' bindings. Please investigate bindings with")+("service identifier '"+E[1]+"'.")};D.CIRCULAR_DEPENDENCY_IN_FACTORY=p,D.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.TargetTypeEnum=D.BindingTypeEnum=D.BindingScopeEnum=void 0;var g={Request:"Request",Singleton:"Singleton",Transient:"Transient"};D.BindingScopeEnum=g;var U={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};D.BindingTypeEnum=U;var b={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};D.TargetTypeEnum=b},6867:function(Qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.NON_CUSTOM_TAG_KEYS=D.POST_CONSTRUCT=D.DESIGN_PARAM_TYPES=D.PARAM_TYPES=D.TAGGED_PROP=D.TAGGED=D.MULTI_INJECT_TAG=D.INJECT_TAG=D.OPTIONAL_TAG=D.UNMANAGED_TAG=D.NAME_TAG=D.NAMED_TAG=void 0,D.NAMED_TAG="named",D.NAME_TAG="name",D.UNMANAGED_TAG="unmanaged",D.OPTIONAL_TAG="optional",D.INJECT_TAG="inject",D.MULTI_INJECT_TAG="multi_inject",D.TAGGED="inversify:tagged",D.TAGGED_PROP="inversify:tagged_props",D.PARAM_TYPES="inversify:paramtypes",D.DESIGN_PARAM_TYPES="design:paramtypes",D.POST_CONSTRUCT="post_construct";function g(){return[D.INJECT_TAG,D.MULTI_INJECT_TAG,D.NAME_TAG,D.UNMANAGED_TAG,D.NAMED_TAG,D.OPTIONAL_TAG]}D.NON_CUSTOM_TAG_KEYS=g()},51389:function(Qe,D,g){"use strict";var U=this&&this.__awaiter||function(St,Et,at,ur){function ee(fr){return fr instanceof at?fr:new at(function(At){At(fr)})}return new(at||(at=Promise))(function(fr,At){function Je(It){try{Ve(ur.next(It))}catch(hr){At(hr)}}function Pt(It){try{Ve(ur.throw(It))}catch(hr){At(hr)}}function Ve(It){It.done?fr(It.value):ee(It.value).then(Je,Pt)}Ve((ur=ur.apply(St,Et||[])).next())})},b=this&&this.__generator||function(St,Et){var at={label:0,sent:function(){if(fr[0]&1)throw fr[1];return fr[1]},trys:[],ops:[]},ur,ee,fr,At;return At={next:Je(0),throw:Je(1),return:Je(2)},typeof Symbol=="function"&&(At[Symbol.iterator]=function(){return this}),At;function Je(Ve){return function(It){return Pt([Ve,It])}}function Pt(Ve){if(ur)throw new TypeError("Generator is already executing.");for(;at;)try{if(ur=1,ee&&(fr=Ve[0]&2?ee.return:Ve[0]?ee.throw||((fr=ee.return)&&fr.call(ee),0):ee.next)&&!(fr=fr.call(ee,Ve[1])).done)return fr;switch(ee=0,fr&&(Ve=[Ve[0]&2,fr.value]),Ve[0]){case 0:case 1:fr=Ve;break;case 4:return at.label++,{value:Ve[1],done:!1};case 5:at.label++,ee=Ve[1],Ve=[0];continue;case 7:Ve=at.ops.pop(),at.trys.pop();continue;default:if(fr=at.trys,!(fr=fr.length>0&&fr[fr.length-1])&&(Ve[0]===6||Ve[0]===2)){at=0;continue}if(Ve[0]===3&&(!fr||Ve[1]>fr[0]&&Ve[1]<fr[3])){at.label=Ve[1];break}if(Ve[0]===6&&at.label<fr[1]){at.label=fr[1],fr=Ve;break}if(fr&&at.label<fr[2]){at.label=fr[2],at.ops.push(Ve);break}fr[2]&&at.ops.pop(),at.trys.pop();continue}Ve=Et.call(St,at)}catch(It){Ve=[6,It],ee=0}finally{ur=fr=0}if(Ve[0]&5)throw Ve[1];return{value:Ve[0]?Ve[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(St,Et){for(var at=0,ur=Et.length,ee=St.length;at<ur;at++,ee++)St[ee]=Et[at];return St};Object.defineProperty(D,"__esModule",{value:!0}),D.Container=void 0;var E=g(44290),Z=g(16674),V=g(28421),H=g(6867),I=g(51377),L=g(86311),_e=g(31927),xe=g(15451),Re=g(37791),$e=g(55800),Rt=g(85700),Lt=g(80175),zt=function(){function St(Et){this._appliedMiddleware=[];var at=Et||{};if(typeof at!="object")throw new Error(""+Z.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(at.defaultScope===void 0)at.defaultScope=V.BindingScopeEnum.Transient;else if(at.defaultScope!==V.BindingScopeEnum.Singleton&&at.defaultScope!==V.BindingScopeEnum.Transient&&at.defaultScope!==V.BindingScopeEnum.Request)throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(at.autoBindInjectable===void 0)at.autoBindInjectable=!1;else if(typeof at.autoBindInjectable!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(at.skipBaseClassChecks===void 0)at.skipBaseClassChecks=!1;else if(typeof at.skipBaseClassChecks!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:at.autoBindInjectable,defaultScope:at.defaultScope,skipBaseClassChecks:at.skipBaseClassChecks},this.id=Re.id(),this._bindingDictionary=new Lt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new I.MetadataReader}return St.merge=function(Et,at){for(var ur=[],ee=2;ee<arguments.length;ee++)ur[ee-2]=arguments[ee];var fr=new St,At=p([Et,at],ur).map(function(Ve){return L.getBindingDictionary(Ve)}),Je=L.getBindingDictionary(fr);function Pt(Ve,It){Ve.traverse(function(hr,Jt){Jt.forEach(function(Fr){It.add(Fr.serviceIdentifier,Fr.clone())})})}return At.forEach(function(Ve){Pt(Ve,Je)}),fr},St.prototype.load=function(){for(var Et=[],at=0;at<arguments.length;at++)Et[at]=arguments[at];for(var ur=this._getContainerModuleHelpersFactory(),ee=0,fr=Et;ee<fr.length;ee++){var At=fr[ee],Je=ur(At.id);At.registry(Je.bindFunction,Je.unbindFunction,Je.isboundFunction,Je.rebindFunction)}},St.prototype.loadAsync=function(){for(var Et=[],at=0;at<arguments.length;at++)Et[at]=arguments[at];return U(this,void 0,void 0,function(){var ur,ee,fr,At,Je;return b(this,function(Pt){switch(Pt.label){case 0:ur=this._getContainerModuleHelpersFactory(),ee=0,fr=Et,Pt.label=1;case 1:return ee<fr.length?(At=fr[ee],Je=ur(At.id),[4,At.registry(Je.bindFunction,Je.unbindFunction,Je.isboundFunction,Je.rebindFunction)]):[3,4];case 2:Pt.sent(),Pt.label=3;case 3:return ee++,[3,1];case 4:return[2]}})})},St.prototype.unload=function(){for(var Et=this,at=[],ur=0;ur<arguments.length;ur++)at[ur]=arguments[ur];var ee=function(fr){return function(At){return At.moduleId===fr}};at.forEach(function(fr){var At=ee(fr.id);Et._bindingDictionary.removeByCondition(At)})},St.prototype.bind=function(Et){var at=this.options.defaultScope||V.BindingScopeEnum.Transient,ur=new E.Binding(Et,at);return this._bindingDictionary.add(Et,ur),new xe.BindingToSyntax(ur)},St.prototype.rebind=function(Et){return this.unbind(Et),this.bind(Et)},St.prototype.unbind=function(Et){try{this._bindingDictionary.remove(Et)}catch(at){throw new Error(Z.CANNOT_UNBIND+" "+$e.getServiceIdentifierAsString(Et))}},St.prototype.unbindAll=function(){this._bindingDictionary=new Lt.Lookup},St.prototype.isBound=function(Et){var at=this._bindingDictionary.hasKey(Et);return!at&&this.parent&&(at=this.parent.isBound(Et)),at},St.prototype.isBoundNamed=function(Et,at){return this.isBoundTagged(Et,H.NAMED_TAG,at)},St.prototype.isBoundTagged=function(Et,at,ur){var ee=!1;if(this._bindingDictionary.hasKey(Et)){var fr=this._bindingDictionary.get(Et),At=L.createMockRequest(this,Et,at,ur);ee=fr.some(function(Je){return Je.constraint(At)})}return!ee&&this.parent&&(ee=this.parent.isBoundTagged(Et,at,ur)),ee},St.prototype.snapshot=function(){this._snapshots.push(Rt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},St.prototype.restore=function(){var Et=this._snapshots.pop();if(Et===void 0)throw new Error(Z.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Et.bindings,this._middleware=Et.middleware},St.prototype.createChild=function(Et){var at=new St(Et||this.options);return at.parent=this,at},St.prototype.applyMiddleware=function(){for(var Et=[],at=0;at<arguments.length;at++)Et[at]=arguments[at];this._appliedMiddleware=this._appliedMiddleware.concat(Et);var ur=this._middleware?this._middleware:this._planAndResolve();this._middleware=Et.reduce(function(ee,fr){return fr(ee)},ur)},St.prototype.applyCustomMetadataReader=function(Et){this._metadataReader=Et},St.prototype.get=function(Et){return this._get(!1,!1,V.TargetTypeEnum.Variable,Et)},St.prototype.getTagged=function(Et,at,ur){return this._get(!1,!1,V.TargetTypeEnum.Variable,Et,at,ur)},St.prototype.getNamed=function(Et,at){return this.getTagged(Et,H.NAMED_TAG,at)},St.prototype.getAll=function(Et){return this._get(!0,!0,V.TargetTypeEnum.Variable,Et)},St.prototype.getAllTagged=function(Et,at,ur){return this._get(!1,!0,V.TargetTypeEnum.Variable,Et,at,ur)},St.prototype.getAllNamed=function(Et,at){return this.getAllTagged(Et,H.NAMED_TAG,at)},St.prototype.resolve=function(Et){var at=this.createChild();return at.bind(Et).toSelf(),this._appliedMiddleware.forEach(function(ur){at.applyMiddleware(ur)}),at.get(Et)},St.prototype._getContainerModuleHelpersFactory=function(){var Et=this,at=function(Je,Pt){Je._binding.moduleId=Pt},ur=function(Je){return function(Pt){var Ve=Et.bind.bind(Et),It=Ve(Pt);return at(It,Je),It}},ee=function(Je){return function(Pt){var Ve=Et.unbind.bind(Et);Ve(Pt)}},fr=function(Je){return function(Pt){var Ve=Et.isBound.bind(Et);return Ve(Pt)}},At=function(Je){return function(Pt){var Ve=Et.rebind.bind(Et),It=Ve(Pt);return at(It,Je),It}};return function(Je){return{bindFunction:ur(Je),isboundFunction:fr(Je),rebindFunction:At(Je),unbindFunction:ee(Je)}}},St.prototype._get=function(Et,at,ur,ee,fr,At){var Je=null,Pt={avoidConstraints:Et,contextInterceptor:function(Ve){return Ve},isMultiInject:at,key:fr,serviceIdentifier:ee,targetType:ur,value:At};if(this._middleware){if(Je=this._middleware(Pt),Je==null)throw new Error(Z.INVALID_MIDDLEWARE_RETURN)}else Je=this._planAndResolve()(Pt);return Je},St.prototype._planAndResolve=function(){var Et=this;return function(at){var ur=L.plan(Et._metadataReader,Et,at.isMultiInject,at.targetType,at.serviceIdentifier,at.key,at.value,at.avoidConstraints);ur=at.contextInterceptor(ur);var ee=_e.resolve(ur);return ee}},St}();D.Container=zt},33244:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.AsyncContainerModule=D.ContainerModule=void 0;var U=g(37791),b=function(){function E(Z){this.id=U.id(),this.registry=Z}return E}();D.ContainerModule=b;var p=function(){function E(Z){this.id=U.id(),this.registry=Z}return E}();D.AsyncContainerModule=p},85700:function(Qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.ContainerSnapshot=void 0;var g=function(){function U(){}return U.of=function(b,p){var E=new U;return E.bindings=b,E.middleware=p,E},U}();D.ContainerSnapshot=g},80175:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Lookup=void 0;var U=g(16674),b=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(E,Z){if(E==null)throw new Error(U.NULL_ARGUMENT);if(Z==null)throw new Error(U.NULL_ARGUMENT);var V=this._map.get(E);V!==void 0?(V.push(Z),this._map.set(E,V)):this._map.set(E,[Z])},p.prototype.get=function(E){if(E==null)throw new Error(U.NULL_ARGUMENT);var Z=this._map.get(E);if(Z!==void 0)return Z;throw new Error(U.KEY_NOT_FOUND)},p.prototype.remove=function(E){if(E==null)throw new Error(U.NULL_ARGUMENT);if(!this._map.delete(E))throw new Error(U.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(E){var Z=this;this._map.forEach(function(V,H){var I=V.filter(function(L){return!E(L)});I.length>0?Z._map.set(H,I):Z._map.delete(H)})},p.prototype.hasKey=function(E){if(E==null)throw new Error(U.NULL_ARGUMENT);return this._map.has(E)},p.prototype.clone=function(){var E=new p;return this._map.forEach(function(Z,V){Z.forEach(function(H){return E.add(V,H.clone())})}),E},p.prototype.traverse=function(E){this._map.forEach(function(Z,V){E(V,Z)})},p}();D.Lookup=b},86700:function(Qe,D,g){"use strict";var U;U={value:!0},U=U=U=U=U=U=D.GW=U=U=D.zY=U=U=U=U=U=D.f3=U=U=D.b2=U=U=U=U=U=D.W2=U=void 0;var b=g(6867);U=b;var p=g(51389);Object.defineProperty(D,"W2",{enumerable:!0,get:function(){return p.Container}});var E=g(28421);U={enumerable:!0,get:function(){return E.BindingScopeEnum}},U={enumerable:!0,get:function(){return E.BindingTypeEnum}},U={enumerable:!0,get:function(){return E.TargetTypeEnum}};var Z=g(33244);U={enumerable:!0,get:function(){return Z.AsyncContainerModule}},U={enumerable:!0,get:function(){return Z.ContainerModule}};var V=g(64315);Object.defineProperty(D,"b2",{enumerable:!0,get:function(){return V.injectable}});var H=g(32052);U={enumerable:!0,get:function(){return H.tagged}};var I=g(38085);U={enumerable:!0,get:function(){return I.named}};var L=g(5744);Object.defineProperty(D,"f3",{enumerable:!0,get:function(){return L.inject}}),U={enumerable:!0,get:function(){return L.LazyServiceIdentifer}};var _e=g(6515);U={enumerable:!0,get:function(){return _e.optional}};var xe=g(86757);U={enumerable:!0,get:function(){return xe.unmanaged}};var Re=g(71693);U={enumerable:!0,get:function(){return Re.multiInject}};var $e=g(55638);U={enumerable:!0,get:function(){return $e.targetName}};var Rt=g(7014);Object.defineProperty(D,"zY",{enumerable:!0,get:function(){return Rt.postConstruct}});var Lt=g(51377);U={enumerable:!0,get:function(){return Lt.MetadataReader}};var zt=g(37791);U={enumerable:!0,get:function(){return zt.id}};var St=g(99934);Object.defineProperty(D,"GW",{enumerable:!0,get:function(){return St.decorate}});var Et=g(80758);U={enumerable:!0,get:function(){return Et.traverseAncerstors}},U={enumerable:!0,get:function(){return Et.taggedConstraint}},U={enumerable:!0,get:function(){return Et.namedConstraint}},U={enumerable:!0,get:function(){return Et.typeConstraint}};var at=g(55800);U={enumerable:!0,get:function(){return at.getServiceIdentifierAsString}};var ur=g(70600);U={enumerable:!0,get:function(){return ur.multiBindToService}}},95228:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Context=void 0;var U=g(37791),b=function(){function p(E){this.id=U.id(),this.container=E}return p.prototype.addPlan=function(E){this.plan=E},p.prototype.setCurrentRequest=function(E){this.currentRequest=E},p}();D.Context=b},47738:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Metadata=void 0;var U=g(6867),b=function(){function p(E,Z){this.key=E,this.value=Z}return p.prototype.toString=function(){return this.key===U.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();D.Metadata=b},51377:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.MetadataReader=void 0;var U=g(6867),b=function(){function p(){}return p.prototype.getConstructorMetadata=function(E){var Z=Reflect.getMetadata(U.PARAM_TYPES,E),V=Reflect.getMetadata(U.TAGGED,E);return{compilerGeneratedMetadata:Z,userGeneratedMetadata:V||{}}},p.prototype.getPropertiesMetadata=function(E){var Z=Reflect.getMetadata(U.TAGGED_PROP,E)||[];return Z},p}();D.MetadataReader=b},55314:function(Qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Plan=void 0;var g=function(){function U(b,p){this.parentContext=b,this.rootRequest=p}return U}();D.Plan=g},86311:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.getBindingDictionary=D.createMockRequest=D.plan=void 0;var U=g(23184),b=g(16674),p=g(28421),E=g(6867),Z=g(85265),V=g(55800),H=g(95228),I=g(47738),L=g(55314),_e=g(6e3),xe=g(6748),Re=g(18924);function $e(ee){return ee._bindingDictionary}D.getBindingDictionary=$e;function Rt(ee,fr,At,Je,Pt,Ve){var It=ee?E.MULTI_INJECT_TAG:E.INJECT_TAG,hr=new I.Metadata(It,At),Jt=new Re.Target(fr,Je,At,hr);if(Pt!==void 0){var Fr=new I.Metadata(Pt,Ve);Jt.metadata.push(Fr)}return Jt}function Lt(ee,fr,At,Je,Pt){var Ve=Et(At.container,Pt.serviceIdentifier),It=[];return Ve.length===U.BindingCount.NoBindingsAvailable&&At.container.options.autoBindInjectable&&typeof Pt.serviceIdentifier=="function"&&ee.getConstructorMetadata(Pt.serviceIdentifier).compilerGeneratedMetadata&&(At.container.bind(Pt.serviceIdentifier).toSelf(),Ve=Et(At.container,Pt.serviceIdentifier)),fr?It=Ve:It=Ve.filter(function(hr){var Jt=new xe.Request(hr.serviceIdentifier,At,Je,hr,Pt);return hr.constraint(Jt)}),zt(Pt.serviceIdentifier,It,Pt,At.container),It}function zt(ee,fr,At,Je){switch(fr.length){case U.BindingCount.NoBindingsAvailable:if(At.isOptional())return fr;var Pt=V.getServiceIdentifierAsString(ee),Ve=b.NOT_REGISTERED;throw Ve+=V.listMetadataForTarget(Pt,At),Ve+=V.listRegisteredBindingsForServiceIdentifier(Je,Pt,Et),new Error(Ve);case U.BindingCount.OnlyOneBindingAvailable:if(!At.isArray())return fr;case U.BindingCount.MultipleBindingsAvailable:default:if(At.isArray())return fr;var Pt=V.getServiceIdentifierAsString(ee),Ve=b.AMBIGUOUS_MATCH+" "+Pt;throw Ve+=V.listRegisteredBindingsForServiceIdentifier(Je,Pt,Et),new Error(Ve)}}function St(ee,fr,At,Je,Pt,Ve){var It,hr;if(Pt===null){It=Lt(ee,fr,Je,null,Ve),hr=new xe.Request(At,Je,null,It,Ve);var Jt=new L.Plan(Je,hr);Je.addPlan(Jt)}else It=Lt(ee,fr,Je,Pt,Ve),hr=Pt.addChildRequest(Ve.serviceIdentifier,It,Ve);It.forEach(function(Fr){var fe=null;if(Ve.isArray())fe=hr.addChildRequest(Fr.serviceIdentifier,Fr,Ve);else{if(Fr.cache)return;fe=hr}if(Fr.type===p.BindingTypeEnum.Instance&&Fr.implementationType!==null){var Fe=_e.getDependencies(ee,Fr.implementationType);if(!Je.container.options.skipBaseClassChecks){var me=_e.getBaseClassDependencyCount(ee,Fr.implementationType);if(Fe.length<me){var bt=b.ARGUMENTS_LENGTH_MISMATCH(_e.getFunctionName(Fr.implementationType));throw new Error(bt)}}Fe.forEach(function(vt){St(ee,!1,vt.serviceIdentifier,Je,fe,vt)})}})}function Et(ee,fr){var At=[],Je=$e(ee);return Je.hasKey(fr)?At=Je.get(fr):ee.parent!==null&&(At=Et(ee.parent,fr)),At}function at(ee,fr,At,Je,Pt,Ve,It,hr){hr===void 0&&(hr=!1);var Jt=new H.Context(fr),Fr=Rt(At,Je,Pt,"",Ve,It);try{return St(ee,hr,Pt,Jt,null,Fr),Jt}catch(fe){throw Z.isStackOverflowExeption(fe)&&Jt.plan&&V.circularDependencyToException(Jt.plan.rootRequest),fe}}D.plan=at;function ur(ee,fr,At,Je){var Pt=new Re.Target(p.TargetTypeEnum.Variable,"",fr,new I.Metadata(At,Je)),Ve=new H.Context(ee),It=new xe.Request(fr,Ve,null,[],Pt);return It}D.createMockRequest=ur},88460:function(Qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.QueryableString=void 0;var g=function(){function U(b){this.str=b}return U.prototype.startsWith=function(b){return this.str.indexOf(b)===0},U.prototype.endsWith=function(b){var p="",E=b.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},E)},U.prototype.contains=function(b){return this.str.indexOf(b)!==-1},U.prototype.equals=function(b){return this.str===b},U.prototype.value=function(){return this.str},U}();D.QueryableString=g},6e3:function(Qe,D,g){"use strict";var U=this&&this.__spreadArray||function(Lt,zt){for(var St=0,Et=zt.length,at=Lt.length;St<Et;St++,at++)Lt[at]=zt[St];return Lt};Object.defineProperty(D,"__esModule",{value:!0}),D.getFunctionName=D.getBaseClassDependencyCount=D.getDependencies=void 0;var b=g(5744),p=g(16674),E=g(28421),Z=g(6867),V=g(55800);Object.defineProperty(D,"getFunctionName",{enumerable:!0,get:function(){return V.getFunctionName}});var H=g(18924);function I(Lt,zt){var St=V.getFunctionName(zt),Et=L(Lt,St,zt,!1);return Et}D.getDependencies=I;function L(Lt,zt,St,Et){var at=Lt.getConstructorMetadata(St),ur=at.compilerGeneratedMetadata;if(ur===void 0){var ee=p.MISSING_INJECTABLE_ANNOTATION+" "+zt+".";throw new Error(ee)}var fr=at.userGeneratedMetadata,At=Object.keys(fr),Je=St.length===0&&At.length>0,Pt=At.length>St.length,Ve=Je||Pt?At.length:St.length,It=xe(Et,zt,ur,fr,Ve),hr=Re(Lt,St),Jt=U(U([],It),hr);return Jt}function _e(Lt,zt,St,Et,at){var ur=at[Lt.toString()]||[],ee=Rt(ur),fr=ee.unmanaged!==!0,At=Et[Lt],Je=ee.inject||ee.multiInject;if(At=Je||At,At instanceof b.LazyServiceIdentifer&&(At=At.unwrap()),fr){var Pt=At===Object,Ve=At===Function,It=At===void 0,hr=Pt||Ve||It;if(!zt&&hr){var Jt=p.MISSING_INJECT_ANNOTATION+" argument "+Lt+" in class "+St+".";throw new Error(Jt)}var Fr=new H.Target(E.TargetTypeEnum.ConstructorArgument,ee.targetName,At);return Fr.metadata=ur,Fr}return null}function xe(Lt,zt,St,Et,at){for(var ur=[],ee=0;ee<at;ee++){var fr=ee,At=_e(fr,Lt,zt,St,Et);At!==null&&ur.push(At)}return ur}function Re(Lt,zt){for(var St=Lt.getPropertiesMetadata(zt),Et=[],at=Object.keys(St),ur=0,ee=at;ur<ee.length;ur++){var fr=ee[ur],At=St[fr],Je=Rt(St[fr]),Pt=Je.targetName||fr,Ve=Je.inject||Je.multiInject,It=new H.Target(E.TargetTypeEnum.ClassProperty,Pt,Ve);It.metadata=At,Et.push(It)}var hr=Object.getPrototypeOf(zt.prototype).constructor;if(hr!==Object){var Jt=Re(Lt,hr);Et=U(U([],Et),Jt)}return Et}function $e(Lt,zt){var St=Object.getPrototypeOf(zt.prototype).constructor;if(St!==Object){var Et=V.getFunctionName(St),at=L(Lt,Et,St,!0),ur=at.map(function(At){return At.metadata.filter(function(Je){return Je.key===Z.UNMANAGED_TAG})}),ee=[].concat.apply([],ur).length,fr=at.length-ee;return fr>0?fr:$e(Lt,St)}else return 0}D.getBaseClassDependencyCount=$e;function Rt(Lt){var zt={};return Lt.forEach(function(St){zt[St.key.toString()]=St.value}),{inject:zt[Z.INJECT_TAG],multiInject:zt[Z.MULTI_INJECT_TAG],targetName:zt[Z.NAME_TAG],unmanaged:zt[Z.UNMANAGED_TAG]}}},6748:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Request=void 0;var U=g(37791),b=function(){function p(E,Z,V,H,I){this.id=U.id(),this.serviceIdentifier=E,this.parentContext=Z,this.parentRequest=V,this.target=I,this.childRequests=[],this.bindings=Array.isArray(H)?H:[H],this.requestScope=V===null?new Map:null}return p.prototype.addChildRequest=function(E,Z,V){var H=new p(E,this.parentContext,this,Z,V);return this.childRequests.push(H),H},p}();D.Request=b},18924:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.Target=void 0;var U=g(6867),b=g(37791),p=g(47738),E=g(88460),Z=function(){function V(H,I,L,_e){this.id=b.id(),this.type=H,this.serviceIdentifier=L,this.name=new E.QueryableString(I||""),this.metadata=new Array;var xe=null;typeof _e=="string"?xe=new p.Metadata(U.NAMED_TAG,_e):_e instanceof p.Metadata&&(xe=_e),xe!==null&&this.metadata.push(xe)}return V.prototype.hasTag=function(H){for(var I=0,L=this.metadata;I<L.length;I++){var _e=L[I];if(_e.key===H)return!0}return!1},V.prototype.isArray=function(){return this.hasTag(U.MULTI_INJECT_TAG)},V.prototype.matchesArray=function(H){return this.matchesTag(U.MULTI_INJECT_TAG)(H)},V.prototype.isNamed=function(){return this.hasTag(U.NAMED_TAG)},V.prototype.isTagged=function(){return this.metadata.some(function(H){return U.NON_CUSTOM_TAG_KEYS.every(function(I){return H.key!==I})})},V.prototype.isOptional=function(){return this.matchesTag(U.OPTIONAL_TAG)(!0)},V.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(H){return H.key===U.NAMED_TAG})[0]:null},V.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(H){return U.NON_CUSTOM_TAG_KEYS.every(function(I){return H.key!==I})}):null},V.prototype.matchesNamedTag=function(H){return this.matchesTag(U.NAMED_TAG)(H)},V.prototype.matchesTag=function(H){var I=this;return function(L){for(var _e=0,xe=I.metadata;_e<xe.length;_e++){var Re=xe[_e];if(Re.key===H&&Re.value===L)return!0}return!1}},V}();D.Target=Z},52279:function(Qe,D,g){"use strict";var U=this&&this.__spreadArray||function(L,_e){for(var xe=0,Re=_e.length,$e=L.length;xe<Re;xe++,$e++)L[$e]=_e[xe];return L};Object.defineProperty(D,"__esModule",{value:!0}),D.resolveInstance=void 0;var b=g(16674),p=g(28421),E=g(6867);function Z(L,_e,xe){var Re=_e.filter(function(Rt){return Rt.target!==null&&Rt.target.type===p.TargetTypeEnum.ClassProperty}),$e=Re.map(xe);return Re.forEach(function(Rt,Lt){var zt="";zt=Rt.target.name.value();var St=$e[Lt];L[zt]=St}),L}function V(L,_e){return new(L.bind.apply(L,U([void 0],_e)))}function H(L,_e){if(Reflect.hasMetadata(E.POST_CONSTRUCT,L)){var xe=Reflect.getMetadata(E.POST_CONSTRUCT,L);try{_e[xe.value]()}catch(Re){throw new Error(b.POST_CONSTRUCT_ERROR(L.name,Re.message))}}}function I(L,_e,xe){var Re=null;if(_e.length>0){var $e=_e.filter(function(Lt){return Lt.target!==null&&Lt.target.type===p.TargetTypeEnum.ConstructorArgument}),Rt=$e.map(xe);Re=V(L,Rt),Re=Z(Re,_e,xe)}else Re=new L;return H(L,Re),Re}D.resolveInstance=I},31927:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.resolve=void 0;var U=g(16674),b=g(28421),p=g(85265),E=g(55800),Z=g(52279),V=function(L,_e,xe){try{return xe()}catch(Re){throw p.isStackOverflowExeption(Re)?new Error(U.CIRCULAR_DEPENDENCY_IN_FACTORY(L,_e.toString())):Re}},H=function(L){return function(_e){_e.parentContext.setCurrentRequest(_e);var xe=_e.bindings,Re=_e.childRequests,$e=_e.target&&_e.target.isArray(),Rt=!_e.parentRequest||!_e.parentRequest.target||!_e.target||!_e.parentRequest.target.matchesArray(_e.target.serviceIdentifier);if($e&&Rt)return Re.map(function(ur){var ee=H(L);return ee(ur)});var Lt=null;if(_e.target.isOptional()&&xe.length===0)return;var zt=xe[0],St=zt.scope===b.BindingScopeEnum.Singleton,Et=zt.scope===b.BindingScopeEnum.Request;if(St&&zt.activated)return zt.cache;if(Et&&L!==null&&L.has(zt.id))return L.get(zt.id);if(zt.type===b.BindingTypeEnum.ConstantValue)Lt=zt.cache,zt.activated=!0;else if(zt.type===b.BindingTypeEnum.Function)Lt=zt.cache,zt.activated=!0;else if(zt.type===b.BindingTypeEnum.Constructor)Lt=zt.implementationType;else if(zt.type===b.BindingTypeEnum.DynamicValue&&zt.dynamicValue!==null)Lt=V("toDynamicValue",zt.serviceIdentifier,function(){return zt.dynamicValue(_e.parentContext)});else if(zt.type===b.BindingTypeEnum.Factory&&zt.factory!==null)Lt=V("toFactory",zt.serviceIdentifier,function(){return zt.factory(_e.parentContext)});else if(zt.type===b.BindingTypeEnum.Provider&&zt.provider!==null)Lt=V("toProvider",zt.serviceIdentifier,function(){return zt.provider(_e.parentContext)});else if(zt.type===b.BindingTypeEnum.Instance&&zt.implementationType!==null)Lt=Z.resolveInstance(zt.implementationType,Re,H(L));else{var at=E.getServiceIdentifierAsString(_e.serviceIdentifier);throw new Error(U.INVALID_BINDING_TYPE+" "+at)}return typeof zt.onActivation=="function"&&(Lt=zt.onActivation(_e.parentContext,Lt)),St&&(zt.cache=Lt,zt.activated=!0),Et&&L!==null&&!L.has(zt.id)&&L.set(zt.id,Lt),Lt}};function I(L){var _e=H(L.plan.rootRequest.requestScope);return _e(L.plan.rootRequest)}D.resolve=I},83366:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingInSyntax=void 0;var U=g(28421),b=g(71325),p=function(){function E(Z){this._binding=Z}return E.prototype.inRequestScope=function(){return this._binding.scope=U.BindingScopeEnum.Request,new b.BindingWhenOnSyntax(this._binding)},E.prototype.inSingletonScope=function(){return this._binding.scope=U.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},E.prototype.inTransientScope=function(){return this._binding.scope=U.BindingScopeEnum.Transient,new b.BindingWhenOnSyntax(this._binding)},E}();D.BindingInSyntax=p},74889:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingInWhenOnSyntax=void 0;var U=g(83366),b=g(51811),p=g(98370),E=function(){function Z(V){this._binding=V,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new b.BindingOnSyntax(this._binding),this._bindingInSyntax=new U.BindingInSyntax(V)}return Z.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},Z.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},Z.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},Z.prototype.when=function(V){return this._bindingWhenSyntax.when(V)},Z.prototype.whenTargetNamed=function(V){return this._bindingWhenSyntax.whenTargetNamed(V)},Z.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Z.prototype.whenTargetTagged=function(V,H){return this._bindingWhenSyntax.whenTargetTagged(V,H)},Z.prototype.whenInjectedInto=function(V){return this._bindingWhenSyntax.whenInjectedInto(V)},Z.prototype.whenParentNamed=function(V){return this._bindingWhenSyntax.whenParentNamed(V)},Z.prototype.whenParentTagged=function(V,H){return this._bindingWhenSyntax.whenParentTagged(V,H)},Z.prototype.whenAnyAncestorIs=function(V){return this._bindingWhenSyntax.whenAnyAncestorIs(V)},Z.prototype.whenNoAncestorIs=function(V){return this._bindingWhenSyntax.whenNoAncestorIs(V)},Z.prototype.whenAnyAncestorNamed=function(V){return this._bindingWhenSyntax.whenAnyAncestorNamed(V)},Z.prototype.whenAnyAncestorTagged=function(V,H){return this._bindingWhenSyntax.whenAnyAncestorTagged(V,H)},Z.prototype.whenNoAncestorNamed=function(V){return this._bindingWhenSyntax.whenNoAncestorNamed(V)},Z.prototype.whenNoAncestorTagged=function(V,H){return this._bindingWhenSyntax.whenNoAncestorTagged(V,H)},Z.prototype.whenAnyAncestorMatches=function(V){return this._bindingWhenSyntax.whenAnyAncestorMatches(V)},Z.prototype.whenNoAncestorMatches=function(V){return this._bindingWhenSyntax.whenNoAncestorMatches(V)},Z.prototype.onActivation=function(V){return this._bindingOnSyntax.onActivation(V)},Z}();D.BindingInWhenOnSyntax=E},51811:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingOnSyntax=void 0;var U=g(98370),b=function(){function p(E){this._binding=E}return p.prototype.onActivation=function(E){return this._binding.onActivation=E,new U.BindingWhenSyntax(this._binding)},p}();D.BindingOnSyntax=b},15451:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingToSyntax=void 0;var U=g(16674),b=g(28421),p=g(74889),E=g(71325),Z=function(){function V(H){this._binding=H}return V.prototype.to=function(H){return this._binding.type=b.BindingTypeEnum.Instance,this._binding.implementationType=H,new p.BindingInWhenOnSyntax(this._binding)},V.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+U.INVALID_TO_SELF_VALUE);var H=this._binding.serviceIdentifier;return this.to(H)},V.prototype.toConstantValue=function(H){return this._binding.type=b.BindingTypeEnum.ConstantValue,this._binding.cache=H,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=b.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},V.prototype.toDynamicValue=function(H){return this._binding.type=b.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=H,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},V.prototype.toConstructor=function(H){return this._binding.type=b.BindingTypeEnum.Constructor,this._binding.implementationType=H,this._binding.scope=b.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},V.prototype.toFactory=function(H){return this._binding.type=b.BindingTypeEnum.Factory,this._binding.factory=H,this._binding.scope=b.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},V.prototype.toFunction=function(H){if(typeof H!="function")throw new Error(U.INVALID_FUNCTION_BINDING);var I=this.toConstantValue(H);return this._binding.type=b.BindingTypeEnum.Function,this._binding.scope=b.BindingScopeEnum.Singleton,I},V.prototype.toAutoFactory=function(H){return this._binding.type=b.BindingTypeEnum.Factory,this._binding.factory=function(I){var L=function(){return I.container.get(H)};return L},this._binding.scope=b.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},V.prototype.toProvider=function(H){return this._binding.type=b.BindingTypeEnum.Provider,this._binding.provider=H,this._binding.scope=b.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},V.prototype.toService=function(H){this.toDynamicValue(function(I){return I.container.get(H)})},V}();D.BindingToSyntax=Z},71325:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingWhenOnSyntax=void 0;var U=g(51811),b=g(98370),p=function(){function E(Z){this._binding=Z,this._bindingWhenSyntax=new b.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new U.BindingOnSyntax(this._binding)}return E.prototype.when=function(Z){return this._bindingWhenSyntax.when(Z)},E.prototype.whenTargetNamed=function(Z){return this._bindingWhenSyntax.whenTargetNamed(Z)},E.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},E.prototype.whenTargetTagged=function(Z,V){return this._bindingWhenSyntax.whenTargetTagged(Z,V)},E.prototype.whenInjectedInto=function(Z){return this._bindingWhenSyntax.whenInjectedInto(Z)},E.prototype.whenParentNamed=function(Z){return this._bindingWhenSyntax.whenParentNamed(Z)},E.prototype.whenParentTagged=function(Z,V){return this._bindingWhenSyntax.whenParentTagged(Z,V)},E.prototype.whenAnyAncestorIs=function(Z){return this._bindingWhenSyntax.whenAnyAncestorIs(Z)},E.prototype.whenNoAncestorIs=function(Z){return this._bindingWhenSyntax.whenNoAncestorIs(Z)},E.prototype.whenAnyAncestorNamed=function(Z){return this._bindingWhenSyntax.whenAnyAncestorNamed(Z)},E.prototype.whenAnyAncestorTagged=function(Z,V){return this._bindingWhenSyntax.whenAnyAncestorTagged(Z,V)},E.prototype.whenNoAncestorNamed=function(Z){return this._bindingWhenSyntax.whenNoAncestorNamed(Z)},E.prototype.whenNoAncestorTagged=function(Z,V){return this._bindingWhenSyntax.whenNoAncestorTagged(Z,V)},E.prototype.whenAnyAncestorMatches=function(Z){return this._bindingWhenSyntax.whenAnyAncestorMatches(Z)},E.prototype.whenNoAncestorMatches=function(Z){return this._bindingWhenSyntax.whenNoAncestorMatches(Z)},E.prototype.onActivation=function(Z){return this._bindingOnSyntax.onActivation(Z)},E}();D.BindingWhenOnSyntax=p},98370:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.BindingWhenSyntax=void 0;var U=g(51811),b=g(80758),p=function(){function E(Z){this._binding=Z}return E.prototype.when=function(Z){return this._binding.constraint=Z,new U.BindingOnSyntax(this._binding)},E.prototype.whenTargetNamed=function(Z){return this._binding.constraint=b.namedConstraint(Z),new U.BindingOnSyntax(this._binding)},E.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(Z){var V=Z.target!==null&&!Z.target.isNamed()&&!Z.target.isTagged();return V},new U.BindingOnSyntax(this._binding)},E.prototype.whenTargetTagged=function(Z,V){return this._binding.constraint=b.taggedConstraint(Z)(V),new U.BindingOnSyntax(this._binding)},E.prototype.whenInjectedInto=function(Z){return this._binding.constraint=function(V){return b.typeConstraint(Z)(V.parentRequest)},new U.BindingOnSyntax(this._binding)},E.prototype.whenParentNamed=function(Z){return this._binding.constraint=function(V){return b.namedConstraint(Z)(V.parentRequest)},new U.BindingOnSyntax(this._binding)},E.prototype.whenParentTagged=function(Z,V){return this._binding.constraint=function(H){return b.taggedConstraint(Z)(V)(H.parentRequest)},new U.BindingOnSyntax(this._binding)},E.prototype.whenAnyAncestorIs=function(Z){return this._binding.constraint=function(V){return b.traverseAncerstors(V,b.typeConstraint(Z))},new U.BindingOnSyntax(this._binding)},E.prototype.whenNoAncestorIs=function(Z){return this._binding.constraint=function(V){return!b.traverseAncerstors(V,b.typeConstraint(Z))},new U.BindingOnSyntax(this._binding)},E.prototype.whenAnyAncestorNamed=function(Z){return this._binding.constraint=function(V){return b.traverseAncerstors(V,b.namedConstraint(Z))},new U.BindingOnSyntax(this._binding)},E.prototype.whenNoAncestorNamed=function(Z){return this._binding.constraint=function(V){return!b.traverseAncerstors(V,b.namedConstraint(Z))},new U.BindingOnSyntax(this._binding)},E.prototype.whenAnyAncestorTagged=function(Z,V){return this._binding.constraint=function(H){return b.traverseAncerstors(H,b.taggedConstraint(Z)(V))},new U.BindingOnSyntax(this._binding)},E.prototype.whenNoAncestorTagged=function(Z,V){return this._binding.constraint=function(H){return!b.traverseAncerstors(H,b.taggedConstraint(Z)(V))},new U.BindingOnSyntax(this._binding)},E.prototype.whenAnyAncestorMatches=function(Z){return this._binding.constraint=function(V){return b.traverseAncerstors(V,Z)},new U.BindingOnSyntax(this._binding)},E.prototype.whenNoAncestorMatches=function(Z){return this._binding.constraint=function(V){return!b.traverseAncerstors(V,Z)},new U.BindingOnSyntax(this._binding)},E}();D.BindingWhenSyntax=p},80758:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.typeConstraint=D.namedConstraint=D.taggedConstraint=D.traverseAncerstors=void 0;var U=g(6867),b=g(47738),p=function(H,I){var L=H.parentRequest;return L!==null?I(L)?!0:p(L,I):!1};D.traverseAncerstors=p;var E=function(H){return function(I){var L=function(_e){return _e!==null&&_e.target!==null&&_e.target.matchesTag(H)(I)};return L.metaData=new b.Metadata(H,I),L}};D.taggedConstraint=E;var Z=E(U.NAMED_TAG);D.namedConstraint=Z;var V=function(H){return function(I){var L=null;if(I!==null)if(L=I.bindings[0],typeof H=="string"){var _e=L.serviceIdentifier;return _e===H}else{var xe=I.bindings[0].implementationType;return H===xe}return!1}};D.typeConstraint=V},70600:function(Qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.multiBindToService=void 0;var g=function(U){return function(b){return function(){for(var p=[],E=0;E<arguments.length;E++)p[E]=arguments[E];return p.forEach(function(Z){return U.bind(Z).toService(b)})}}};D.multiBindToService=g},85265:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.isStackOverflowExeption=void 0;var U=g(16674);function b(p){return p instanceof RangeError||p.message===U.STACK_OVERFLOW}D.isStackOverflowExeption=b},37791:function(Qe,D){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.id=void 0;var g=0;function U(){return g++}D.id=U},55800:function(Qe,D,g){"use strict";Object.defineProperty(D,"__esModule",{value:!0}),D.circularDependencyToException=D.listMetadataForTarget=D.listRegisteredBindingsForServiceIdentifier=D.getServiceIdentifierAsString=D.getFunctionName=void 0;var U=g(16674);function b(L){if(typeof L=="function"){var _e=L;return _e.name}else{if(typeof L=="symbol")return L.toString();var _e=L;return _e}}D.getServiceIdentifierAsString=b;function p(L,_e,xe){var Re="",$e=xe(L,_e);return $e.length!==0&&(Re=`
Registered bindings:`,$e.forEach(function(Rt){var Lt="Object";Rt.implementationType!==null&&(Lt=I(Rt.implementationType)),Re=Re+`
 `+Lt,Rt.constraint.metaData&&(Re=Re+" - "+Rt.constraint.metaData)})),Re}D.listRegisteredBindingsForServiceIdentifier=p;function E(L,_e){return L.parentRequest===null?!1:L.parentRequest.serviceIdentifier===_e?!0:E(L.parentRequest,_e)}function Z(L){function _e(Re,$e){$e===void 0&&($e=[]);var Rt=b(Re.serviceIdentifier);return $e.push(Rt),Re.parentRequest!==null?_e(Re.parentRequest,$e):$e}var xe=_e(L);return xe.reverse().join(" --> ")}function V(L){L.childRequests.forEach(function(_e){if(E(_e,_e.serviceIdentifier)){var xe=Z(_e);throw new Error(U.CIRCULAR_DEPENDENCY+" "+xe)}else V(_e)})}D.circularDependencyToException=V;function H(L,_e){if(_e.isTagged()||_e.isNamed()){var xe="",Re=_e.getNamedTag(),$e=_e.getCustomTags();return Re!==null&&(xe+=Re.toString()+`
`),$e!==null&&$e.forEach(function(Rt){xe+=Rt.toString()+`
`})," "+L+`
 `+L+" - "+xe}else return" "+L}D.listMetadataForTarget=H;function I(L){if(L.name)return L.name;var _e=L.toString(),xe=_e.match(/^function\s*([^\s(]+)/);return xe?xe[1]:"Anonymous function: "+_e}D.getFunctionName=I},18857:function(Qe,D,g){"use strict";g.r(D),g.d(D,{Function:function(){return Na},Interpreter:function(){return vo},default:function(){return Gu},evaluate:function(){return Tu},vm:function(){return U}});var U={};g.r(U),g.d(U,{Script:function(){return Vu},compileFunction:function(){return Sl},createContext:function(){return ju},runInContext:function(){return wu},runInNewContext:function(){return Ul}});var b={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},p="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",E={5:p,"5module":p+" export import",6:p+" const class extends export import super"},Z=/^in(stanceof)?$/,V="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",H="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",I=new RegExp("["+V+"]"),L=new RegExp("["+V+H+"]");V=H=null;var _e=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],xe=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Re(m,w){for(var W=65536,R=0;R<w.length;R+=2){if(W+=w[R],W>m)return!1;if(W+=w[R+1],W>=m)return!0}}function $e(m,w){return m<65?m===36:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&I.test(String.fromCharCode(m)):w===!1?!1:Re(m,_e)}function Rt(m,w){return m<48?m===36:m<58?!0:m<65?!1:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&L.test(String.fromCharCode(m)):w===!1?!1:Re(m,_e)||Re(m,xe)}var Lt=function(w,W){W===void 0&&(W={}),this.label=w,this.keyword=W.keyword,this.beforeExpr=!!W.beforeExpr,this.startsExpr=!!W.startsExpr,this.isLoop=!!W.isLoop,this.isAssign=!!W.isAssign,this.prefix=!!W.prefix,this.postfix=!!W.postfix,this.binop=W.binop||null,this.updateContext=null};function zt(m,w){return new Lt(m,{beforeExpr:!0,binop:w})}var St={beforeExpr:!0},Et={startsExpr:!0},at={};function ur(m,w){return w===void 0&&(w={}),w.keyword=m,at[m]=new Lt(m,w)}var ee={num:new Lt("num",Et),regexp:new Lt("regexp",Et),string:new Lt("string",Et),name:new Lt("name",Et),eof:new Lt("eof"),bracketL:new Lt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Lt("]"),braceL:new Lt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Lt("}"),parenL:new Lt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Lt(")"),comma:new Lt(",",St),semi:new Lt(";",St),colon:new Lt(":",St),dot:new Lt("."),question:new Lt("?",St),questionDot:new Lt("?."),arrow:new Lt("=>",St),template:new Lt("template"),invalidTemplate:new Lt("invalidTemplate"),ellipsis:new Lt("...",St),backQuote:new Lt("`",Et),dollarBraceL:new Lt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Lt("=",{beforeExpr:!0,isAssign:!0}),assign:new Lt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Lt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Lt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:zt("||",1),logicalAND:zt("&&",2),bitwiseOR:zt("|",3),bitwiseXOR:zt("^",4),bitwiseAND:zt("&",5),equality:zt("==/!=/===/!==",6),relational:zt("</>/<=/>=",7),bitShift:zt("<</>>/>>>",8),plusMin:new Lt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:zt("%",10),star:zt("*",10),slash:zt("/",10),starstar:new Lt("**",{beforeExpr:!0}),coalesce:zt("??",1),_break:ur("break"),_case:ur("case",St),_catch:ur("catch"),_continue:ur("continue"),_debugger:ur("debugger"),_default:ur("default",St),_do:ur("do",{isLoop:!0,beforeExpr:!0}),_else:ur("else",St),_finally:ur("finally"),_for:ur("for",{isLoop:!0}),_function:ur("function",Et),_if:ur("if"),_return:ur("return",St),_switch:ur("switch"),_throw:ur("throw",St),_try:ur("try"),_var:ur("var"),_const:ur("const"),_while:ur("while",{isLoop:!0}),_with:ur("with"),_new:ur("new",{beforeExpr:!0,startsExpr:!0}),_this:ur("this",Et),_super:ur("super",Et),_class:ur("class",Et),_extends:ur("extends",St),_export:ur("export"),_import:ur("import",Et),_null:ur("null",Et),_true:ur("true",Et),_false:ur("false",Et),_in:ur("in",{beforeExpr:!0,binop:7}),_instanceof:ur("instanceof",{beforeExpr:!0,binop:7}),_typeof:ur("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ur("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ur("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},fr=/\r\n?|\n|\u2028|\u2029/,At=new RegExp(fr.source,"g");function Je(m,w){return m===10||m===13||!w&&(m===8232||m===8233)}var Pt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ve=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,It=Object.prototype,hr=It.hasOwnProperty,Jt=It.toString;function Fr(m,w){return hr.call(m,w)}var fe=Array.isArray||function(m){return Jt.call(m)==="[object Array]"};function Fe(m){return new RegExp("^(?:"+m.replace(/ /g,"|")+")$")}var me=function(w,W){this.line=w,this.column=W};me.prototype.offset=function(w){return new me(this.line,this.column+w)};var bt=function(w,W,R){this.start=W,this.end=R,w.sourceFile!==null&&(this.source=w.sourceFile)};function vt(m,w){for(var W=1,R=0;;){At.lastIndex=R;var le=At.exec(m);if(le&&le.index<w)++W,R=le.index+le[0].length;else return new me(W,w-R)}}var Zt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Ut(m){var w={};for(var W in Zt)w[W]=m&&Fr(m,W)?m[W]:Zt[W];if(w.ecmaVersion>=2015&&(w.ecmaVersion-=2009),w.allowReserved==null&&(w.allowReserved=w.ecmaVersion<5),fe(w.onToken)){var R=w.onToken;w.onToken=function(le){return R.push(le)}}return fe(w.onComment)&&(w.onComment=Rr(w,w.onComment)),w}function Rr(m,w){return function(W,R,le,Le,ct,Nt){var kt={type:W?"Block":"Line",value:R,start:le,end:Le};m.locations&&(kt.loc=new bt(this,ct,Nt)),m.ranges&&(kt.range=[le,Le]),w.push(kt)}}var ln=1,pn=2,Vi=ln|pn,ar=4,pe=8,Pe=16,Ge=32,ke=64,Ft=128;function ir(m,w){return pn|(m?ar:0)|(w?pe:0)}var T=0,G=1,Se=2,Be=3,et=4,tt=5,Ct=function(w,W,R){this.options=w=Ut(w),this.sourceFile=w.sourceFile,this.keywords=Fe(E[w.ecmaVersion>=6?6:w.sourceType==="module"?"5module":5]);var le="";if(w.allowReserved!==!0){for(var Le=w.ecmaVersion;!(le=b[Le]);Le--);w.sourceType==="module"&&(le+=" await")}this.reservedWords=Fe(le);var ct=(le?le+" ":"")+b.strict;this.reservedWordsStrict=Fe(ct),this.reservedWordsStrictBind=Fe(ct+" "+b.strictBind),this.input=String(W),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(fr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=ee.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=w.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&w.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(ln),this.regexpState=null},jt={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ct.prototype.parse=function(){var w=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(w)},jt.inFunction.get=function(){return(this.currentVarScope().flags&pn)>0},jt.inGenerator.get=function(){return(this.currentVarScope().flags&pe)>0},jt.inAsync.get=function(){return(this.currentVarScope().flags&ar)>0},jt.allowSuper.get=function(){return(this.currentThisScope().flags&ke)>0},jt.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Ft)>0},jt.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ct.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&pn)>0},Ct.extend=function(){for(var w=[],W=arguments.length;W--;)w[W]=arguments[W];for(var R=this,le=0;le<w.length;le++)R=w[le](R);return R},Ct.parse=function(w,W){return new this(W,w).parse()},Ct.parseExpressionAt=function(w,W,R){var le=new this(R,w,W);return le.nextToken(),le.parseExpression()},Ct.tokenizer=function(w,W){return new this(W,w)},Object.defineProperties(Ct.prototype,jt);var Mt=Ct.prototype,Qt=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Mt.strictDirective=function(m){for(;;){Ve.lastIndex=m,m+=Ve.exec(this.input)[0].length;var w=Qt.exec(this.input.slice(m));if(!w)return!1;if((w[1]||w[2])==="use strict"){Ve.lastIndex=m+w[0].length;var W=Ve.exec(this.input),R=W.index+W[0].length,le=this.input.charAt(R);return le===";"||le==="}"||fr.test(W[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(le)||le==="!"&&this.input.charAt(R+1)==="=")}m+=w[0].length,Ve.lastIndex=m,m+=Ve.exec(this.input)[0].length,this.input[m]===";"&&m++}},Mt.eat=function(m){return this.type===m?(this.next(),!0):!1},Mt.isContextual=function(m){return this.type===ee.name&&this.value===m&&!this.containsEsc},Mt.eatContextual=function(m){return this.isContextual(m)?(this.next(),!0):!1},Mt.expectContextual=function(m){this.eatContextual(m)||this.unexpected()},Mt.canInsertSemicolon=function(){return this.type===ee.eof||this.type===ee.braceR||fr.test(this.input.slice(this.lastTokEnd,this.start))},Mt.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Mt.semicolon=function(){!this.eat(ee.semi)&&!this.insertSemicolon()&&this.unexpected()},Mt.afterTrailingComma=function(m,w){if(this.type===m)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),w||this.next(),!0},Mt.expect=function(m){this.eat(m)||this.unexpected()},Mt.unexpected=function(m){this.raise(m!=null?m:this.start,"Unexpected token")};function ne(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Mt.checkPatternErrors=function(m,w){if(!!m){m.trailingComma>-1&&this.raiseRecoverable(m.trailingComma,"Comma is not permitted after the rest element");var W=w?m.parenthesizedAssign:m.parenthesizedBind;W>-1&&this.raiseRecoverable(W,"Parenthesized pattern")}},Mt.checkExpressionErrors=function(m,w){if(!m)return!1;var W=m.shorthandAssign,R=m.doubleProto;if(!w)return W>=0||R>=0;W>=0&&this.raise(W,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},Mt.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Mt.isSimpleAssignTarget=function(m){return m.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(m.expression):m.type==="Identifier"||m.type==="MemberExpression"};var Kt=Ct.prototype;Kt.parseTopLevel=function(m){var w={};for(m.body||(m.body=[]);this.type!==ee.eof;){var W=this.parseStatement(null,!0,w);m.body.push(W)}if(this.inModule)for(var R=0,le=Object.keys(this.undefinedExports);R<le.length;R+=1){var Le=le[R];this.raiseRecoverable(this.undefinedExports[Le].start,"Export '"+Le+"' is not defined")}return this.adaptDirectivePrologue(m.body),this.next(),m.sourceType=this.options.sourceType,this.finishNode(m,"Program")};var Dr={kind:"loop"},Mr={kind:"switch"};Kt.isLet=function(m){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Ve.lastIndex=this.pos;var w=Ve.exec(this.input),W=this.pos+w[0].length,R=this.input.charCodeAt(W);if(R===91)return!0;if(m)return!1;if(R===123)return!0;if($e(R,!0)){for(var le=W+1;Rt(this.input.charCodeAt(le),!0);)++le;var Le=this.input.slice(W,le);if(!Z.test(Le))return!0}return!1},Kt.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Ve.lastIndex=this.pos;var m=Ve.exec(this.input),w=this.pos+m[0].length;return!fr.test(this.input.slice(this.pos,w))&&this.input.slice(w,w+8)==="function"&&(w+8===this.input.length||!Rt(this.input.charAt(w+8)))},Kt.parseStatement=function(m,w,W){var R=this.type,le=this.startNode(),Le;switch(this.isLet(m)&&(R=ee._var,Le="let"),R){case ee._break:case ee._continue:return this.parseBreakContinueStatement(le,R.keyword);case ee._debugger:return this.parseDebuggerStatement(le);case ee._do:return this.parseDoStatement(le);case ee._for:return this.parseForStatement(le);case ee._function:return m&&(this.strict||m!=="if"&&m!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(le,!1,!m);case ee._class:return m&&this.unexpected(),this.parseClass(le,!0);case ee._if:return this.parseIfStatement(le);case ee._return:return this.parseReturnStatement(le);case ee._switch:return this.parseSwitchStatement(le);case ee._throw:return this.parseThrowStatement(le);case ee._try:return this.parseTryStatement(le);case ee._const:case ee._var:return Le=Le||this.value,m&&Le!=="var"&&this.unexpected(),this.parseVarStatement(le,Le);case ee._while:return this.parseWhileStatement(le);case ee._with:return this.parseWithStatement(le);case ee.braceL:return this.parseBlock(!0,le);case ee.semi:return this.parseEmptyStatement(le);case ee._export:case ee._import:if(this.options.ecmaVersion>10&&R===ee._import){Ve.lastIndex=this.pos;var ct=Ve.exec(this.input),Nt=this.pos+ct[0].length,kt=this.input.charCodeAt(Nt);if(kt===40||kt===46)return this.parseExpressionStatement(le,this.parseExpression())}return this.options.allowImportExportEverywhere||(w||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===ee._import?this.parseImport(le):this.parseExport(le,W);default:if(this.isAsyncFunction())return m&&this.unexpected(),this.next(),this.parseFunctionStatement(le,!0,!m);var Tr=this.value,Gr=this.parseExpression();return R===ee.name&&Gr.type==="Identifier"&&this.eat(ee.colon)?this.parseLabeledStatement(le,Tr,Gr,m):this.parseExpressionStatement(le,Gr)}},Kt.parseBreakContinueStatement=function(m,w){var W=w==="break";this.next(),this.eat(ee.semi)||this.insertSemicolon()?m.label=null:this.type!==ee.name?this.unexpected():(m.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var le=this.labels[R];if((m.label==null||le.name===m.label.name)&&(le.kind!=null&&(W||le.kind==="loop")||m.label&&W))break}return R===this.labels.length&&this.raise(m.start,"Unsyntactic "+w),this.finishNode(m,W?"BreakStatement":"ContinueStatement")},Kt.parseDebuggerStatement=function(m){return this.next(),this.semicolon(),this.finishNode(m,"DebuggerStatement")},Kt.parseDoStatement=function(m){return this.next(),this.labels.push(Dr),m.body=this.parseStatement("do"),this.labels.pop(),this.expect(ee._while),m.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(ee.semi):this.semicolon(),this.finishNode(m,"DoWhileStatement")},Kt.parseForStatement=function(m){this.next();var w=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Dr),this.enterScope(0),this.expect(ee.parenL),this.type===ee.semi)return w>-1&&this.unexpected(w),this.parseFor(m,null);var W=this.isLet();if(this.type===ee._var||this.type===ee._const||W){var R=this.startNode(),le=W?"let":this.value;return this.next(),this.parseVar(R,!0,le),this.finishNode(R,"VariableDeclaration"),(this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===ee._in?w>-1&&this.unexpected(w):m.await=w>-1),this.parseForIn(m,R)):(w>-1&&this.unexpected(w),this.parseFor(m,R))}var Le=new ne,ct=this.parseExpression(!0,Le);return this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===ee._in?w>-1&&this.unexpected(w):m.await=w>-1),this.toAssignable(ct,!1,Le),this.checkLVal(ct),this.parseForIn(m,ct)):(this.checkExpressionErrors(Le,!0),w>-1&&this.unexpected(w),this.parseFor(m,ct))},Kt.parseFunctionStatement=function(m,w,W){return this.next(),this.parseFunction(m,xt|(W?0:ht),!1,w)},Kt.parseIfStatement=function(m){return this.next(),m.test=this.parseParenExpression(),m.consequent=this.parseStatement("if"),m.alternate=this.eat(ee._else)?this.parseStatement("if"):null,this.finishNode(m,"IfStatement")},Kt.parseReturnStatement=function(m){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(ee.semi)||this.insertSemicolon()?m.argument=null:(m.argument=this.parseExpression(),this.semicolon()),this.finishNode(m,"ReturnStatement")},Kt.parseSwitchStatement=function(m){this.next(),m.discriminant=this.parseParenExpression(),m.cases=[],this.expect(ee.braceL),this.labels.push(Mr),this.enterScope(0);for(var w,W=!1;this.type!==ee.braceR;)if(this.type===ee._case||this.type===ee._default){var R=this.type===ee._case;w&&this.finishNode(w,"SwitchCase"),m.cases.push(w=this.startNode()),w.consequent=[],this.next(),R?w.test=this.parseExpression():(W&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),W=!0,w.test=null),this.expect(ee.colon)}else w||this.unexpected(),w.consequent.push(this.parseStatement(null));return this.exitScope(),w&&this.finishNode(w,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(m,"SwitchStatement")},Kt.parseThrowStatement=function(m){return this.next(),fr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),m.argument=this.parseExpression(),this.semicolon(),this.finishNode(m,"ThrowStatement")};var nt=[];Kt.parseTryStatement=function(m){if(this.next(),m.block=this.parseBlock(),m.handler=null,this.type===ee._catch){var w=this.startNode();if(this.next(),this.eat(ee.parenL)){w.param=this.parseBindingAtom();var W=w.param.type==="Identifier";this.enterScope(W?Ge:0),this.checkLVal(w.param,W?et:Se),this.expect(ee.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),w.param=null,this.enterScope(0);w.body=this.parseBlock(!1),this.exitScope(),m.handler=this.finishNode(w,"CatchClause")}return m.finalizer=this.eat(ee._finally)?this.parseBlock():null,!m.handler&&!m.finalizer&&this.raise(m.start,"Missing catch or finally clause"),this.finishNode(m,"TryStatement")},Kt.parseVarStatement=function(m,w){return this.next(),this.parseVar(m,!1,w),this.semicolon(),this.finishNode(m,"VariableDeclaration")},Kt.parseWhileStatement=function(m){return this.next(),m.test=this.parseParenExpression(),this.labels.push(Dr),m.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(m,"WhileStatement")},Kt.parseWithStatement=function(m){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),m.object=this.parseParenExpression(),m.body=this.parseStatement("with"),this.finishNode(m,"WithStatement")},Kt.parseEmptyStatement=function(m){return this.next(),this.finishNode(m,"EmptyStatement")},Kt.parseLabeledStatement=function(m,w,W,R){for(var le=0,Le=this.labels;le<Le.length;le+=1){var ct=Le[le];ct.name===w&&this.raise(W.start,"Label '"+w+"' is already declared")}for(var Nt=this.type.isLoop?"loop":this.type===ee._switch?"switch":null,kt=this.labels.length-1;kt>=0;kt--){var Tr=this.labels[kt];if(Tr.statementStart===m.start)Tr.statementStart=this.start,Tr.kind=Nt;else break}return this.labels.push({name:w,kind:Nt,statementStart:this.start}),m.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),m.label=W,this.finishNode(m,"LabeledStatement")},Kt.parseExpressionStatement=function(m,w){return m.expression=w,this.semicolon(),this.finishNode(m,"ExpressionStatement")},Kt.parseBlock=function(m,w,W){for(m===void 0&&(m=!0),w===void 0&&(w=this.startNode()),w.body=[],this.expect(ee.braceL),m&&this.enterScope(0);this.type!==ee.braceR;){var R=this.parseStatement(null);w.body.push(R)}return W&&(this.strict=!1),this.next(),m&&this.exitScope(),this.finishNode(w,"BlockStatement")},Kt.parseFor=function(m,w){return m.init=w,this.expect(ee.semi),m.test=this.type===ee.semi?null:this.parseExpression(),this.expect(ee.semi),m.update=this.type===ee.parenR?null:this.parseExpression(),this.expect(ee.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,"ForStatement")},Kt.parseForIn=function(m,w){var W=this.type===ee._in;return this.next(),w.type==="VariableDeclaration"&&w.declarations[0].init!=null&&(!W||this.options.ecmaVersion<8||this.strict||w.kind!=="var"||w.declarations[0].id.type!=="Identifier")?this.raise(w.start,(W?"for-in":"for-of")+" loop variable declaration may not have an initializer"):w.type==="AssignmentPattern"&&this.raise(w.start,"Invalid left-hand side in for-loop"),m.left=w,m.right=W?this.parseExpression():this.parseMaybeAssign(),this.expect(ee.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,W?"ForInStatement":"ForOfStatement")},Kt.parseVar=function(m,w,W){for(m.declarations=[],m.kind=W;;){var R=this.startNode();if(this.parseVarId(R,W),this.eat(ee.eq)?R.init=this.parseMaybeAssign(w):W==="const"&&!(this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(w&&(this.type===ee._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,m.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(ee.comma))break}return m},Kt.parseVarId=function(m,w){m.id=this.parseBindingAtom(),this.checkLVal(m.id,w==="var"?G:Se,!1)};var xt=1,ht=2,vr=4;Kt.parseFunction=function(m,w,W,R){this.initFunction(m),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===ee.star&&w&ht&&this.unexpected(),m.generator=this.eat(ee.star)),this.options.ecmaVersion>=8&&(m.async=!!R),w&xt&&(m.id=w&vr&&this.type!==ee.name?null:this.parseIdent(),m.id&&!(w&ht)&&this.checkLVal(m.id,this.strict||m.generator||m.async?this.treatFunctionsAsVar?G:Se:Be));var le=this.yieldPos,Le=this.awaitPos,ct=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ir(m.async,m.generator)),w&xt||(m.id=this.type===ee.name?this.parseIdent():null),this.parseFunctionParams(m),this.parseFunctionBody(m,W,!1),this.yieldPos=le,this.awaitPos=Le,this.awaitIdentPos=ct,this.finishNode(m,w&xt?"FunctionDeclaration":"FunctionExpression")},Kt.parseFunctionParams=function(m){this.expect(ee.parenL),m.params=this.parseBindingList(ee.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Kt.parseClass=function(m,w){this.next();var W=this.strict;this.strict=!0,this.parseClassId(m,w),this.parseClassSuper(m);var R=this.startNode(),le=!1;for(R.body=[],this.expect(ee.braceL);this.type!==ee.braceR;){var Le=this.parseClassElement(m.superClass!==null);Le&&(R.body.push(Le),Le.type==="MethodDefinition"&&Le.kind==="constructor"&&(le&&this.raise(Le.start,"Duplicate constructor in the same class"),le=!0))}return this.strict=W,this.next(),m.body=this.finishNode(R,"ClassBody"),this.finishNode(m,w?"ClassDeclaration":"ClassExpression")},Kt.parseClassElement=function(m){var w=this;if(this.eat(ee.semi))return null;var W=this.startNode(),R=function(kt,Tr){Tr===void 0&&(Tr=!1);var Gr=w.start,Jn=w.startLoc;return w.eatContextual(kt)?w.type!==ee.parenL&&(!Tr||!w.canInsertSemicolon())?!0:(W.key&&w.unexpected(),W.computed=!1,W.key=w.startNodeAt(Gr,Jn),W.key.name=kt,w.finishNode(W.key,"Identifier"),!1):!1};W.kind="method",W.static=R("static");var le=this.eat(ee.star),Le=!1;le||(this.options.ecmaVersion>=8&&R("async",!0)?(Le=!0,le=this.options.ecmaVersion>=9&&this.eat(ee.star)):R("get")?W.kind="get":R("set")&&(W.kind="set")),W.key||this.parsePropertyName(W);var ct=W.key,Nt=!1;return!W.computed&&!W.static&&(ct.type==="Identifier"&&ct.name==="constructor"||ct.type==="Literal"&&ct.value==="constructor")?(W.kind!=="method"&&this.raise(ct.start,"Constructor can't have get/set modifier"),le&&this.raise(ct.start,"Constructor can't be a generator"),Le&&this.raise(ct.start,"Constructor can't be an async method"),W.kind="constructor",Nt=m):W.static&&ct.type==="Identifier"&&ct.name==="prototype"&&this.raise(ct.start,"Classes may not have a static property named prototype"),this.parseClassMethod(W,le,Le,Nt),W.kind==="get"&&W.value.params.length!==0&&this.raiseRecoverable(W.value.start,"getter should have no params"),W.kind==="set"&&W.value.params.length!==1&&this.raiseRecoverable(W.value.start,"setter should have exactly one param"),W.kind==="set"&&W.value.params[0].type==="RestElement"&&this.raiseRecoverable(W.value.params[0].start,"Setter cannot use rest params"),W},Kt.parseClassMethod=function(m,w,W,R){return m.value=this.parseMethod(w,W,R),this.finishNode(m,"MethodDefinition")},Kt.parseClassId=function(m,w){this.type===ee.name?(m.id=this.parseIdent(),w&&this.checkLVal(m.id,Se,!1)):(w===!0&&this.unexpected(),m.id=null)},Kt.parseClassSuper=function(m){m.superClass=this.eat(ee._extends)?this.parseExprSubscripts():null},Kt.parseExport=function(m,w){if(this.next(),this.eat(ee.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(m.exported=this.parseIdent(!0),this.checkExport(w,m.exported.name,this.lastTokStart)):m.exported=null),this.expectContextual("from"),this.type!==ee.string&&this.unexpected(),m.source=this.parseExprAtom(),this.semicolon(),this.finishNode(m,"ExportAllDeclaration");if(this.eat(ee._default)){this.checkExport(w,"default",this.lastTokStart);var W;if(this.type===ee._function||(W=this.isAsyncFunction())){var R=this.startNode();this.next(),W&&this.next(),m.declaration=this.parseFunction(R,xt|vr,!1,W)}else if(this.type===ee._class){var le=this.startNode();m.declaration=this.parseClass(le,"nullableID")}else m.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(m,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())m.declaration=this.parseStatement(null),m.declaration.type==="VariableDeclaration"?this.checkVariableExport(w,m.declaration.declarations):this.checkExport(w,m.declaration.id.name,m.declaration.id.start),m.specifiers=[],m.source=null;else{if(m.declaration=null,m.specifiers=this.parseExportSpecifiers(w),this.eatContextual("from"))this.type!==ee.string&&this.unexpected(),m.source=this.parseExprAtom();else{for(var Le=0,ct=m.specifiers;Le<ct.length;Le+=1){var Nt=ct[Le];this.checkUnreserved(Nt.local),this.checkLocalExport(Nt.local)}m.source=null}this.semicolon()}return this.finishNode(m,"ExportNamedDeclaration")},Kt.checkExport=function(m,w,W){!m||(Fr(m,w)&&this.raiseRecoverable(W,"Duplicate export '"+w+"'"),m[w]=!0)},Kt.checkPatternExport=function(m,w){var W=w.type;if(W==="Identifier")this.checkExport(m,w.name,w.start);else if(W==="ObjectPattern")for(var R=0,le=w.properties;R<le.length;R+=1){var Le=le[R];this.checkPatternExport(m,Le)}else if(W==="ArrayPattern")for(var ct=0,Nt=w.elements;ct<Nt.length;ct+=1){var kt=Nt[ct];kt&&this.checkPatternExport(m,kt)}else W==="Property"?this.checkPatternExport(m,w.value):W==="AssignmentPattern"?this.checkPatternExport(m,w.left):W==="RestElement"?this.checkPatternExport(m,w.argument):W==="ParenthesizedExpression"&&this.checkPatternExport(m,w.expression)},Kt.checkVariableExport=function(m,w){if(!!m)for(var W=0,R=w;W<R.length;W+=1){var le=R[W];this.checkPatternExport(m,le.id)}},Kt.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Kt.parseExportSpecifiers=function(m){var w=[],W=!0;for(this.expect(ee.braceL);!this.eat(ee.braceR);){if(W)W=!1;else if(this.expect(ee.comma),this.afterTrailingComma(ee.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(m,R.exported.name,R.exported.start),w.push(this.finishNode(R,"ExportSpecifier"))}return w},Kt.parseImport=function(m){return this.next(),this.type===ee.string?(m.specifiers=nt,m.source=this.parseExprAtom()):(m.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),m.source=this.type===ee.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(m,"ImportDeclaration")},Kt.parseImportSpecifiers=function(){var m=[],w=!0;if(this.type===ee.name){var W=this.startNode();if(W.local=this.parseIdent(),this.checkLVal(W.local,Se),m.push(this.finishNode(W,"ImportDefaultSpecifier")),!this.eat(ee.comma))return m}if(this.type===ee.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,Se),m.push(this.finishNode(R,"ImportNamespaceSpecifier")),m}for(this.expect(ee.braceL);!this.eat(ee.braceR);){if(w)w=!1;else if(this.expect(ee.comma),this.afterTrailingComma(ee.braceR))break;var le=this.startNode();le.imported=this.parseIdent(!0),this.eatContextual("as")?le.local=this.parseIdent():(this.checkUnreserved(le.imported),le.local=le.imported),this.checkLVal(le.local,Se),m.push(this.finishNode(le,"ImportSpecifier"))}return m},Kt.adaptDirectivePrologue=function(m){for(var w=0;w<m.length&&this.isDirectiveCandidate(m[w]);++w)m[w].directive=m[w].expression.raw.slice(1,-1)},Kt.isDirectiveCandidate=function(m){return m.type==="ExpressionStatement"&&m.expression.type==="Literal"&&typeof m.expression.value=="string"&&(this.input[m.start]==='"'||this.input[m.start]==="'")};var Zr=Ct.prototype;Zr.toAssignable=function(m,w,W){if(this.options.ecmaVersion>=6&&m)switch(m.type){case"Identifier":this.inAsync&&m.name==="await"&&this.raise(m.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":m.type="ObjectPattern",W&&this.checkPatternErrors(W,!0);for(var R=0,le=m.properties;R<le.length;R+=1){var Le=le[R];this.toAssignable(Le,w),Le.type==="RestElement"&&(Le.argument.type==="ArrayPattern"||Le.argument.type==="ObjectPattern")&&this.raise(Le.argument.start,"Unexpected token")}break;case"Property":m.kind!=="init"&&this.raise(m.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(m.value,w);break;case"ArrayExpression":m.type="ArrayPattern",W&&this.checkPatternErrors(W,!0),this.toAssignableList(m.elements,w);break;case"SpreadElement":m.type="RestElement",this.toAssignable(m.argument,w),m.argument.type==="AssignmentPattern"&&this.raise(m.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":m.operator!=="="&&this.raise(m.left.end,"Only '=' operator can be used for specifying default value."),m.type="AssignmentPattern",delete m.operator,this.toAssignable(m.left,w);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(m.expression,w,W);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!w)break;default:this.raise(m.start,"Assigning to rvalue")}else W&&this.checkPatternErrors(W,!0);return m},Zr.toAssignableList=function(m,w){for(var W=m.length,R=0;R<W;R++){var le=m[R];le&&this.toAssignable(le,w)}if(W){var Le=m[W-1];this.options.ecmaVersion===6&&w&&Le&&Le.type==="RestElement"&&Le.argument.type!=="Identifier"&&this.unexpected(Le.argument.start)}return m},Zr.parseSpread=function(m){var w=this.startNode();return this.next(),w.argument=this.parseMaybeAssign(!1,m),this.finishNode(w,"SpreadElement")},Zr.parseRestBinding=function(){var m=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==ee.name&&this.unexpected(),m.argument=this.parseBindingAtom(),this.finishNode(m,"RestElement")},Zr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case ee.bracketL:var m=this.startNode();return this.next(),m.elements=this.parseBindingList(ee.bracketR,!0,!0),this.finishNode(m,"ArrayPattern");case ee.braceL:return this.parseObj(!0)}return this.parseIdent()},Zr.parseBindingList=function(m,w,W){for(var R=[],le=!0;!this.eat(m);)if(le?le=!1:this.expect(ee.comma),w&&this.type===ee.comma)R.push(null);else{if(W&&this.afterTrailingComma(m))break;if(this.type===ee.ellipsis){var Le=this.parseRestBinding();this.parseBindingListItem(Le),R.push(Le),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(m);break}else{var ct=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(ct),R.push(ct)}}return R},Zr.parseBindingListItem=function(m){return m},Zr.parseMaybeDefault=function(m,w,W){if(W=W||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(ee.eq))return W;var R=this.startNodeAt(m,w);return R.left=W,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},Zr.checkLVal=function(m,w,W){switch(w===void 0&&(w=T),m.type){case"Identifier":w===Se&&m.name==="let"&&this.raiseRecoverable(m.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(m.name)&&this.raiseRecoverable(m.start,(w?"Binding ":"Assigning to ")+m.name+" in strict mode"),W&&(Fr(W,m.name)&&this.raiseRecoverable(m.start,"Argument name clash"),W[m.name]=!0),w!==T&&w!==tt&&this.declareName(m.name,w,m.start);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":w&&this.raiseRecoverable(m.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,le=m.properties;R<le.length;R+=1){var Le=le[R];this.checkLVal(Le,w,W)}break;case"Property":this.checkLVal(m.value,w,W);break;case"ArrayPattern":for(var ct=0,Nt=m.elements;ct<Nt.length;ct+=1){var kt=Nt[ct];kt&&this.checkLVal(kt,w,W)}break;case"AssignmentPattern":this.checkLVal(m.left,w,W);break;case"RestElement":this.checkLVal(m.argument,w,W);break;case"ParenthesizedExpression":this.checkLVal(m.expression,w,W);break;default:this.raise(m.start,(w?"Binding":"Assigning to")+" rvalue")}};var Ur=Ct.prototype;Ur.checkPropClash=function(m,w,W){if(!(this.options.ecmaVersion>=9&&m.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(m.computed||m.method||m.shorthand))){var R=m.key,le;switch(R.type){case"Identifier":le=R.name;break;case"Literal":le=String(R.value);break;default:return}var Le=m.kind;if(this.options.ecmaVersion>=6){le==="__proto__"&&Le==="init"&&(w.proto&&(W?W.doubleProto<0&&(W.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),w.proto=!0);return}le="$"+le;var ct=w[le];if(ct){var Nt;Le==="init"?Nt=this.strict&&ct.init||ct.get||ct.set:Nt=ct.init||ct[Le],Nt&&this.raiseRecoverable(R.start,"Redefinition of property")}else ct=w[le]={init:!1,get:!1,set:!1};ct[Le]=!0}},Ur.parseExpression=function(m,w){var W=this.start,R=this.startLoc,le=this.parseMaybeAssign(m,w);if(this.type===ee.comma){var Le=this.startNodeAt(W,R);for(Le.expressions=[le];this.eat(ee.comma);)Le.expressions.push(this.parseMaybeAssign(m,w));return this.finishNode(Le,"SequenceExpression")}return le},Ur.parseMaybeAssign=function(m,w,W){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(m);this.exprAllowed=!1}var R=!1,le=-1,Le=-1;w?(le=w.parenthesizedAssign,Le=w.trailingComma,w.parenthesizedAssign=w.trailingComma=-1):(w=new ne,R=!0);var ct=this.start,Nt=this.startLoc;(this.type===ee.parenL||this.type===ee.name)&&(this.potentialArrowAt=this.start);var kt=this.parseMaybeConditional(m,w);if(W&&(kt=W.call(this,kt,ct,Nt)),this.type.isAssign){var Tr=this.startNodeAt(ct,Nt);return Tr.operator=this.value,Tr.left=this.type===ee.eq?this.toAssignable(kt,!1,w):kt,R||(w.parenthesizedAssign=w.trailingComma=w.doubleProto=-1),w.shorthandAssign>=Tr.left.start&&(w.shorthandAssign=-1),this.checkLVal(kt),this.next(),Tr.right=this.parseMaybeAssign(m),this.finishNode(Tr,"AssignmentExpression")}else R&&this.checkExpressionErrors(w,!0);return le>-1&&(w.parenthesizedAssign=le),Le>-1&&(w.trailingComma=Le),kt},Ur.parseMaybeConditional=function(m,w){var W=this.start,R=this.startLoc,le=this.parseExprOps(m,w);if(this.checkExpressionErrors(w))return le;if(this.eat(ee.question)){var Le=this.startNodeAt(W,R);return Le.test=le,Le.consequent=this.parseMaybeAssign(),this.expect(ee.colon),Le.alternate=this.parseMaybeAssign(m),this.finishNode(Le,"ConditionalExpression")}return le},Ur.parseExprOps=function(m,w){var W=this.start,R=this.startLoc,le=this.parseMaybeUnary(w,!1);return this.checkExpressionErrors(w)||le.start===W&&le.type==="ArrowFunctionExpression"?le:this.parseExprOp(le,W,R,-1,m)},Ur.parseExprOp=function(m,w,W,R,le){var Le=this.type.binop;if(Le!=null&&(!le||this.type!==ee._in)&&Le>R){var ct=this.type===ee.logicalOR||this.type===ee.logicalAND,Nt=this.type===ee.coalesce;Nt&&(Le=ee.logicalAND.binop);var kt=this.value;this.next();var Tr=this.start,Gr=this.startLoc,Jn=this.parseExprOp(this.parseMaybeUnary(null,!1),Tr,Gr,Le,le),Mi=this.buildBinary(w,W,m,Jn,kt,ct||Nt);return(ct&&this.type===ee.coalesce||Nt&&(this.type===ee.logicalOR||this.type===ee.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Mi,w,W,R,le)}return m},Ur.buildBinary=function(m,w,W,R,le,Le){var ct=this.startNodeAt(m,w);return ct.left=W,ct.operator=le,ct.right=R,this.finishNode(ct,Le?"LogicalExpression":"BinaryExpression")},Ur.parseMaybeUnary=function(m,w){var W=this.start,R=this.startLoc,le;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))le=this.parseAwait(),w=!0;else if(this.type.prefix){var Le=this.startNode(),ct=this.type===ee.incDec;Le.operator=this.value,Le.prefix=!0,this.next(),Le.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(m,!0),ct?this.checkLVal(Le.argument):this.strict&&Le.operator==="delete"&&Le.argument.type==="Identifier"?this.raiseRecoverable(Le.start,"Deleting local variable in strict mode"):w=!0,le=this.finishNode(Le,ct?"UpdateExpression":"UnaryExpression")}else{if(le=this.parseExprSubscripts(m),this.checkExpressionErrors(m))return le;for(;this.type.postfix&&!this.canInsertSemicolon();){var Nt=this.startNodeAt(W,R);Nt.operator=this.value,Nt.prefix=!1,Nt.argument=le,this.checkLVal(le),this.next(),le=this.finishNode(Nt,"UpdateExpression")}}return!w&&this.eat(ee.starstar)?this.buildBinary(W,R,le,this.parseMaybeUnary(null,!1),"**",!1):le},Ur.parseExprSubscripts=function(m){var w=this.start,W=this.startLoc,R=this.parseExprAtom(m);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var le=this.parseSubscripts(R,w,W);return m&&le.type==="MemberExpression"&&(m.parenthesizedAssign>=le.start&&(m.parenthesizedAssign=-1),m.parenthesizedBind>=le.start&&(m.parenthesizedBind=-1)),le},Ur.parseSubscripts=function(m,w,W,R){for(var le=this.options.ecmaVersion>=8&&m.type==="Identifier"&&m.name==="async"&&this.lastTokEnd===m.end&&!this.canInsertSemicolon()&&m.end-m.start==5&&this.potentialArrowAt===m.start,Le=!1;;){var ct=this.parseSubscript(m,w,W,R,le,Le);if(ct.optional&&(Le=!0),ct===m||ct.type==="ArrowFunctionExpression"){if(Le){var Nt=this.startNodeAt(w,W);Nt.expression=ct,ct=this.finishNode(Nt,"ChainExpression")}return ct}m=ct}},Ur.parseSubscript=function(m,w,W,R,le,Le){var ct=this.options.ecmaVersion>=11,Nt=ct&&this.eat(ee.questionDot);R&&Nt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var kt=this.eat(ee.bracketL);if(kt||Nt&&this.type!==ee.parenL&&this.type!==ee.backQuote||this.eat(ee.dot)){var Tr=this.startNodeAt(w,W);Tr.object=m,Tr.property=kt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Tr.computed=!!kt,kt&&this.expect(ee.bracketR),ct&&(Tr.optional=Nt),m=this.finishNode(Tr,"MemberExpression")}else if(!R&&this.eat(ee.parenL)){var Gr=new ne,Jn=this.yieldPos,Mi=this.awaitPos,ci=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Ti=this.parseExprList(ee.parenR,this.options.ecmaVersion>=8,!1,Gr);if(le&&!Nt&&!this.canInsertSemicolon()&&this.eat(ee.arrow))return this.checkPatternErrors(Gr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Jn,this.awaitPos=Mi,this.awaitIdentPos=ci,this.parseArrowExpression(this.startNodeAt(w,W),Ti,!0);this.checkExpressionErrors(Gr,!0),this.yieldPos=Jn||this.yieldPos,this.awaitPos=Mi||this.awaitPos,this.awaitIdentPos=ci||this.awaitIdentPos;var Ui=this.startNodeAt(w,W);Ui.callee=m,Ui.arguments=Ti,ct&&(Ui.optional=Nt),m=this.finishNode(Ui,"CallExpression")}else if(this.type===ee.backQuote){(Nt||Le)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Fa=this.startNodeAt(w,W);Fa.tag=m,Fa.quasi=this.parseTemplate({isTagged:!0}),m=this.finishNode(Fa,"TaggedTemplateExpression")}return m},Ur.parseExprAtom=function(m){this.type===ee.slash&&this.readRegexp();var w,W=this.potentialArrowAt===this.start;switch(this.type){case ee._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),w=this.startNode(),this.next(),this.type===ee.parenL&&!this.allowDirectSuper&&this.raise(w.start,"super() call outside constructor of a subclass"),this.type!==ee.dot&&this.type!==ee.bracketL&&this.type!==ee.parenL&&this.unexpected(),this.finishNode(w,"Super");case ee._this:return w=this.startNode(),this.next(),this.finishNode(w,"ThisExpression");case ee.name:var R=this.start,le=this.startLoc,Le=this.containsEsc,ct=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Le&&ct.name==="async"&&!this.canInsertSemicolon()&&this.eat(ee._function))return this.parseFunction(this.startNodeAt(R,le),0,!1,!0);if(W&&!this.canInsertSemicolon()){if(this.eat(ee.arrow))return this.parseArrowExpression(this.startNodeAt(R,le),[ct],!1);if(this.options.ecmaVersion>=8&&ct.name==="async"&&this.type===ee.name&&!Le)return ct=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(ee.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,le),[ct],!0)}return ct;case ee.regexp:var Nt=this.value;return w=this.parseLiteral(Nt.value),w.regex={pattern:Nt.pattern,flags:Nt.flags},w;case ee.num:case ee.string:return this.parseLiteral(this.value);case ee._null:case ee._true:case ee._false:return w=this.startNode(),w.value=this.type===ee._null?null:this.type===ee._true,w.raw=this.type.keyword,this.next(),this.finishNode(w,"Literal");case ee.parenL:var kt=this.start,Tr=this.parseParenAndDistinguishExpression(W);return m&&(m.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Tr)&&(m.parenthesizedAssign=kt),m.parenthesizedBind<0&&(m.parenthesizedBind=kt)),Tr;case ee.bracketL:return w=this.startNode(),this.next(),w.elements=this.parseExprList(ee.bracketR,!0,!0,m),this.finishNode(w,"ArrayExpression");case ee.braceL:return this.parseObj(!1,m);case ee._function:return w=this.startNode(),this.next(),this.parseFunction(w,0);case ee._class:return this.parseClass(this.startNode(),!1);case ee._new:return this.parseNew();case ee.backQuote:return this.parseTemplate();case ee._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Ur.parseExprImport=function(){var m=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var w=this.parseIdent(!0);switch(this.type){case ee.parenL:return this.parseDynamicImport(m);case ee.dot:return m.meta=w,this.parseImportMeta(m);default:this.unexpected()}},Ur.parseDynamicImport=function(m){if(this.next(),m.source=this.parseMaybeAssign(),!this.eat(ee.parenR)){var w=this.start;this.eat(ee.comma)&&this.eat(ee.parenR)?this.raiseRecoverable(w,"Trailing comma is not allowed in import()"):this.unexpected(w)}return this.finishNode(m,"ImportExpression")},Ur.parseImportMeta=function(m){this.next();var w=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="meta"&&this.raiseRecoverable(m.property.start,"The only valid meta property for import is 'import.meta'"),w&&this.raiseRecoverable(m.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(m.start,"Cannot use 'import.meta' outside a module"),this.finishNode(m,"MetaProperty")},Ur.parseLiteral=function(m){var w=this.startNode();return w.value=m,w.raw=this.input.slice(this.start,this.end),w.raw.charCodeAt(w.raw.length-1)===110&&(w.bigint=w.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(w,"Literal")},Ur.parseParenExpression=function(){this.expect(ee.parenL);var m=this.parseExpression();return this.expect(ee.parenR),m},Ur.parseParenAndDistinguishExpression=function(m){var w=this.start,W=this.startLoc,R,le=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Le=this.start,ct=this.startLoc,Nt=[],kt=!0,Tr=!1,Gr=new ne,Jn=this.yieldPos,Mi=this.awaitPos,ci;for(this.yieldPos=0,this.awaitPos=0;this.type!==ee.parenR;)if(kt?kt=!1:this.expect(ee.comma),le&&this.afterTrailingComma(ee.parenR,!0)){Tr=!0;break}else if(this.type===ee.ellipsis){ci=this.start,Nt.push(this.parseParenItem(this.parseRestBinding())),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Nt.push(this.parseMaybeAssign(!1,Gr,this.parseParenItem));var Ti=this.start,Ui=this.startLoc;if(this.expect(ee.parenR),m&&!this.canInsertSemicolon()&&this.eat(ee.arrow))return this.checkPatternErrors(Gr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Jn,this.awaitPos=Mi,this.parseParenArrowList(w,W,Nt);(!Nt.length||Tr)&&this.unexpected(this.lastTokStart),ci&&this.unexpected(ci),this.checkExpressionErrors(Gr,!0),this.yieldPos=Jn||this.yieldPos,this.awaitPos=Mi||this.awaitPos,Nt.length>1?(R=this.startNodeAt(Le,ct),R.expressions=Nt,this.finishNodeAt(R,"SequenceExpression",Ti,Ui)):R=Nt[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var Fa=this.startNodeAt(w,W);return Fa.expression=R,this.finishNode(Fa,"ParenthesizedExpression")}else return R},Ur.parseParenItem=function(m){return m},Ur.parseParenArrowList=function(m,w,W){return this.parseArrowExpression(this.startNodeAt(m,w),W)};var tn=[];Ur.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var m=this.startNode(),w=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(ee.dot)){m.meta=w;var W=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="target"&&this.raiseRecoverable(m.property.start,"The only valid meta property for new is 'new.target'"),W&&this.raiseRecoverable(m.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(m.start,"'new.target' can only be used in functions"),this.finishNode(m,"MetaProperty")}var R=this.start,le=this.startLoc,Le=this.type===ee._import;return m.callee=this.parseSubscripts(this.parseExprAtom(),R,le,!0),Le&&m.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(ee.parenL)?m.arguments=this.parseExprList(ee.parenR,this.options.ecmaVersion>=8,!1):m.arguments=tn,this.finishNode(m,"NewExpression")},Ur.parseTemplateElement=function(m){var w=m.isTagged,W=this.startNode();return this.type===ee.invalidTemplate?(w||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),W.value={raw:this.value,cooked:null}):W.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),W.tail=this.type===ee.backQuote,this.finishNode(W,"TemplateElement")},Ur.parseTemplate=function(m){m===void 0&&(m={});var w=m.isTagged;w===void 0&&(w=!1);var W=this.startNode();this.next(),W.expressions=[];var R=this.parseTemplateElement({isTagged:w});for(W.quasis=[R];!R.tail;)this.type===ee.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(ee.dollarBraceL),W.expressions.push(this.parseExpression()),this.expect(ee.braceR),W.quasis.push(R=this.parseTemplateElement({isTagged:w}));return this.next(),this.finishNode(W,"TemplateLiteral")},Ur.isAsyncProp=function(m){return!m.computed&&m.key.type==="Identifier"&&m.key.name==="async"&&(this.type===ee.name||this.type===ee.num||this.type===ee.string||this.type===ee.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===ee.star)&&!fr.test(this.input.slice(this.lastTokEnd,this.start))},Ur.parseObj=function(m,w){var W=this.startNode(),R=!0,le={};for(W.properties=[],this.next();!this.eat(ee.braceR);){if(R)R=!1;else if(this.expect(ee.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(ee.braceR))break;var Le=this.parseProperty(m,w);m||this.checkPropClash(Le,le,w),W.properties.push(Le)}return this.finishNode(W,m?"ObjectPattern":"ObjectExpression")},Ur.parseProperty=function(m,w){var W=this.startNode(),R,le,Le,ct;if(this.options.ecmaVersion>=9&&this.eat(ee.ellipsis))return m?(W.argument=this.parseIdent(!1),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(W,"RestElement")):(this.type===ee.parenL&&w&&(w.parenthesizedAssign<0&&(w.parenthesizedAssign=this.start),w.parenthesizedBind<0&&(w.parenthesizedBind=this.start)),W.argument=this.parseMaybeAssign(!1,w),this.type===ee.comma&&w&&w.trailingComma<0&&(w.trailingComma=this.start),this.finishNode(W,"SpreadElement"));this.options.ecmaVersion>=6&&(W.method=!1,W.shorthand=!1,(m||w)&&(Le=this.start,ct=this.startLoc),m||(R=this.eat(ee.star)));var Nt=this.containsEsc;return this.parsePropertyName(W),!m&&!Nt&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(W)?(le=!0,R=this.options.ecmaVersion>=9&&this.eat(ee.star),this.parsePropertyName(W,w)):le=!1,this.parsePropertyValue(W,m,R,le,Le,ct,w,Nt),this.finishNode(W,"Property")},Ur.parsePropertyValue=function(m,w,W,R,le,Le,ct,Nt){if((W||R)&&this.type===ee.colon&&this.unexpected(),this.eat(ee.colon))m.value=w?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,ct),m.kind="init";else if(this.options.ecmaVersion>=6&&this.type===ee.parenL)w&&this.unexpected(),m.kind="init",m.method=!0,m.value=this.parseMethod(W,R);else if(!w&&!Nt&&this.options.ecmaVersion>=5&&!m.computed&&m.key.type==="Identifier"&&(m.key.name==="get"||m.key.name==="set")&&this.type!==ee.comma&&this.type!==ee.braceR&&this.type!==ee.eq){(W||R)&&this.unexpected(),m.kind=m.key.name,this.parsePropertyName(m),m.value=this.parseMethod(!1);var kt=m.kind==="get"?0:1;if(m.value.params.length!==kt){var Tr=m.value.start;m.kind==="get"?this.raiseRecoverable(Tr,"getter should have no params"):this.raiseRecoverable(Tr,"setter should have exactly one param")}else m.kind==="set"&&m.value.params[0].type==="RestElement"&&this.raiseRecoverable(m.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!m.computed&&m.key.type==="Identifier"?((W||R)&&this.unexpected(),this.checkUnreserved(m.key),m.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=le),m.kind="init",w?m.value=this.parseMaybeDefault(le,Le,m.key):this.type===ee.eq&&ct?(ct.shorthandAssign<0&&(ct.shorthandAssign=this.start),m.value=this.parseMaybeDefault(le,Le,m.key)):m.value=m.key,m.shorthand=!0):this.unexpected()},Ur.parsePropertyName=function(m){if(this.options.ecmaVersion>=6){if(this.eat(ee.bracketL))return m.computed=!0,m.key=this.parseMaybeAssign(),this.expect(ee.bracketR),m.key;m.computed=!1}return m.key=this.type===ee.num||this.type===ee.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Ur.initFunction=function(m){m.id=null,this.options.ecmaVersion>=6&&(m.generator=m.expression=!1),this.options.ecmaVersion>=8&&(m.async=!1)},Ur.parseMethod=function(m,w,W){var R=this.startNode(),le=this.yieldPos,Le=this.awaitPos,ct=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=m),this.options.ecmaVersion>=8&&(R.async=!!w),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ir(w,R.generator)|ke|(W?Ft:0)),this.expect(ee.parenL),R.params=this.parseBindingList(ee.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=le,this.awaitPos=Le,this.awaitIdentPos=ct,this.finishNode(R,"FunctionExpression")},Ur.parseArrowExpression=function(m,w,W){var R=this.yieldPos,le=this.awaitPos,Le=this.awaitIdentPos;return this.enterScope(ir(W,!1)|Pe),this.initFunction(m),this.options.ecmaVersion>=8&&(m.async=!!W),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,m.params=this.toAssignableList(w,!0),this.parseFunctionBody(m,!0,!1),this.yieldPos=R,this.awaitPos=le,this.awaitIdentPos=Le,this.finishNode(m,"ArrowFunctionExpression")},Ur.parseFunctionBody=function(m,w,W){var R=w&&this.type!==ee.braceL,le=this.strict,Le=!1;if(R)m.body=this.parseMaybeAssign(),m.expression=!0,this.checkParams(m,!1);else{var ct=this.options.ecmaVersion>=7&&!this.isSimpleParamList(m.params);(!le||ct)&&(Le=this.strictDirective(this.end),Le&&ct&&this.raiseRecoverable(m.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Nt=this.labels;this.labels=[],Le&&(this.strict=!0),this.checkParams(m,!le&&!Le&&!w&&!W&&this.isSimpleParamList(m.params)),this.strict&&m.id&&this.checkLVal(m.id,tt),m.body=this.parseBlock(!1,void 0,Le&&!le),m.expression=!1,this.adaptDirectivePrologue(m.body.body),this.labels=Nt}this.exitScope()},Ur.isSimpleParamList=function(m){for(var w=0,W=m;w<W.length;w+=1){var R=W[w];if(R.type!=="Identifier")return!1}return!0},Ur.checkParams=function(m,w){for(var W={},R=0,le=m.params;R<le.length;R+=1){var Le=le[R];this.checkLVal(Le,G,w?null:W)}},Ur.parseExprList=function(m,w,W,R){for(var le=[],Le=!0;!this.eat(m);){if(Le)Le=!1;else if(this.expect(ee.comma),w&&this.afterTrailingComma(m))break;var ct=void 0;W&&this.type===ee.comma?ct=null:this.type===ee.ellipsis?(ct=this.parseSpread(R),R&&this.type===ee.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):ct=this.parseMaybeAssign(!1,R),le.push(ct)}return le},Ur.checkUnreserved=function(m){var w=m.start,W=m.end,R=m.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(w,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(w,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(w,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(w,W).indexOf("\\")!==-1)){var le=this.strict?this.reservedWordsStrict:this.reservedWords;le.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(w,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(w,"The keyword '"+R+"' is reserved"))}},Ur.parseIdent=function(m,w){var W=this.startNode();return this.type===ee.name?W.name=this.value:this.type.keyword?(W.name=this.type.keyword,(W.name==="class"||W.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!m),this.finishNode(W,"Identifier"),m||(this.checkUnreserved(W),W.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=W.start)),W},Ur.parseYield=function(m){this.yieldPos||(this.yieldPos=this.start);var w=this.startNode();return this.next(),this.type===ee.semi||this.canInsertSemicolon()||this.type!==ee.star&&!this.type.startsExpr?(w.delegate=!1,w.argument=null):(w.delegate=this.eat(ee.star),w.argument=this.parseMaybeAssign(m)),this.finishNode(w,"YieldExpression")},Ur.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var m=this.startNode();return this.next(),m.argument=this.parseMaybeUnary(null,!1),this.finishNode(m,"AwaitExpression")};var jr=Ct.prototype;jr.raise=function(m,w){var W=vt(this.input,m);w+=" ("+W.line+":"+W.column+")";var R=new SyntaxError(w);throw R.pos=m,R.loc=W,R.raisedAt=this.pos,R},jr.raiseRecoverable=jr.raise,jr.curPosition=function(){if(this.options.locations)return new me(this.curLine,this.pos-this.lineStart)};var wr=Ct.prototype,Dn=function(w){this.flags=w,this.var=[],this.lexical=[],this.functions=[]};wr.enterScope=function(m){this.scopeStack.push(new Dn(m))},wr.exitScope=function(){this.scopeStack.pop()},wr.treatFunctionsAsVarInScope=function(m){return m.flags&pn||!this.inModule&&m.flags&ln},wr.declareName=function(m,w,W){var R=!1;if(w===Se){var le=this.currentScope();R=le.lexical.indexOf(m)>-1||le.functions.indexOf(m)>-1||le.var.indexOf(m)>-1,le.lexical.push(m),this.inModule&&le.flags&ln&&delete this.undefinedExports[m]}else if(w===et){var Le=this.currentScope();Le.lexical.push(m)}else if(w===Be){var ct=this.currentScope();this.treatFunctionsAsVar?R=ct.lexical.indexOf(m)>-1:R=ct.lexical.indexOf(m)>-1||ct.var.indexOf(m)>-1,ct.functions.push(m)}else for(var Nt=this.scopeStack.length-1;Nt>=0;--Nt){var kt=this.scopeStack[Nt];if(kt.lexical.indexOf(m)>-1&&!(kt.flags&Ge&&kt.lexical[0]===m)||!this.treatFunctionsAsVarInScope(kt)&&kt.functions.indexOf(m)>-1){R=!0;break}if(kt.var.push(m),this.inModule&&kt.flags&ln&&delete this.undefinedExports[m],kt.flags&Vi)break}R&&this.raiseRecoverable(W,"Identifier '"+m+"' has already been declared")},wr.checkLocalExport=function(m){this.scopeStack[0].lexical.indexOf(m.name)===-1&&this.scopeStack[0].var.indexOf(m.name)===-1&&(this.undefinedExports[m.name]=m)},wr.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},wr.currentVarScope=function(){for(var m=this.scopeStack.length-1;;m--){var w=this.scopeStack[m];if(w.flags&Vi)return w}},wr.currentThisScope=function(){for(var m=this.scopeStack.length-1;;m--){var w=this.scopeStack[m];if(w.flags&Vi&&!(w.flags&Pe))return w}};var Zn=function(w,W,R){this.type="",this.start=W,this.end=0,w.options.locations&&(this.loc=new bt(w,R)),w.options.directSourceFile&&(this.sourceFile=w.options.directSourceFile),w.options.ranges&&(this.range=[W,0])},bi=Ct.prototype;bi.startNode=function(){return new Zn(this,this.start,this.startLoc)},bi.startNodeAt=function(m,w){return new Zn(this,m,w)};function Hi(m,w,W,R){return m.type=w,m.end=W,this.options.locations&&(m.loc.end=R),this.options.ranges&&(m.range[1]=W),m}bi.finishNode=function(m,w){return Hi.call(this,m,w,this.lastTokEnd,this.lastTokEndLoc)},bi.finishNodeAt=function(m,w,W,R){return Hi.call(this,m,w,W,R)};var qi=function(w,W,R,le,Le){this.token=w,this.isExpr=!!W,this.preserveSpace=!!R,this.override=le,this.generator=!!Le},ki={b_stat:new qi("{",!1),b_expr:new qi("{",!0),b_tmpl:new qi("${",!1),p_stat:new qi("(",!1),p_expr:new qi("(",!0),q_tmpl:new qi("`",!0,!0,function(m){return m.tryReadTemplateToken()}),f_stat:new qi("function",!1),f_expr:new qi("function",!0),f_expr_gen:new qi("function",!0,!1,null,!0),f_gen:new qi("function",!1,!1,null,!0)},Oi=Ct.prototype;Oi.initialContext=function(){return[ki.b_stat]},Oi.braceIsBlock=function(m){var w=this.curContext();return w===ki.f_expr||w===ki.f_stat?!0:m===ee.colon&&(w===ki.b_stat||w===ki.b_expr)?!w.isExpr:m===ee._return||m===ee.name&&this.exprAllowed?fr.test(this.input.slice(this.lastTokEnd,this.start)):m===ee._else||m===ee.semi||m===ee.eof||m===ee.parenR||m===ee.arrow?!0:m===ee.braceL?w===ki.b_stat:m===ee._var||m===ee._const||m===ee.name?!1:!this.exprAllowed},Oi.inGeneratorContext=function(){for(var m=this.context.length-1;m>=1;m--){var w=this.context[m];if(w.token==="function")return w.generator}return!1},Oi.updateContext=function(m){var w,W=this.type;W.keyword&&m===ee.dot?this.exprAllowed=!1:(w=W.updateContext)?w.call(this,m):this.exprAllowed=W.beforeExpr},ee.parenR.updateContext=ee.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var m=this.context.pop();m===ki.b_stat&&this.curContext().token==="function"&&(m=this.context.pop()),this.exprAllowed=!m.isExpr},ee.braceL.updateContext=function(m){this.context.push(this.braceIsBlock(m)?ki.b_stat:ki.b_expr),this.exprAllowed=!0},ee.dollarBraceL.updateContext=function(){this.context.push(ki.b_tmpl),this.exprAllowed=!0},ee.parenL.updateContext=function(m){var w=m===ee._if||m===ee._for||m===ee._with||m===ee._while;this.context.push(w?ki.p_stat:ki.p_expr),this.exprAllowed=!0},ee.incDec.updateContext=function(){},ee._function.updateContext=ee._class.updateContext=function(m){m.beforeExpr&&m!==ee.semi&&m!==ee._else&&!(m===ee._return&&fr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((m===ee.colon||m===ee.braceL)&&this.curContext()===ki.b_stat)?this.context.push(ki.f_expr):this.context.push(ki.f_stat),this.exprAllowed=!1},ee.backQuote.updateContext=function(){this.curContext()===ki.q_tmpl?this.context.pop():this.context.push(ki.q_tmpl),this.exprAllowed=!1},ee.star.updateContext=function(m){if(m===ee._function){var w=this.context.length-1;this.context[w]===ki.f_expr?this.context[w]=ki.f_expr_gen:this.context[w]=ki.f_gen}this.exprAllowed=!0},ee.name.updateContext=function(m){var w=!1;this.options.ecmaVersion>=6&&m!==ee.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(w=!0),this.exprAllowed=w};var $="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ce=$+" Extended_Pictographic",ve=ce,j={9:$,10:ce,11:ve},se="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",de="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Me=de+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ue=Me+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Te={9:de,10:Me,11:ue},mt={};function br(m){var w=mt[m]={binary:Fe(j[m]+" "+se),nonBinary:{General_Category:Fe(se),Script:Fe(Te[m])}};w.nonBinary.Script_Extensions=w.nonBinary.Script,w.nonBinary.gc=w.nonBinary.General_Category,w.nonBinary.sc=w.nonBinary.Script,w.nonBinary.scx=w.nonBinary.Script_Extensions}br(9),br(10),br(11);var Yt=Ct.prototype,nr=function(w){this.parser=w,this.validFlags="gim"+(w.options.ecmaVersion>=6?"uy":"")+(w.options.ecmaVersion>=9?"s":""),this.unicodeProperties=mt[w.options.ecmaVersion>=11?11:w.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};nr.prototype.reset=function(w,W,R){var le=R.indexOf("u")!==-1;this.start=w|0,this.source=W+"",this.flags=R,this.switchU=le&&this.parser.options.ecmaVersion>=6,this.switchN=le&&this.parser.options.ecmaVersion>=9},nr.prototype.raise=function(w){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+w)},nr.prototype.at=function(w,W){W===void 0&&(W=!1);var R=this.source,le=R.length;if(w>=le)return-1;var Le=R.charCodeAt(w);if(!(W||this.switchU)||Le<=55295||Le>=57344||w+1>=le)return Le;var ct=R.charCodeAt(w+1);return ct>=56320&&ct<=57343?(Le<<10)+ct-56613888:Le},nr.prototype.nextIndex=function(w,W){W===void 0&&(W=!1);var R=this.source,le=R.length;if(w>=le)return le;var Le=R.charCodeAt(w),ct;return!(W||this.switchU)||Le<=55295||Le>=57344||w+1>=le||(ct=R.charCodeAt(w+1))<56320||ct>57343?w+1:w+2},nr.prototype.current=function(w){return w===void 0&&(w=!1),this.at(this.pos,w)},nr.prototype.lookahead=function(w){return w===void 0&&(w=!1),this.at(this.nextIndex(this.pos,w),w)},nr.prototype.advance=function(w){w===void 0&&(w=!1),this.pos=this.nextIndex(this.pos,w)},nr.prototype.eat=function(w,W){return W===void 0&&(W=!1),this.current(W)===w?(this.advance(W),!0):!1};function kr(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Yt.validateRegExpFlags=function(m){for(var w=m.validFlags,W=m.flags,R=0;R<W.length;R++){var le=W.charAt(R);w.indexOf(le)===-1&&this.raise(m.start,"Invalid regular expression flag"),W.indexOf(le,R+1)>-1&&this.raise(m.start,"Duplicate regular expression flag")}},Yt.validateRegExpPattern=function(m){this.regexp_pattern(m),!m.switchN&&this.options.ecmaVersion>=9&&m.groupNames.length>0&&(m.switchN=!0,this.regexp_pattern(m))},Yt.regexp_pattern=function(m){m.pos=0,m.lastIntValue=0,m.lastStringValue="",m.lastAssertionIsQuantifiable=!1,m.numCapturingParens=0,m.maxBackReference=0,m.groupNames.length=0,m.backReferenceNames.length=0,this.regexp_disjunction(m),m.pos!==m.source.length&&(m.eat(41)&&m.raise("Unmatched ')'"),(m.eat(93)||m.eat(125))&&m.raise("Lone quantifier brackets")),m.maxBackReference>m.numCapturingParens&&m.raise("Invalid escape");for(var w=0,W=m.backReferenceNames;w<W.length;w+=1){var R=W[w];m.groupNames.indexOf(R)===-1&&m.raise("Invalid named capture referenced")}},Yt.regexp_disjunction=function(m){for(this.regexp_alternative(m);m.eat(124);)this.regexp_alternative(m);this.regexp_eatQuantifier(m,!0)&&m.raise("Nothing to repeat"),m.eat(123)&&m.raise("Lone quantifier brackets")},Yt.regexp_alternative=function(m){for(;m.pos<m.source.length&&this.regexp_eatTerm(m););},Yt.regexp_eatTerm=function(m){return this.regexp_eatAssertion(m)?(m.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(m)&&m.switchU&&m.raise("Invalid quantifier"),!0):(m.switchU?this.regexp_eatAtom(m):this.regexp_eatExtendedAtom(m))?(this.regexp_eatQuantifier(m),!0):!1},Yt.regexp_eatAssertion=function(m){var w=m.pos;if(m.lastAssertionIsQuantifiable=!1,m.eat(94)||m.eat(36))return!0;if(m.eat(92)){if(m.eat(66)||m.eat(98))return!0;m.pos=w}if(m.eat(40)&&m.eat(63)){var W=!1;if(this.options.ecmaVersion>=9&&(W=m.eat(60)),m.eat(61)||m.eat(33))return this.regexp_disjunction(m),m.eat(41)||m.raise("Unterminated group"),m.lastAssertionIsQuantifiable=!W,!0}return m.pos=w,!1},Yt.regexp_eatQuantifier=function(m,w){return w===void 0&&(w=!1),this.regexp_eatQuantifierPrefix(m,w)?(m.eat(63),!0):!1},Yt.regexp_eatQuantifierPrefix=function(m,w){return m.eat(42)||m.eat(43)||m.eat(63)||this.regexp_eatBracedQuantifier(m,w)},Yt.regexp_eatBracedQuantifier=function(m,w){var W=m.pos;if(m.eat(123)){var R=0,le=-1;if(this.regexp_eatDecimalDigits(m)&&(R=m.lastIntValue,m.eat(44)&&this.regexp_eatDecimalDigits(m)&&(le=m.lastIntValue),m.eat(125)))return le!==-1&&le<R&&!w&&m.raise("numbers out of order in {} quantifier"),!0;m.switchU&&!w&&m.raise("Incomplete quantifier"),m.pos=W}return!1},Yt.regexp_eatAtom=function(m){return this.regexp_eatPatternCharacters(m)||m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)},Yt.regexp_eatReverseSolidusAtomEscape=function(m){var w=m.pos;if(m.eat(92)){if(this.regexp_eatAtomEscape(m))return!0;m.pos=w}return!1},Yt.regexp_eatUncapturingGroup=function(m){var w=m.pos;if(m.eat(40)){if(m.eat(63)&&m.eat(58)){if(this.regexp_disjunction(m),m.eat(41))return!0;m.raise("Unterminated group")}m.pos=w}return!1},Yt.regexp_eatCapturingGroup=function(m){if(m.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(m):m.current()===63&&m.raise("Invalid group"),this.regexp_disjunction(m),m.eat(41))return m.numCapturingParens+=1,!0;m.raise("Unterminated group")}return!1},Yt.regexp_eatExtendedAtom=function(m){return m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)||this.regexp_eatInvalidBracedQuantifier(m)||this.regexp_eatExtendedPatternCharacter(m)},Yt.regexp_eatInvalidBracedQuantifier=function(m){return this.regexp_eatBracedQuantifier(m,!0)&&m.raise("Nothing to repeat"),!1},Yt.regexp_eatSyntaxCharacter=function(m){var w=m.current();return Mn(w)?(m.lastIntValue=w,m.advance(),!0):!1};function Mn(m){return m===36||m>=40&&m<=43||m===46||m===63||m>=91&&m<=94||m>=123&&m<=125}Yt.regexp_eatPatternCharacters=function(m){for(var w=m.pos,W=0;(W=m.current())!==-1&&!Mn(W);)m.advance();return m.pos!==w},Yt.regexp_eatExtendedPatternCharacter=function(m){var w=m.current();return w!==-1&&w!==36&&!(w>=40&&w<=43)&&w!==46&&w!==63&&w!==91&&w!==94&&w!==124?(m.advance(),!0):!1},Yt.regexp_groupSpecifier=function(m){if(m.eat(63)){if(this.regexp_eatGroupName(m)){m.groupNames.indexOf(m.lastStringValue)!==-1&&m.raise("Duplicate capture group name"),m.groupNames.push(m.lastStringValue);return}m.raise("Invalid group")}},Yt.regexp_eatGroupName=function(m){if(m.lastStringValue="",m.eat(60)){if(this.regexp_eatRegExpIdentifierName(m)&&m.eat(62))return!0;m.raise("Invalid capture group name")}return!1},Yt.regexp_eatRegExpIdentifierName=function(m){if(m.lastStringValue="",this.regexp_eatRegExpIdentifierStart(m)){for(m.lastStringValue+=kr(m.lastIntValue);this.regexp_eatRegExpIdentifierPart(m);)m.lastStringValue+=kr(m.lastIntValue);return!0}return!1},Yt.regexp_eatRegExpIdentifierStart=function(m){var w=m.pos,W=this.options.ecmaVersion>=11,R=m.current(W);return m.advance(W),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,W)&&(R=m.lastIntValue),Pn(R)?(m.lastIntValue=R,!0):(m.pos=w,!1)};function Pn(m){return $e(m,!0)||m===36||m===95}Yt.regexp_eatRegExpIdentifierPart=function(m){var w=m.pos,W=this.options.ecmaVersion>=11,R=m.current(W);return m.advance(W),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,W)&&(R=m.lastIntValue),tr(R)?(m.lastIntValue=R,!0):(m.pos=w,!1)};function tr(m){return Rt(m,!0)||m===36||m===95||m===8204||m===8205}Yt.regexp_eatAtomEscape=function(m){return this.regexp_eatBackReference(m)||this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)||m.switchN&&this.regexp_eatKGroupName(m)?!0:(m.switchU&&(m.current()===99&&m.raise("Invalid unicode escape"),m.raise("Invalid escape")),!1)},Yt.regexp_eatBackReference=function(m){var w=m.pos;if(this.regexp_eatDecimalEscape(m)){var W=m.lastIntValue;if(m.switchU)return W>m.maxBackReference&&(m.maxBackReference=W),!0;if(W<=m.numCapturingParens)return!0;m.pos=w}return!1},Yt.regexp_eatKGroupName=function(m){if(m.eat(107)){if(this.regexp_eatGroupName(m))return m.backReferenceNames.push(m.lastStringValue),!0;m.raise("Invalid named reference")}return!1},Yt.regexp_eatCharacterEscape=function(m){return this.regexp_eatControlEscape(m)||this.regexp_eatCControlLetter(m)||this.regexp_eatZero(m)||this.regexp_eatHexEscapeSequence(m)||this.regexp_eatRegExpUnicodeEscapeSequence(m,!1)||!m.switchU&&this.regexp_eatLegacyOctalEscapeSequence(m)||this.regexp_eatIdentityEscape(m)},Yt.regexp_eatCControlLetter=function(m){var w=m.pos;if(m.eat(99)){if(this.regexp_eatControlLetter(m))return!0;m.pos=w}return!1},Yt.regexp_eatZero=function(m){return m.current()===48&&!Li(m.lookahead())?(m.lastIntValue=0,m.advance(),!0):!1},Yt.regexp_eatControlEscape=function(m){var w=m.current();return w===116?(m.lastIntValue=9,m.advance(),!0):w===110?(m.lastIntValue=10,m.advance(),!0):w===118?(m.lastIntValue=11,m.advance(),!0):w===102?(m.lastIntValue=12,m.advance(),!0):w===114?(m.lastIntValue=13,m.advance(),!0):!1},Yt.regexp_eatControlLetter=function(m){var w=m.current();return Sn(w)?(m.lastIntValue=w%32,m.advance(),!0):!1};function Sn(m){return m>=65&&m<=90||m>=97&&m<=122}Yt.regexp_eatRegExpUnicodeEscapeSequence=function(m,w){w===void 0&&(w=!1);var W=m.pos,R=w||m.switchU;if(m.eat(117)){if(this.regexp_eatFixedHexDigits(m,4)){var le=m.lastIntValue;if(R&&le>=55296&&le<=56319){var Le=m.pos;if(m.eat(92)&&m.eat(117)&&this.regexp_eatFixedHexDigits(m,4)){var ct=m.lastIntValue;if(ct>=56320&&ct<=57343)return m.lastIntValue=(le-55296)*1024+(ct-56320)+65536,!0}m.pos=Le,m.lastIntValue=le}return!0}if(R&&m.eat(123)&&this.regexp_eatHexDigits(m)&&m.eat(125)&&on(m.lastIntValue))return!0;R&&m.raise("Invalid unicode escape"),m.pos=W}return!1};function on(m){return m>=0&&m<=1114111}Yt.regexp_eatIdentityEscape=function(m){if(m.switchU)return this.regexp_eatSyntaxCharacter(m)?!0:m.eat(47)?(m.lastIntValue=47,!0):!1;var w=m.current();return w!==99&&(!m.switchN||w!==107)?(m.lastIntValue=w,m.advance(),!0):!1},Yt.regexp_eatDecimalEscape=function(m){m.lastIntValue=0;var w=m.current();if(w>=49&&w<=57){do m.lastIntValue=10*m.lastIntValue+(w-48),m.advance();while((w=m.current())>=48&&w<=57);return!0}return!1},Yt.regexp_eatCharacterClassEscape=function(m){var w=m.current();if(cn(w))return m.lastIntValue=-1,m.advance(),!0;if(m.switchU&&this.options.ecmaVersion>=9&&(w===80||w===112)){if(m.lastIntValue=-1,m.advance(),m.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(m)&&m.eat(125))return!0;m.raise("Invalid property name")}return!1};function cn(m){return m===100||m===68||m===115||m===83||m===119||m===87}Yt.regexp_eatUnicodePropertyValueExpression=function(m){var w=m.pos;if(this.regexp_eatUnicodePropertyName(m)&&m.eat(61)){var W=m.lastStringValue;if(this.regexp_eatUnicodePropertyValue(m)){var R=m.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(m,W,R),!0}}if(m.pos=w,this.regexp_eatLoneUnicodePropertyNameOrValue(m)){var le=m.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(m,le),!0}return!1},Yt.regexp_validateUnicodePropertyNameAndValue=function(m,w,W){Fr(m.unicodeProperties.nonBinary,w)||m.raise("Invalid property name"),m.unicodeProperties.nonBinary[w].test(W)||m.raise("Invalid property value")},Yt.regexp_validateUnicodePropertyNameOrValue=function(m,w){m.unicodeProperties.binary.test(w)||m.raise("Invalid property name")},Yt.regexp_eatUnicodePropertyName=function(m){var w=0;for(m.lastStringValue="";wi(w=m.current());)m.lastStringValue+=kr(w),m.advance();return m.lastStringValue!==""};function wi(m){return Sn(m)||m===95}Yt.regexp_eatUnicodePropertyValue=function(m){var w=0;for(m.lastStringValue="";xn(w=m.current());)m.lastStringValue+=kr(w),m.advance();return m.lastStringValue!==""};function xn(m){return wi(m)||Li(m)}Yt.regexp_eatLoneUnicodePropertyNameOrValue=function(m){return this.regexp_eatUnicodePropertyValue(m)},Yt.regexp_eatCharacterClass=function(m){if(m.eat(91)){if(m.eat(94),this.regexp_classRanges(m),m.eat(93))return!0;m.raise("Unterminated character class")}return!1},Yt.regexp_classRanges=function(m){for(;this.regexp_eatClassAtom(m);){var w=m.lastIntValue;if(m.eat(45)&&this.regexp_eatClassAtom(m)){var W=m.lastIntValue;m.switchU&&(w===-1||W===-1)&&m.raise("Invalid character class"),w!==-1&&W!==-1&&w>W&&m.raise("Range out of order in character class")}}},Yt.regexp_eatClassAtom=function(m){var w=m.pos;if(m.eat(92)){if(this.regexp_eatClassEscape(m))return!0;if(m.switchU){var W=m.current();(W===99||Ji(W))&&m.raise("Invalid class escape"),m.raise("Invalid escape")}m.pos=w}var R=m.current();return R!==93?(m.lastIntValue=R,m.advance(),!0):!1},Yt.regexp_eatClassEscape=function(m){var w=m.pos;if(m.eat(98))return m.lastIntValue=8,!0;if(m.switchU&&m.eat(45))return m.lastIntValue=45,!0;if(!m.switchU&&m.eat(99)){if(this.regexp_eatClassControlLetter(m))return!0;m.pos=w}return this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)},Yt.regexp_eatClassControlLetter=function(m){var w=m.current();return Li(w)||w===95?(m.lastIntValue=w%32,m.advance(),!0):!1},Yt.regexp_eatHexEscapeSequence=function(m){var w=m.pos;if(m.eat(120)){if(this.regexp_eatFixedHexDigits(m,2))return!0;m.switchU&&m.raise("Invalid escape"),m.pos=w}return!1},Yt.regexp_eatDecimalDigits=function(m){var w=m.pos,W=0;for(m.lastIntValue=0;Li(W=m.current());)m.lastIntValue=10*m.lastIntValue+(W-48),m.advance();return m.pos!==w};function Li(m){return m>=48&&m<=57}Yt.regexp_eatHexDigits=function(m){var w=m.pos,W=0;for(m.lastIntValue=0;$i(W=m.current());)m.lastIntValue=16*m.lastIntValue+ai(W),m.advance();return m.pos!==w};function $i(m){return m>=48&&m<=57||m>=65&&m<=70||m>=97&&m<=102}function ai(m){return m>=65&&m<=70?10+(m-65):m>=97&&m<=102?10+(m-97):m-48}Yt.regexp_eatLegacyOctalEscapeSequence=function(m){if(this.regexp_eatOctalDigit(m)){var w=m.lastIntValue;if(this.regexp_eatOctalDigit(m)){var W=m.lastIntValue;w<=3&&this.regexp_eatOctalDigit(m)?m.lastIntValue=w*64+W*8+m.lastIntValue:m.lastIntValue=w*8+W}else m.lastIntValue=w;return!0}return!1},Yt.regexp_eatOctalDigit=function(m){var w=m.current();return Ji(w)?(m.lastIntValue=w-48,m.advance(),!0):(m.lastIntValue=0,!1)};function Ji(m){return m>=48&&m<=55}Yt.regexp_eatFixedHexDigits=function(m,w){var W=m.pos;m.lastIntValue=0;for(var R=0;R<w;++R){var le=m.current();if(!$i(le))return m.pos=W,!1;m.lastIntValue=16*m.lastIntValue+ai(le),m.advance()}return!0};var Ni=function(w){this.type=w.type,this.value=w.value,this.start=w.start,this.end=w.end,w.options.locations&&(this.loc=new bt(w,w.startLoc,w.endLoc)),w.options.ranges&&(this.range=[w.start,w.end])},Ai=Ct.prototype;Ai.next=function(m){!m&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ni(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Ai.getToken=function(){return this.next(),new Ni(this)},typeof Symbol!="undefined"&&(Ai[Symbol.iterator]=function(){var m=this;return{next:function(){var w=m.getToken();return{done:w.type===ee.eof,value:w}}}}),Ai.curContext=function(){return this.context[this.context.length-1]},Ai.nextToken=function(){var m=this.curContext();if((!m||!m.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(ee.eof);if(m.override)return m.override(this);this.readToken(this.fullCharCodeAtPos())},Ai.readToken=function(m){return $e(m,this.options.ecmaVersion>=6)||m===92?this.readWord():this.getTokenFromCode(m)},Ai.fullCharCodeAtPos=function(){var m=this.input.charCodeAt(this.pos);if(m<=55295||m>=57344)return m;var w=this.input.charCodeAt(this.pos+1);return(m<<10)+w-56613888},Ai.skipBlockComment=function(){var m=this.options.onComment&&this.curPosition(),w=this.pos,W=this.input.indexOf("*/",this.pos+=2);if(W===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=W+2,this.options.locations){At.lastIndex=w;for(var R;(R=At.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(w+2,W),w,this.pos,m,this.curPosition())},Ai.skipLineComment=function(m){for(var w=this.pos,W=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=m);this.pos<this.input.length&&!Je(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(w+m,this.pos),w,this.pos,W,this.curPosition())},Ai.skipSpace=function(){e:for(;this.pos<this.input.length;){var m=this.input.charCodeAt(this.pos);switch(m){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(m>8&&m<14||m>=5760&&Pt.test(String.fromCharCode(m)))++this.pos;else break e}}},Ai.finishToken=function(m,w){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var W=this.type;this.type=m,this.value=w,this.updateContext(W)},Ai.readToken_dot=function(){var m=this.input.charCodeAt(this.pos+1);if(m>=48&&m<=57)return this.readNumber(!0);var w=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&m===46&&w===46?(this.pos+=3,this.finishToken(ee.ellipsis)):(++this.pos,this.finishToken(ee.dot))},Ai.readToken_slash=function(){var m=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):m===61?this.finishOp(ee.assign,2):this.finishOp(ee.slash,1)},Ai.readToken_mult_modulo_exp=function(m){var w=this.input.charCodeAt(this.pos+1),W=1,R=m===42?ee.star:ee.modulo;return this.options.ecmaVersion>=7&&m===42&&w===42&&(++W,R=ee.starstar,w=this.input.charCodeAt(this.pos+2)),w===61?this.finishOp(ee.assign,W+1):this.finishOp(R,W)},Ai.readToken_pipe_amp=function(m){var w=this.input.charCodeAt(this.pos+1);if(w===m){if(this.options.ecmaVersion>=12){var W=this.input.charCodeAt(this.pos+2);if(W===61)return this.finishOp(ee.assign,3)}return this.finishOp(m===124?ee.logicalOR:ee.logicalAND,2)}return w===61?this.finishOp(ee.assign,2):this.finishOp(m===124?ee.bitwiseOR:ee.bitwiseAND,1)},Ai.readToken_caret=function(){var m=this.input.charCodeAt(this.pos+1);return m===61?this.finishOp(ee.assign,2):this.finishOp(ee.bitwiseXOR,1)},Ai.readToken_plus_min=function(m){var w=this.input.charCodeAt(this.pos+1);return w===m?w===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||fr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(ee.incDec,2):w===61?this.finishOp(ee.assign,2):this.finishOp(ee.plusMin,1)},Ai.readToken_lt_gt=function(m){var w=this.input.charCodeAt(this.pos+1),W=1;return w===m?(W=m===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+W)===61?this.finishOp(ee.assign,W+1):this.finishOp(ee.bitShift,W)):w===33&&m===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(w===61&&(W=2),this.finishOp(ee.relational,W))},Ai.readToken_eq_excl=function(m){var w=this.input.charCodeAt(this.pos+1);return w===61?this.finishOp(ee.equality,this.input.charCodeAt(this.pos+2)===61?3:2):m===61&&w===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(ee.arrow)):this.finishOp(m===61?ee.eq:ee.prefix,1)},Ai.readToken_question=function(){var m=this.options.ecmaVersion;if(m>=11){var w=this.input.charCodeAt(this.pos+1);if(w===46){var W=this.input.charCodeAt(this.pos+2);if(W<48||W>57)return this.finishOp(ee.questionDot,2)}if(w===63){if(m>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(ee.assign,3)}return this.finishOp(ee.coalesce,2)}}return this.finishOp(ee.question,1)},Ai.getTokenFromCode=function(m){switch(m){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(ee.parenL);case 41:return++this.pos,this.finishToken(ee.parenR);case 59:return++this.pos,this.finishToken(ee.semi);case 44:return++this.pos,this.finishToken(ee.comma);case 91:return++this.pos,this.finishToken(ee.bracketL);case 93:return++this.pos,this.finishToken(ee.bracketR);case 123:return++this.pos,this.finishToken(ee.braceL);case 125:return++this.pos,this.finishToken(ee.braceR);case 58:return++this.pos,this.finishToken(ee.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(ee.backQuote);case 48:var w=this.input.charCodeAt(this.pos+1);if(w===120||w===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(w===111||w===79)return this.readRadixNumber(8);if(w===98||w===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(m);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(m);case 124:case 38:return this.readToken_pipe_amp(m);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(m);case 60:case 62:return this.readToken_lt_gt(m);case 61:case 33:return this.readToken_eq_excl(m);case 63:return this.readToken_question();case 126:return this.finishOp(ee.prefix,1)}this.raise(this.pos,"Unexpected character '"+ii(m)+"'")},Ai.finishOp=function(m,w){var W=this.input.slice(this.pos,this.pos+w);return this.pos+=w,this.finishToken(m,W)},Ai.readRegexp=function(){for(var m,w,W=this.pos;;){this.pos>=this.input.length&&this.raise(W,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(fr.test(R)&&this.raise(W,"Unterminated regular expression"),m)m=!1;else{if(R==="[")w=!0;else if(R==="]"&&w)w=!1;else if(R==="/"&&!w)break;m=R==="\\"}++this.pos}var le=this.input.slice(W,this.pos);++this.pos;var Le=this.pos,ct=this.readWord1();this.containsEsc&&this.unexpected(Le);var Nt=this.regexpState||(this.regexpState=new nr(this));Nt.reset(W,le,ct),this.validateRegExpFlags(Nt),this.validateRegExpPattern(Nt);var kt=null;try{kt=new RegExp(le,ct)}catch(Tr){}return this.finishToken(ee.regexp,{pattern:le,flags:ct,value:kt})},Ai.readInt=function(m,w,W){for(var R=this.options.ecmaVersion>=12&&w===void 0,le=W&&this.input.charCodeAt(this.pos)===48,Le=this.pos,ct=0,Nt=0,kt=0,Tr=w==null?Infinity:w;kt<Tr;++kt,++this.pos){var Gr=this.input.charCodeAt(this.pos),Jn=void 0;if(R&&Gr===95){le&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Nt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),kt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Nt=Gr;continue}if(Gr>=97?Jn=Gr-97+10:Gr>=65?Jn=Gr-65+10:Gr>=48&&Gr<=57?Jn=Gr-48:Jn=Infinity,Jn>=m)break;Nt=Gr,ct=ct*m+Jn}return R&&Nt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Le||w!=null&&this.pos-Le!==w?null:ct};function ha(m,w){return w?parseInt(m,8):parseFloat(m.replace(/_/g,""))}function Ca(m){return typeof BigInt!="function"?null:BigInt(m.replace(/_/g,""))}Ai.readRadixNumber=function(m){var w=this.pos;this.pos+=2;var W=this.readInt(m);return W==null&&this.raise(this.start+2,"Expected number in radix "+m),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(W=Ca(this.input.slice(w,this.pos)),++this.pos):$e(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ee.num,W)},Ai.readNumber=function(m){var w=this.pos;!m&&this.readInt(10,void 0,!0)===null&&this.raise(w,"Invalid number");var W=this.pos-w>=2&&this.input.charCodeAt(w)===48;W&&this.strict&&this.raise(w,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!W&&!m&&this.options.ecmaVersion>=11&&R===110){var le=Ca(this.input.slice(w,this.pos));return++this.pos,$e(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ee.num,le)}W&&/[89]/.test(this.input.slice(w,this.pos))&&(W=!1),R===46&&!W&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!W&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(w,"Invalid number")),$e(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Le=ha(this.input.slice(w,this.pos),W);return this.finishToken(ee.num,Le)},Ai.readCodePoint=function(){var m=this.input.charCodeAt(this.pos),w;if(m===123){this.options.ecmaVersion<6&&this.unexpected();var W=++this.pos;w=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,w>1114111&&this.invalidStringToken(W,"Code point out of bounds")}else w=this.readHexChar(4);return w};function ii(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Ai.readString=function(m){for(var w="",W=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===m)break;R===92?(w+=this.input.slice(W,this.pos),w+=this.readEscapedChar(!1),W=this.pos):(Je(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return w+=this.input.slice(W,this.pos++),this.finishToken(ee.string,w)};var ti={};Ai.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(m){if(m===ti)this.readInvalidTemplateToken();else throw m}this.inTemplateElement=!1},Ai.invalidStringToken=function(m,w){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw ti;this.raise(m,w)},Ai.readTmplToken=function(){for(var m="",w=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var W=this.input.charCodeAt(this.pos);if(W===96||W===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===ee.template||this.type===ee.invalidTemplate)?W===36?(this.pos+=2,this.finishToken(ee.dollarBraceL)):(++this.pos,this.finishToken(ee.backQuote)):(m+=this.input.slice(w,this.pos),this.finishToken(ee.template,m));if(W===92)m+=this.input.slice(w,this.pos),m+=this.readEscapedChar(!0),w=this.pos;else if(Je(W)){switch(m+=this.input.slice(w,this.pos),++this.pos,W){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:m+=`
`;break;default:m+=String.fromCharCode(W);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),w=this.pos}else++this.pos}},Ai.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(ee.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Ai.readEscapedChar=function(m){var w=this.input.charCodeAt(++this.pos);switch(++this.pos,w){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ii(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(m){var W=this.pos-1;return this.invalidStringToken(W,"Invalid escape sequence in template string"),null}default:if(w>=48&&w<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],le=parseInt(R,8);return le>255&&(R=R.slice(0,-1),le=parseInt(R,8)),this.pos+=R.length-1,w=this.input.charCodeAt(this.pos),(R!=="0"||w===56||w===57)&&(this.strict||m)&&this.invalidStringToken(this.pos-1-R.length,m?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(le)}return Je(w)?"":String.fromCharCode(w)}},Ai.readHexChar=function(m){var w=this.pos,W=this.readInt(16,m);return W===null&&this.invalidStringToken(w,"Bad character escape sequence"),W},Ai.readWord1=function(){this.containsEsc=!1;for(var m="",w=!0,W=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var le=this.fullCharCodeAtPos();if(Rt(le,R))this.pos+=le<=65535?1:2;else if(le===92){this.containsEsc=!0,m+=this.input.slice(W,this.pos);var Le=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var ct=this.readCodePoint();(w?$e:Rt)(ct,R)||this.invalidStringToken(Le,"Invalid Unicode escape"),m+=ii(ct),W=this.pos}else break;w=!1}return m+this.input.slice(W,this.pos)},Ai.readWord=function(){var m=this.readWord1(),w=ee.name;return this.keywords.test(m)&&(w=at[m]),this.finishToken(w,m)};var Xi="7.4.1";Ct.acorn={Parser:Ct,version:Xi,defaultOptions:Zt,Position:me,SourceLocation:bt,getLineInfo:vt,Node:Zn,TokenType:Lt,tokTypes:ee,keywordTypes:at,TokContext:qi,tokContexts:ki,isIdentifierChar:Rt,isIdentifierStart:$e,Token:Ni,isNewLine:Je,lineBreak:fr,lineBreakG:At,nonASCIIwhitespace:Pt};function va(m,w){return Ct.parse(m,w)}function Vo(m,w,W){return Ct.parseExpressionAt(m,w,W)}function ba(m,w){return Ct.tokenizer(m,w)}function gi(m,w){m.prototype=Object.create(w.prototype),m.prototype.constructor=m,m.__proto__=w}function Bs(m){var w=typeof Map=="function"?new Map:void 0;return Bs=function(R){if(R===null||!Io(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof w!="undefined"){if(w.has(R))return w.get(R);w.set(R,le)}function le(){return Aa(R,arguments,Ka(this).constructor)}return le.prototype=Object.create(R.prototype,{constructor:{value:le,enumerable:!1,writable:!0,configurable:!0}}),zi(le,R)},Bs(m)}function nu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function Aa(m,w,W){return nu()?Aa=Reflect.construct:Aa=function(le,Le,ct){var Nt=[null];Nt.push.apply(Nt,Le);var kt=Function.bind.apply(le,Nt),Tr=new kt;return ct&&zi(Tr,ct.prototype),Tr},Aa.apply(null,arguments)}function Io(m){return Function.toString.call(m).indexOf("[native code]")!==-1}function zi(m,w){return zi=Object.setPrototypeOf||function(R,le){return R.__proto__=le,R},zi(m,w)}function Ka(m){return Ka=Object.setPrototypeOf?Object.getPrototypeOf:function(W){return W.__proto__||Object.getPrototypeOf(W)},Ka(m)}var Go=function(m){gi(w,m);function w(){return m.apply(this,arguments)||this}return w}(Bs(Error)),ea=function(m){gi(w,m);function w(){return m.apply(this,arguments)||this}return w}(Bs(SyntaxError)),To=function(m){gi(w,m);function w(){return m.apply(this,arguments)||this}return w}(Bs(ReferenceError)),Oo=function(m){gi(w,m);function w(){return m.apply(this,arguments)||this}return w}(Bs(TypeError)),co=function(m){gi(w,m);function w(){return m.apply(this,arguments)||this}return w}(Go),fo=function(m){gi(w,m);function w(){return m.apply(this,arguments)||this}return w}(ea),Yi=function(m){gi(w,m);function w(){return m.apply(this,arguments)||this}return w}(To),Da={UnknownError:[3001,"%0",co],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",co],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Yi],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Yi],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Yi],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Yi],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Yi],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Yi],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Yi],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Yi],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Yi],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Yi],FunctionUndefinedReferenceError:[2001,"%0 is not a function",To],VariableUndefinedReferenceError:[2002,"%0 is not defined",To],IsNotConstructor:[2003,"%0 is not a constructor",Oo]};function ka(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function fs(m,w,W){return ka()?fs=Reflect.construct:fs=function(le,Le,ct){var Nt=[null];Nt.push.apply(Nt,Le);var kt=Function.bind.apply(le,Nt),Tr=new kt;return ct&&Sa(Tr,ct.prototype),Tr},fs.apply(null,arguments)}function Sa(m,w){return Sa=Object.setPrototypeOf||function(R,le){return R.__proto__=le,R},Sa(m,w)}var be="0.0.2";function Ne(m,w){Object.defineProperty(m,"name",{value:w,writable:!1,enumerable:!1,configurable:!0})}var pt=Object.prototype.hasOwnProperty,rr=Symbol("Break"),Xr=Symbol("Continue"),Kn=Symbol("DefaultCase"),vi=Symbol("EmptyStatementReturn"),Ga=Symbol("WithScopeName"),ao=Symbol("SuperScopeName"),oo=Symbol("RootScopeName"),hs=Symbol("GlobalScopeName");function Xs(m){return typeof m=="function"}var ws=function(){function m(W){this.interpreter=W}var w=m.prototype;return w.generator=function(){var R=this.interpreter;function le(){return this.getCurrentScope()}function Le(){return this.getGlobalScope()}function ct(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:le.bind(R),getGlobalScope:Le.bind(R),getCurrentContext:ct.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},m}();function _o(m,w,W){if(W===void 0&&(W=!0),!(m instanceof ws))throw new Error("Illegal call");if(typeof w!="string")return w;if(!!w){var R=m.generator(),le=R.getOptions(),Le={timeout:le.timeout,_initEnv:function(){W||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},ct=W?R.getGlobalScope():R.getCurrentScope(),Nt=new vo(ct,Le);return Nt.evaluate(w)}}Object.defineProperty(_o,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function rs(m){if(!(m instanceof ws))throw new Error("Illegal call");for(var w=m.generator(),W=arguments.length,R=new Array(W>1?W-1:0),le=1;le<W;le++)R[le-1]=arguments[le];var Le=R.pop(),ct=new vo(w.getGlobalScope(),w.getOptions()),Nt=`
		    (function anonymous(`+R.join(",")+`){
		        `+Le+`
		    });
		    `;return ct.evaluate(Nt)}Object.defineProperty(rs,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Ho=function(w){this.value=w},Lo=function(w){this.value=w},xo=function(w){this.value=w},Si=function(w,W,R){W===void 0&&(W=null),this.name=R,this.parent=W,this.data=w,this.labelStack=[]};function Ds(){}function ns(m,w){return m===void 0&&(m=null),new Si(Object.create(null),m,w)}function ps(m){return Object.create(m)}var wa={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:_o,Function:rs};typeof JSON!="undefined"&&(wa.JSON=JSON),typeof Promise!="undefined"&&(wa.Promise=Promise),typeof Set!="undefined"&&(wa.Set=Set),typeof Map!="undefined"&&(wa.Map=Map),typeof Symbol!="undefined"&&(wa.Symbol=Symbol),typeof Proxy!="undefined"&&(wa.Proxy=Proxy),typeof WeakMap!="undefined"&&(wa.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(wa.WeakSet=WeakSet),typeof Reflect!="undefined"&&(wa.Reflect=Reflect);var vo=function(){function m(W,R){W===void 0&&(W=m.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||m.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?m.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=W||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var w=m.prototype;return w.initEnvironment=function(R){var le;if(R instanceof Si)le=R;else{var Le=null,ct=this.createSuperScope(R);this.options.rootContext&&(Le=new Si(ps(this.options.rootContext),ct,oo)),le=new Si(R,Le||ct,hs)}this.globalScope=le,this.currentScope=this.globalScope,this.globalContext=le.data,this.currentContext=le.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Nt=this.options._initEnv;Nt&&Nt.call(this)},w.getExecStartTime=function(){return this.execStartTime},w.getExecutionTime=function(){return this.execEndTime-this.execStartTime},w.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},w.getOptions=function(){return this.options},w.getGlobalScope=function(){return this.globalScope},w.getCurrentScope=function(){return this.currentScope},w.getCurrentContext=function(){return this.currentContext},w.isInterruptThrow=function(R){return R instanceof co||R instanceof Yi||R instanceof fo},w.createSuperScope=function(R){var le=Object.assign({},wa),Le=Object.keys(le);return Le.forEach(function(ct){ct in R&&delete le[ct]}),new Si(le,null,ao)},w.setCurrentContext=function(R){this.currentContext=R},w.setCurrentScope=function(R){this.currentScope=R},w.evaluate=function(R){R===void 0&&(R="");var le;if(!!R)return le=va(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||m.ecmaVersion}),this.evaluateNode(le,R)},w.appendCode=function(R){return this.evaluate(R)},w.evaluateNode=function(R,le){var Le=this;le===void 0&&(le=""),this.value=void 0,this.source=le,this.sourceList.push(le),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var ct=this.getCurrentScope(),Nt=this.getCurrentContext(),kt=ct.labelStack.concat([]),Tr=this.callStack.concat([]),Gr=function(){Le.setCurrentScope(ct),Le.setCurrentContext(Nt),ct.labelStack=kt,Le.callStack=Tr};try{var Jn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Jn()}catch(Mi){throw Mi}finally{Gr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},w.createErrorMessage=function(R,le,Le){var ct=R[1].replace("%0",String(le));return Le!==null&&(ct+=this.getNodePosition(Le||this.lastExecNode)),ct},w.createError=function(R,le){return new le(R)},w.createThrowError=function(R,le){return this.createError(R,le)},w.createInternalThrowError=function(R,le,Le){return this.createError(this.createErrorMessage(R,le,Le),R[2])},w.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,le=Date.now();return le-this.execStartTime>R},w.getNodePosition=function(R){if(R){var le="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+le:""}return""},w.createClosure=function(R){var le=this,Le;switch(R.type){case"BinaryExpression":Le=this.binaryExpressionHandler(R);break;case"LogicalExpression":Le=this.logicalExpressionHandler(R);break;case"UnaryExpression":Le=this.unaryExpressionHandler(R);break;case"UpdateExpression":Le=this.updateExpressionHandler(R);break;case"ObjectExpression":Le=this.objectExpressionHandler(R);break;case"ArrayExpression":Le=this.arrayExpressionHandler(R);break;case"CallExpression":Le=this.callExpressionHandler(R);break;case"NewExpression":Le=this.newExpressionHandler(R);break;case"MemberExpression":Le=this.memberExpressionHandler(R);break;case"ThisExpression":Le=this.thisExpressionHandler(R);break;case"SequenceExpression":Le=this.sequenceExpressionHandler(R);break;case"Literal":Le=this.literalHandler(R);break;case"Identifier":Le=this.identifierHandler(R);break;case"AssignmentExpression":Le=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":Le=this.functionDeclarationHandler(R);break;case"VariableDeclaration":Le=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":Le=this.programHandler(R);break;case"ExpressionStatement":Le=this.expressionStatementHandler(R);break;case"EmptyStatement":Le=this.emptyStatementHandler(R);break;case"ReturnStatement":Le=this.returnStatementHandler(R);break;case"FunctionExpression":Le=this.functionExpressionHandler(R);break;case"IfStatement":Le=this.ifStatementHandler(R);break;case"ConditionalExpression":Le=this.conditionalExpressionHandler(R);break;case"ForStatement":Le=this.forStatementHandler(R);break;case"WhileStatement":Le=this.whileStatementHandler(R);break;case"DoWhileStatement":Le=this.doWhileStatementHandler(R);break;case"ForInStatement":Le=this.forInStatementHandler(R);break;case"WithStatement":Le=this.withStatementHandler(R);break;case"ThrowStatement":Le=this.throwStatementHandler(R);break;case"TryStatement":Le=this.tryStatementHandler(R);break;case"ContinueStatement":Le=this.continueStatementHandler(R);break;case"BreakStatement":Le=this.breakStatementHandler(R);break;case"SwitchStatement":Le=this.switchStatementHandler(R);break;case"LabeledStatement":Le=this.labeledStatementHandler(R);break;case"DebuggerStatement":Le=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(Da.NodeTypeSyntaxError,R.type,R)}return function(){var ct=le.options.timeout;if(ct&&ct>0&&le.checkTimeout())throw le.createInternalThrowError(Da.ExecutionTimeOutError,ct,null);return le.lastExecNode=R,Le.apply(void 0,arguments)}},w.binaryExpressionHandler=function(R){var le=this,Le=this.createClosure(R.left),ct=this.createClosure(R.right);return function(){var Nt=Le(),kt=ct();switch(R.operator){case"==":return Nt==kt;case"!=":return Nt!=kt;case"===":return Nt===kt;case"!==":return Nt!==kt;case"<":return Nt<kt;case"<=":return Nt<=kt;case">":return Nt>kt;case">=":return Nt>=kt;case"<<":return Nt<<kt;case">>":return Nt>>kt;case">>>":return Nt>>>kt;case"+":return Nt+kt;case"-":return Nt-kt;case"*":return Nt*kt;case"**":return Math.pow(Nt,kt);case"/":return Nt/kt;case"%":return Nt%kt;case"|":return Nt|kt;case"^":return Nt^kt;case"&":return Nt&kt;case"in":return Nt in kt;case"instanceof":return Nt instanceof kt;default:throw le.createInternalThrowError(Da.BinaryOperatorSyntaxError,R.operator,R)}}},w.logicalExpressionHandler=function(R){var le=this,Le=this.createClosure(R.left),ct=this.createClosure(R.right);return function(){switch(R.operator){case"||":return Le()||ct();case"&&":return Le()&&ct();default:throw le.createInternalThrowError(Da.LogicalOperatorSyntaxError,R.operator,R)}}},w.unaryExpressionHandler=function(R){var le=this;switch(R.operator){case"delete":var Le=this.createObjectGetter(R.argument),ct=this.createNameGetter(R.argument);return function(){var Gr=Le(),Jn=ct();return delete Gr[Jn]};default:var Nt;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var kt=this.createObjectGetter(R.argument),Tr=this.createNameGetter(R.argument);Nt=function(){return kt()[Tr()]}}else Nt=this.createClosure(R.argument);return function(){var Gr=Nt();switch(R.operator){case"-":return-Gr;case"+":return+Gr;case"!":return!Gr;case"~":return~Gr;case"void":return;case"typeof":return typeof Gr;default:throw le.createInternalThrowError(Da.UnaryOperatorSyntaxError,R.operator,R)}}}},w.updateExpressionHandler=function(R){var le=this,Le=this.createObjectGetter(R.argument),ct=this.createNameGetter(R.argument);return function(){var Nt=Le(),kt=ct();switch(le.assertVariable(Nt,kt,R),R.operator){case"++":return R.prefix?++Nt[kt]:Nt[kt]++;case"--":return R.prefix?--Nt[kt]:Nt[kt]--;default:throw le.createInternalThrowError(Da.UpdateOperatorSyntaxError,R.operator,R)}}},w.objectExpressionHandler=function(R){var le=this,Le=[];function ct(kt){return kt.type==="Identifier"?kt.name:kt.type==="Literal"?kt.value:this.throwError(Da.ObjectStructureSyntaxError,kt.type,kt)}var Nt=Object.create(null);return R.properties.forEach(function(kt){var Tr=kt.kind,Gr=ct(kt.key);(!Nt[Gr]||Tr==="init")&&(Nt[Gr]={}),Nt[Gr][Tr]=le.createClosure(kt.value),Le.push({key:Gr,property:kt})}),function(){for(var kt={},Tr=Le.length,Gr=0;Gr<Tr;Gr++){var Jn=Le[Gr],Mi=Jn.key,ci=Nt[Mi],Ti=ci.init?ci.init():void 0,Ui=ci.get?ci.get():function(){},Fa=ci.set?ci.set():function(Ts){};if("set"in ci||"get"in ci){var ta={configurable:!0,enumerable:!0,get:Ui,set:Fa};Object.defineProperty(kt,Mi,ta)}else{var ds=Jn.property,bo=ds.kind;ds.key.type==="Identifier"&&ds.value.type==="FunctionExpression"&&bo==="init"&&!ds.value.id&&Ne(Ti,ds.key.name),kt[Mi]=Ti}}return kt}},w.arrayExpressionHandler=function(R){var le=this,Le=R.elements.map(function(ct){return ct&&le.createClosure(ct)});return function(){for(var ct=Le.length,Nt=Array(ct),kt=0;kt<ct;kt++){var Tr=Le[kt];Tr&&(Nt[kt]=Tr())}return Nt}},w.safeObjectGet=function(R,le,Le){return R[le]},w.createCallFunctionGetter=function(R){var le=this;switch(R.type){case"MemberExpression":var Le=this.createClosure(R.object),ct=this.createMemberKeyGetter(R),Nt=this.source;return function(){var Tr=Le(),Gr=ct(),Jn=le.safeObjectGet(Tr,Gr,R);if(!Jn||!Xs(Jn)){var Mi=Nt.slice(R.start,R.end);throw le.createInternalThrowError(Da.FunctionUndefinedReferenceError,Mi,R)}return Jn.__IS_EVAL_FUNC?function(ci){return Jn(new ws(le),ci,!0)}:Jn.__IS_FUNCTION_FUNC?function(){for(var ci=arguments.length,Ti=new Array(ci),Ui=0;Ui<ci;Ui++)Ti[Ui]=arguments[Ui];return Jn.apply(void 0,[new ws(le)].concat(Ti))}:Jn.bind(Tr)};default:var kt=this.createClosure(R);return function(){var Tr="";R.type==="Identifier"&&(Tr=R.name);var Gr=kt();if(!Gr||!Xs(Gr))throw le.createInternalThrowError(Da.FunctionUndefinedReferenceError,Tr,R);if(R.type==="Identifier"&&Gr.__IS_EVAL_FUNC&&Tr==="eval")return function(ci){var Ti=le.getScopeFromName(Tr,le.getCurrentScope()),Ui=Ti.name===ao||Ti.name===hs||Ti.name===oo;return Gr(new ws(le),ci,!Ui)};if(Gr.__IS_EVAL_FUNC)return function(ci){return Gr(new ws(le),ci,!0)};if(Gr.__IS_FUNCTION_FUNC)return function(){for(var ci=arguments.length,Ti=new Array(ci),Ui=0;Ui<ci;Ui++)Ti[Ui]=arguments[Ui];return Gr.apply(void 0,[new ws(le)].concat(Ti))};var Jn=le.options.globalContextInFunction;if(R.type==="Identifier"){var Mi=le.getIdentifierScope(R);Mi.name===Ga&&(Jn=Mi.data)}return Gr.bind(Jn)}}},w.callExpressionHandler=function(R){var le=this,Le=this.createCallFunctionGetter(R.callee),ct=R.arguments.map(function(Nt){return le.createClosure(Nt)});return function(){return Le().apply(void 0,ct.map(function(Nt){return Nt()}))}},w.functionExpressionHandler=function(R){var le=this,Le=this,ct=this.source,Nt=this.collectDeclVars,kt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Tr=R.id?R.id.name:"",Gr=R.params.length,Jn=R.params.map(function(Ui){return le.createParamNameGetter(Ui)}),Mi=this.createClosure(R.body),ci=this.collectDeclVars,Ti=this.collectDeclFuncs;return this.collectDeclVars=Nt,this.collectDeclFuncs=kt,function(){var Ui=Le.getCurrentScope(),Fa=function ta(){for(var ds=arguments.length,bo=new Array(ds),Ts=0;Ts<ds;Ts++)bo[Ts]=arguments[Ts];Le.callStack.push(""+Tr);var iu=Le.getCurrentScope(),Ns=ns(Ui,"FunctionScope("+Tr+")");Le.setCurrentScope(Ns),Le.addDeclarationsToScope(ci,Ti,Ns),Tr&&(Ns.data[Tr]=ta),Ns.data.arguments=arguments,Jn.forEach(function(Ks,$s){Ns.data[Ks()]=bo[$s]});var il=Le.getCurrentContext();Le.setCurrentContext(this);var Ys=Mi();if(Le.setCurrentContext(il),Le.setCurrentScope(iu),Le.callStack.pop(),Ys instanceof Ho)return Ys.value};return Ne(Fa,Tr),Object.defineProperty(Fa,"length",{value:Gr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Fa,"toString",{value:function(){return ct.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Fa,"valueOf",{value:function(){return ct.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Fa}},w.newExpressionHandler=function(R){var le=this,Le=this.source,ct=this.createClosure(R.callee),Nt=R.arguments.map(function(kt){return le.createClosure(kt)});return function(){var kt=ct();if(!Xs(kt)||kt.__IS_EVAL_FUNC){var Tr=R.callee,Gr=Le.slice(Tr.start,Tr.end);throw le.createInternalThrowError(Da.IsNotConstructor,Gr,R)}return kt.__IS_FUNCTION_FUNC?kt.apply(void 0,[new ws(le)].concat(Nt.map(function(Jn){return Jn()}))):fs(kt,Nt.map(function(Jn){return Jn()}))}},w.memberExpressionHandler=function(R){var le=this.createClosure(R.object),Le=this.createMemberKeyGetter(R);return function(){var ct=le(),Nt=Le();return ct[Nt]}},w.thisExpressionHandler=function(R){var le=this;return function(){return le.getCurrentContext()}},w.sequenceExpressionHandler=function(R){var le=this,Le=R.expressions.map(function(ct){return le.createClosure(ct)});return function(){for(var ct,Nt=Le.length,kt=0;kt<Nt;kt++){var Tr=Le[kt];ct=Tr()}return ct}},w.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},w.identifierHandler=function(R){var le=this;return function(){var Le=le.getCurrentScope(),ct=le.getScopeDataFromName(R.name,Le);return le.assertVariable(ct,R.name,R),ct[R.name]}},w.getIdentifierScope=function(R){var le=this.getCurrentScope(),Le=this.getScopeFromName(R.name,le);return Le},w.assignmentExpressionHandler=function(R){var le=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var Le=this.createObjectGetter(R.left),ct=this.createNameGetter(R.left),Nt=this.createClosure(R.right);return function(){var kt=Le(),Tr=ct(),Gr=Nt();switch(R.operator!=="="&&le.assertVariable(kt,Tr,R),R.operator){case"=":return kt[Tr]=Gr;case"+=":return kt[Tr]+=Gr;case"-=":return kt[Tr]-=Gr;case"*=":return kt[Tr]*=Gr;case"**=":return kt[Tr]=Math.pow(kt[Tr],Gr);case"/=":return kt[Tr]/=Gr;case"%=":return kt[Tr]%=Gr;case"<<=":return kt[Tr]<<=Gr;case">>=":return kt[Tr]>>=Gr;case">>>=":return kt[Tr]>>>=Gr;case"&=":return kt[Tr]&=Gr;case"^=":return kt[Tr]^=Gr;case"|=":return kt[Tr]|=Gr;default:throw le.createInternalThrowError(Da.AssignmentExpressionSyntaxError,R.type,R)}}},w.functionDeclarationHandler=function(R){if(R.id){var le=this.functionExpressionHandler(R);Object.defineProperty(le,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,le)}return function(){return vi}},w.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(Da.VariableTypeSyntaxError,R.type,R)},w.variableDeclarationHandler=function(R){for(var le=this,Le,ct=[],Nt=0;Nt<R.declarations.length;Nt++){var kt=R.declarations[Nt];this.varDeclaration(this.getVariableName(kt.id)),kt.init&&ct.push({type:"AssignmentExpression",operator:"=",left:kt.id,right:kt.init})}return ct.length&&(Le=this.createClosure({type:"BlockStatement",body:ct})),function(){if(Le){var Tr=le.isVarDeclMode;le.isVarDeclMode=!0,Le(),le.isVarDeclMode=Tr}return vi}},w.assertVariable=function(R,le,Le){if(R===this.globalScope.data&&!(le in R))throw this.createInternalThrowError(Da.VariableUndefinedReferenceError,le,Le)},w.programHandler=function(R){var le=this,Le=R.body.map(function(ct){return le.createClosure(ct)});return function(){for(var ct=vi,Nt=0;Nt<Le.length;Nt++){var kt=Le[Nt],Tr=le.setValue(kt());if(Tr!==vi&&(ct=Tr,ct instanceof Ho||ct instanceof Lo||ct instanceof xo||ct===rr||ct===Xr))break}return ct}},w.expressionStatementHandler=function(R){return this.createClosure(R.expression)},w.emptyStatementHandler=function(R){return function(){return vi}},w.returnStatementHandler=function(R){var le=R.argument?this.createClosure(R.argument):Ds;return function(){return new Ho(le())}},w.ifStatementHandler=function(R){var le=this.createClosure(R.test),Le=this.createClosure(R.consequent),ct=R.alternate?this.createClosure(R.alternate):function(){return vi};return function(){return le()?Le():ct()}},w.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},w.forStatementHandler=function(R){var le=this,Le=Ds,ct=R.test?this.createClosure(R.test):function(){return!0},Nt=Ds,kt=this.createClosure(R.body);return R.type==="ForStatement"&&(Le=R.init?this.createClosure(R.init):Le,Nt=R.update?this.createClosure(R.update):Ds),function(Tr){var Gr,Jn=vi,Mi=R.type==="DoWhileStatement";for(Tr&&Tr.type==="LabeledStatement"&&(Gr=Tr.label.name),Le();Mi||ct();Nt()){Mi=!1;var ci=le.setValue(kt());if(!(ci===vi||ci===Xr)){if(ci===rr)break;if(Jn=ci,Jn instanceof xo&&Jn.value===Gr){Jn=vi;continue}if(Jn instanceof Ho||Jn instanceof Lo||Jn instanceof xo)break}}return Jn}},w.whileStatementHandler=function(R){return this.forStatementHandler(R)},w.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},w.forInStatementHandler=function(R){var le=this,Le=R.left,ct=this.createClosure(R.right),Nt=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),Le=R.left.declarations[0].id),function(kt){var Tr,Gr=vi,Jn;kt&&kt.type==="LabeledStatement"&&(Tr=kt.label.name);var Mi=ct();for(Jn in Mi){le.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Le,right:{type:"Literal",value:Jn}})();var ci=le.setValue(Nt());if(!(ci===vi||ci===Xr)){if(ci===rr)break;if(Gr=ci,Gr instanceof xo&&Gr.value===Tr){Gr=vi;continue}if(Gr instanceof Ho||Gr instanceof Lo||Gr instanceof xo)break}}return Gr}},w.withStatementHandler=function(R){var le=this,Le=this.createClosure(R.object),ct=this.createClosure(R.body);return function(){var Nt=Le(),kt=le.getCurrentScope(),Tr=new Si(Nt,kt,Ga);le.setCurrentScope(Tr);var Gr=le.setValue(ct());return le.setCurrentScope(kt),Gr}},w.throwStatementHandler=function(R){var le=this,Le=this.createClosure(R.argument);return function(){throw le.setValue(void 0),Le()}},w.tryStatementHandler=function(R){var le=this,Le=this.createClosure(R.block),ct=R.handler?this.catchClauseHandler(R.handler):null,Nt=R.finalizer?this.createClosure(R.finalizer):null;return function(){var kt=le.getCurrentScope(),Tr=le.getCurrentContext(),Gr=kt.labelStack.concat([]),Jn=le.callStack.concat([]),Mi=vi,ci,Ti,Ui=function(){le.setCurrentScope(kt),le.setCurrentContext(Tr),kt.labelStack=Gr,le.callStack=Jn};try{Mi=le.setValue(Le()),Mi instanceof Ho&&(ci=Mi)}catch(Fa){if(Ui(),le.isInterruptThrow(Fa))throw Fa;if(ct)try{Mi=le.setValue(ct(Fa)),Mi instanceof Ho&&(ci=Mi)}catch(ta){if(Ui(),le.isInterruptThrow(ta))throw ta;Ti=ta}}if(Nt)try{Mi=Nt(),Mi instanceof Ho&&(ci=Mi)}catch(Fa){if(Ui(),le.isInterruptThrow(Fa))throw Fa;Ti=Fa}if(Ti)throw Ti;return ci||Mi}},w.catchClauseHandler=function(R){var le=this,Le=this.createParamNameGetter(R.param),ct=this.createClosure(R.body);return function(Nt){var kt,Tr=le.getCurrentScope(),Gr=Tr.data,Jn=Le(),Mi=pt.call(Gr,Jn),ci=Gr[Jn];return Gr[Jn]=Nt,kt=ct(),Mi?Gr[Jn]=ci:delete Gr[Jn],kt}},w.continueStatementHandler=function(R){return function(){return R.label?new xo(R.label.name):Xr}},w.breakStatementHandler=function(R){return function(){return R.label?new Lo(R.label.name):rr}},w.switchStatementHandler=function(R){var le=this,Le=this.createClosure(R.discriminant),ct=R.cases.map(function(Nt){return le.switchCaseHandler(Nt)});return function(){for(var Nt=Le(),kt=!1,Tr,Gr,Jn,Mi=0;Mi<ct.length;Mi++){var ci=ct[Mi](),Ti=ci.testClosure();if(Ti===Kn){Jn=ci;continue}if(kt||Ti===Nt){if(kt=!0,Gr=le.setValue(ci.bodyClosure()),Gr===vi)continue;if(Gr===rr||(Tr=Gr,Tr instanceof Ho||Tr instanceof Lo||Tr instanceof xo||Tr===Xr))break}}if(!kt&&Jn){Gr=le.setValue(Jn.bodyClosure());var Ui=Gr===vi||Gr===rr||Gr===Xr;Ui||(Tr=Gr)}return Tr}},w.switchCaseHandler=function(R){var le=R.test?this.createClosure(R.test):function(){return Kn},Le=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:le,bodyClosure:Le}}},w.labeledStatementHandler=function(R){var le=this,Le=R.label.name,ct=this.createClosure(R.body);return function(){var Nt,kt=le.getCurrentScope();return kt.labelStack.push(Le),Nt=ct(R),Nt instanceof Lo&&Nt.value===Le&&(Nt=vi),kt.labelStack.pop(),Nt}},w.debuggerStatementHandler=function(R){return function(){debugger;return vi}},w.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(Da.ParamTypeSyntaxError,R.type,R)},w.createObjectKeyGetter=function(R){var le;return R.type==="Identifier"?le=function(){return R.name}:le=this.createClosure(R),function(){return le()}},w.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},w.createObjectGetter=function(R){var le=this;switch(R.type){case"Identifier":return function(){return le.getScopeDataFromName(R.name,le.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(Da.AssignmentTypeSyntaxError,R.type,R)}},w.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(Da.AssignmentTypeSyntaxError,R.type,R)}},w.varDeclaration=function(R){var le=this.collectDeclVars;le[R]=void 0},w.funcDeclaration=function(R,le){var Le=this.collectDeclFuncs;Le[R]=le},w.addDeclarationsToScope=function(R,le,Le){var ct=Le.data;for(var Nt in le){var kt=le[Nt];ct[Nt]=kt&&kt()}for(var Tr in R)Tr in ct||(ct[Tr]=void 0)},w.getScopeValue=function(R,le){var Le=this.getScopeFromName(R,le);return Le.data[R]},w.getScopeDataFromName=function(R,le){return this.getScopeFromName(R,le).data},w.getScopeFromName=function(R,le){var Le=le;do if(R in Le.data)return Le;while(Le=Le.parent);return this.globalScope},w.setValue=function(R){var le=this.callStack.length;return this.isVarDeclMode||le||R===vi||R===rr||R===Xr||R instanceof Lo||R instanceof xo||(this.value=R instanceof Ho?R.value:R),R},w.getValue=function(){return this.value},m}();vo.version=be,vo.eval=_o,vo.Function=rs,vo.ecmaVersion=5,vo.globalContextInFunction=void 0,vo.global=Object.create(null);function ju(m){return m===void 0&&(m=Object.create(null)),m}function Sl(m,w,W){w===void 0&&(w=[]),W===void 0&&(W={});var R=W.parsingContext,le=W.timeout===void 0?0:W.timeout,Le=`
    (function anonymous(`+w.join(",")+`){
         `+m+`
    });
    `,ct=new vo(R,{ecmaVersion:W.ecmaVersion,timeout:le,rootContext:W.rootContext,globalContextInFunction:W.globalContextInFunction});return ct.evaluate(Le)}function wu(m,w,W){var R=new vo(w,W);return R.evaluate(m)}var Ul=wu,Vu=function(){function m(W){this._code=W}var w=m.prototype;return w.runInContext=function(R){return wu(this._code,R)},w.runInNewContext=function(R){return wu(this._code,R)},m}(),Tu=function(m,w,W){return wu(m,w,W)};function Na(){for(var m=arguments.length,w=new Array(m),W=0;W<m;W++)w[W]=arguments[W];var R=w.pop();return Sl(R||"",w)}var Gu=Tu},88307:function(Qe,D,g){(function(U,b){Qe.exports=b(g(18857))})(this,function(U){"use strict";var b=function(X){return X instanceof Uint8Array||X instanceof Uint16Array||X instanceof Uint32Array||X instanceof Int8Array||X instanceof Int16Array||X instanceof Int32Array||X instanceof Float32Array||X instanceof Float64Array||X instanceof Uint8ClampedArray},p=function(X,Oe){for(var qe=Object.keys(Oe),lr=0;lr<qe.length;++lr)X[qe[lr]]=Oe[qe[lr]];return X},E=`
`;function Z(X){return typeof atob!="undefined"?atob(X):"base64:"+X}function V(X){var Oe=new Error("(regl) "+X);throw console.error(Oe),Oe}function H(X,Oe){X||V(Oe)}function I(X){return X?": "+X:""}function L(X,Oe,qe){X in Oe||V("unknown parameter ("+X+")"+I(qe)+". possible values: "+Object.keys(Oe).join())}function _e(X,Oe){b(X)||V("invalid parameter type"+I(Oe)+". must be a typed array")}function xe(X,Oe){switch(Oe){case"number":return typeof X=="number";case"object":return typeof X=="object";case"string":return typeof X=="string";case"boolean":return typeof X=="boolean";case"function":return typeof X=="function";case"undefined":return typeof X=="undefined";case"symbol":return typeof X=="symbol"}}function Re(X,Oe,qe){xe(X,Oe)||V("invalid parameter type"+I(qe)+". expected "+Oe+", got "+typeof X)}function $e(X,Oe){X>=0&&(X|0)===X||V("invalid parameter type, ("+X+")"+I(Oe)+". must be a nonnegative integer")}function Rt(X,Oe,qe){Oe.indexOf(X)<0&&V("invalid value"+I(qe)+". must be one of: "+Oe)}var Lt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function zt(X){Object.keys(X).forEach(function(Oe){Lt.indexOf(Oe)<0&&V('invalid regl constructor argument "'+Oe+'". must be one of '+Lt)})}function St(X,Oe){for(X=X+"";X.length<Oe;)X=" "+X;return X}function Et(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function at(X,Oe){this.number=X,this.line=Oe,this.errors=[]}function ur(X,Oe,qe){this.file=X,this.line=Oe,this.message=qe}function ee(){var X=new Error,Oe=(X.stack||X).toString(),qe=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Oe);if(qe)return qe[1];var lr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Oe);return lr?lr[1]:"unknown"}function fr(){var X=new Error,Oe=(X.stack||X).toString(),qe=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Oe);if(qe)return qe[1];var lr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Oe);return lr?lr[1]:"unknown"}function At(X,Oe){var qe=X.split(`
`),lr=1,Ir=0,or={unknown:new Et,0:new Et};or.unknown.name=or[0].name=Oe||ee(),or.unknown.lines.push(new at(0,""));for(var Cr=0;Cr<qe.length;++Cr){var Nr=qe[Cr],Hr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Nr);if(Hr)switch(Hr[1]){case"line":var Kr=/(\d+)(\s+\d+)?/.exec(Hr[2]);Kr&&(lr=Kr[1]|0,Kr[2]&&(Ir=Kr[2]|0,Ir in or||(or[Ir]=new Et)));break;case"define":var Jr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Hr[2]);Jr&&(or[Ir].name=Jr[1]?Z(Jr[2]):Jr[2]);break}or[Ir].lines.push(new at(lr++,Nr))}return Object.keys(or).forEach(function(rn){var dn=or[rn];dn.lines.forEach(function(Wr){dn.index[Wr.number]=Wr})}),or}function Je(X){var Oe=[];return X.split(`
`).forEach(function(qe){if(!(qe.length<5)){var lr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(qe);lr?Oe.push(new ur(lr[1]|0,lr[2]|0,lr[3].trim())):qe.length>0&&Oe.push(new ur("unknown",0,qe))}}),Oe}function Pt(X,Oe){Oe.forEach(function(qe){var lr=X[qe.file];if(lr){var Ir=lr.index[qe.line];if(Ir){Ir.errors.push(qe),lr.hasErrors=!0;return}}X.unknown.hasErrors=!0,X.unknown.lines[0].errors.push(qe)})}function Ve(X,Oe,qe,lr,Ir){if(!X.getShaderParameter(Oe,X.COMPILE_STATUS)){var or=X.getShaderInfoLog(Oe),Cr=lr===X.FRAGMENT_SHADER?"fragment":"vertex";me(qe,"string",Cr+" shader source must be a string",Ir);var Nr=At(qe,Ir),Hr=Je(or);Pt(Nr,Hr),Object.keys(Nr).forEach(function(Kr){var Jr=Nr[Kr];if(!Jr.hasErrors)return;var rn=[""],dn=[""];function Wr(en,Bt){rn.push(en),dn.push(Bt||"")}Wr("file number "+Kr+": "+Jr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Jr.lines.forEach(function(en){if(en.errors.length>0){Wr(St(en.number,4)+"|  ","background-color:yellow; font-weight:bold"),Wr(en.line+E,"color:red; background-color:yellow; font-weight:bold");var Bt=0;en.errors.forEach(function(yr){var Yr=yr.message,wn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Yr);if(wn){var Ar=wn[1];switch(Yr=wn[2],Ar){case"assign":Ar="=";break}Bt=Math.max(en.line.indexOf(Ar,Bt),0)}else Bt=0;Wr(St("| ",6)),Wr(St("^^^",Bt+3)+E,"font-weight:bold"),Wr(St("| ",6)),Wr(Yr+E,"font-weight:bold")}),Wr(St("| ",6)+E)}else Wr(St(en.number,4)+"|  "),Wr(en.line+E,"color:red")}),typeof document!="undefined"&&!window.chrome?(dn[0]=rn.join("%c"),console.log.apply(console,dn)):console.log(rn.join(""))}),H.raise("Error compiling "+Cr+" shader, "+Nr[0].name)}}function It(X,Oe,qe,lr,Ir){if(!X.getProgramParameter(Oe,X.LINK_STATUS)){var or=X.getProgramInfoLog(Oe),Cr=At(qe,Ir),Nr=At(lr,Ir),Hr='Error linking program with vertex shader, "'+Nr[0].name+'", and fragment shader "'+Cr[0].name+'"';typeof document!="undefined"?console.log("%c"+Hr+E+"%c"+or,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Hr+E+or),H.raise(Hr)}}function hr(X){X._commandRef=ee()}function Jt(X,Oe,qe,lr){hr(X);function Ir(Hr){return Hr?lr.id(Hr):0}X._fragId=Ir(X.static.frag),X._vertId=Ir(X.static.vert);function or(Hr,Kr){Object.keys(Kr).forEach(function(Jr){Hr[lr.id(Jr)]=!0})}var Cr=X._uniformSet={};or(Cr,Oe.static),or(Cr,Oe.dynamic);var Nr=X._attributeSet={};or(Nr,qe.static),or(Nr,qe.dynamic),X._hasCount="count"in X.static||"count"in X.dynamic||"elements"in X.static||"elements"in X.dynamic}function Fr(X,Oe){var qe=fr();V(X+" in command "+(Oe||ee())+(qe==="unknown"?"":" called from "+qe))}function fe(X,Oe,qe){X||Fr(Oe,qe||ee())}function Fe(X,Oe,qe,lr){X in Oe||Fr("unknown parameter ("+X+")"+I(qe)+". possible values: "+Object.keys(Oe).join(),lr||ee())}function me(X,Oe,qe,lr){xe(X,Oe)||Fr("invalid parameter type"+I(qe)+". expected "+Oe+", got "+typeof X,lr||ee())}function bt(X){X()}function vt(X,Oe,qe){X.texture?Rt(X.texture._texture.internalformat,Oe,"unsupported texture format for attachment"):Rt(X.renderbuffer._renderbuffer.format,qe,"unsupported renderbuffer format for attachment")}var Zt=33071,Ut=9728,Rr=9984,ln=9985,pn=9986,Vi=9987,ar=5120,pe=5121,Pe=5122,Ge=5123,ke=5124,Ft=5125,ir=5126,T=32819,G=32820,Se=33635,Be=34042,et=36193,tt={};tt[ar]=tt[pe]=1,tt[Pe]=tt[Ge]=tt[et]=tt[Se]=tt[T]=tt[G]=2,tt[ke]=tt[Ft]=tt[ir]=tt[Be]=4;function Ct(X,Oe){return X===G||X===T||X===Se?2:X===Be?4:tt[X]*Oe}function jt(X){return!(X&X-1)&&!!X}function Mt(X,Oe,qe){var lr,Ir=Oe.width,or=Oe.height,Cr=Oe.channels;H(Ir>0&&Ir<=qe.maxTextureSize&&or>0&&or<=qe.maxTextureSize,"invalid texture shape"),(X.wrapS!==Zt||X.wrapT!==Zt)&&H(jt(Ir)&&jt(or),"incompatible wrap mode for texture, both width and height must be power of 2"),Oe.mipmask===1?Ir!==1&&or!==1&&H(X.minFilter!==Rr&&X.minFilter!==pn&&X.minFilter!==ln&&X.minFilter!==Vi,"min filter requires mipmap"):(H(jt(Ir)&&jt(or),"texture must be a square power of 2 to support mipmapping"),H(Oe.mipmask===(Ir<<1)-1,"missing or incomplete mipmap data")),Oe.type===ir&&(qe.extensions.indexOf("oes_texture_float_linear")<0&&H(X.minFilter===Ut&&X.magFilter===Ut,"filter not supported, must enable oes_texture_float_linear"),H(!X.genMipmaps,"mipmap generation not supported with float textures"));var Nr=Oe.images;for(lr=0;lr<16;++lr)if(Nr[lr]){var Hr=Ir>>lr,Kr=or>>lr;H(Oe.mipmask&1<<lr,"missing mipmap data");var Jr=Nr[lr];if(H(Jr.width===Hr&&Jr.height===Kr,"invalid shape for mip images"),H(Jr.format===Oe.format&&Jr.internalformat===Oe.internalformat&&Jr.type===Oe.type,"incompatible type for mip image"),!Jr.compressed)if(Jr.data){var rn=Math.ceil(Ct(Jr.type,Cr)*Hr/Jr.unpackAlignment)*Jr.unpackAlignment;H(Jr.data.byteLength===rn*Kr,"invalid data for image, buffer size is inconsistent with image format")}else Jr.element||Jr.copy}else X.genMipmaps||H((Oe.mipmask&1<<lr)==0,"extra mipmap data");Oe.compressed&&H(!X.genMipmaps,"mipmap generation for compressed images not supported")}function Qt(X,Oe,qe,lr){var Ir=X.width,or=X.height,Cr=X.channels;H(Ir>0&&Ir<=lr.maxTextureSize&&or>0&&or<=lr.maxTextureSize,"invalid texture shape"),H(Ir===or,"cube map must be square"),H(Oe.wrapS===Zt&&Oe.wrapT===Zt,"wrap mode not supported by cube map");for(var Nr=0;Nr<qe.length;++Nr){var Hr=qe[Nr];H(Hr.width===Ir&&Hr.height===or,"inconsistent cube map face shape"),Oe.genMipmaps&&(H(!Hr.compressed,"can not generate mipmap for compressed textures"),H(Hr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Kr=Hr.images,Jr=0;Jr<16;++Jr){var rn=Kr[Jr];if(rn){var dn=Ir>>Jr,Wr=or>>Jr;H(Hr.mipmask&1<<Jr,"missing mipmap data"),H(rn.width===dn&&rn.height===Wr,"invalid shape for mip images"),H(rn.format===X.format&&rn.internalformat===X.internalformat&&rn.type===X.type,"incompatible type for mip image"),rn.compressed||(rn.data?H(rn.data.byteLength===dn*Wr*Math.max(Ct(rn.type,Cr),rn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):rn.element||rn.copy)}}}}var ne=p(H,{optional:bt,raise:V,commandRaise:Fr,command:fe,parameter:L,commandParameter:Fe,constructor:zt,type:Re,commandType:me,isTypedArray:_e,nni:$e,oneOf:Rt,shaderError:Ve,linkError:It,callSite:fr,saveCommandRef:hr,saveDrawInfo:Jt,framebufferFormat:vt,guessCommand:ee,texture2D:Mt,textureCube:Qt}),Kt=0,Dr=0,Mr=5,nt=6;function xt(X,Oe){this.id=Kt++,this.type=X,this.data=Oe}function ht(X){return X.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function vr(X){if(X.length===0)return[];var Oe=X.charAt(0),qe=X.charAt(X.length-1);if(X.length>1&&Oe===qe&&(Oe==='"'||Oe==="'"))return['"'+ht(X.substr(1,X.length-2))+'"'];var lr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(X);if(lr)return vr(X.substr(0,lr.index)).concat(vr(lr[1])).concat(vr(X.substr(lr.index+lr[0].length)));var Ir=X.split(".");if(Ir.length===1)return['"'+ht(X)+'"'];for(var or=[],Cr=0;Cr<Ir.length;++Cr)or=or.concat(vr(Ir[Cr]));return or}function Zr(X){return"["+vr(X).join("][")+"]"}function Ur(X,Oe){return new xt(X,Zr(Oe+""))}function tn(X){return typeof X=="function"&&!X._reglType||X instanceof xt}function jr(X,Oe){if(typeof X=="function")return new xt(Dr,X);if(typeof X=="number"||typeof X=="boolean")return new xt(Mr,X);if(Array.isArray(X))return new xt(nt,X.map(function(qe,lr){return jr(qe,Oe+"["+lr+"]")}));if(X instanceof xt)return X;ne(!1,"invalid option type in uniform "+Oe)}var wr={DynamicVariable:xt,define:Ur,isDynamic:tn,unbox:jr,accessor:Zr},Dn={next:typeof requestAnimationFrame=="function"?function(X){return requestAnimationFrame(X)}:function(X){return setTimeout(X,16)},cancel:typeof cancelAnimationFrame=="function"?function(X){return cancelAnimationFrame(X)}:clearTimeout},Zn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",bi=Zn?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Hi(){var X={"":0},Oe=[""];return{id:function(qe){var lr=X[qe];return lr||(lr=X[qe]=Oe.length,Oe.push(qe),lr)},str:function(qe){return Oe[qe]}}}function qi(X,Oe,qe){var lr=document.createElement("canvas");p(lr.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),X.appendChild(lr),X===document.body&&(lr.style.position="absolute",p(X.style,{margin:0,padding:0}));function Ir(){var Nr=window.innerWidth,Hr=window.innerHeight;if(X!==document.body){var Kr=lr.getBoundingClientRect();Nr=Kr.right-Kr.left,Hr=Kr.bottom-Kr.top}lr.width=qe*Nr,lr.height=qe*Hr}var or;X!==document.body&&typeof ResizeObserver=="function"?(or=new ResizeObserver(function(){setTimeout(Ir)}),or.observe(X)):window.addEventListener("resize",Ir,!1);function Cr(){or?or.disconnect():window.removeEventListener("resize",Ir),X.removeChild(lr)}return Ir(),{canvas:lr,onDestroy:Cr}}function ki(X,Oe){function qe(lr){try{return X.getContext(lr,Oe)}catch(Ir){return null}}return qe("webgl")||qe("experimental-webgl")||qe("webgl-experimental")}function Oi(X){return typeof X.nodeName=="string"&&typeof X.appendChild=="function"&&typeof X.getBoundingClientRect=="function"}function $(X){return typeof X.drawArrays=="function"||typeof X.drawElements=="function"}function ce(X){return typeof X=="string"?X.split():(ne(Array.isArray(X),"invalid extension array"),X)}function ve(X){return typeof X=="string"?(ne(typeof document!="undefined","not supported outside of DOM"),document.querySelector(X)):X}function j(X){var Oe=X||{},qe,lr,Ir,or,Cr={},Nr=[],Hr=[],Kr=typeof window=="undefined"?1:window.devicePixelRatio,Jr=!1,rn=function(en){en&&ne.raise(en)},dn=function(){};if(typeof Oe=="string"?(ne(typeof document!="undefined","selector queries only supported in DOM environments"),qe=document.querySelector(Oe),ne(qe,"invalid query string for element")):typeof Oe=="object"?Oi(Oe)?qe=Oe:$(Oe)?(or=Oe,Ir=or.canvas):(ne.constructor(Oe),"gl"in Oe?or=Oe.gl:"canvas"in Oe?Ir=ve(Oe.canvas):"container"in Oe&&(lr=ve(Oe.container)),"attributes"in Oe&&(Cr=Oe.attributes,ne.type(Cr,"object","invalid context attributes")),"extensions"in Oe&&(Nr=ce(Oe.extensions)),"optionalExtensions"in Oe&&(Hr=ce(Oe.optionalExtensions)),"onDone"in Oe&&(ne.type(Oe.onDone,"function","invalid or missing onDone callback"),rn=Oe.onDone),"profile"in Oe&&(Jr=!!Oe.profile),"pixelRatio"in Oe&&(Kr=+Oe.pixelRatio,ne(Kr>0,"invalid pixel ratio"))):ne.raise("invalid arguments to regl"),qe&&(qe.nodeName.toLowerCase()==="canvas"?Ir=qe:lr=qe),!or){if(!Ir){ne(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Wr=qi(lr||document.body,rn,Kr);if(!Wr)return null;Ir=Wr.canvas,dn=Wr.onDestroy}Cr.premultipliedAlpha===void 0&&(Cr.premultipliedAlpha=!0),or=ki(Ir,Cr)}return or?{gl:or,canvas:Ir,container:lr,extensions:Nr,optionalExtensions:Hr,pixelRatio:Kr,profile:Jr,onDone:rn,onDestroy:dn}:(dn(),rn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function se(X,Oe){var qe={};function lr(Nr){ne.type(Nr,"string","extension name must be string");var Hr=Nr.toLowerCase(),Kr;try{Kr=qe[Hr]=Ir(Nr)}catch(Jr){}return!!Kr}function Ir(Nr){return X.getExtension(Nr)?X.getExtension(Nr):X.getExtension(Nr.toLowerCase())?X.getExtension(Nr.toLowerCase()):null}for(var or=0;or<Oe.extensions.length;++or){var Cr=Oe.extensions[or];if(!lr(Cr))return Oe.onDestroy(),Oe.onDone('"'+Cr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Oe.optionalExtensions.forEach(lr),{extensions:qe,restore:function(){Object.keys(qe).forEach(function(Nr){if(qe[Nr]&&!lr(Nr))throw new Error("(regl): error restoring extension "+Nr)})}}}function de(X,Oe){for(var qe=Array(X),lr=0;lr<X;++lr)qe[lr]=Oe(lr);return qe}var Me=5120,ue=5121,Te=5122,mt=5123,br=5124,Yt=5125,nr=5126;function kr(X){for(var Oe=16;Oe<=1<<28;Oe*=16)if(X<=Oe)return Oe;return 0}function Mn(X){var Oe,qe;return Oe=(X>65535)<<4,X>>>=Oe,qe=(X>255)<<3,X>>>=qe,Oe|=qe,qe=(X>15)<<2,X>>>=qe,Oe|=qe,qe=(X>3)<<1,X>>>=qe,Oe|=qe,Oe|X>>1}function Pn(){var X=de(8,function(){return[]});function Oe(or){var Cr=kr(or),Nr=X[Mn(Cr)>>2];return Nr.length>0?Nr.pop():new ArrayBuffer(Cr)}function qe(or){X[Mn(or.byteLength)>>2].push(or)}function lr(or,Cr){var Nr=null;switch(or){case Me:Nr=new Int8Array(Oe(Cr),0,Cr);break;case ue:Nr=new Uint8Array(Oe(Cr),0,Cr);break;case Te:Nr=new Int16Array(Oe(2*Cr),0,Cr);break;case mt:Nr=new Uint16Array(Oe(2*Cr),0,Cr);break;case br:Nr=new Int32Array(Oe(4*Cr),0,Cr);break;case Yt:Nr=new Uint32Array(Oe(4*Cr),0,Cr);break;case nr:Nr=new Float32Array(Oe(4*Cr),0,Cr);break;default:return null}return Nr.length!==Cr?Nr.subarray(0,Cr):Nr}function Ir(or){qe(or.buffer)}return{alloc:Oe,free:qe,allocType:lr,freeType:Ir}}var tr=Pn();tr.zero=Pn();var Sn=3408,on=3410,cn=3411,wi=3412,xn=3413,Li=3414,$i=3415,ai=33901,Ji=33902,Ni=3379,Ai=3386,ha=34921,Ca=36347,ii=36348,ti=35661,Xi=35660,va=34930,Vo=36349,ba=34076,gi=34024,Bs=7936,nu=7937,Aa=7938,Io=35724,zi=34047,Ka=36063,Go=34852,ea=3553,To=34067,Oo=34069,co=33984,fo=6408,Yi=5126,Da=5121,ka=36160,fs=36053,Sa=36064,be=16384,Ne=function(X,Oe){var qe=1;Oe.ext_texture_filter_anisotropic&&(qe=X.getParameter(zi));var lr=1,Ir=1;Oe.webgl_draw_buffers&&(lr=X.getParameter(Go),Ir=X.getParameter(Ka));var or=!!Oe.oes_texture_float;if(or){var Cr=X.createTexture();X.bindTexture(ea,Cr),X.texImage2D(ea,0,fo,1,1,0,fo,Yi,null);var Nr=X.createFramebuffer();if(X.bindFramebuffer(ka,Nr),X.framebufferTexture2D(ka,Sa,ea,Cr,0),X.bindTexture(ea,null),X.checkFramebufferStatus(ka)!==fs)or=!1;else{X.viewport(0,0,1,1),X.clearColor(1,0,0,1),X.clear(be);var Hr=tr.allocType(Yi,4);X.readPixels(0,0,1,1,fo,Yi,Hr),X.getError()?or=!1:(X.deleteFramebuffer(Nr),X.deleteTexture(Cr),or=Hr[0]===1),tr.freeType(Hr)}}var Kr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Jr=!0;if(!Kr){var rn=X.createTexture(),dn=tr.allocType(Da,36);X.activeTexture(co),X.bindTexture(To,rn),X.texImage2D(Oo,0,fo,3,3,0,fo,Da,dn),tr.freeType(dn),X.bindTexture(To,null),X.deleteTexture(rn),Jr=!X.getError()}return{colorBits:[X.getParameter(on),X.getParameter(cn),X.getParameter(wi),X.getParameter(xn)],depthBits:X.getParameter(Li),stencilBits:X.getParameter($i),subpixelBits:X.getParameter(Sn),extensions:Object.keys(Oe).filter(function(Wr){return!!Oe[Wr]}),maxAnisotropic:qe,maxDrawbuffers:lr,maxColorAttachments:Ir,pointSizeDims:X.getParameter(ai),lineWidthDims:X.getParameter(Ji),maxViewportDims:X.getParameter(Ai),maxCombinedTextureUnits:X.getParameter(ti),maxCubeMapSize:X.getParameter(ba),maxRenderbufferSize:X.getParameter(gi),maxTextureUnits:X.getParameter(va),maxTextureSize:X.getParameter(Ni),maxAttributes:X.getParameter(ha),maxVertexUniforms:X.getParameter(Ca),maxVertexTextureUnits:X.getParameter(Xi),maxVaryingVectors:X.getParameter(ii),maxFragmentUniforms:X.getParameter(Vo),glsl:X.getParameter(Io),renderer:X.getParameter(nu),vendor:X.getParameter(Bs),version:X.getParameter(Aa),readFloat:or,npotTextureCube:Jr}};function pt(X){return!!X&&typeof X=="object"&&Array.isArray(X.shape)&&Array.isArray(X.stride)&&typeof X.offset=="number"&&X.shape.length===X.stride.length&&(Array.isArray(X.data)||b(X.data))}var rr=function(X){return Object.keys(X).map(function(Oe){return X[Oe]})},Xr={shape:hs,flatten:oo};function Kn(X,Oe,qe){for(var lr=0;lr<Oe;++lr)qe[lr]=X[lr]}function vi(X,Oe,qe,lr){for(var Ir=0,or=0;or<Oe;++or)for(var Cr=X[or],Nr=0;Nr<qe;++Nr)lr[Ir++]=Cr[Nr]}function Ga(X,Oe,qe,lr,Ir,or){for(var Cr=or,Nr=0;Nr<Oe;++Nr)for(var Hr=X[Nr],Kr=0;Kr<qe;++Kr)for(var Jr=Hr[Kr],rn=0;rn<lr;++rn)Ir[Cr++]=Jr[rn]}function ao(X,Oe,qe,lr,Ir){for(var or=1,Cr=qe+1;Cr<Oe.length;++Cr)or*=Oe[Cr];var Nr=Oe[qe];if(Oe.length-qe==4){var Hr=Oe[qe+1],Kr=Oe[qe+2],Jr=Oe[qe+3];for(Cr=0;Cr<Nr;++Cr)Ga(X[Cr],Hr,Kr,Jr,lr,Ir),Ir+=or}else for(Cr=0;Cr<Nr;++Cr)ao(X[Cr],Oe,qe+1,lr,Ir),Ir+=or}function oo(X,Oe,qe,lr){var Ir=1;if(Oe.length)for(var or=0;or<Oe.length;++or)Ir*=Oe[or];else Ir=0;var Cr=lr||tr.allocType(qe,Ir);switch(Oe.length){case 0:break;case 1:Kn(X,Oe[0],Cr);break;case 2:vi(X,Oe[0],Oe[1],Cr);break;case 3:Ga(X,Oe[0],Oe[1],Oe[2],Cr,0);break;default:ao(X,Oe,0,Cr,0)}return Cr}function hs(X){for(var Oe=[],qe=X;qe.length;qe=qe[0])Oe.push(qe.length);return Oe}var Xs={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ws=5120,_o=5122,rs=5124,Ho=5121,Lo=5123,xo=5125,Si=5126,Ds=5126,ns={int8:ws,int16:_o,int32:rs,uint8:Ho,uint16:Lo,uint32:xo,float:Si,float32:Ds},ps=35048,wa=35040,vo={dynamic:ps,stream:wa,static:35044},ju=Xr.flatten,Sl=Xr.shape,wu=35044,Ul=35040,Vu=5121,Tu=5126,Na=[];Na[5120]=1,Na[5122]=2,Na[5124]=4,Na[5121]=1,Na[5123]=2,Na[5125]=4,Na[5126]=4;function Gu(X){return Xs[Object.prototype.toString.call(X)]|0}function m(X,Oe){for(var qe=0;qe<Oe.length;++qe)X[qe]=Oe[qe]}function w(X,Oe,qe,lr,Ir,or,Cr){for(var Nr=0,Hr=0;Hr<qe;++Hr)for(var Kr=0;Kr<lr;++Kr)X[Nr++]=Oe[Ir*Hr+or*Kr+Cr]}function W(X,Oe,qe,lr){var Ir=0,or={};function Cr(Bt){this.id=Ir++,this.buffer=X.createBuffer(),this.type=Bt,this.usage=wu,this.byteLength=0,this.dimension=1,this.dtype=Vu,this.persistentData=null,qe.profile&&(this.stats={size:0})}Cr.prototype.bind=function(){X.bindBuffer(this.type,this.buffer)},Cr.prototype.destroy=function(){dn(this)};var Nr=[];function Hr(Bt,yr){var Yr=Nr.pop();return Yr||(Yr=new Cr(Bt)),Yr.bind(),rn(Yr,yr,Ul,0,1,!1),Yr}function Kr(Bt){Nr.push(Bt)}function Jr(Bt,yr,Yr){Bt.byteLength=yr.byteLength,X.bufferData(Bt.type,yr,Yr)}function rn(Bt,yr,Yr,wn,Ar,En){var qr;if(Bt.usage=Yr,Array.isArray(yr)){if(Bt.dtype=wn||Tu,yr.length>0){var li;if(Array.isArray(yr[0])){qr=Sl(yr);for(var Pr=1,Sr=1;Sr<qr.length;++Sr)Pr*=qr[Sr];Bt.dimension=Pr,li=ju(yr,qr,Bt.dtype),Jr(Bt,li,Yr),En?Bt.persistentData=li:tr.freeType(li)}else if(typeof yr[0]=="number"){Bt.dimension=Ar;var Wn=tr.allocType(Bt.dtype,yr.length);m(Wn,yr),Jr(Bt,Wn,Yr),En?Bt.persistentData=Wn:tr.freeType(Wn)}else b(yr[0])?(Bt.dimension=yr[0].length,Bt.dtype=wn||Gu(yr[0])||Tu,li=ju(yr,[yr.length,yr[0].length],Bt.dtype),Jr(Bt,li,Yr),En?Bt.persistentData=li:tr.freeType(li)):ne.raise("invalid buffer data")}}else if(b(yr))Bt.dtype=wn||Gu(yr),Bt.dimension=Ar,Jr(Bt,yr,Yr),En&&(Bt.persistentData=new Uint8Array(new Uint8Array(yr.buffer)));else if(pt(yr)){qr=yr.shape;var hn=yr.stride,$r=yr.offset,yn=0,bn=0,Ri=0,Ii=0;qr.length===1?(yn=qr[0],bn=1,Ri=hn[0],Ii=0):qr.length===2?(yn=qr[0],bn=qr[1],Ri=hn[0],Ii=hn[1]):ne.raise("invalid shape"),Bt.dtype=wn||Gu(yr.data)||Tu,Bt.dimension=bn;var An=tr.allocType(Bt.dtype,yn*bn);w(An,yr.data,yn,bn,Ri,Ii,$r),Jr(Bt,An,Yr),En?Bt.persistentData=An:tr.freeType(An)}else yr instanceof ArrayBuffer?(Bt.dtype=Vu,Bt.dimension=Ar,Jr(Bt,yr,Yr),En&&(Bt.persistentData=new Uint8Array(new Uint8Array(yr)))):ne.raise("invalid buffer data")}function dn(Bt){Oe.bufferCount--,lr(Bt);var yr=Bt.buffer;ne(yr,"buffer must not be deleted already"),X.deleteBuffer(yr),Bt.buffer=null,delete or[Bt.id]}function Wr(Bt,yr,Yr,wn){Oe.bufferCount++;var Ar=new Cr(yr);or[Ar.id]=Ar;function En(Pr){var Sr=wu,Wn=null,hn=0,$r=0,yn=1;return Array.isArray(Pr)||b(Pr)||pt(Pr)||Pr instanceof ArrayBuffer?Wn=Pr:typeof Pr=="number"?hn=Pr|0:Pr&&(ne.type(Pr,"object","buffer arguments must be an object, a number or an array"),"data"in Pr&&(ne(Wn===null||Array.isArray(Wn)||b(Wn)||pt(Wn),"invalid data for buffer"),Wn=Pr.data),"usage"in Pr&&(ne.parameter(Pr.usage,vo,"invalid buffer usage"),Sr=vo[Pr.usage]),"type"in Pr&&(ne.parameter(Pr.type,ns,"invalid buffer type"),$r=ns[Pr.type]),"dimension"in Pr&&(ne.type(Pr.dimension,"number","invalid dimension"),yn=Pr.dimension|0),"length"in Pr&&(ne.nni(hn,"buffer length must be a nonnegative integer"),hn=Pr.length|0)),Ar.bind(),Wn?rn(Ar,Wn,Sr,$r,yn,wn):(hn&&X.bufferData(Ar.type,hn,Sr),Ar.dtype=$r||Vu,Ar.usage=Sr,Ar.dimension=yn,Ar.byteLength=hn),qe.profile&&(Ar.stats.size=Ar.byteLength*Na[Ar.dtype]),En}function qr(Pr,Sr){ne(Sr+Pr.byteLength<=Ar.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Pr.byteLength+" starting from offset "+Sr+" to a buffer of size "+Ar.byteLength),X.bufferSubData(Ar.type,Sr,Pr)}function li(Pr,Sr){var Wn=(Sr||0)|0,hn;if(Ar.bind(),b(Pr)||Pr instanceof ArrayBuffer)qr(Pr,Wn);else if(Array.isArray(Pr)){if(Pr.length>0)if(typeof Pr[0]=="number"){var $r=tr.allocType(Ar.dtype,Pr.length);m($r,Pr),qr($r,Wn),tr.freeType($r)}else if(Array.isArray(Pr[0])||b(Pr[0])){hn=Sl(Pr);var yn=ju(Pr,hn,Ar.dtype);qr(yn,Wn),tr.freeType(yn)}else ne.raise("invalid buffer data")}else if(pt(Pr)){hn=Pr.shape;var bn=Pr.stride,Ri=0,Ii=0,An=0,Tn=0;hn.length===1?(Ri=hn[0],Ii=1,An=bn[0],Tn=0):hn.length===2?(Ri=hn[0],Ii=hn[1],An=bn[0],Tn=bn[1]):ne.raise("invalid shape");var Ei=Array.isArray(Pr.data)?Ar.dtype:Gu(Pr.data),Bi=tr.allocType(Ei,Ri*Ii);w(Bi,Pr.data,Ri,Ii,An,Tn,Pr.offset),qr(Bi,Wn),tr.freeType(Bi)}else ne.raise("invalid data for buffer subdata");return En}return Yr||En(Bt),En._reglType="buffer",En._buffer=Ar,En.subdata=li,qe.profile&&(En.stats=Ar.stats),En.destroy=function(){dn(Ar)},En}function en(){rr(or).forEach(function(Bt){Bt.buffer=X.createBuffer(),X.bindBuffer(Bt.type,Bt.buffer),X.bufferData(Bt.type,Bt.persistentData||Bt.byteLength,Bt.usage)})}return qe.profile&&(Oe.getTotalBufferSize=function(){var Bt=0;return Object.keys(or).forEach(function(yr){Bt+=or[yr].stats.size}),Bt}),{create:Wr,createStream:Hr,destroyStream:Kr,clear:function(){rr(or).forEach(dn),Nr.forEach(dn)},getBuffer:function(Bt){return Bt&&Bt._buffer instanceof Cr?Bt._buffer:null},restore:en,_initBuffer:rn}}var R=0,le=0,Le=1,ct=1,Nt=4,kt=4,Tr={points:R,point:le,lines:Le,line:ct,triangles:Nt,triangle:kt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Gr=0,Jn=1,Mi=4,ci=5120,Ti=5121,Ui=5122,Fa=5123,ta=5124,ds=5125,bo=34963,Ts=35040,iu=35044;function Ns(X,Oe,qe,lr){var Ir={},or=0,Cr={uint8:Ti,uint16:Fa};Oe.oes_element_index_uint&&(Cr.uint32=ds);function Nr(en){this.id=or++,Ir[this.id]=this,this.buffer=en,this.primType=Mi,this.vertCount=0,this.type=0}Nr.prototype.bind=function(){this.buffer.bind()};var Hr=[];function Kr(en){var Bt=Hr.pop();return Bt||(Bt=new Nr(qe.create(null,bo,!0,!1)._buffer)),rn(Bt,en,Ts,-1,-1,0,0),Bt}function Jr(en){Hr.push(en)}function rn(en,Bt,yr,Yr,wn,Ar,En){en.buffer.bind();var qr;if(Bt){var li=En;!En&&(!b(Bt)||pt(Bt)&&!b(Bt.data))&&(li=Oe.oes_element_index_uint?ds:Fa),qe._initBuffer(en.buffer,Bt,yr,li,3)}else X.bufferData(bo,Ar,yr),en.buffer.dtype=qr||Ti,en.buffer.usage=yr,en.buffer.dimension=3,en.buffer.byteLength=Ar;if(qr=En,!En){switch(en.buffer.dtype){case Ti:case ci:qr=Ti;break;case Fa:case Ui:qr=Fa;break;case ds:case ta:qr=ds;break;default:ne.raise("unsupported type for element array")}en.buffer.dtype=qr}en.type=qr,ne(qr!==ds||!!Oe.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Pr=wn;Pr<0&&(Pr=en.buffer.byteLength,qr===Fa?Pr>>=1:qr===ds&&(Pr>>=2)),en.vertCount=Pr;var Sr=Yr;if(Yr<0){Sr=Mi;var Wn=en.buffer.dimension;Wn===1&&(Sr=Gr),Wn===2&&(Sr=Jn),Wn===3&&(Sr=Mi)}en.primType=Sr}function dn(en){lr.elementsCount--,ne(en.buffer!==null,"must not double destroy elements"),delete Ir[en.id],en.buffer.destroy(),en.buffer=null}function Wr(en,Bt){var yr=qe.create(null,bo,!0),Yr=new Nr(yr._buffer);lr.elementsCount++;function wn(Ar){if(!Ar)yr(),Yr.primType=Mi,Yr.vertCount=0,Yr.type=Ti;else if(typeof Ar=="number")yr(Ar),Yr.primType=Mi,Yr.vertCount=Ar|0,Yr.type=Ti;else{var En=null,qr=iu,li=-1,Pr=-1,Sr=0,Wn=0;Array.isArray(Ar)||b(Ar)||pt(Ar)?En=Ar:(ne.type(Ar,"object","invalid arguments for elements"),"data"in Ar&&(En=Ar.data,ne(Array.isArray(En)||b(En)||pt(En),"invalid data for element buffer")),"usage"in Ar&&(ne.parameter(Ar.usage,vo,"invalid element buffer usage"),qr=vo[Ar.usage]),"primitive"in Ar&&(ne.parameter(Ar.primitive,Tr,"invalid element buffer primitive"),li=Tr[Ar.primitive]),"count"in Ar&&(ne(typeof Ar.count=="number"&&Ar.count>=0,"invalid vertex count for elements"),Pr=Ar.count|0),"type"in Ar&&(ne.parameter(Ar.type,Cr,"invalid buffer type"),Wn=Cr[Ar.type]),"length"in Ar?Sr=Ar.length|0:(Sr=Pr,Wn===Fa||Wn===Ui?Sr*=2:(Wn===ds||Wn===ta)&&(Sr*=4))),rn(Yr,En,qr,li,Pr,Sr,Wn)}return wn}return wn(en),wn._reglType="elements",wn._elements=Yr,wn.subdata=function(Ar,En){return yr.subdata(Ar,En),wn},wn.destroy=function(){dn(Yr)},wn}return{create:Wr,createStream:Kr,destroyStream:Jr,getElements:function(en){return typeof en=="function"&&en._elements instanceof Nr?en._elements:null},clear:function(){rr(Ir).forEach(dn)}}}var il=new Float32Array(1),Ys=new Uint32Array(il.buffer),Ks=5123;function $s(X){for(var Oe=tr.allocType(Ks,X.length),qe=0;qe<X.length;++qe)if(isNaN(X[qe]))Oe[qe]=65535;else if(X[qe]===Infinity)Oe[qe]=31744;else if(X[qe]===-Infinity)Oe[qe]=64512;else{il[0]=X[qe];var lr=Ys[0],Ir=lr>>>31<<15,or=(lr<<1>>>24)-127,Cr=lr>>13&(1<<10)-1;if(or<-24)Oe[qe]=Ir;else if(or<-14){var Nr=-14-or;Oe[qe]=Ir+(Cr+(1<<10)>>Nr)}else or>15?Oe[qe]=Ir+31744:Oe[qe]=Ir+(or+15<<10)+Cr}return Oe}function so(X){return Array.isArray(X)||b(X)}var Au=function(X){return!(X&X-1)&&!!X},al=34467,is=3553,Zl=34067,au=34069,zs=6408,cc=6406,Pu=6407,Pa=6409,Hu=6410,jl=32854,Mu=32855,fc=36194,hf=32819,El=32820,hc=33635,Cl=34042,vu=6402,ol=34041,sl=35904,Wu=35906,ul=36193,Xu=33776,Us=33777,pc=33778,dc=33779,kc=35986,Yu=35987,wl=34798,Vl=35840,vc=35841,Gl=35842,Hl=35843,Iu=36196,Ou=5121,Wl=5123,Ha=5125,mu=5126,Xl=10242,ll=10243,Yl=10497,Lu=33071,Kc=33648,cl=10240,to=10241,fl=9728,Ku=9729,ou=9984,ra=9985,za=9986,_s=9987,Kl=33170,yu=4352,$l=4353,$c=4354,Jc=34046,Tl=3317,Al=37440,Ru=37441,Ro=37443,Pl=37444,Zs=33984,So=[ou,za,ra,_s],kn=[0,Pa,Hu,Pu,zs],ho={};ho[Pa]=ho[cc]=ho[vu]=1,ho[ol]=ho[Hu]=2,ho[Pu]=ho[sl]=3,ho[zs]=ho[Wu]=4;function gu(X){return"[object "+X+"]"}var hl=gu("HTMLCanvasElement"),Js=gu("OffscreenCanvas"),As=gu("CanvasRenderingContext2D"),mc=gu("ImageBitmap"),mn=gu("HTMLImageElement"),Jl=gu("HTMLVideoElement"),Ql=Object.keys(Xs).concat([hl,Js,As,mc,mn,Jl]),Du=[];Du[Ou]=1,Du[mu]=4,Du[ul]=2,Du[Wl]=2,Du[Ha]=4;var ja=[];ja[jl]=2,ja[Mu]=2,ja[fc]=2,ja[ol]=4,ja[Xu]=.5,ja[Us]=.5,ja[pc]=1,ja[dc]=1,ja[kc]=.5,ja[Yu]=1,ja[wl]=1,ja[Vl]=.5,ja[vc]=.25,ja[Gl]=.5,ja[Hl]=.25,ja[Iu]=.5;function Ps(X){return Array.isArray(X)&&(X.length===0||typeof X[0]=="number")}function ql(X){if(!Array.isArray(X))return!1;var Oe=X.length;return!(Oe===0||!so(X[0]))}function _u(X){return Object.prototype.toString.call(X)}function Ms(X){return _u(X)===hl}function xu(X){return _u(X)===Js}function Fc(X){return _u(X)===As}function Ml(X){return _u(X)===mc}function yc(X){return _u(X)===mn}function gc(X){return _u(X)===Jl}function Qs(X){var Oe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(Oe&&X&&X.getContext)}function Is(X){if(!X)return!1;if(Qs(X))return!0;var Oe=_u(X);return Ql.indexOf(Oe)>=0?!0:Ps(X)||ql(X)||pt(X)}function na(X){return Xs[Object.prototype.toString.call(X)]|0}function bu(X,Oe){var qe=Oe.length;switch(X.type){case Ou:case Wl:case Ha:case mu:var lr=tr.allocType(X.type,qe);lr.set(Oe),X.data=lr;break;case ul:X.data=$s(Oe);break;default:ne.raise("unsupported texture type, must specify a typed array")}}function qs(X,Oe){return tr.allocType(X.type===ul?mu:X.type,Oe)}function No(X,Oe){X.type===ul?(X.data=$s(Oe),tr.freeType(Oe)):X.data=Oe}function $u(X,Oe,qe,lr,Ir,or){for(var Cr=X.width,Nr=X.height,Hr=X.channels,Kr=Cr*Nr*Hr,Jr=qs(X,Kr),rn=0,dn=0;dn<Nr;++dn)for(var Wr=0;Wr<Cr;++Wr)for(var en=0;en<Hr;++en)Jr[rn++]=Oe[qe*Wr+lr*dn+Ir*en+or];No(X,Jr)}function su(X,Oe,qe,lr,Ir,or){var Cr;if(typeof ja[X]!="undefined"?Cr=ja[X]:Cr=ho[X]*Du[Oe],or&&(Cr*=6),Ir){for(var Nr=0,Hr=qe;Hr>=1;)Nr+=Cr*Hr*Hr,Hr/=2;return Nr}else return Cr*qe*lr}function uu(X,Oe,qe,lr,Ir,or,Cr){var Nr={"don't care":yu,"dont care":yu,nice:$c,fast:$l},Hr={repeat:Yl,clamp:Lu,mirror:Kc},Kr={nearest:fl,linear:Ku},Jr=p({mipmap:_s,"nearest mipmap nearest":ou,"linear mipmap nearest":ra,"nearest mipmap linear":za,"linear mipmap linear":_s},Kr),rn={none:0,browser:Pl},dn={uint8:Ou,rgba4:hf,rgb565:hc,"rgb5 a1":El},Wr={alpha:cc,luminance:Pa,"luminance alpha":Hu,rgb:Pu,rgba:zs,rgba4:jl,"rgb5 a1":Mu,rgb565:fc},en={};Oe.ext_srgb&&(Wr.srgb=sl,Wr.srgba=Wu),Oe.oes_texture_float&&(dn.float32=dn.float=mu),Oe.oes_texture_half_float&&(dn.float16=dn["half float"]=ul),Oe.webgl_depth_texture&&(p(Wr,{depth:vu,"depth stencil":ol}),p(dn,{uint16:Wl,uint32:Ha,"depth stencil":Cl})),Oe.webgl_compressed_texture_s3tc&&p(en,{"rgb s3tc dxt1":Xu,"rgba s3tc dxt1":Us,"rgba s3tc dxt3":pc,"rgba s3tc dxt5":dc}),Oe.webgl_compressed_texture_atc&&p(en,{"rgb atc":kc,"rgba atc explicit alpha":Yu,"rgba atc interpolated alpha":wl}),Oe.webgl_compressed_texture_pvrtc&&p(en,{"rgb pvrtc 4bppv1":Vl,"rgb pvrtc 2bppv1":vc,"rgba pvrtc 4bppv1":Gl,"rgba pvrtc 2bppv1":Hl}),Oe.webgl_compressed_texture_etc1&&(en["rgb etc1"]=Iu);var Bt=Array.prototype.slice.call(X.getParameter(al)||new Uint32Array(0));Object.keys(en).forEach(function(Ye){var dr=en[Ye];Bt.indexOf(dr)>=0&&(Wr[Ye]=dr)});var yr=Object.keys(Wr);qe.textureFormats=yr;var Yr=[];Object.keys(Wr).forEach(function(Ye){var dr=Wr[Ye];Yr[dr]=Ye});var wn=[];Object.keys(dn).forEach(function(Ye){var dr=dn[Ye];wn[dr]=Ye});var Ar=[];Object.keys(Kr).forEach(function(Ye){var dr=Kr[Ye];Ar[dr]=Ye});var En=[];Object.keys(Jr).forEach(function(Ye){var dr=Jr[Ye];En[dr]=Ye});var qr=[];Object.keys(Hr).forEach(function(Ye){var dr=Hr[Ye];qr[dr]=Ye});var li=yr.reduce(function(Ye,dr){var er=Wr[dr];return er===Pa||er===cc||er===Pa||er===Hu||er===vu||er===ol||Oe.ext_srgb&&(er===sl||er===Wu)?Ye[er]=er:er===Mu||dr.indexOf("rgba")>=0?Ye[er]=zs:Ye[er]=Pu,Ye},{});function Pr(){this.internalformat=zs,this.format=zs,this.type=Ou,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Pl,this.width=0,this.height=0,this.channels=0}function Sr(Ye,dr){Ye.internalformat=dr.internalformat,Ye.format=dr.format,Ye.type=dr.type,Ye.compressed=dr.compressed,Ye.premultiplyAlpha=dr.premultiplyAlpha,Ye.flipY=dr.flipY,Ye.unpackAlignment=dr.unpackAlignment,Ye.colorSpace=dr.colorSpace,Ye.width=dr.width,Ye.height=dr.height,Ye.channels=dr.channels}function Wn(Ye,dr){if(!(typeof dr!="object"||!dr)){if("premultiplyAlpha"in dr&&(ne.type(dr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ye.premultiplyAlpha=dr.premultiplyAlpha),"flipY"in dr&&(ne.type(dr.flipY,"boolean","invalid texture flip"),Ye.flipY=dr.flipY),"alignment"in dr&&(ne.oneOf(dr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ye.unpackAlignment=dr.alignment),"colorSpace"in dr&&(ne.parameter(dr.colorSpace,rn,"invalid colorSpace"),Ye.colorSpace=rn[dr.colorSpace]),"type"in dr){var er=dr.type;ne(Oe.oes_texture_float||!(er==="float"||er==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),ne(Oe.oes_texture_half_float||!(er==="half float"||er==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ne(Oe.webgl_depth_texture||!(er==="uint16"||er==="uint32"||er==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ne.parameter(er,dn,"invalid texture type"),Ye.type=dn[er]}var Bn=Ye.width,ca=Ye.height,ze=Ye.channels,Ee=!1;"shape"in dr?(ne(Array.isArray(dr.shape)&&dr.shape.length>=2,"shape must be an array"),Bn=dr.shape[0],ca=dr.shape[1],dr.shape.length===3&&(ze=dr.shape[2],ne(ze>0&&ze<=4,"invalid number of channels"),Ee=!0),ne(Bn>=0&&Bn<=qe.maxTextureSize,"invalid width"),ne(ca>=0&&ca<=qe.maxTextureSize,"invalid height")):("radius"in dr&&(Bn=ca=dr.radius,ne(Bn>=0&&Bn<=qe.maxTextureSize,"invalid radius")),"width"in dr&&(Bn=dr.width,ne(Bn>=0&&Bn<=qe.maxTextureSize,"invalid width")),"height"in dr&&(ca=dr.height,ne(ca>=0&&ca<=qe.maxTextureSize,"invalid height")),"channels"in dr&&(ze=dr.channels,ne(ze>0&&ze<=4,"invalid number of channels"),Ee=!0)),Ye.width=Bn|0,Ye.height=ca|0,Ye.channels=ze|0;var ut=!1;if("format"in dr){var Ot=dr.format;ne(Oe.webgl_depth_texture||!(Ot==="depth"||Ot==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ne.parameter(Ot,Wr,"invalid texture format");var sr=Ye.internalformat=Wr[Ot];Ye.format=li[sr],Ot in dn&&("type"in dr||(Ye.type=dn[Ot])),Ot in en&&(Ye.compressed=!0),ut=!0}!Ee&&ut?Ye.channels=ho[Ye.format]:Ee&&!ut?Ye.channels!==kn[Ye.format]&&(Ye.format=Ye.internalformat=kn[Ye.channels]):ut&&Ee&&ne(Ye.channels===ho[Ye.format],"number of channels inconsistent with specified format")}}function hn(Ye){X.pixelStorei(Al,Ye.flipY),X.pixelStorei(Ru,Ye.premultiplyAlpha),X.pixelStorei(Ro,Ye.colorSpace),X.pixelStorei(Tl,Ye.unpackAlignment)}function $r(){Pr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function yn(Ye,dr){var er=null;if(Is(dr)?er=dr:dr&&(ne.type(dr,"object","invalid pixel data type"),Wn(Ye,dr),"x"in dr&&(Ye.xOffset=dr.x|0),"y"in dr&&(Ye.yOffset=dr.y|0),Is(dr.data)&&(er=dr.data)),ne(!Ye.compressed||er instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),dr.copy){ne(!er,"can not specify copy and data field for the same texture");var Bn=Ir.viewportWidth,ca=Ir.viewportHeight;Ye.width=Ye.width||Bn-Ye.xOffset,Ye.height=Ye.height||ca-Ye.yOffset,Ye.needsCopy=!0,ne(Ye.xOffset>=0&&Ye.xOffset<Bn&&Ye.yOffset>=0&&Ye.yOffset<ca&&Ye.width>0&&Ye.width<=Bn&&Ye.height>0&&Ye.height<=ca,"copy texture read out of bounds")}else if(!er)Ye.width=Ye.width||1,Ye.height=Ye.height||1,Ye.channels=Ye.channels||4;else if(b(er))Ye.channels=Ye.channels||4,Ye.data=er,!("type"in dr)&&Ye.type===Ou&&(Ye.type=na(er));else if(Ps(er))Ye.channels=Ye.channels||4,bu(Ye,er),Ye.alignment=1,Ye.needsFree=!0;else if(pt(er)){var ze=er.data;!Array.isArray(ze)&&Ye.type===Ou&&(Ye.type=na(ze));var Ee=er.shape,ut=er.stride,Ot,sr,yt,dt,lt,De;Ee.length===3?(yt=Ee[2],De=ut[2]):(ne(Ee.length===2,"invalid ndarray pixel data, must be 2 or 3D"),yt=1,De=1),Ot=Ee[0],sr=Ee[1],dt=ut[0],lt=ut[1],Ye.alignment=1,Ye.width=Ot,Ye.height=sr,Ye.channels=yt,Ye.format=Ye.internalformat=kn[yt],Ye.needsFree=!0,$u(Ye,ze,dt,lt,De,er.offset)}else if(Qs(er)||Ms(er)||xu(er)||Fc(er))Qs(er)||Ms(er)||xu(er)?Ye.element=er:Ye.element=er.canvas,Ye.width=Ye.element.width,Ye.height=Ye.element.height,Ye.channels=4;else if(Ml(er))Ye.element=er,Ye.width=er.width,Ye.height=er.height,Ye.channels=4;else if(yc(er))Ye.element=er,Ye.width=er.naturalWidth,Ye.height=er.naturalHeight,Ye.channels=4;else if(gc(er))Ye.element=er,Ye.width=er.videoWidth,Ye.height=er.videoHeight,Ye.channels=4;else if(ql(er)){var it=Ye.width||er[0].length,Ue=Ye.height||er.length,Gt=Ye.channels;so(er[0][0])?Gt=Gt||er[0][0].length:Gt=Gt||1;for(var Xt=Xr.shape(er),Br=1,fn=0;fn<Xt.length;++fn)Br*=Xt[fn];var sn=qs(Ye,Br);Xr.flatten(er,Xt,"",sn),No(Ye,sn),Ye.alignment=1,Ye.width=it,Ye.height=Ue,Ye.channels=Gt,Ye.format=Ye.internalformat=kn[Gt],Ye.needsFree=!0}Ye.type===mu?ne(qe.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ye.type===ul&&ne(qe.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function bn(Ye,dr,er){var Bn=Ye.element,ca=Ye.data,ze=Ye.internalformat,Ee=Ye.format,ut=Ye.type,Ot=Ye.width,sr=Ye.height;hn(Ye),Bn?X.texImage2D(dr,er,Ee,Ee,ut,Bn):Ye.compressed?X.compressedTexImage2D(dr,er,ze,Ot,sr,0,ca):Ye.needsCopy?(lr(),X.copyTexImage2D(dr,er,Ee,Ye.xOffset,Ye.yOffset,Ot,sr,0)):X.texImage2D(dr,er,Ee,Ot,sr,0,Ee,ut,ca||null)}function Ri(Ye,dr,er,Bn,ca){var ze=Ye.element,Ee=Ye.data,ut=Ye.internalformat,Ot=Ye.format,sr=Ye.type,yt=Ye.width,dt=Ye.height;hn(Ye),ze?X.texSubImage2D(dr,ca,er,Bn,Ot,sr,ze):Ye.compressed?X.compressedTexSubImage2D(dr,ca,er,Bn,ut,yt,dt,Ee):Ye.needsCopy?(lr(),X.copyTexSubImage2D(dr,ca,er,Bn,Ye.xOffset,Ye.yOffset,yt,dt)):X.texSubImage2D(dr,ca,er,Bn,yt,dt,Ot,sr,Ee)}var Ii=[];function An(){return Ii.pop()||new $r}function Tn(Ye){Ye.needsFree&&tr.freeType(Ye.data),$r.call(Ye),Ii.push(Ye)}function Ei(){Pr.call(this),this.genMipmaps=!1,this.mipmapHint=yu,this.mipmask=0,this.images=Array(16)}function Bi(Ye,dr,er){var Bn=Ye.images[0]=An();Ye.mipmask=1,Bn.width=Ye.width=dr,Bn.height=Ye.height=er,Bn.channels=Ye.channels=4}function Fi(Ye,dr){var er=null;if(Is(dr))er=Ye.images[0]=An(),Sr(er,Ye),yn(er,dr),Ye.mipmask=1;else if(Wn(Ye,dr),Array.isArray(dr.mipmap))for(var Bn=dr.mipmap,ca=0;ca<Bn.length;++ca)er=Ye.images[ca]=An(),Sr(er,Ye),er.width>>=ca,er.height>>=ca,yn(er,Bn[ca]),Ye.mipmask|=1<<ca;else er=Ye.images[0]=An(),Sr(er,Ye),yn(er,dr),Ye.mipmask=1;Sr(Ye,Ye.images[0]),Ye.compressed&&(Ye.internalformat===Xu||Ye.internalformat===Us||Ye.internalformat===pc||Ye.internalformat===dc)&&ne(Ye.width%4==0&&Ye.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function po(Ye,dr){for(var er=Ye.images,Bn=0;Bn<er.length;++Bn){if(!er[Bn])return;bn(er[Bn],dr,Bn)}}var Co=[];function oa(){var Ye=Co.pop()||new Ei;Pr.call(Ye),Ye.mipmask=0;for(var dr=0;dr<16;++dr)Ye.images[dr]=null;return Ye}function Os(Ye){for(var dr=Ye.images,er=0;er<dr.length;++er)dr[er]&&Tn(dr[er]),dr[er]=null;Co.push(Ye)}function uo(){this.minFilter=fl,this.magFilter=fl,this.wrapS=Lu,this.wrapT=Lu,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=yu}function ys(Ye,dr){if("min"in dr){var er=dr.min;ne.parameter(er,Jr),Ye.minFilter=Jr[er],So.indexOf(Ye.minFilter)>=0&&!("faces"in dr)&&(Ye.genMipmaps=!0)}if("mag"in dr){var Bn=dr.mag;ne.parameter(Bn,Kr),Ye.magFilter=Kr[Bn]}var ca=Ye.wrapS,ze=Ye.wrapT;if("wrap"in dr){var Ee=dr.wrap;typeof Ee=="string"?(ne.parameter(Ee,Hr),ca=ze=Hr[Ee]):Array.isArray(Ee)&&(ne.parameter(Ee[0],Hr),ne.parameter(Ee[1],Hr),ca=Hr[Ee[0]],ze=Hr[Ee[1]])}else{if("wrapS"in dr){var ut=dr.wrapS;ne.parameter(ut,Hr),ca=Hr[ut]}if("wrapT"in dr){var Ot=dr.wrapT;ne.parameter(Ot,Hr),ze=Hr[Ot]}}if(Ye.wrapS=ca,Ye.wrapT=ze,"anisotropic"in dr){var sr=dr.anisotropic;ne(typeof sr=="number"&&sr>=1&&sr<=qe.maxAnisotropic,"aniso samples must be between 1 and "),Ye.anisotropic=dr.anisotropic}if("mipmap"in dr){var yt=!1;switch(typeof dr.mipmap){case"string":ne.parameter(dr.mipmap,Nr,"invalid mipmap hint"),Ye.mipmapHint=Nr[dr.mipmap],Ye.genMipmaps=!0,yt=!0;break;case"boolean":yt=Ye.genMipmaps=dr.mipmap;break;case"object":ne(Array.isArray(dr.mipmap),"invalid mipmap type"),Ye.genMipmaps=!1,yt=!0;break;default:ne.raise("invalid mipmap type")}yt&&!("min"in dr)&&(Ye.minFilter=ou)}}function Uo(Ye,dr){X.texParameteri(dr,to,Ye.minFilter),X.texParameteri(dr,cl,Ye.magFilter),X.texParameteri(dr,Xl,Ye.wrapS),X.texParameteri(dr,ll,Ye.wrapT),Oe.ext_texture_filter_anisotropic&&X.texParameteri(dr,Jc,Ye.anisotropic),Ye.genMipmaps&&(X.hint(Kl,Ye.mipmapHint),X.generateMipmap(dr))}var us=0,Ko={},wo=qe.maxTextureUnits,Zo=Array(wo).map(function(){return null});function Wi(Ye){Pr.call(this),this.mipmask=0,this.internalformat=zs,this.id=us++,this.refCount=1,this.target=Ye,this.texture=X.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new uo,Cr.profile&&(this.stats={size:0})}function $o(Ye){X.activeTexture(Zs),X.bindTexture(Ye.target,Ye.texture)}function Ea(){var Ye=Zo[0];Ye?X.bindTexture(Ye.target,Ye.texture):X.bindTexture(is,null)}function no(Ye){var dr=Ye.texture;ne(dr,"must not double destroy texture");var er=Ye.unit,Bn=Ye.target;er>=0&&(X.activeTexture(Zs+er),X.bindTexture(Bn,null),Zo[er]=null),X.deleteTexture(dr),Ye.texture=null,Ye.params=null,Ye.pixels=null,Ye.refCount=0,delete Ko[Ye.id],or.textureCount--}p(Wi.prototype,{bind:function(){var Ye=this;Ye.bindCount+=1;var dr=Ye.unit;if(dr<0){for(var er=0;er<wo;++er){var Bn=Zo[er];if(Bn){if(Bn.bindCount>0)continue;Bn.unit=-1}Zo[er]=Ye,dr=er;break}dr>=wo&&ne.raise("insufficient number of texture units"),Cr.profile&&or.maxTextureUnits<dr+1&&(or.maxTextureUnits=dr+1),Ye.unit=dr,X.activeTexture(Zs+dr),X.bindTexture(Ye.target,Ye.texture)}return dr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&no(this)}});function di(Ye,dr){var er=new Wi(is);Ko[er.id]=er,or.textureCount++;function Bn(Ee,ut){var Ot=er.texInfo;uo.call(Ot);var sr=oa();return typeof Ee=="number"?typeof ut=="number"?Bi(sr,Ee|0,ut|0):Bi(sr,Ee|0,Ee|0):Ee?(ne.type(Ee,"object","invalid arguments to regl.texture"),ys(Ot,Ee),Fi(sr,Ee)):Bi(sr,1,1),Ot.genMipmaps&&(sr.mipmask=(sr.width<<1)-1),er.mipmask=sr.mipmask,Sr(er,sr),ne.texture2D(Ot,sr,qe),er.internalformat=sr.internalformat,Bn.width=sr.width,Bn.height=sr.height,$o(er),po(sr,is),Uo(Ot,is),Ea(),Os(sr),Cr.profile&&(er.stats.size=su(er.internalformat,er.type,sr.width,sr.height,Ot.genMipmaps,!1)),Bn.format=Yr[er.internalformat],Bn.type=wn[er.type],Bn.mag=Ar[Ot.magFilter],Bn.min=En[Ot.minFilter],Bn.wrapS=qr[Ot.wrapS],Bn.wrapT=qr[Ot.wrapT],Bn}function ca(Ee,ut,Ot,sr){ne(!!Ee,"must specify image data");var yt=ut|0,dt=Ot|0,lt=sr|0,De=An();return Sr(De,er),De.width=0,De.height=0,yn(De,Ee),De.width=De.width||(er.width>>lt)-yt,De.height=De.height||(er.height>>lt)-dt,ne(er.type===De.type&&er.format===De.format&&er.internalformat===De.internalformat,"incompatible format for texture.subimage"),ne(yt>=0&&dt>=0&&yt+De.width<=er.width&&dt+De.height<=er.height,"texture.subimage write out of bounds"),ne(er.mipmask&1<<lt,"missing mipmap data"),ne(De.data||De.element||De.needsCopy,"missing image data"),$o(er),Ri(De,is,yt,dt,lt),Ea(),Tn(De),Bn}function ze(Ee,ut){var Ot=Ee|0,sr=ut|0||Ot;if(Ot===er.width&&sr===er.height)return Bn;Bn.width=er.width=Ot,Bn.height=er.height=sr,$o(er);for(var yt=0;er.mipmask>>yt;++yt){var dt=Ot>>yt,lt=sr>>yt;if(!dt||!lt)break;X.texImage2D(is,yt,er.format,dt,lt,0,er.format,er.type,null)}return Ea(),Cr.profile&&(er.stats.size=su(er.internalformat,er.type,Ot,sr,!1,!1)),Bn}return Bn(Ye,dr),Bn.subimage=ca,Bn.resize=ze,Bn._reglType="texture2d",Bn._texture=er,Cr.profile&&(Bn.stats=er.stats),Bn.destroy=function(){er.decRef()},Bn}function la(Ye,dr,er,Bn,ca,ze){var Ee=new Wi(Zl);Ko[Ee.id]=Ee,or.cubeCount++;var ut=new Array(6);function Ot(dt,lt,De,it,Ue,Gt){var Xt,Br=Ee.texInfo;for(uo.call(Br),Xt=0;Xt<6;++Xt)ut[Xt]=oa();if(typeof dt=="number"||!dt){var fn=dt|0||1;for(Xt=0;Xt<6;++Xt)Bi(ut[Xt],fn,fn)}else if(typeof dt=="object")if(lt)Fi(ut[0],dt),Fi(ut[1],lt),Fi(ut[2],De),Fi(ut[3],it),Fi(ut[4],Ue),Fi(ut[5],Gt);else if(ys(Br,dt),Wn(Ee,dt),"faces"in dt){var sn=dt.faces;for(ne(Array.isArray(sn)&&sn.length===6,"cube faces must be a length 6 array"),Xt=0;Xt<6;++Xt)ne(typeof sn[Xt]=="object"&&!!sn[Xt],"invalid input for cube map face"),Sr(ut[Xt],Ee),Fi(ut[Xt],sn[Xt])}else for(Xt=0;Xt<6;++Xt)Fi(ut[Xt],dt);else ne.raise("invalid arguments to cube map");for(Sr(Ee,ut[0]),ne.optional(function(){qe.npotTextureCube||ne(Au(Ee.width)&&Au(Ee.height),"your browser does not support non power or two texture dimensions")}),Br.genMipmaps?Ee.mipmask=(ut[0].width<<1)-1:Ee.mipmask=ut[0].mipmask,ne.textureCube(Ee,Br,ut,qe),Ee.internalformat=ut[0].internalformat,Ot.width=ut[0].width,Ot.height=ut[0].height,$o(Ee),Xt=0;Xt<6;++Xt)po(ut[Xt],au+Xt);for(Uo(Br,Zl),Ea(),Cr.profile&&(Ee.stats.size=su(Ee.internalformat,Ee.type,Ot.width,Ot.height,Br.genMipmaps,!0)),Ot.format=Yr[Ee.internalformat],Ot.type=wn[Ee.type],Ot.mag=Ar[Br.magFilter],Ot.min=En[Br.minFilter],Ot.wrapS=qr[Br.wrapS],Ot.wrapT=qr[Br.wrapT],Xt=0;Xt<6;++Xt)Os(ut[Xt]);return Ot}function sr(dt,lt,De,it,Ue){ne(!!lt,"must specify image data"),ne(typeof dt=="number"&&dt===(dt|0)&&dt>=0&&dt<6,"invalid face");var Gt=De|0,Xt=it|0,Br=Ue|0,fn=An();return Sr(fn,Ee),fn.width=0,fn.height=0,yn(fn,lt),fn.width=fn.width||(Ee.width>>Br)-Gt,fn.height=fn.height||(Ee.height>>Br)-Xt,ne(Ee.type===fn.type&&Ee.format===fn.format&&Ee.internalformat===fn.internalformat,"incompatible format for texture.subimage"),ne(Gt>=0&&Xt>=0&&Gt+fn.width<=Ee.width&&Xt+fn.height<=Ee.height,"texture.subimage write out of bounds"),ne(Ee.mipmask&1<<Br,"missing mipmap data"),ne(fn.data||fn.element||fn.needsCopy,"missing image data"),$o(Ee),Ri(fn,au+dt,Gt,Xt,Br),Ea(),Tn(fn),Ot}function yt(dt){var lt=dt|0;if(lt!==Ee.width){Ot.width=Ee.width=lt,Ot.height=Ee.height=lt,$o(Ee);for(var De=0;De<6;++De)for(var it=0;Ee.mipmask>>it;++it)X.texImage2D(au+De,it,Ee.format,lt>>it,lt>>it,0,Ee.format,Ee.type,null);return Ea(),Cr.profile&&(Ee.stats.size=su(Ee.internalformat,Ee.type,Ot.width,Ot.height,!1,!0)),Ot}}return Ot(Ye,dr,er,Bn,ca,ze),Ot.subimage=sr,Ot.resize=yt,Ot._reglType="textureCube",Ot._texture=Ee,Cr.profile&&(Ot.stats=Ee.stats),Ot.destroy=function(){Ee.decRef()},Ot}function Wa(){for(var Ye=0;Ye<wo;++Ye)X.activeTexture(Zs+Ye),X.bindTexture(is,null),Zo[Ye]=null;rr(Ko).forEach(no),or.cubeCount=0,or.textureCount=0}Cr.profile&&(or.getTotalTextureSize=function(){var Ye=0;return Object.keys(Ko).forEach(function(dr){Ye+=Ko[dr].stats.size}),Ye});function lo(){for(var Ye=0;Ye<wo;++Ye){var dr=Zo[Ye];dr&&(dr.bindCount=0,dr.unit=-1,Zo[Ye]=null)}rr(Ko).forEach(function(er){er.texture=X.createTexture(),X.bindTexture(er.target,er.texture);for(var Bn=0;Bn<32;++Bn)if((er.mipmask&1<<Bn)!=0)if(er.target===is)X.texImage2D(is,Bn,er.internalformat,er.width>>Bn,er.height>>Bn,0,er.internalformat,er.type,null);else for(var ca=0;ca<6;++ca)X.texImage2D(au+ca,Bn,er.internalformat,er.width>>Bn,er.height>>Bn,0,er.internalformat,er.type,null);Uo(er.texInfo,er.target)})}function tl(){for(var Ye=0;Ye<wo;++Ye){var dr=Zo[Ye];dr&&(dr.bindCount=0,dr.unit=-1,Zo[Ye]=null),X.activeTexture(Zs+Ye),X.bindTexture(is,null),X.bindTexture(Zl,null)}}return{create2D:di,createCube:la,clear:Wa,getTexture:function(Ye){return null},restore:lo,refresh:tl}}var Eo=36161,ku=32854,ni=32855,Hn=36194,Il=33189,as=36168,js=34041,Wo=35907,lu=34836,_c=34842,ec=34843,Qi=[];Qi[ku]=2,Qi[ni]=2,Qi[Hn]=2,Qi[Il]=2,Qi[as]=1,Qi[js]=4,Qi[Wo]=4,Qi[lu]=16,Qi[_c]=8,Qi[ec]=6;function Do(X,Oe,qe){return Qi[X]*Oe*qe}var Bc=function(X,Oe,qe,lr,Ir){var or={rgba4:ku,rgb565:Hn,"rgb5 a1":ni,depth:Il,stencil:as,"depth stencil":js};Oe.ext_srgb&&(or.srgba=Wo),Oe.ext_color_buffer_half_float&&(or.rgba16f=_c,or.rgb16f=ec),Oe.webgl_color_buffer_float&&(or.rgba32f=lu);var Cr=[];Object.keys(or).forEach(function(Wr){var en=or[Wr];Cr[en]=Wr});var Nr=0,Hr={};function Kr(Wr){this.id=Nr++,this.refCount=1,this.renderbuffer=Wr,this.format=ku,this.width=0,this.height=0,Ir.profile&&(this.stats={size:0})}Kr.prototype.decRef=function(){--this.refCount<=0&&Jr(this)};function Jr(Wr){var en=Wr.renderbuffer;ne(en,"must not double destroy renderbuffer"),X.bindRenderbuffer(Eo,null),X.deleteRenderbuffer(en),Wr.renderbuffer=null,Wr.refCount=0,delete Hr[Wr.id],lr.renderbufferCount--}function rn(Wr,en){var Bt=new Kr(X.createRenderbuffer());Hr[Bt.id]=Bt,lr.renderbufferCount++;function yr(wn,Ar){var En=0,qr=0,li=ku;if(typeof wn=="object"&&wn){var Pr=wn;if("shape"in Pr){var Sr=Pr.shape;ne(Array.isArray(Sr)&&Sr.length>=2,"invalid renderbuffer shape"),En=Sr[0]|0,qr=Sr[1]|0}else"radius"in Pr&&(En=qr=Pr.radius|0),"width"in Pr&&(En=Pr.width|0),"height"in Pr&&(qr=Pr.height|0);"format"in Pr&&(ne.parameter(Pr.format,or,"invalid renderbuffer format"),li=or[Pr.format])}else typeof wn=="number"?(En=wn|0,typeof Ar=="number"?qr=Ar|0:qr=En):wn?ne.raise("invalid arguments to renderbuffer constructor"):En=qr=1;if(ne(En>0&&qr>0&&En<=qe.maxRenderbufferSize&&qr<=qe.maxRenderbufferSize,"invalid renderbuffer size"),!(En===Bt.width&&qr===Bt.height&&li===Bt.format))return yr.width=Bt.width=En,yr.height=Bt.height=qr,Bt.format=li,X.bindRenderbuffer(Eo,Bt.renderbuffer),X.renderbufferStorage(Eo,li,En,qr),ne(X.getError()===0,"invalid render buffer format"),Ir.profile&&(Bt.stats.size=Do(Bt.format,Bt.width,Bt.height)),yr.format=Cr[Bt.format],yr}function Yr(wn,Ar){var En=wn|0,qr=Ar|0||En;return En===Bt.width&&qr===Bt.height||(ne(En>0&&qr>0&&En<=qe.maxRenderbufferSize&&qr<=qe.maxRenderbufferSize,"invalid renderbuffer size"),yr.width=Bt.width=En,yr.height=Bt.height=qr,X.bindRenderbuffer(Eo,Bt.renderbuffer),X.renderbufferStorage(Eo,Bt.format,En,qr),ne(X.getError()===0,"invalid render buffer format"),Ir.profile&&(Bt.stats.size=Do(Bt.format,Bt.width,Bt.height))),yr}return yr(Wr,en),yr.resize=Yr,yr._reglType="renderbuffer",yr._renderbuffer=Bt,Ir.profile&&(yr.stats=Bt.stats),yr.destroy=function(){Bt.decRef()},yr}Ir.profile&&(lr.getTotalRenderbufferSize=function(){var Wr=0;return Object.keys(Hr).forEach(function(en){Wr+=Hr[en].stats.size}),Wr});function dn(){rr(Hr).forEach(function(Wr){Wr.renderbuffer=X.createRenderbuffer(),X.bindRenderbuffer(Eo,Wr.renderbuffer),X.renderbufferStorage(Eo,Wr.format,Wr.width,Wr.height)}),X.bindRenderbuffer(Eo,null)}return{create:rn,clear:function(){rr(Hr).forEach(Jr)},restore:dn}},xs=36160,Ol=36161,bs=3553,vs=34069,pl=36064,cu=36096,tc=36128,Ju=33306,dl=36053,Nc=36054,Ll=36055,vl=36057,xc=36061,Qu=36193,Fu=5121,rc=5126,Bu=6407,Vs=6408,bc=6402,Nu=[Bu,Vs],nc=[];nc[Vs]=4,nc[Bu]=3;var qu=[];qu[Fu]=1,qu[rc]=4,qu[Qu]=2;var n=32854,u=32855,a=36194,h=33189,_=36168,C=34041,P=35907,N=34836,K=34842,oe=34843,Ce=[n,u,a,P,K,oe,N],we={};we[dl]="complete",we[Nc]="incomplete attachment",we[vl]="incomplete dimensions",we[Ll]="incomplete, missing attachment",we[xc]="unsupported";function Ie(X,Oe,qe,lr,Ir,or){var Cr={cur:null,next:null,dirty:!1,setFBO:null},Nr=["rgba"],Hr=["rgba4","rgb565","rgb5 a1"];Oe.ext_srgb&&Hr.push("srgba"),Oe.ext_color_buffer_half_float&&Hr.push("rgba16f","rgb16f"),Oe.webgl_color_buffer_float&&Hr.push("rgba32f");var Kr=["uint8"];Oe.oes_texture_half_float&&Kr.push("half float","float16"),Oe.oes_texture_float&&Kr.push("float","float32");function Jr($r,yn,bn){this.target=$r,this.texture=yn,this.renderbuffer=bn;var Ri=0,Ii=0;yn?(Ri=yn.width,Ii=yn.height):bn&&(Ri=bn.width,Ii=bn.height),this.width=Ri,this.height=Ii}function rn($r){$r&&($r.texture&&$r.texture._texture.decRef(),$r.renderbuffer&&$r.renderbuffer._renderbuffer.decRef())}function dn($r,yn,bn){if(!!$r)if($r.texture){var Ri=$r.texture._texture,Ii=Math.max(1,Ri.width),An=Math.max(1,Ri.height);ne(Ii===yn&&An===bn,"inconsistent width/height for supplied texture"),Ri.refCount+=1}else{var Tn=$r.renderbuffer._renderbuffer;ne(Tn.width===yn&&Tn.height===bn,"inconsistent width/height for renderbuffer"),Tn.refCount+=1}}function Wr($r,yn){yn&&(yn.texture?X.framebufferTexture2D(xs,$r,yn.target,yn.texture._texture.texture,0):X.framebufferRenderbuffer(xs,$r,Ol,yn.renderbuffer._renderbuffer.renderbuffer))}function en($r){var yn=bs,bn=null,Ri=null,Ii=$r;typeof $r=="object"&&(Ii=$r.data,"target"in $r&&(yn=$r.target|0)),ne.type(Ii,"function","invalid attachment data");var An=Ii._reglType;return An==="texture2d"?(bn=Ii,ne(yn===bs)):An==="textureCube"?(bn=Ii,ne(yn>=vs&&yn<vs+6,"invalid cube map target")):An==="renderbuffer"?(Ri=Ii,yn=Ol):ne.raise("invalid regl object for attachment"),new Jr(yn,bn,Ri)}function Bt($r,yn,bn,Ri,Ii){if(bn){var An=lr.create2D({width:$r,height:yn,format:Ri,type:Ii});return An._texture.refCount=0,new Jr(bs,An,null)}else{var Tn=Ir.create({width:$r,height:yn,format:Ri});return Tn._renderbuffer.refCount=0,new Jr(Ol,null,Tn)}}function yr($r){return $r&&($r.texture||$r.renderbuffer)}function Yr($r,yn,bn){$r&&($r.texture?$r.texture.resize(yn,bn):$r.renderbuffer&&$r.renderbuffer.resize(yn,bn),$r.width=yn,$r.height=bn)}var wn=0,Ar={};function En(){this.id=wn++,Ar[this.id]=this,this.framebuffer=X.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function qr($r){$r.colorAttachments.forEach(rn),rn($r.depthAttachment),rn($r.stencilAttachment),rn($r.depthStencilAttachment)}function li($r){var yn=$r.framebuffer;ne(yn,"must not double destroy framebuffer"),X.deleteFramebuffer(yn),$r.framebuffer=null,or.framebufferCount--,delete Ar[$r.id]}function Pr($r){var yn;X.bindFramebuffer(xs,$r.framebuffer);var bn=$r.colorAttachments;for(yn=0;yn<bn.length;++yn)Wr(pl+yn,bn[yn]);for(yn=bn.length;yn<qe.maxColorAttachments;++yn)X.framebufferTexture2D(xs,pl+yn,bs,null,0);X.framebufferTexture2D(xs,Ju,bs,null,0),X.framebufferTexture2D(xs,cu,bs,null,0),X.framebufferTexture2D(xs,tc,bs,null,0),Wr(cu,$r.depthAttachment),Wr(tc,$r.stencilAttachment),Wr(Ju,$r.depthStencilAttachment);var Ri=X.checkFramebufferStatus(xs);!X.isContextLost()&&Ri!==dl&&ne.raise("framebuffer configuration not supported, status = "+we[Ri]),X.bindFramebuffer(xs,Cr.next?Cr.next.framebuffer:null),Cr.cur=Cr.next,X.getError()}function Sr($r,yn){var bn=new En;or.framebufferCount++;function Ri(An,Tn){var Ei;ne(Cr.next!==bn,"can not update framebuffer which is currently in use");var Bi=0,Fi=0,po=!0,Co=!0,oa=null,Os=!0,uo="rgba",ys="uint8",Uo=1,us=null,Ko=null,wo=null,Zo=!1;if(typeof An=="number")Bi=An|0,Fi=Tn|0||Bi;else if(!An)Bi=Fi=1;else{ne.type(An,"object","invalid arguments for framebuffer");var Wi=An;if("shape"in Wi){var $o=Wi.shape;ne(Array.isArray($o)&&$o.length>=2,"invalid shape for framebuffer"),Bi=$o[0],Fi=$o[1]}else"radius"in Wi&&(Bi=Fi=Wi.radius),"width"in Wi&&(Bi=Wi.width),"height"in Wi&&(Fi=Wi.height);("color"in Wi||"colors"in Wi)&&(oa=Wi.color||Wi.colors,Array.isArray(oa)&&ne(oa.length===1||Oe.webgl_draw_buffers,"multiple render targets not supported")),oa||("colorCount"in Wi&&(Uo=Wi.colorCount|0,ne(Uo>0,"invalid color buffer count")),"colorTexture"in Wi&&(Os=!!Wi.colorTexture,uo="rgba4"),"colorType"in Wi&&(ys=Wi.colorType,Os?(ne(Oe.oes_texture_float||!(ys==="float"||ys==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ne(Oe.oes_texture_half_float||!(ys==="half float"||ys==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ys==="half float"||ys==="float16"?(ne(Oe.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),uo="rgba16f"):(ys==="float"||ys==="float32")&&(ne(Oe.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),uo="rgba32f"),ne.oneOf(ys,Kr,"invalid color type")),"colorFormat"in Wi&&(uo=Wi.colorFormat,Nr.indexOf(uo)>=0?Os=!0:Hr.indexOf(uo)>=0?Os=!1:ne.optional(function(){Os?ne.oneOf(Wi.colorFormat,Nr,"invalid color format for texture"):ne.oneOf(Wi.colorFormat,Hr,"invalid color format for renderbuffer")}))),("depthTexture"in Wi||"depthStencilTexture"in Wi)&&(Zo=!!(Wi.depthTexture||Wi.depthStencilTexture),ne(!Zo||Oe.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Wi&&(typeof Wi.depth=="boolean"?po=Wi.depth:(us=Wi.depth,Co=!1)),"stencil"in Wi&&(typeof Wi.stencil=="boolean"?Co=Wi.stencil:(Ko=Wi.stencil,po=!1)),"depthStencil"in Wi&&(typeof Wi.depthStencil=="boolean"?po=Co=Wi.depthStencil:(wo=Wi.depthStencil,po=!1,Co=!1))}var Ea=null,no=null,di=null,la=null;if(Array.isArray(oa))Ea=oa.map(en);else if(oa)Ea=[en(oa)];else for(Ea=new Array(Uo),Ei=0;Ei<Uo;++Ei)Ea[Ei]=Bt(Bi,Fi,Os,uo,ys);ne(Oe.webgl_draw_buffers||Ea.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ne(Ea.length<=qe.maxColorAttachments,"too many color attachments, not supported"),Bi=Bi||Ea[0].width,Fi=Fi||Ea[0].height,us?no=en(us):po&&!Co&&(no=Bt(Bi,Fi,Zo,"depth","uint32")),Ko?di=en(Ko):Co&&!po&&(di=Bt(Bi,Fi,!1,"stencil","uint8")),wo?la=en(wo):!us&&!Ko&&Co&&po&&(la=Bt(Bi,Fi,Zo,"depth stencil","depth stencil")),ne(!!us+!!Ko+!!wo<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Wa=null;for(Ei=0;Ei<Ea.length;++Ei)if(dn(Ea[Ei],Bi,Fi),ne(!Ea[Ei]||Ea[Ei].texture&&Nu.indexOf(Ea[Ei].texture._texture.format)>=0||Ea[Ei].renderbuffer&&Ce.indexOf(Ea[Ei].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ei+" is invalid"),Ea[Ei]&&Ea[Ei].texture){var lo=nc[Ea[Ei].texture._texture.format]*qu[Ea[Ei].texture._texture.type];Wa===null?Wa=lo:ne(Wa===lo,"all color attachments much have the same number of bits per pixel.")}return dn(no,Bi,Fi),ne(!no||no.texture&&no.texture._texture.format===bc||no.renderbuffer&&no.renderbuffer._renderbuffer.format===h,"invalid depth attachment for framebuffer object"),dn(di,Bi,Fi),ne(!di||di.renderbuffer&&di.renderbuffer._renderbuffer.format===_,"invalid stencil attachment for framebuffer object"),dn(la,Bi,Fi),ne(!la||la.texture&&la.texture._texture.format===C||la.renderbuffer&&la.renderbuffer._renderbuffer.format===C,"invalid depth-stencil attachment for framebuffer object"),qr(bn),bn.width=Bi,bn.height=Fi,bn.colorAttachments=Ea,bn.depthAttachment=no,bn.stencilAttachment=di,bn.depthStencilAttachment=la,Ri.color=Ea.map(yr),Ri.depth=yr(no),Ri.stencil=yr(di),Ri.depthStencil=yr(la),Ri.width=bn.width,Ri.height=bn.height,Pr(bn),Ri}function Ii(An,Tn){ne(Cr.next!==bn,"can not resize a framebuffer which is currently in use");var Ei=Math.max(An|0,1),Bi=Math.max(Tn|0||Ei,1);if(Ei===bn.width&&Bi===bn.height)return Ri;for(var Fi=bn.colorAttachments,po=0;po<Fi.length;++po)Yr(Fi[po],Ei,Bi);return Yr(bn.depthAttachment,Ei,Bi),Yr(bn.stencilAttachment,Ei,Bi),Yr(bn.depthStencilAttachment,Ei,Bi),bn.width=Ri.width=Ei,bn.height=Ri.height=Bi,Pr(bn),Ri}return Ri($r,yn),p(Ri,{resize:Ii,_reglType:"framebuffer",_framebuffer:bn,destroy:function(){li(bn),qr(bn)},use:function(An){Cr.setFBO({framebuffer:Ri},An)}})}function Wn($r){var yn=Array(6);function bn(Ii){var An;ne(yn.indexOf(Cr.next)<0,"can not update framebuffer which is currently in use");var Tn={color:null},Ei=0,Bi=null,Fi="rgba",po="uint8",Co=1;if(typeof Ii=="number")Ei=Ii|0;else if(!Ii)Ei=1;else{ne.type(Ii,"object","invalid arguments for framebuffer");var oa=Ii;if("shape"in oa){var Os=oa.shape;ne(Array.isArray(Os)&&Os.length>=2,"invalid shape for framebuffer"),ne(Os[0]===Os[1],"cube framebuffer must be square"),Ei=Os[0]}else"radius"in oa&&(Ei=oa.radius|0),"width"in oa?(Ei=oa.width|0,"height"in oa&&ne(oa.height===Ei,"must be square")):"height"in oa&&(Ei=oa.height|0);("color"in oa||"colors"in oa)&&(Bi=oa.color||oa.colors,Array.isArray(Bi)&&ne(Bi.length===1||Oe.webgl_draw_buffers,"multiple render targets not supported")),Bi||("colorCount"in oa&&(Co=oa.colorCount|0,ne(Co>0,"invalid color buffer count")),"colorType"in oa&&(ne.oneOf(oa.colorType,Kr,"invalid color type"),po=oa.colorType),"colorFormat"in oa&&(Fi=oa.colorFormat,ne.oneOf(oa.colorFormat,Nr,"invalid color format for texture"))),"depth"in oa&&(Tn.depth=oa.depth),"stencil"in oa&&(Tn.stencil=oa.stencil),"depthStencil"in oa&&(Tn.depthStencil=oa.depthStencil)}var uo;if(Bi)if(Array.isArray(Bi))for(uo=[],An=0;An<Bi.length;++An)uo[An]=Bi[An];else uo=[Bi];else{uo=Array(Co);var ys={radius:Ei,format:Fi,type:po};for(An=0;An<Co;++An)uo[An]=lr.createCube(ys)}for(Tn.color=Array(uo.length),An=0;An<uo.length;++An){var Uo=uo[An];ne(typeof Uo=="function"&&Uo._reglType==="textureCube","invalid cube map"),Ei=Ei||Uo.width,ne(Uo.width===Ei&&Uo.height===Ei,"invalid cube map shape"),Tn.color[An]={target:vs,data:uo[An]}}for(An=0;An<6;++An){for(var us=0;us<uo.length;++us)Tn.color[us].target=vs+An;An>0&&(Tn.depth=yn[0].depth,Tn.stencil=yn[0].stencil,Tn.depthStencil=yn[0].depthStencil),yn[An]?yn[An](Tn):yn[An]=Sr(Tn)}return p(bn,{width:Ei,height:Ei,color:uo})}function Ri(Ii){var An,Tn=Ii|0;if(ne(Tn>0&&Tn<=qe.maxCubeMapSize,"invalid radius for cube fbo"),Tn===bn.width)return bn;var Ei=bn.color;for(An=0;An<Ei.length;++An)Ei[An].resize(Tn);for(An=0;An<6;++An)yn[An].resize(Tn);return bn.width=bn.height=Tn,bn}return bn($r),p(bn,{faces:yn,resize:Ri,_reglType:"framebufferCube",destroy:function(){yn.forEach(function(Ii){Ii.destroy()})}})}function hn(){Cr.cur=null,Cr.next=null,Cr.dirty=!0,rr(Ar).forEach(function($r){$r.framebuffer=X.createFramebuffer(),Pr($r)})}return p(Cr,{getFramebuffer:function($r){if(typeof $r=="function"&&$r._reglType==="framebuffer"){var yn=$r._framebuffer;if(yn instanceof En)return yn}return null},create:Sr,createCube:Wn,clear:function(){rr(Ar).forEach(li)},restore:hn})}var Ke=5126,We=34962,ot=34963,je=["attributes","elements","offset","count","primitive","instances"];function st(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ke,this.offset=0,this.stride=0,this.divisor=0}function wt(X,Oe,qe,lr,Ir,or,Cr){for(var Nr=qe.maxAttributes,Hr=new Array(Nr),Kr=0;Kr<Nr;++Kr)Hr[Kr]=new st;var Jr=0,rn={},dn={Record:st,scope:{},state:Hr,currentVAO:null,targetVAO:null,restore:en()?qr:function(){},createVAO:li,getVAO:yr,destroyBuffer:Wr,setVAO:en()?Yr:wn,clear:en()?Ar:function(){}};function Wr(Pr){for(var Sr=0;Sr<Hr.length;++Sr){var Wn=Hr[Sr];Wn.buffer===Pr&&(X.disableVertexAttribArray(Sr),Wn.buffer=null)}}function en(){return Oe.oes_vertex_array_object}function Bt(){return Oe.angle_instanced_arrays}function yr(Pr){return typeof Pr=="function"&&Pr._vao?Pr._vao:null}function Yr(Pr){if(Pr!==dn.currentVAO){var Sr=en();Pr?Sr.bindVertexArrayOES(Pr.vao):Sr.bindVertexArrayOES(null),dn.currentVAO=Pr}}function wn(Pr){if(Pr!==dn.currentVAO){if(Pr)Pr.bindAttrs();else{for(var Sr=Bt(),Wn=0;Wn<Hr.length;++Wn){var hn=Hr[Wn];hn.buffer?(X.enableVertexAttribArray(Wn),hn.buffer.bind(),X.vertexAttribPointer(Wn,hn.size,hn.type,hn.normalized,hn.stride,hn.offfset),Sr&&hn.divisor&&Sr.vertexAttribDivisorANGLE(Wn,hn.divisor)):(X.disableVertexAttribArray(Wn),X.vertexAttrib4f(Wn,hn.x,hn.y,hn.z,hn.w))}Cr.elements?X.bindBuffer(ot,Cr.elements.buffer.buffer):X.bindBuffer(ot,null)}dn.currentVAO=Pr}}function Ar(){rr(rn).forEach(function(Pr){Pr.destroy()})}function En(){this.id=++Jr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Pr=en();Pr?this.vao=Pr.createVertexArrayOES():this.vao=null,rn[this.id]=this,this.buffers=[]}En.prototype.bindAttrs=function(){for(var Pr=Bt(),Sr=this.attributes,Wn=0;Wn<Sr.length;++Wn){var hn=Sr[Wn];hn.buffer?(X.enableVertexAttribArray(Wn),X.bindBuffer(We,hn.buffer.buffer),X.vertexAttribPointer(Wn,hn.size,hn.type,hn.normalized,hn.stride,hn.offset),Pr&&hn.divisor&&Pr.vertexAttribDivisorANGLE(Wn,hn.divisor)):(X.disableVertexAttribArray(Wn),X.vertexAttrib4f(Wn,hn.x,hn.y,hn.z,hn.w))}for(var $r=Sr.length;$r<Nr;++$r)X.disableVertexAttribArray($r);var yn=or.getElements(this.elements);yn?X.bindBuffer(ot,yn.buffer.buffer):X.bindBuffer(ot,null)},En.prototype.refresh=function(){var Pr=en();Pr&&(Pr.bindVertexArrayOES(this.vao),this.bindAttrs(),dn.currentVAO=null,Pr.bindVertexArrayOES(null))},En.prototype.destroy=function(){if(this.vao){var Pr=en();this===dn.currentVAO&&(dn.currentVAO=null,Pr.bindVertexArrayOES(null)),Pr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),rn[this.id]&&(delete rn[this.id],lr.vaoCount-=1)};function qr(){var Pr=en();Pr&&rr(rn).forEach(function(Sr){Sr.refresh()})}function li(Pr){var Sr=new En;lr.vaoCount+=1;function Wn(hn){var $r;if(Array.isArray(hn))$r=hn,Sr.elements&&Sr.ownsElements&&Sr.elements.destroy(),Sr.elements=null,Sr.ownsElements=!1,Sr.offset=0,Sr.count=0,Sr.instances=-1,Sr.primitive=4;else{if(ne(typeof hn=="object","invalid arguments for create vao"),ne("attributes"in hn,"must specify attributes for vao"),hn.elements){var yn=hn.elements;Sr.ownsElements?typeof yn=="function"&&yn._reglType==="elements"?(Sr.elements.destroy(),Sr.ownsElements=!1):(Sr.elements(yn),Sr.ownsElements=!1):or.getElements(hn.elements)?(Sr.elements=hn.elements,Sr.ownsElements=!1):(Sr.elements=or.create(hn.elements),Sr.ownsElements=!0)}else Sr.elements=null,Sr.ownsElements=!1;$r=hn.attributes,Sr.offset=0,Sr.count=-1,Sr.instances=-1,Sr.primitive=4,Sr.elements&&(Sr.count=Sr.elements._elements.vertCount,Sr.primitive=Sr.elements._elements.primType),"offset"in hn&&(Sr.offset=hn.offset|0),"count"in hn&&(Sr.count=hn.count|0),"instances"in hn&&(Sr.instances=hn.instances|0),"primitive"in hn&&(ne(hn.primitive in Tr,"bad primitive type: "+hn.primitive),Sr.primitive=Tr[hn.primitive]),ne.optional(()=>{for(var po=Object.keys(hn),Co=0;Co<po.length;++Co)ne(je.indexOf(po[Co])>=0,'invalid option for vao: "'+po[Co]+'" valid options are '+je)}),ne(Array.isArray($r),"attributes must be an array")}ne($r.length<Nr,"too many attributes"),ne($r.length>0,"must specify at least one attribute");var bn={},Ri=Sr.attributes;Ri.length=$r.length;for(var Ii=0;Ii<$r.length;++Ii){var An=$r[Ii],Tn=Ri[Ii]=new st,Ei=An.data||An;if(Array.isArray(Ei)||b(Ei)||pt(Ei)){var Bi;Sr.buffers[Ii]&&(Bi=Sr.buffers[Ii],b(Ei)&&Bi._buffer.byteLength>=Ei.byteLength?Bi.subdata(Ei):(Bi.destroy(),Sr.buffers[Ii]=null)),Sr.buffers[Ii]||(Bi=Sr.buffers[Ii]=Ir.create(An,We,!1,!0)),Tn.buffer=Ir.getBuffer(Bi),Tn.size=Tn.buffer.dimension|0,Tn.normalized=!1,Tn.type=Tn.buffer.dtype,Tn.offset=0,Tn.stride=0,Tn.divisor=0,Tn.state=1,bn[Ii]=1}else Ir.getBuffer(An)?(Tn.buffer=Ir.getBuffer(An),Tn.size=Tn.buffer.dimension|0,Tn.normalized=!1,Tn.type=Tn.buffer.dtype,Tn.offset=0,Tn.stride=0,Tn.divisor=0,Tn.state=1):Ir.getBuffer(An.buffer)?(Tn.buffer=Ir.getBuffer(An.buffer),Tn.size=(+An.size||Tn.buffer.dimension)|0,Tn.normalized=!!An.normalized||!1,"type"in An?(ne.parameter(An.type,ns,"invalid buffer type"),Tn.type=ns[An.type]):Tn.type=Tn.buffer.dtype,Tn.offset=(An.offset||0)|0,Tn.stride=(An.stride||0)|0,Tn.divisor=(An.divisor||0)|0,Tn.state=1,ne(Tn.size>=1&&Tn.size<=4,"size must be between 1 and 4"),ne(Tn.offset>=0,"invalid offset"),ne(Tn.stride>=0&&Tn.stride<=255,"stride must be between 0 and 255"),ne(Tn.divisor>=0,"divisor must be positive"),ne(!Tn.divisor||!!Oe.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in An?(ne(Ii>0,"first attribute must not be a constant"),Tn.x=+An.x||0,Tn.y=+An.y||0,Tn.z=+An.z||0,Tn.w=+An.w||0,Tn.state=2):ne(!1,"invalid attribute spec for location "+Ii)}for(var Fi=0;Fi<Sr.buffers.length;++Fi)!bn[Fi]&&Sr.buffers[Fi]&&(Sr.buffers[Fi].destroy(),Sr.buffers[Fi]=null);return Sr.refresh(),Wn}return Wn.destroy=function(){for(var hn=0;hn<Sr.buffers.length;++hn)Sr.buffers[hn]&&Sr.buffers[hn].destroy();Sr.buffers.length=0,Sr.ownsElements&&(Sr.elements.destroy(),Sr.elements=null,Sr.ownsElements=!1),Sr.destroy()},Wn._vao=Sr,Wn._reglType="vao",Wn(Pr)}return dn}var Wt=35632,gr=35633,cr=35718,xr=35721;function zr(X,Oe,qe,lr){var Ir={},or={};function Cr(Bt,yr,Yr,wn){this.name=Bt,this.id=yr,this.location=Yr,this.info=wn}function Nr(Bt,yr){for(var Yr=0;Yr<Bt.length;++Yr)if(Bt[Yr].id===yr.id){Bt[Yr].location=yr.location;return}Bt.push(yr)}function Hr(Bt,yr,Yr){var wn=Bt===Wt?Ir:or,Ar=wn[yr];if(!Ar){var En=Oe.str(yr);Ar=X.createShader(Bt),X.shaderSource(Ar,En),X.compileShader(Ar),ne.shaderError(X,Ar,En,Bt,Yr),wn[yr]=Ar}return Ar}var Kr={},Jr=[],rn=0;function dn(Bt,yr){this.id=rn++,this.fragId=Bt,this.vertId=yr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,lr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Wr(Bt,yr,Yr){var wn,Ar,En=Hr(Wt,Bt.fragId),qr=Hr(gr,Bt.vertId),li=Bt.program=X.createProgram();if(X.attachShader(li,En),X.attachShader(li,qr),Yr)for(wn=0;wn<Yr.length;++wn){var Pr=Yr[wn];X.bindAttribLocation(li,Pr[0],Pr[1])}X.linkProgram(li),ne.linkError(X,li,Oe.str(Bt.fragId),Oe.str(Bt.vertId),yr);var Sr=X.getProgramParameter(li,cr);lr.profile&&(Bt.stats.uniformsCount=Sr);var Wn=Bt.uniforms;for(wn=0;wn<Sr;++wn)if(Ar=X.getActiveUniform(li,wn),Ar)if(Ar.size>1)for(var hn=0;hn<Ar.size;++hn){var $r=Ar.name.replace("[0]","["+hn+"]");Nr(Wn,new Cr($r,Oe.id($r),X.getUniformLocation(li,$r),Ar))}else Nr(Wn,new Cr(Ar.name,Oe.id(Ar.name),X.getUniformLocation(li,Ar.name),Ar));var yn=X.getProgramParameter(li,xr);lr.profile&&(Bt.stats.attributesCount=yn);var bn=Bt.attributes;for(wn=0;wn<yn;++wn)Ar=X.getActiveAttrib(li,wn),Ar&&Nr(bn,new Cr(Ar.name,Oe.id(Ar.name),X.getAttribLocation(li,Ar.name),Ar))}lr.profile&&(qe.getMaxUniformsCount=function(){var Bt=0;return Jr.forEach(function(yr){yr.stats.uniformsCount>Bt&&(Bt=yr.stats.uniformsCount)}),Bt},qe.getMaxAttributesCount=function(){var Bt=0;return Jr.forEach(function(yr){yr.stats.attributesCount>Bt&&(Bt=yr.stats.attributesCount)}),Bt});function en(){Ir={},or={};for(var Bt=0;Bt<Jr.length;++Bt)Wr(Jr[Bt],null,Jr[Bt].attributes.map(function(yr){return[yr.location,yr.name]}))}return{clear:function(){var Bt=X.deleteShader.bind(X);rr(Ir).forEach(Bt),Ir={},rr(or).forEach(Bt),or={},Jr.forEach(function(yr){X.deleteProgram(yr.program)}),Jr.length=0,Kr={},qe.shaderCount=0},program:function(Bt,yr,Yr,wn){ne.command(Bt>=0,"missing vertex shader",Yr),ne.command(yr>=0,"missing fragment shader",Yr);var Ar=Kr[yr];Ar||(Ar=Kr[yr]={});var En=Ar[Bt];if(En&&(En.refCount++,!wn))return En;var qr=new dn(yr,Bt);return qe.shaderCount++,Wr(qr,Yr,wn),En||(Ar[Bt]=qr),Jr.push(qr),p(qr,{destroy:function(){if(qr.refCount--,qr.refCount<=0){X.deleteProgram(qr.program);var li=Jr.indexOf(qr);Jr.splice(li,1),qe.shaderCount--}Ar[qr.vertId].refCount<=0&&(X.deleteShader(or[qr.vertId]),delete or[qr.vertId],delete Kr[qr.fragId][qr.vertId]),Object.keys(Kr[qr.fragId]).length||(X.deleteShader(Ir[qr.fragId]),delete Ir[qr.fragId],delete Kr[qr.fragId])}})},restore:en,shader:Hr,frag:-1,vert:-1}}var an=6408,Qr=5121,Cn=3333,ei=5126;function fi(X,Oe,qe,lr,Ir,or,Cr){function Nr(Jr){var rn;Oe.next===null?(ne(Ir.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),rn=Qr):(ne(Oe.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),rn=Oe.next.colorAttachments[0].texture._texture.type,ne.optional(function(){or.oes_texture_float?(ne(rn===Qr||rn===ei,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),rn===ei&&ne(Cr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ne(rn===Qr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var dn=0,Wr=0,en=lr.framebufferWidth,Bt=lr.framebufferHeight,yr=null;b(Jr)?yr=Jr:Jr&&(ne.type(Jr,"object","invalid arguments to regl.read()"),dn=Jr.x|0,Wr=Jr.y|0,ne(dn>=0&&dn<lr.framebufferWidth,"invalid x offset for regl.read"),ne(Wr>=0&&Wr<lr.framebufferHeight,"invalid y offset for regl.read"),en=(Jr.width||lr.framebufferWidth-dn)|0,Bt=(Jr.height||lr.framebufferHeight-Wr)|0,yr=Jr.data||null),yr&&(rn===Qr?ne(yr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):rn===ei&&ne(yr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ne(en>0&&en+dn<=lr.framebufferWidth,"invalid width for read pixels"),ne(Bt>0&&Bt+Wr<=lr.framebufferHeight,"invalid height for read pixels"),qe();var Yr=en*Bt*4;return yr||(rn===Qr?yr=new Uint8Array(Yr):rn===ei&&(yr=yr||new Float32Array(Yr))),ne.isTypedArray(yr,"data buffer for regl.read() must be a typedarray"),ne(yr.byteLength>=Yr,"data buffer for regl.read() too small"),X.pixelStorei(Cn,4),X.readPixels(dn,Wr,en,Bt,an,rn,yr),yr}function Hr(Jr){var rn;return Oe.setFBO({framebuffer:Jr.framebuffer},function(){rn=Nr(Jr)}),rn}function Kr(Jr){return!Jr||!("framebuffer"in Jr)?Nr(Jr):Hr(Jr)}return Kr}function ri(X){return Array.prototype.slice.call(X)}function ia(X){return ri(X).join("")}function Nn(){var X=0,Oe=[],qe=[];function lr(rn){for(var dn=0;dn<qe.length;++dn)if(qe[dn]===rn)return Oe[dn];var Wr="g"+X++;return Oe.push(Wr),qe.push(rn),Wr}function Ir(){var rn=[];function dn(){rn.push.apply(rn,ri(arguments))}var Wr=[];function en(){var Bt="v"+X++;return Wr.push(Bt),arguments.length>0&&(rn.push(Bt,"="),rn.push.apply(rn,ri(arguments)),rn.push(";")),Bt}return p(dn,{def:en,toString:function(){return ia([Wr.length>0?"var "+Wr.join(",")+";":"",ia(rn)])}})}function or(){var rn=Ir(),dn=Ir(),Wr=rn.toString,en=dn.toString;function Bt(yr,Yr){dn(yr,Yr,"=",rn.def(yr,Yr),";")}return p(function(){rn.apply(rn,ri(arguments))},{def:rn.def,entry:rn,exit:dn,save:Bt,set:function(yr,Yr,wn){Bt(yr,Yr),rn(yr,Yr,"=",wn,";")},toString:function(){return Wr()+en()}})}function Cr(){var rn=ia(arguments),dn=or(),Wr=or(),en=dn.toString,Bt=Wr.toString;return p(dn,{then:function(){return dn.apply(dn,ri(arguments)),this},else:function(){return Wr.apply(Wr,ri(arguments)),this},toString:function(){var yr=Bt();return yr&&(yr="else{"+yr+"}"),ia(["if(",rn,"){",en(),"}",yr])}})}var Nr=Ir(),Hr={};function Kr(rn,dn){var Wr=[];function en(){var Ar="a"+Wr.length;return Wr.push(Ar),Ar}dn=dn||0;for(var Bt=0;Bt<dn;++Bt)en();var yr=or(),Yr=yr.toString,wn=Hr[rn]=p(yr,{arg:en,toString:function(){return ia(["function(",Wr.join(),"){",Yr(),"}"])}});return wn}function Jr(){var rn=['"use strict";',Nr,"return {"];Object.keys(Hr).forEach(function(Bt){rn.push('"',Bt,'":',Hr[Bt].toString(),",")}),rn.push("}");var dn=ia(rn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Wr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",en=Wr?U.Function.apply(null,Oe.concat(dn)):Function.apply(null,Oe.concat(dn));return en.apply(null,qe)}return{global:Nr,link:lr,block:Ir,proc:Kr,scope:or,cond:Cr,compile:Jr}}var _i="xyzw".split(""),Zi=5121,q=1,te=2,k=0,F=1,ie=2,Ae=3,ft=4,Vt=5,Tt=6,qt="dither",Lr="blend.enable",In="blend.color",Fn="blend.equation",oi="blend.func",ui="depth.enable",mi="depth.func",Gi="depth.range",ma="depth.mask",ya="colorMask",ro="cull.enable",Oa="cull.face",mo="frontFace",Ma="lineWidth",ga="polygonOffset.enable",aa="polygonOffset.offset",pa="sample.alpha",Ua="sample.enable",Za="sample.coverage",ko="stencil.enable",ji="stencil.mask",Xo="stencil.func",Fo="stencil.opFront",Yo="stencil.opBack",Sc="scissor.enable",zu="scissor.box",el="viewport",fu="profile",Rl="framebuffer",Gs="vert",ml="frag",yl="elements",hu="primitive",Ao="count",Qc="offset",qc="instances",pf="vao",Rf="Width",eu="Height",ef=Rl+Rf,Ec=Rl+eu,_p=el+Rf,Dl=el+eu,nh="drawingBuffer",Cc=nh+Rf,df=nh+eu,Vp=[oi,Fn,Xo,Fo,Yo,Za,el,zu,aa],vf=34962,kh=34963,Gp=35632,xp=35633,ih=3553,Fh=34067,Df=2884,Bh=3042,tf=3024,Nh=2960,os=2929,kf=3089,zh=32823,ah=32926,oh=32928,rf=5126,Ff=35664,Bf=35665,gl=35666,Nf=5124,nf=35667,sh=35668,wc=35669,Uh=35670,mf=35671,yf=35672,gf=35673,kl=35674,Su=35675,_f=35676,zf=35678,xf=35680,Zh=4,bf=1028,_l=1029,uh=2304,Uf=2305,jh=32775,lh=32776,bp=519,Tc=7680,zc=0,Vh=1,Sf=32774,af=513,Uu=36160,Sp=36064,Fl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Gh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],xl={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ic={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Hh={frag:Gp,vert:xp},ch={cw:uh,ccw:Uf};function Ef(X){return Array.isArray(X)||b(X)||pt(X)}function fh(X){return X.sort(function(Oe,qe){return Oe===el?-1:qe===el?1:Oe<qe?-1:1})}function ms(X,Oe,qe,lr){this.thisDep=X,this.contextDep=Oe,this.propDep=qe,this.append=lr}function zo(X){return X&&!(X.thisDep||X.contextDep||X.propDep)}function ss(X){return new ms(!1,!1,!1,X)}function pu(X,Oe){var qe=X.type;if(qe===k){var lr=X.data.length;return new ms(!0,lr>=1,lr>=2,Oe)}else if(qe===ft){var Ir=X.data;return new ms(Ir.thisDep,Ir.contextDep,Ir.propDep,Oe)}else{if(qe===Vt)return new ms(!1,!1,!1,Oe);if(qe===Tt){for(var or=!1,Cr=!1,Nr=!1,Hr=0;Hr<X.data.length;++Hr){var Kr=X.data[Hr];if(Kr.type===F)Nr=!0;else if(Kr.type===ie)Cr=!0;else if(Kr.type===Ae)or=!0;else if(Kr.type===k){or=!0;var Jr=Kr.data;Jr>=1&&(Cr=!0),Jr>=2&&(Nr=!0)}else Kr.type===ft&&(or=or||Kr.data.thisDep,Cr=Cr||Kr.data.contextDep,Nr=Nr||Kr.data.propDep)}return new ms(or,Cr,Nr,Oe)}else return new ms(qe===Ae,qe===ie,qe===F,Oe)}}var hh=new ms(!1,!1,!1,function(){});function Wh(X,Oe,qe,lr,Ir,or,Cr,Nr,Hr,Kr,Jr,rn,dn,Wr,en){var Bt=Kr.Record,yr={add:32774,subtract:32778,"reverse subtract":32779};qe.ext_blend_minmax&&(yr.min=jh,yr.max=lh);var Yr=qe.angle_instanced_arrays,wn=qe.webgl_draw_buffers,Ar=qe.oes_vertex_array_object,En={dirty:!0,profile:en.profile},qr={},li=[],Pr={},Sr={};function Wn(ze){return ze.replace(".","_")}function hn(ze,Ee,ut){var Ot=Wn(ze);li.push(ze),qr[Ot]=En[Ot]=!!ut,Pr[Ot]=Ee}function $r(ze,Ee,ut){var Ot=Wn(ze);li.push(ze),Array.isArray(ut)?(En[Ot]=ut.slice(),qr[Ot]=ut.slice()):En[Ot]=qr[Ot]=ut,Sr[Ot]=Ee}hn(qt,tf),hn(Lr,Bh),$r(In,"blendColor",[0,0,0,0]),$r(Fn,"blendEquationSeparate",[Sf,Sf]),$r(oi,"blendFuncSeparate",[Vh,zc,Vh,zc]),hn(ui,os,!0),$r(mi,"depthFunc",af),$r(Gi,"depthRange",[0,1]),$r(ma,"depthMask",!0),$r(ya,ya,[!0,!0,!0,!0]),hn(ro,Df),$r(Oa,"cullFace",_l),$r(mo,mo,Uf),$r(Ma,Ma,1),hn(ga,zh),$r(aa,"polygonOffset",[0,0]),hn(pa,ah),hn(Ua,oh),$r(Za,"sampleCoverage",[1,!1]),hn(ko,Nh),$r(ji,"stencilMask",-1),$r(Xo,"stencilFunc",[bp,0,-1]),$r(Fo,"stencilOpSeparate",[bf,Tc,Tc,Tc]),$r(Yo,"stencilOpSeparate",[_l,Tc,Tc,Tc]),hn(Sc,kf),$r(zu,"scissor",[0,0,X.drawingBufferWidth,X.drawingBufferHeight]),$r(el,el,[0,0,X.drawingBufferWidth,X.drawingBufferHeight]);var yn={gl:X,context:dn,strings:Oe,next:qr,current:En,draw:rn,elements:or,buffer:Ir,shader:Jr,attributes:Kr.state,vao:Kr,uniforms:Hr,framebuffer:Nr,extensions:qe,timer:Wr,isBufferArgs:Ef},bn={primTypes:Tr,compareFuncs:xl,blendFuncs:Fl,blendEquations:yr,stencilOps:ic,glTypes:ns,orientationType:ch};ne.optional(function(){yn.isArrayLike=so}),wn&&(bn.backBuffer=[_l],bn.drawBuffer=de(lr.maxDrawbuffers,function(ze){return ze===0?[0]:de(ze,function(Ee){return Sp+Ee})}));var Ri=0;function Ii(){var ze=Nn(),Ee=ze.link,ut=ze.global;ze.id=Ri++,ze.batchId="0";var Ot=Ee(yn),sr=ze.shared={props:"a0"};Object.keys(yn).forEach(function(it){sr[it]=ut.def(Ot,".",it)}),ne.optional(function(){ze.CHECK=Ee(ne),ze.commandStr=ne.guessCommand(),ze.command=Ee(ze.commandStr),ze.assert=function(it,Ue,Gt){it("if(!(",Ue,"))",this.CHECK,".commandRaise(",Ee(Gt),",",this.command,");")},bn.invalidBlendCombinations=Gh});var yt=ze.next={},dt=ze.current={};Object.keys(Sr).forEach(function(it){Array.isArray(En[it])&&(yt[it]=ut.def(sr.next,".",it),dt[it]=ut.def(sr.current,".",it))});var lt=ze.constants={};Object.keys(bn).forEach(function(it){lt[it]=ut.def(JSON.stringify(bn[it]))}),ze.invoke=function(it,Ue){switch(Ue.type){case k:var Gt=["this",sr.context,sr.props,ze.batchId];return it.def(Ee(Ue.data),".call(",Gt.slice(0,Math.max(Ue.data.length+1,4)),")");case F:return it.def(sr.props,Ue.data);case ie:return it.def(sr.context,Ue.data);case Ae:return it.def("this",Ue.data);case ft:return Ue.data.append(ze,it),Ue.data.ref;case Vt:return Ue.data.toString();case Tt:return Ue.data.map(function(Xt){return ze.invoke(it,Xt)})}},ze.attribCache={};var De={};return ze.scopeAttrib=function(it){var Ue=Oe.id(it);if(Ue in De)return De[Ue];var Gt=Kr.scope[Ue];Gt||(Gt=Kr.scope[Ue]=new Bt);var Xt=De[Ue]=Ee(Gt);return Xt},ze}function An(ze){var Ee=ze.static,ut=ze.dynamic,Ot;if(fu in Ee){var sr=!!Ee[fu];Ot=ss(function(dt,lt){return sr}),Ot.enable=sr}else if(fu in ut){var yt=ut[fu];Ot=pu(yt,function(dt,lt){return dt.invoke(lt,yt)})}return Ot}function Tn(ze,Ee){var ut=ze.static,Ot=ze.dynamic;if(Rl in ut){var sr=ut[Rl];return sr?(sr=Nr.getFramebuffer(sr),ne.command(sr,"invalid framebuffer object"),ss(function(dt,lt){var De=dt.link(sr),it=dt.shared;lt.set(it.framebuffer,".next",De);var Ue=it.context;return lt.set(Ue,"."+ef,De+".width"),lt.set(Ue,"."+Ec,De+".height"),De})):ss(function(dt,lt){var De=dt.shared;lt.set(De.framebuffer,".next","null");var it=De.context;return lt.set(it,"."+ef,it+"."+Cc),lt.set(it,"."+Ec,it+"."+df),"null"})}else if(Rl in Ot){var yt=Ot[Rl];return pu(yt,function(dt,lt){var De=dt.invoke(lt,yt),it=dt.shared,Ue=it.framebuffer,Gt=lt.def(Ue,".getFramebuffer(",De,")");ne.optional(function(){dt.assert(lt,"!"+De+"||"+Gt,"invalid framebuffer object")}),lt.set(Ue,".next",Gt);var Xt=it.context;return lt.set(Xt,"."+ef,Gt+"?"+Gt+".width:"+Xt+"."+Cc),lt.set(Xt,"."+Ec,Gt+"?"+Gt+".height:"+Xt+"."+df),Gt})}else return null}function Ei(ze,Ee,ut){var Ot=ze.static,sr=ze.dynamic;function yt(De){if(De in Ot){var it=Ot[De];ne.commandType(it,"object","invalid "+De,ut.commandStr);var Ue=!0,Gt=it.x|0,Xt=it.y|0,Br,fn;return"width"in it?(Br=it.width|0,ne.command(Br>=0,"invalid "+De,ut.commandStr)):Ue=!1,"height"in it?(fn=it.height|0,ne.command(fn>=0,"invalid "+De,ut.commandStr)):Ue=!1,new ms(!Ue&&Ee&&Ee.thisDep,!Ue&&Ee&&Ee.contextDep,!Ue&&Ee&&Ee.propDep,function(un,Yn){var On=un.shared.context,jn=Br;"width"in it||(jn=Yn.def(On,".",ef,"-",Gt));var Vn=fn;return"height"in it||(Vn=Yn.def(On,".",Ec,"-",Xt)),[Gt,Xt,jn,Vn]})}else if(De in sr){var sn=sr[De],gn=pu(sn,function(un,Yn){var On=un.invoke(Yn,sn);ne.optional(function(){un.assert(Yn,On+"&&typeof "+On+'==="object"',"invalid "+De)});var jn=un.shared.context,Vn=Yn.def(On,".x|0"),Gn=Yn.def(On,".y|0"),hi=Yn.def('"width" in ',On,"?",On,".width|0:","(",jn,".",ef,"-",Vn,")"),Xa=Yn.def('"height" in ',On,"?",On,".height|0:","(",jn,".",Ec,"-",Gn,")");return ne.optional(function(){un.assert(Yn,hi+">=0&&"+Xa+">=0","invalid "+De)}),[Vn,Gn,hi,Xa]});return Ee&&(gn.thisDep=gn.thisDep||Ee.thisDep,gn.contextDep=gn.contextDep||Ee.contextDep,gn.propDep=gn.propDep||Ee.propDep),gn}else return Ee?new ms(Ee.thisDep,Ee.contextDep,Ee.propDep,function(un,Yn){var On=un.shared.context;return[0,0,Yn.def(On,".",ef),Yn.def(On,".",Ec)]}):null}var dt=yt(el);if(dt){var lt=dt;dt=new ms(dt.thisDep,dt.contextDep,dt.propDep,function(De,it){var Ue=lt.append(De,it),Gt=De.shared.context;return it.set(Gt,"."+_p,Ue[2]),it.set(Gt,"."+Dl,Ue[3]),Ue})}return{viewport:dt,scissor_box:yt(zu)}}function Bi(ze,Ee){var ut=ze.static,Ot=typeof ut[ml]=="string"&&typeof ut[Gs]=="string";if(Ot){if(Object.keys(Ee.dynamic).length>0)return null;var sr=Ee.static,yt=Object.keys(sr);if(yt.length>0&&typeof sr[yt[0]]=="number"){for(var dt=[],lt=0;lt<yt.length;++lt)ne(typeof sr[yt[lt]]=="number","must specify all vertex attribute locations when using vaos"),dt.push([sr[yt[lt]]|0,yt[lt]]);return dt}}return null}function Fi(ze,Ee,ut){var Ot=ze.static,sr=ze.dynamic;function yt(Ue){if(Ue in Ot){var Gt=Oe.id(Ot[Ue]);ne.optional(function(){Jr.shader(Hh[Ue],Gt,ne.guessCommand())});var Xt=ss(function(){return Gt});return Xt.id=Gt,Xt}else if(Ue in sr){var Br=sr[Ue];return pu(Br,function(fn,sn){var gn=fn.invoke(sn,Br),un=sn.def(fn.shared.strings,".id(",gn,")");return ne.optional(function(){sn(fn.shared.shader,".shader(",Hh[Ue],",",un,",",fn.command,");")}),un})}return null}var dt=yt(ml),lt=yt(Gs),De=null,it;return zo(dt)&&zo(lt)?(De=Jr.program(lt.id,dt.id,null,ut),it=ss(function(Ue,Gt){return Ue.link(De)})):it=new ms(dt&&dt.thisDep||lt&&lt.thisDep,dt&&dt.contextDep||lt&&lt.contextDep,dt&&dt.propDep||lt&&lt.propDep,function(Ue,Gt){var Xt=Ue.shared.shader,Br;dt?Br=dt.append(Ue,Gt):Br=Gt.def(Xt,".",ml);var fn;lt?fn=lt.append(Ue,Gt):fn=Gt.def(Xt,".",Gs);var sn=Xt+".program("+fn+","+Br;return ne.optional(function(){sn+=","+Ue.command}),Gt.def(sn+")")}),{frag:dt,vert:lt,progVar:it,program:De}}function po(ze,Ee){var ut=ze.static,Ot=ze.dynamic,sr={},yt=!1;function dt(){if(pf in ut){var Yn=ut[pf];return Yn!==null&&Kr.getVAO(Yn)===null&&(Yn=Kr.createVAO(Yn)),yt=!0,sr.vao=Yn,ss(function(jn){var Vn=Kr.getVAO(Yn);return Vn?jn.link(Vn):"null"})}else if(pf in Ot){yt=!0;var On=Ot[pf];return pu(On,function(jn,Vn){var Gn=jn.invoke(Vn,On);return Vn.def(jn.shared.vao+".getVAO("+Gn+")")})}return null}var lt=dt(),De=!1;function it(){if(yl in ut){var Yn=ut[yl];if(sr.elements=Yn,Ef(Yn)){var On=sr.elements=or.create(Yn,!0);Yn=or.getElements(On),De=!0}else Yn&&(Yn=or.getElements(Yn),De=!0,ne.command(Yn,"invalid elements",Ee.commandStr));var jn=ss(function(Gn,hi){if(Yn){var Xa=Gn.link(Yn);return Gn.ELEMENTS=Xa,Xa}return Gn.ELEMENTS=null,null});return jn.value=Yn,jn}else if(yl in Ot){De=!0;var Vn=Ot[yl];return pu(Vn,function(Gn,hi){var Xa=Gn.shared,Bo=Xa.isBufferArgs,bl=Xa.elements,Ja=Gn.invoke(hi,Vn),La=hi.def("null"),Ss=hi.def(Bo,"(",Ja,")"),Zu=Gn.cond(Ss).then(La,"=",bl,".createStream(",Ja,");").else(La,"=",bl,".getElements(",Ja,");");return ne.optional(function(){Gn.assert(Zu.else,"!"+Ja+"||"+La,"invalid elements")}),hi.entry(Zu),hi.exit(Gn.cond(Ss).then(bl,".destroyStream(",La,");")),Gn.ELEMENTS=La,La})}else if(yt)return new ms(lt.thisDep,lt.contextDep,lt.propDep,function(Gn,hi){return hi.def(Gn.shared.vao+".currentVAO?"+Gn.shared.elements+".getElements("+Gn.shared.vao+".currentVAO.elements):null")});return null}var Ue=it();function Gt(){if(hu in ut){var Yn=ut[hu];return sr.primitive=Yn,ne.commandParameter(Yn,Tr,"invalid primitve",Ee.commandStr),ss(function(jn,Vn){return Tr[Yn]})}else if(hu in Ot){var On=Ot[hu];return pu(On,function(jn,Vn){var Gn=jn.constants.primTypes,hi=jn.invoke(Vn,On);return ne.optional(function(){jn.assert(Vn,hi+" in "+Gn,"invalid primitive, must be one of "+Object.keys(Tr))}),Vn.def(Gn,"[",hi,"]")})}else{if(De)return zo(Ue)?Ue.value?ss(function(jn,Vn){return Vn.def(jn.ELEMENTS,".primType")}):ss(function(){return Zh}):new ms(Ue.thisDep,Ue.contextDep,Ue.propDep,function(jn,Vn){var Gn=jn.ELEMENTS;return Vn.def(Gn,"?",Gn,".primType:",Zh)});if(yt)return new ms(lt.thisDep,lt.contextDep,lt.propDep,function(jn,Vn){return Vn.def(jn.shared.vao+".currentVAO?"+jn.shared.vao+".currentVAO.primitive:"+Zh)})}return null}function Xt(Yn,On){if(Yn in ut){var jn=ut[Yn]|0;return On?sr.offset=jn:sr.instances=jn,ne.command(!On||jn>=0,"invalid "+Yn,Ee.commandStr),ss(function(Gn,hi){return On&&(Gn.OFFSET=jn),jn})}else if(Yn in Ot){var Vn=Ot[Yn];return pu(Vn,function(Gn,hi){var Xa=Gn.invoke(hi,Vn);return On&&(Gn.OFFSET=Xa,ne.optional(function(){Gn.assert(hi,Xa+">=0","invalid "+Yn)})),Xa})}else if(On){if(De)return ss(function(Gn,hi){return Gn.OFFSET=0,0});if(yt)return new ms(lt.thisDep,lt.contextDep,lt.propDep,function(Gn,hi){return hi.def(Gn.shared.vao+".currentVAO?"+Gn.shared.vao+".currentVAO.offset:0")})}else if(yt)return new ms(lt.thisDep,lt.contextDep,lt.propDep,function(Gn,hi){return hi.def(Gn.shared.vao+".currentVAO?"+Gn.shared.vao+".currentVAO.instances:-1")});return null}var Br=Xt(Qc,!0);function fn(){if(Ao in ut){var Yn=ut[Ao]|0;return sr.count=Yn,ne.command(typeof Yn=="number"&&Yn>=0,"invalid vertex count",Ee.commandStr),ss(function(){return Yn})}else if(Ao in Ot){var On=Ot[Ao];return pu(On,function(hi,Xa){var Bo=hi.invoke(Xa,On);return ne.optional(function(){hi.assert(Xa,"typeof "+Bo+'==="number"&&'+Bo+">=0&&"+Bo+"===("+Bo+"|0)","invalid vertex count")}),Bo})}else if(De)if(zo(Ue)){if(Ue)return Br?new ms(Br.thisDep,Br.contextDep,Br.propDep,function(hi,Xa){var Bo=Xa.def(hi.ELEMENTS,".vertCount-",hi.OFFSET);return ne.optional(function(){hi.assert(Xa,Bo+">=0","invalid vertex offset/element buffer too small")}),Bo}):ss(function(hi,Xa){return Xa.def(hi.ELEMENTS,".vertCount")});var jn=ss(function(){return-1});return ne.optional(function(){jn.MISSING=!0}),jn}else{var Vn=new ms(Ue.thisDep||Br.thisDep,Ue.contextDep||Br.contextDep,Ue.propDep||Br.propDep,function(hi,Xa){var Bo=hi.ELEMENTS;return hi.OFFSET?Xa.def(Bo,"?",Bo,".vertCount-",hi.OFFSET,":-1"):Xa.def(Bo,"?",Bo,".vertCount:-1")});return ne.optional(function(){Vn.DYNAMIC=!0}),Vn}else if(yt){var Gn=new ms(lt.thisDep,lt.contextDep,lt.propDep,function(hi,Xa){return Xa.def(hi.shared.vao,".currentVAO?",hi.shared.vao,".currentVAO.count:-1")});return Gn}return null}var sn=Gt(),gn=fn(),un=Xt(qc,!1);return{elements:Ue,primitive:sn,count:gn,instances:un,offset:Br,vao:lt,vaoActive:yt,elementsActive:De,static:sr}}function Co(ze,Ee){var ut=ze.static,Ot=ze.dynamic,sr={};return li.forEach(function(yt){var dt=Wn(yt);function lt(De,it){if(yt in ut){var Ue=De(ut[yt]);sr[dt]=ss(function(){return Ue})}else if(yt in Ot){var Gt=Ot[yt];sr[dt]=pu(Gt,function(Xt,Br){return it(Xt,Br,Xt.invoke(Br,Gt))})}}switch(yt){case ro:case Lr:case qt:case ko:case ui:case Sc:case ga:case pa:case Ua:case ma:return lt(function(De){return ne.commandType(De,"boolean",yt,Ee.commandStr),De},function(De,it,Ue){return ne.optional(function(){De.assert(it,"typeof "+Ue+'==="boolean"',"invalid flag "+yt,De.commandStr)}),Ue});case mi:return lt(function(De){return ne.commandParameter(De,xl,"invalid "+yt,Ee.commandStr),xl[De]},function(De,it,Ue){var Gt=De.constants.compareFuncs;return ne.optional(function(){De.assert(it,Ue+" in "+Gt,"invalid "+yt+", must be one of "+Object.keys(xl))}),it.def(Gt,"[",Ue,"]")});case Gi:return lt(function(De){return ne.command(so(De)&&De.length===2&&typeof De[0]=="number"&&typeof De[1]=="number"&&De[0]<=De[1],"depth range is 2d array",Ee.commandStr),De},function(De,it,Ue){ne.optional(function(){De.assert(it,De.shared.isArrayLike+"("+Ue+")&&"+Ue+".length===2&&typeof "+Ue+'[0]==="number"&&typeof '+Ue+'[1]==="number"&&'+Ue+"[0]<="+Ue+"[1]","depth range must be a 2d array")});var Gt=it.def("+",Ue,"[0]"),Xt=it.def("+",Ue,"[1]");return[Gt,Xt]});case oi:return lt(function(De){ne.commandType(De,"object","blend.func",Ee.commandStr);var it="srcRGB"in De?De.srcRGB:De.src,Ue="srcAlpha"in De?De.srcAlpha:De.src,Gt="dstRGB"in De?De.dstRGB:De.dst,Xt="dstAlpha"in De?De.dstAlpha:De.dst;return ne.commandParameter(it,Fl,dt+".srcRGB",Ee.commandStr),ne.commandParameter(Ue,Fl,dt+".srcAlpha",Ee.commandStr),ne.commandParameter(Gt,Fl,dt+".dstRGB",Ee.commandStr),ne.commandParameter(Xt,Fl,dt+".dstAlpha",Ee.commandStr),ne.command(Gh.indexOf(it+", "+Gt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+it+", "+Gt+")",Ee.commandStr),[Fl[it],Fl[Gt],Fl[Ue],Fl[Xt]]},function(De,it,Ue){var Gt=De.constants.blendFuncs;ne.optional(function(){De.assert(it,Ue+"&&typeof "+Ue+'==="object"',"invalid blend func, must be an object")});function Xt(On,jn){var Vn=it.def('"',On,jn,'" in ',Ue,"?",Ue,".",On,jn,":",Ue,".",On);return ne.optional(function(){De.assert(it,Vn+" in "+Gt,"invalid "+yt+"."+On+jn+", must be one of "+Object.keys(Fl))}),Vn}var Br=Xt("src","RGB"),fn=Xt("dst","RGB");ne.optional(function(){var On=De.constants.invalidBlendCombinations;De.assert(it,On+".indexOf("+Br+'+", "+'+fn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var sn=it.def(Gt,"[",Br,"]"),gn=it.def(Gt,"[",Xt("src","Alpha"),"]"),un=it.def(Gt,"[",fn,"]"),Yn=it.def(Gt,"[",Xt("dst","Alpha"),"]");return[sn,un,gn,Yn]});case Fn:return lt(function(De){if(typeof De=="string")return ne.commandParameter(De,yr,"invalid "+yt,Ee.commandStr),[yr[De],yr[De]];if(typeof De=="object")return ne.commandParameter(De.rgb,yr,yt+".rgb",Ee.commandStr),ne.commandParameter(De.alpha,yr,yt+".alpha",Ee.commandStr),[yr[De.rgb],yr[De.alpha]];ne.commandRaise("invalid blend.equation",Ee.commandStr)},function(De,it,Ue){var Gt=De.constants.blendEquations,Xt=it.def(),Br=it.def(),fn=De.cond("typeof ",Ue,'==="string"');return ne.optional(function(){function sn(gn,un,Yn){De.assert(gn,Yn+" in "+Gt,"invalid "+un+", must be one of "+Object.keys(yr))}sn(fn.then,yt,Ue),De.assert(fn.else,Ue+"&&typeof "+Ue+'==="object"',"invalid "+yt),sn(fn.else,yt+".rgb",Ue+".rgb"),sn(fn.else,yt+".alpha",Ue+".alpha")}),fn.then(Xt,"=",Br,"=",Gt,"[",Ue,"];"),fn.else(Xt,"=",Gt,"[",Ue,".rgb];",Br,"=",Gt,"[",Ue,".alpha];"),it(fn),[Xt,Br]});case In:return lt(function(De){return ne.command(so(De)&&De.length===4,"blend.color must be a 4d array",Ee.commandStr),de(4,function(it){return+De[it]})},function(De,it,Ue){return ne.optional(function(){De.assert(it,De.shared.isArrayLike+"("+Ue+")&&"+Ue+".length===4","blend.color must be a 4d array")}),de(4,function(Gt){return it.def("+",Ue,"[",Gt,"]")})});case ji:return lt(function(De){return ne.commandType(De,"number",dt,Ee.commandStr),De|0},function(De,it,Ue){return ne.optional(function(){De.assert(it,"typeof "+Ue+'==="number"',"invalid stencil.mask")}),it.def(Ue,"|0")});case Xo:return lt(function(De){ne.commandType(De,"object",dt,Ee.commandStr);var it=De.cmp||"keep",Ue=De.ref||0,Gt="mask"in De?De.mask:-1;return ne.commandParameter(it,xl,yt+".cmp",Ee.commandStr),ne.commandType(Ue,"number",yt+".ref",Ee.commandStr),ne.commandType(Gt,"number",yt+".mask",Ee.commandStr),[xl[it],Ue,Gt]},function(De,it,Ue){var Gt=De.constants.compareFuncs;ne.optional(function(){function sn(){De.assert(it,Array.prototype.join.call(arguments,""),"invalid stencil.func")}sn(Ue+"&&typeof ",Ue,'==="object"'),sn('!("cmp" in ',Ue,")||(",Ue,".cmp in ",Gt,")")});var Xt=it.def('"cmp" in ',Ue,"?",Gt,"[",Ue,".cmp]",":",Tc),Br=it.def(Ue,".ref|0"),fn=it.def('"mask" in ',Ue,"?",Ue,".mask|0:-1");return[Xt,Br,fn]});case Fo:case Yo:return lt(function(De){ne.commandType(De,"object",dt,Ee.commandStr);var it=De.fail||"keep",Ue=De.zfail||"keep",Gt=De.zpass||"keep";return ne.commandParameter(it,ic,yt+".fail",Ee.commandStr),ne.commandParameter(Ue,ic,yt+".zfail",Ee.commandStr),ne.commandParameter(Gt,ic,yt+".zpass",Ee.commandStr),[yt===Yo?_l:bf,ic[it],ic[Ue],ic[Gt]]},function(De,it,Ue){var Gt=De.constants.stencilOps;ne.optional(function(){De.assert(it,Ue+"&&typeof "+Ue+'==="object"',"invalid "+yt)});function Xt(Br){return ne.optional(function(){De.assert(it,'!("'+Br+'" in '+Ue+")||("+Ue+"."+Br+" in "+Gt+")","invalid "+yt+"."+Br+", must be one of "+Object.keys(ic))}),it.def('"',Br,'" in ',Ue,"?",Gt,"[",Ue,".",Br,"]:",Tc)}return[yt===Yo?_l:bf,Xt("fail"),Xt("zfail"),Xt("zpass")]});case aa:return lt(function(De){ne.commandType(De,"object",dt,Ee.commandStr);var it=De.factor|0,Ue=De.units|0;return ne.commandType(it,"number",dt+".factor",Ee.commandStr),ne.commandType(Ue,"number",dt+".units",Ee.commandStr),[it,Ue]},function(De,it,Ue){ne.optional(function(){De.assert(it,Ue+"&&typeof "+Ue+'==="object"',"invalid "+yt)});var Gt=it.def(Ue,".factor|0"),Xt=it.def(Ue,".units|0");return[Gt,Xt]});case Oa:return lt(function(De){var it=0;return De==="front"?it=bf:De==="back"&&(it=_l),ne.command(!!it,dt,Ee.commandStr),it},function(De,it,Ue){return ne.optional(function(){De.assert(it,Ue+'==="front"||'+Ue+'==="back"',"invalid cull.face")}),it.def(Ue,'==="front"?',bf,":",_l)});case Ma:return lt(function(De){return ne.command(typeof De=="number"&&De>=lr.lineWidthDims[0]&&De<=lr.lineWidthDims[1],"invalid line width, must be a positive number between "+lr.lineWidthDims[0]+" and "+lr.lineWidthDims[1],Ee.commandStr),De},function(De,it,Ue){return ne.optional(function(){De.assert(it,"typeof "+Ue+'==="number"&&'+Ue+">="+lr.lineWidthDims[0]+"&&"+Ue+"<="+lr.lineWidthDims[1],"invalid line width")}),Ue});case mo:return lt(function(De){return ne.commandParameter(De,ch,dt,Ee.commandStr),ch[De]},function(De,it,Ue){return ne.optional(function(){De.assert(it,Ue+'==="cw"||'+Ue+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),it.def(Ue+'==="cw"?'+uh+":"+Uf)});case ya:return lt(function(De){return ne.command(so(De)&&De.length===4,"color.mask must be length 4 array",Ee.commandStr),De.map(function(it){return!!it})},function(De,it,Ue){return ne.optional(function(){De.assert(it,De.shared.isArrayLike+"("+Ue+")&&"+Ue+".length===4","invalid color.mask")}),de(4,function(Gt){return"!!"+Ue+"["+Gt+"]"})});case Za:return lt(function(De){ne.command(typeof De=="object"&&De,dt,Ee.commandStr);var it="value"in De?De.value:1,Ue=!!De.invert;return ne.command(typeof it=="number"&&it>=0&&it<=1,"sample.coverage.value must be a number between 0 and 1",Ee.commandStr),[it,Ue]},function(De,it,Ue){ne.optional(function(){De.assert(it,Ue+"&&typeof "+Ue+'==="object"',"invalid sample.coverage")});var Gt=it.def('"value" in ',Ue,"?+",Ue,".value:1"),Xt=it.def("!!",Ue,".invert");return[Gt,Xt]})}}),sr}function oa(ze,Ee){var ut=ze.static,Ot=ze.dynamic,sr={};return Object.keys(ut).forEach(function(yt){var dt=ut[yt],lt;if(typeof dt=="number"||typeof dt=="boolean")lt=ss(function(){return dt});else if(typeof dt=="function"){var De=dt._reglType;De==="texture2d"||De==="textureCube"?lt=ss(function(it){return it.link(dt)}):De==="framebuffer"||De==="framebufferCube"?(ne.command(dt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+yt+'"',Ee.commandStr),lt=ss(function(it){return it.link(dt.color[0])})):ne.commandRaise('invalid data for uniform "'+yt+'"',Ee.commandStr)}else so(dt)?lt=ss(function(it){var Ue=it.global.def("[",de(dt.length,function(Gt){return ne.command(typeof dt[Gt]=="number"||typeof dt[Gt]=="boolean","invalid uniform "+yt,it.commandStr),dt[Gt]}),"]");return Ue}):ne.commandRaise('invalid or missing data for uniform "'+yt+'"',Ee.commandStr);lt.value=dt,sr[yt]=lt}),Object.keys(Ot).forEach(function(yt){var dt=Ot[yt];sr[yt]=pu(dt,function(lt,De){return lt.invoke(De,dt)})}),sr}function Os(ze,Ee){var ut=ze.static,Ot=ze.dynamic,sr={};return Object.keys(ut).forEach(function(yt){var dt=ut[yt],lt=Oe.id(yt),De=new Bt;if(Ef(dt))De.state=q,De.buffer=Ir.getBuffer(Ir.create(dt,vf,!1,!0)),De.type=0;else{var it=Ir.getBuffer(dt);if(it)De.state=q,De.buffer=it,De.type=0;else if(ne.command(typeof dt=="object"&&dt,"invalid data for attribute "+yt,Ee.commandStr),"constant"in dt){var Ue=dt.constant;De.buffer="null",De.state=te,typeof Ue=="number"?De.x=Ue:(ne.command(so(Ue)&&Ue.length>0&&Ue.length<=4,"invalid constant for attribute "+yt,Ee.commandStr),_i.forEach(function(un,Yn){Yn<Ue.length&&(De[un]=Ue[Yn])}))}else{Ef(dt.buffer)?it=Ir.getBuffer(Ir.create(dt.buffer,vf,!1,!0)):it=Ir.getBuffer(dt.buffer),ne.command(!!it,'missing buffer for attribute "'+yt+'"',Ee.commandStr);var Gt=dt.offset|0;ne.command(Gt>=0,'invalid offset for attribute "'+yt+'"',Ee.commandStr);var Xt=dt.stride|0;ne.command(Xt>=0&&Xt<256,'invalid stride for attribute "'+yt+'", must be integer betweeen [0, 255]',Ee.commandStr);var Br=dt.size|0;ne.command(!("size"in dt)||Br>0&&Br<=4,'invalid size for attribute "'+yt+'", must be 1,2,3,4',Ee.commandStr);var fn=!!dt.normalized,sn=0;"type"in dt&&(ne.commandParameter(dt.type,ns,"invalid type for attribute "+yt,Ee.commandStr),sn=ns[dt.type]);var gn=dt.divisor|0;ne.optional(function(){"divisor"in dt&&(ne.command(gn===0||Yr,'cannot specify divisor for attribute "'+yt+'", instancing not supported',Ee.commandStr),ne.command(gn>=0,'invalid divisor for attribute "'+yt+'"',Ee.commandStr));var un=Ee.commandStr,Yn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(dt).forEach(function(On){ne.command(Yn.indexOf(On)>=0,'unknown parameter "'+On+'" for attribute pointer "'+yt+'" (valid parameters are '+Yn+")",un)})}),De.buffer=it,De.state=q,De.size=Br,De.normalized=fn,De.type=sn||it.dtype,De.offset=Gt,De.stride=Xt,De.divisor=gn}}sr[yt]=ss(function(un,Yn){var On=un.attribCache;if(lt in On)return On[lt];var jn={isStream:!1};return Object.keys(De).forEach(function(Vn){jn[Vn]=De[Vn]}),De.buffer&&(jn.buffer=un.link(De.buffer),jn.type=jn.type||jn.buffer+".dtype"),On[lt]=jn,jn})}),Object.keys(Ot).forEach(function(yt){var dt=Ot[yt];function lt(De,it){var Ue=De.invoke(it,dt),Gt=De.shared,Xt=De.constants,Br=Gt.isBufferArgs,fn=Gt.buffer;ne.optional(function(){De.assert(it,Ue+"&&(typeof "+Ue+'==="object"||typeof '+Ue+'==="function")&&('+Br+"("+Ue+")||"+fn+".getBuffer("+Ue+")||"+fn+".getBuffer("+Ue+".buffer)||"+Br+"("+Ue+'.buffer)||("constant" in '+Ue+"&&(typeof "+Ue+'.constant==="number"||'+Gt.isArrayLike+"("+Ue+".constant))))",'invalid dynamic attribute "'+yt+'"')});var sn={isStream:it.def(!1)},gn=new Bt;gn.state=q,Object.keys(gn).forEach(function(jn){sn[jn]=it.def(""+gn[jn])});var un=sn.buffer,Yn=sn.type;it("if(",Br,"(",Ue,")){",sn.isStream,"=true;",un,"=",fn,".createStream(",vf,",",Ue,");",Yn,"=",un,".dtype;","}else{",un,"=",fn,".getBuffer(",Ue,");","if(",un,"){",Yn,"=",un,".dtype;",'}else if("constant" in ',Ue,"){",sn.state,"=",te,";","if(typeof "+Ue+'.constant === "number"){',sn[_i[0]],"=",Ue,".constant;",_i.slice(1).map(function(jn){return sn[jn]}).join("="),"=0;","}else{",_i.map(function(jn,Vn){return sn[jn]+"="+Ue+".constant.length>"+Vn+"?"+Ue+".constant["+Vn+"]:0;"}).join(""),"}}else{","if(",Br,"(",Ue,".buffer)){",un,"=",fn,".createStream(",vf,",",Ue,".buffer);","}else{",un,"=",fn,".getBuffer(",Ue,".buffer);","}",Yn,'="type" in ',Ue,"?",Xt.glTypes,"[",Ue,".type]:",un,".dtype;",sn.normalized,"=!!",Ue,".normalized;");function On(jn){it(sn[jn],"=",Ue,".",jn,"|0;")}return On("size"),On("offset"),On("stride"),On("divisor"),it("}}"),it.exit("if(",sn.isStream,"){",fn,".destroyStream(",un,");","}"),sn}sr[yt]=pu(dt,lt)}),sr}function uo(ze){var Ee=ze.static,ut=ze.dynamic,Ot={};return Object.keys(Ee).forEach(function(sr){var yt=Ee[sr];Ot[sr]=ss(function(dt,lt){return typeof yt=="number"||typeof yt=="boolean"?""+yt:dt.link(yt)})}),Object.keys(ut).forEach(function(sr){var yt=ut[sr];Ot[sr]=pu(yt,function(dt,lt){return dt.invoke(lt,yt)})}),Ot}function ys(ze,Ee,ut,Ot,sr){var yt=ze.static,dt=ze.dynamic;ne.optional(function(){var On=[Rl,Gs,ml,yl,hu,Qc,Ao,qc,fu,pf].concat(li);function jn(Vn){Object.keys(Vn).forEach(function(Gn){ne.command(On.indexOf(Gn)>=0,'unknown parameter "'+Gn+'"',sr.commandStr)})}jn(yt),jn(dt)});var lt=Bi(ze,Ee),De=Tn(ze,sr),it=Ei(ze,De,sr),Ue=po(ze,sr),Gt=Co(ze,sr),Xt=Fi(ze,sr,lt);function Br(On){var jn=it[On];jn&&(Gt[On]=jn)}Br(el),Br(Wn(zu));var fn=Object.keys(Gt).length>0,sn={framebuffer:De,draw:Ue,shader:Xt,state:Gt,dirty:fn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(sn.profile=An(ze,sr),sn.uniforms=oa(ut,sr),sn.drawVAO=sn.scopeVAO=Ue.vao,!sn.drawVAO&&Xt.program&&!lt&&qe.angle_instanced_arrays&&Ue.static.elements){var gn=!0,un=Xt.program.attributes.map(function(On){var jn=Ee.static[On];return gn=gn&&!!jn,jn});if(gn&&un.length>0){var Yn=Kr.getVAO(Kr.createVAO({attributes:un,elements:Ue.static.elements}));sn.drawVAO=new ms(null,null,null,function(On,jn){return On.link(Yn)}),sn.useVAO=!0}}return lt?sn.useVAO=!0:sn.attributes=Os(Ee,sr),sn.context=uo(Ot,sr),sn}function Uo(ze,Ee,ut){var Ot=ze.shared,sr=Ot.context,yt=ze.scope();Object.keys(ut).forEach(function(dt){Ee.save(sr,"."+dt);var lt=ut[dt],De=lt.append(ze,Ee);Array.isArray(De)?yt(sr,".",dt,"=[",De.join(),"];"):yt(sr,".",dt,"=",De,";")}),Ee(yt)}function us(ze,Ee,ut,Ot){var sr=ze.shared,yt=sr.gl,dt=sr.framebuffer,lt;wn&&(lt=Ee.def(sr.extensions,".webgl_draw_buffers"));var De=ze.constants,it=De.drawBuffer,Ue=De.backBuffer,Gt;ut?Gt=ut.append(ze,Ee):Gt=Ee.def(dt,".next"),Ot||Ee("if(",Gt,"!==",dt,".cur){"),Ee("if(",Gt,"){",yt,".bindFramebuffer(",Uu,",",Gt,".framebuffer);"),wn&&Ee(lt,".drawBuffersWEBGL(",it,"[",Gt,".colorAttachments.length]);"),Ee("}else{",yt,".bindFramebuffer(",Uu,",null);"),wn&&Ee(lt,".drawBuffersWEBGL(",Ue,");"),Ee("}",dt,".cur=",Gt,";"),Ot||Ee("}")}function Ko(ze,Ee,ut){var Ot=ze.shared,sr=Ot.gl,yt=ze.current,dt=ze.next,lt=Ot.current,De=Ot.next,it=ze.cond(lt,".dirty");li.forEach(function(Ue){var Gt=Wn(Ue);if(!(Gt in ut.state)){var Xt,Br;if(Gt in dt){Xt=dt[Gt],Br=yt[Gt];var fn=de(En[Gt].length,function(gn){return it.def(Xt,"[",gn,"]")});it(ze.cond(fn.map(function(gn,un){return gn+"!=="+Br+"["+un+"]"}).join("||")).then(sr,".",Sr[Gt],"(",fn,");",fn.map(function(gn,un){return Br+"["+un+"]="+gn}).join(";"),";"))}else{Xt=it.def(De,".",Gt);var sn=ze.cond(Xt,"!==",lt,".",Gt);it(sn),Gt in Pr?sn(ze.cond(Xt).then(sr,".enable(",Pr[Gt],");").else(sr,".disable(",Pr[Gt],");"),lt,".",Gt,"=",Xt,";"):sn(sr,".",Sr[Gt],"(",Xt,");",lt,".",Gt,"=",Xt,";")}}}),Object.keys(ut.state).length===0&&it(lt,".dirty=false;"),Ee(it)}function wo(ze,Ee,ut,Ot){var sr=ze.shared,yt=ze.current,dt=sr.current,lt=sr.gl;fh(Object.keys(ut)).forEach(function(De){var it=ut[De];if(!(Ot&&!Ot(it))){var Ue=it.append(ze,Ee);if(Pr[De]){var Gt=Pr[De];zo(it)?Ue?Ee(lt,".enable(",Gt,");"):Ee(lt,".disable(",Gt,");"):Ee(ze.cond(Ue).then(lt,".enable(",Gt,");").else(lt,".disable(",Gt,");")),Ee(dt,".",De,"=",Ue,";")}else if(so(Ue)){var Xt=yt[De];Ee(lt,".",Sr[De],"(",Ue,");",Ue.map(function(Br,fn){return Xt+"["+fn+"]="+Br}).join(";"),";")}else Ee(lt,".",Sr[De],"(",Ue,");",dt,".",De,"=",Ue,";")}})}function Zo(ze,Ee){Yr&&(ze.instancing=Ee.def(ze.shared.extensions,".angle_instanced_arrays"))}function Wi(ze,Ee,ut,Ot,sr){var yt=ze.shared,dt=ze.stats,lt=yt.current,De=yt.timer,it=ut.profile;function Ue(){var On=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return On||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Gt,Xt;function Br(On){Gt=Ee.def(),On(Gt,"=",Ue(),";"),typeof sr=="string"?On(dt,".count+=",sr,";"):On(dt,".count++;"),Wr&&(Ot?(Xt=Ee.def(),On(Xt,"=",De,".getNumPendingQueries();")):On(De,".beginQuery(",dt,");"))}function fn(On){On(dt,".cpuTime+=",Ue(),"-",Gt,";"),Wr&&(Ot?On(De,".pushScopeStats(",Xt,",",De,".getNumPendingQueries(),",dt,");"):On(De,".endQuery();"))}function sn(On){var jn=Ee.def(lt,".profile");Ee(lt,".profile=",On,";"),Ee.exit(lt,".profile=",jn,";")}var gn;if(it){if(zo(it)){it.enable?(Br(Ee),fn(Ee.exit),sn("true")):sn("false");return}gn=it.append(ze,Ee),sn(gn)}else gn=Ee.def(lt,".profile");var un=ze.block();Br(un),Ee("if(",gn,"){",un,"}");var Yn=ze.block();fn(Yn),Ee.exit("if(",gn,"){",Yn,"}")}function $o(ze,Ee,ut,Ot,sr){var yt=ze.shared;function dt(De){switch(De){case Ff:case nf:case mf:return 2;case Bf:case sh:case yf:return 3;case gl:case wc:case gf:return 4;default:return 1}}function lt(De,it,Ue){var Gt=yt.gl,Xt=Ee.def(De,".location"),Br=Ee.def(yt.attributes,"[",Xt,"]"),fn=Ue.state,sn=Ue.buffer,gn=[Ue.x,Ue.y,Ue.z,Ue.w],un=["buffer","normalized","offset","stride"];function Yn(){Ee("if(!",Br,".buffer){",Gt,".enableVertexAttribArray(",Xt,");}");var jn=Ue.type,Vn;if(Ue.size?Vn=Ee.def(Ue.size,"||",it):Vn=it,Ee("if(",Br,".type!==",jn,"||",Br,".size!==",Vn,"||",un.map(function(hi){return Br+"."+hi+"!=="+Ue[hi]}).join("||"),"){",Gt,".bindBuffer(",vf,",",sn,".buffer);",Gt,".vertexAttribPointer(",[Xt,Vn,jn,Ue.normalized,Ue.stride,Ue.offset],");",Br,".type=",jn,";",Br,".size=",Vn,";",un.map(function(hi){return Br+"."+hi+"="+Ue[hi]+";"}).join(""),"}"),Yr){var Gn=Ue.divisor;Ee("if(",Br,".divisor!==",Gn,"){",ze.instancing,".vertexAttribDivisorANGLE(",[Xt,Gn],");",Br,".divisor=",Gn,";}")}}function On(){Ee("if(",Br,".buffer){",Gt,".disableVertexAttribArray(",Xt,");",Br,".buffer=null;","}if(",_i.map(function(jn,Vn){return Br+"."+jn+"!=="+gn[Vn]}).join("||"),"){",Gt,".vertexAttrib4f(",Xt,",",gn,");",_i.map(function(jn,Vn){return Br+"."+jn+"="+gn[Vn]+";"}).join(""),"}")}fn===q?Yn():fn===te?On():(Ee("if(",fn,"===",q,"){"),Yn(),Ee("}else{"),On(),Ee("}"))}Ot.forEach(function(De){var it=De.name,Ue=ut.attributes[it],Gt;if(Ue){if(!sr(Ue))return;Gt=Ue.append(ze,Ee)}else{if(!sr(hh))return;var Xt=ze.scopeAttrib(it);ne.optional(function(){ze.assert(Ee,Xt+".state","missing attribute "+it)}),Gt={},Object.keys(new Bt).forEach(function(Br){Gt[Br]=Ee.def(Xt,".",Br)})}lt(ze.link(De),dt(De.info.type),Gt)})}function Ea(ze,Ee,ut,Ot,sr,yt){for(var dt=ze.shared,lt=dt.gl,De,it=0;it<Ot.length;++it){var Ue=Ot[it],Gt=Ue.name,Xt=Ue.info.type,Br=ut.uniforms[Gt],fn=ze.link(Ue),sn=fn+".location",gn;if(Br){if(!sr(Br))continue;if(zo(Br)){var un=Br.value;if(ne.command(un!==null&&typeof un!="undefined",'missing uniform "'+Gt+'"',ze.commandStr),Xt===zf||Xt===xf){ne.command(typeof un=="function"&&(Xt===zf&&(un._reglType==="texture2d"||un._reglType==="framebuffer")||Xt===xf&&(un._reglType==="textureCube"||un._reglType==="framebufferCube")),"invalid texture for uniform "+Gt,ze.commandStr);var Yn=ze.link(un._texture||un.color[0]._texture);Ee(lt,".uniform1i(",sn,",",Yn+".bind());"),Ee.exit(Yn,".unbind();")}else if(Xt===kl||Xt===Su||Xt===_f){ne.optional(function(){ne.command(so(un),"invalid matrix for uniform "+Gt,ze.commandStr),ne.command(Xt===kl&&un.length===4||Xt===Su&&un.length===9||Xt===_f&&un.length===16,"invalid length for matrix uniform "+Gt,ze.commandStr)});var On=ze.global.def("new Float32Array(["+Array.prototype.slice.call(un)+"])"),jn=2;Xt===Su?jn=3:Xt===_f&&(jn=4),Ee(lt,".uniformMatrix",jn,"fv(",sn,",false,",On,");")}else{switch(Xt){case rf:ne.commandType(un,"number","uniform "+Gt,ze.commandStr),De="1f";break;case Ff:ne.command(so(un)&&un.length===2,"uniform "+Gt,ze.commandStr),De="2f";break;case Bf:ne.command(so(un)&&un.length===3,"uniform "+Gt,ze.commandStr),De="3f";break;case gl:ne.command(so(un)&&un.length===4,"uniform "+Gt,ze.commandStr),De="4f";break;case Uh:ne.commandType(un,"boolean","uniform "+Gt,ze.commandStr),De="1i";break;case Nf:ne.commandType(un,"number","uniform "+Gt,ze.commandStr),De="1i";break;case mf:ne.command(so(un)&&un.length===2,"uniform "+Gt,ze.commandStr),De="2i";break;case nf:ne.command(so(un)&&un.length===2,"uniform "+Gt,ze.commandStr),De="2i";break;case yf:ne.command(so(un)&&un.length===3,"uniform "+Gt,ze.commandStr),De="3i";break;case sh:ne.command(so(un)&&un.length===3,"uniform "+Gt,ze.commandStr),De="3i";break;case gf:ne.command(so(un)&&un.length===4,"uniform "+Gt,ze.commandStr),De="4i";break;case wc:ne.command(so(un)&&un.length===4,"uniform "+Gt,ze.commandStr),De="4i";break}Ee(lt,".uniform",De,"(",sn,",",so(un)?Array.prototype.slice.call(un):un,");")}continue}else gn=Br.append(ze,Ee)}else{if(!sr(hh))continue;gn=Ee.def(dt.uniforms,"[",Oe.id(Gt),"]")}Xt===zf?(ne(!Array.isArray(gn),"must specify a scalar prop for textures"),Ee("if(",gn,"&&",gn,'._reglType==="framebuffer"){',gn,"=",gn,".color[0];","}")):Xt===xf&&(ne(!Array.isArray(gn),"must specify a scalar prop for cube maps"),Ee("if(",gn,"&&",gn,'._reglType==="framebufferCube"){',gn,"=",gn,".color[0];","}")),ne.optional(function(){function Ss(rl,Zf){ze.assert(Ee,rl,'bad data or missing for uniform "'+Gt+'".  '+Zf)}function Zu(rl){ne(!Array.isArray(gn),"must not specify an array type for uniform"),Ss("typeof "+gn+'==="'+rl+'"',"invalid type, expected "+rl)}function Eu(rl,Zf){Array.isArray(gn)?ne(gn.length===rl,"must have length "+rl):Ss(dt.isArrayLike+"("+gn+")&&"+gn+".length==="+rl,"invalid vector, should have length "+rl,ze.commandStr)}function vh(rl){ne(!Array.isArray(gn),"must not specify a value type"),Ss("typeof "+gn+'==="function"&&'+gn+'._reglType==="texture'+(rl===ih?"2d":"Cube")+'"',"invalid texture type",ze.commandStr)}switch(Xt){case Nf:Zu("number");break;case nf:Eu(2,"number");break;case sh:Eu(3,"number");break;case wc:Eu(4,"number");break;case rf:Zu("number");break;case Ff:Eu(2,"number");break;case Bf:Eu(3,"number");break;case gl:Eu(4,"number");break;case Uh:Zu("boolean");break;case mf:Eu(2,"boolean");break;case yf:Eu(3,"boolean");break;case gf:Eu(4,"boolean");break;case kl:Eu(4,"number");break;case Su:Eu(9,"number");break;case _f:Eu(16,"number");break;case zf:vh(ih);break;case xf:vh(Fh);break}});var Vn=1;switch(Xt){case zf:case xf:var Gn=Ee.def(gn,"._texture");Ee(lt,".uniform1i(",sn,",",Gn,".bind());"),Ee.exit(Gn,".unbind();");continue;case Nf:case Uh:De="1i";break;case nf:case mf:De="2i",Vn=2;break;case sh:case yf:De="3i",Vn=3;break;case wc:case gf:De="4i",Vn=4;break;case rf:De="1f";break;case Ff:De="2f",Vn=2;break;case Bf:De="3f",Vn=3;break;case gl:De="4f",Vn=4;break;case kl:De="Matrix2fv";break;case Su:De="Matrix3fv";break;case _f:De="Matrix4fv";break}if(De.charAt(0)==="M"){Ee(lt,".uniform",De,"(",sn,",");var hi=Math.pow(Xt-kl+2,2),Xa=ze.global.def("new Float32Array(",hi,")");Array.isArray(gn)?Ee("false,(",de(hi,function(Ss){return Xa+"["+Ss+"]="+gn[Ss]}),",",Xa,")"):Ee("false,(Array.isArray(",gn,")||",gn," instanceof Float32Array)?",gn,":(",de(hi,function(Ss){return Xa+"["+Ss+"]="+gn+"["+Ss+"]"}),",",Xa,")"),Ee(");")}else if(Vn>1){for(var Bo=[],bl=[],Ja=0;Ja<Vn;++Ja)Array.isArray(gn)?bl.push(gn[Ja]):bl.push(Ee.def(gn+"["+Ja+"]")),yt&&Bo.push(Ee.def());yt&&Ee("if(!",ze.batchId,"||",Bo.map(function(Ss,Zu){return Ss+"!=="+bl[Zu]}).join("||"),"){",Bo.map(function(Ss,Zu){return Ss+"="+bl[Zu]+";"}).join("")),Ee(lt,".uniform",De,"(",sn,",",bl.join(","),");"),yt&&Ee("}")}else{if(ne(!Array.isArray(gn),"uniform value must not be an array"),yt){var La=Ee.def();Ee("if(!",ze.batchId,"||",La,"!==",gn,"){",La,"=",gn,";")}Ee(lt,".uniform",De,"(",sn,",",gn,");"),yt&&Ee("}")}}}function no(ze,Ee,ut,Ot){var sr=ze.shared,yt=sr.gl,dt=sr.draw,lt=Ot.draw;function De(){var Vn=lt.elements,Gn,hi=Ee;return Vn?((Vn.contextDep&&Ot.contextDynamic||Vn.propDep)&&(hi=ut),Gn=Vn.append(ze,hi),lt.elementsActive&&hi("if("+Gn+")"+yt+".bindBuffer("+kh+","+Gn+".buffer.buffer);")):(Gn=hi.def(),hi(Gn,"=",dt,".",yl,";","if(",Gn,"){",yt,".bindBuffer(",kh,",",Gn,".buffer.buffer);}","else if(",sr.vao,".currentVAO){",Gn,"=",ze.shared.elements+".getElements("+sr.vao,".currentVAO.elements);",Ar?"":"if("+Gn+")"+yt+".bindBuffer("+kh+","+Gn+".buffer.buffer);","}")),Gn}function it(){var Vn=lt.count,Gn,hi=Ee;return Vn?((Vn.contextDep&&Ot.contextDynamic||Vn.propDep)&&(hi=ut),Gn=Vn.append(ze,hi),ne.optional(function(){Vn.MISSING&&ze.assert(Ee,"false","missing vertex count"),Vn.DYNAMIC&&ze.assert(hi,Gn+">=0","missing vertex count")})):(Gn=hi.def(dt,".",Ao),ne.optional(function(){ze.assert(hi,Gn+">=0","missing vertex count")})),Gn}var Ue=De();function Gt(Vn){var Gn=lt[Vn];return Gn?Gn.contextDep&&Ot.contextDynamic||Gn.propDep?Gn.append(ze,ut):Gn.append(ze,Ee):Ee.def(dt,".",Vn)}var Xt=Gt(hu),Br=Gt(Qc),fn=it();if(typeof fn=="number"){if(fn===0)return}else ut("if(",fn,"){"),ut.exit("}");var sn,gn;Yr&&(sn=Gt(qc),gn=ze.instancing);var un=Ue+".type",Yn=lt.elements&&zo(lt.elements)&&!lt.vaoActive;function On(){function Vn(){ut(gn,".drawElementsInstancedANGLE(",[Xt,fn,un,Br+"<<(("+un+"-"+Zi+")>>1)",sn],");")}function Gn(){ut(gn,".drawArraysInstancedANGLE(",[Xt,Br,fn,sn],");")}Ue&&Ue!=="null"?Yn?Vn():(ut("if(",Ue,"){"),Vn(),ut("}else{"),Gn(),ut("}")):Gn()}function jn(){function Vn(){ut(yt+".drawElements("+[Xt,fn,un,Br+"<<(("+un+"-"+Zi+")>>1)"]+");")}function Gn(){ut(yt+".drawArrays("+[Xt,Br,fn]+");")}Ue&&Ue!=="null"?Yn?Vn():(ut("if(",Ue,"){"),Vn(),ut("}else{"),Gn(),ut("}")):Gn()}Yr&&(typeof sn!="number"||sn>=0)?typeof sn=="string"?(ut("if(",sn,">0){"),On(),ut("}else if(",sn,"<0){"),jn(),ut("}")):On():jn()}function di(ze,Ee,ut,Ot,sr){var yt=Ii(),dt=yt.proc("body",sr);return ne.optional(function(){yt.commandStr=Ee.commandStr,yt.command=yt.link(Ee.commandStr)}),Yr&&(yt.instancing=dt.def(yt.shared.extensions,".angle_instanced_arrays")),ze(yt,dt,ut,Ot),yt.compile().body}function la(ze,Ee,ut,Ot){Zo(ze,Ee),ut.useVAO?ut.drawVAO?Ee(ze.shared.vao,".setVAO(",ut.drawVAO.append(ze,Ee),");"):Ee(ze.shared.vao,".setVAO(",ze.shared.vao,".targetVAO);"):(Ee(ze.shared.vao,".setVAO(null);"),$o(ze,Ee,ut,Ot.attributes,function(){return!0})),Ea(ze,Ee,ut,Ot.uniforms,function(){return!0},!1),no(ze,Ee,Ee,ut)}function Wa(ze,Ee){var ut=ze.proc("draw",1);Zo(ze,ut),Uo(ze,ut,Ee.context),us(ze,ut,Ee.framebuffer),Ko(ze,ut,Ee),wo(ze,ut,Ee.state),Wi(ze,ut,Ee,!1,!0);var Ot=Ee.shader.progVar.append(ze,ut);if(ut(ze.shared.gl,".useProgram(",Ot,".program);"),Ee.shader.program)la(ze,ut,Ee,Ee.shader.program);else{ut(ze.shared.vao,".setVAO(null);");var sr=ze.global.def("{}"),yt=ut.def(Ot,".id"),dt=ut.def(sr,"[",yt,"]");ut(ze.cond(dt).then(dt,".call(this,a0);").else(dt,"=",sr,"[",yt,"]=",ze.link(function(lt){return di(la,ze,Ee,lt,1)}),"(",Ot,");",dt,".call(this,a0);"))}Object.keys(Ee.state).length>0&&ut(ze.shared.current,".dirty=true;"),ze.shared.vao&&ut(ze.shared.vao,".setVAO(null);")}function lo(ze,Ee,ut,Ot){ze.batchId="a1",Zo(ze,Ee);function sr(){return!0}$o(ze,Ee,ut,Ot.attributes,sr),Ea(ze,Ee,ut,Ot.uniforms,sr,!1),no(ze,Ee,Ee,ut)}function tl(ze,Ee,ut,Ot){Zo(ze,Ee);var sr=ut.contextDep,yt=Ee.def(),dt="a0",lt="a1",De=Ee.def();ze.shared.props=De,ze.batchId=yt;var it=ze.scope(),Ue=ze.scope();Ee(it.entry,"for(",yt,"=0;",yt,"<",lt,";++",yt,"){",De,"=",dt,"[",yt,"];",Ue,"}",it.exit);function Gt(un){return un.contextDep&&sr||un.propDep}function Xt(un){return!Gt(un)}if(ut.needsContext&&Uo(ze,Ue,ut.context),ut.needsFramebuffer&&us(ze,Ue,ut.framebuffer),wo(ze,Ue,ut.state,Gt),ut.profile&&Gt(ut.profile)&&Wi(ze,Ue,ut,!1,!0),Ot)ut.useVAO?ut.drawVAO?Gt(ut.drawVAO)?Ue(ze.shared.vao,".setVAO(",ut.drawVAO.append(ze,Ue),");"):it(ze.shared.vao,".setVAO(",ut.drawVAO.append(ze,it),");"):it(ze.shared.vao,".setVAO(",ze.shared.vao,".targetVAO);"):(it(ze.shared.vao,".setVAO(null);"),$o(ze,it,ut,Ot.attributes,Xt),$o(ze,Ue,ut,Ot.attributes,Gt)),Ea(ze,it,ut,Ot.uniforms,Xt,!1),Ea(ze,Ue,ut,Ot.uniforms,Gt,!0),no(ze,it,Ue,ut);else{var Br=ze.global.def("{}"),fn=ut.shader.progVar.append(ze,Ue),sn=Ue.def(fn,".id"),gn=Ue.def(Br,"[",sn,"]");Ue(ze.shared.gl,".useProgram(",fn,".program);","if(!",gn,"){",gn,"=",Br,"[",sn,"]=",ze.link(function(un){return di(lo,ze,ut,un,2)}),"(",fn,");}",gn,".call(this,a0[",yt,"],",yt,");")}}function Ye(ze,Ee){var ut=ze.proc("batch",2);ze.batchId="0",Zo(ze,ut);var Ot=!1,sr=!0;Object.keys(Ee.context).forEach(function(Br){Ot=Ot||Ee.context[Br].propDep}),Ot||(Uo(ze,ut,Ee.context),sr=!1);var yt=Ee.framebuffer,dt=!1;yt?(yt.propDep?Ot=dt=!0:yt.contextDep&&Ot&&(dt=!0),dt||us(ze,ut,yt)):us(ze,ut,null),Ee.state.viewport&&Ee.state.viewport.propDep&&(Ot=!0);function lt(Br){return Br.contextDep&&Ot||Br.propDep}Ko(ze,ut,Ee),wo(ze,ut,Ee.state,function(Br){return!lt(Br)}),(!Ee.profile||!lt(Ee.profile))&&Wi(ze,ut,Ee,!1,"a1"),Ee.contextDep=Ot,Ee.needsContext=sr,Ee.needsFramebuffer=dt;var De=Ee.shader.progVar;if(De.contextDep&&Ot||De.propDep)tl(ze,ut,Ee,null);else{var it=De.append(ze,ut);if(ut(ze.shared.gl,".useProgram(",it,".program);"),Ee.shader.program)tl(ze,ut,Ee,Ee.shader.program);else{ut(ze.shared.vao,".setVAO(null);");var Ue=ze.global.def("{}"),Gt=ut.def(it,".id"),Xt=ut.def(Ue,"[",Gt,"]");ut(ze.cond(Xt).then(Xt,".call(this,a0,a1);").else(Xt,"=",Ue,"[",Gt,"]=",ze.link(function(Br){return di(tl,ze,Ee,Br,2)}),"(",it,");",Xt,".call(this,a0,a1);"))}}Object.keys(Ee.state).length>0&&ut(ze.shared.current,".dirty=true;"),ze.shared.vao&&ut(ze.shared.vao,".setVAO(null);")}function dr(ze,Ee){var ut=ze.proc("scope",3);ze.batchId="a2";var Ot=ze.shared,sr=Ot.current;Uo(ze,ut,Ee.context),Ee.framebuffer&&Ee.framebuffer.append(ze,ut),fh(Object.keys(Ee.state)).forEach(function(dt){var lt=Ee.state[dt],De=lt.append(ze,ut);so(De)?De.forEach(function(it,Ue){ut.set(ze.next[dt],"["+Ue+"]",it)}):ut.set(Ot.next,"."+dt,De)}),Wi(ze,ut,Ee,!0,!0),[yl,Qc,Ao,qc,hu].forEach(function(dt){var lt=Ee.draw[dt];!lt||ut.set(Ot.draw,"."+dt,""+lt.append(ze,ut))}),Object.keys(Ee.uniforms).forEach(function(dt){var lt=Ee.uniforms[dt].append(ze,ut);Array.isArray(lt)&&(lt="["+lt.join()+"]"),ut.set(Ot.uniforms,"["+Oe.id(dt)+"]",lt)}),Object.keys(Ee.attributes).forEach(function(dt){var lt=Ee.attributes[dt].append(ze,ut),De=ze.scopeAttrib(dt);Object.keys(new Bt).forEach(function(it){ut.set(De,"."+it,lt[it])})}),Ee.scopeVAO&&ut.set(Ot.vao,".targetVAO",Ee.scopeVAO.append(ze,ut));function yt(dt){var lt=Ee.shader[dt];lt&&ut.set(Ot.shader,"."+dt,lt.append(ze,ut))}yt(Gs),yt(ml),Object.keys(Ee.state).length>0&&(ut(sr,".dirty=true;"),ut.exit(sr,".dirty=true;")),ut("a1(",ze.shared.context,",a0,",ze.batchId,");")}function er(ze){if(!(typeof ze!="object"||so(ze))){for(var Ee=Object.keys(ze),ut=0;ut<Ee.length;++ut)if(wr.isDynamic(ze[Ee[ut]]))return!0;return!1}}function Bn(ze,Ee,ut){var Ot=Ee.static[ut];if(!Ot||!er(Ot))return;var sr=ze.global,yt=Object.keys(Ot),dt=!1,lt=!1,De=!1,it=ze.global.def("{}");yt.forEach(function(Gt){var Xt=Ot[Gt];if(wr.isDynamic(Xt)){typeof Xt=="function"&&(Xt=Ot[Gt]=wr.unbox(Xt));var Br=pu(Xt,null);dt=dt||Br.thisDep,De=De||Br.propDep,lt=lt||Br.contextDep}else{switch(sr(it,".",Gt,"="),typeof Xt){case"number":sr(Xt);break;case"string":sr('"',Xt,'"');break;case"object":Array.isArray(Xt)&&sr("[",Xt.join(),"]");break;default:sr(ze.link(Xt));break}sr(";")}});function Ue(Gt,Xt){yt.forEach(function(Br){var fn=Ot[Br];if(!!wr.isDynamic(fn)){var sn=Gt.invoke(Xt,fn);Xt(it,".",Br,"=",sn,";")}})}Ee.dynamic[ut]=new wr.DynamicVariable(ft,{thisDep:dt,contextDep:lt,propDep:De,ref:it,append:Ue}),delete Ee.static[ut]}function ca(ze,Ee,ut,Ot,sr){var yt=Ii();yt.stats=yt.link(sr),Object.keys(Ee.static).forEach(function(lt){Bn(yt,Ee,lt)}),Vp.forEach(function(lt){Bn(yt,ze,lt)});var dt=ys(ze,Ee,ut,Ot,yt);return Wa(yt,dt),dr(yt,dt),Ye(yt,dt),p(yt.compile(),{destroy:function(){dt.shader.program.destroy()}})}return{next:qr,current:En,procs:function(){var ze=Ii(),Ee=ze.proc("poll"),ut=ze.proc("refresh"),Ot=ze.block();Ee(Ot),ut(Ot);var sr=ze.shared,yt=sr.gl,dt=sr.next,lt=sr.current;Ot(lt,".dirty=false;"),us(ze,Ee),us(ze,ut,null,!0);var De;Yr&&(De=ze.link(Yr)),qe.oes_vertex_array_object&&ut(ze.link(qe.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var it=0;it<lr.maxAttributes;++it){var Ue=ut.def(sr.attributes,"[",it,"]"),Gt=ze.cond(Ue,".buffer");Gt.then(yt,".enableVertexAttribArray(",it,");",yt,".bindBuffer(",vf,",",Ue,".buffer.buffer);",yt,".vertexAttribPointer(",it,",",Ue,".size,",Ue,".type,",Ue,".normalized,",Ue,".stride,",Ue,".offset);").else(yt,".disableVertexAttribArray(",it,");",yt,".vertexAttrib4f(",it,",",Ue,".x,",Ue,".y,",Ue,".z,",Ue,".w);",Ue,".buffer=null;"),ut(Gt),Yr&&ut(De,".vertexAttribDivisorANGLE(",it,",",Ue,".divisor);")}return ut(ze.shared.vao,".currentVAO=null;",ze.shared.vao,".setVAO(",ze.shared.vao,".targetVAO);"),Object.keys(Pr).forEach(function(Xt){var Br=Pr[Xt],fn=Ot.def(dt,".",Xt),sn=ze.block();sn("if(",fn,"){",yt,".enable(",Br,")}else{",yt,".disable(",Br,")}",lt,".",Xt,"=",fn,";"),ut(sn),Ee("if(",fn,"!==",lt,".",Xt,"){",sn,"}")}),Object.keys(Sr).forEach(function(Xt){var Br=Sr[Xt],fn=En[Xt],sn,gn,un=ze.block();if(un(yt,".",Br,"("),so(fn)){var Yn=fn.length;sn=ze.global.def(dt,".",Xt),gn=ze.global.def(lt,".",Xt),un(de(Yn,function(On){return sn+"["+On+"]"}),");",de(Yn,function(On){return gn+"["+On+"]="+sn+"["+On+"];"}).join("")),Ee("if(",de(Yn,function(On){return sn+"["+On+"]!=="+gn+"["+On+"]"}).join("||"),"){",un,"}")}else sn=Ot.def(dt,".",Xt),gn=Ot.def(lt,".",Xt),un(sn,");",lt,".",Xt,"=",sn,";"),Ee("if(",sn,"!==",gn,"){",un,"}");ut(un)}),ze.compile()}(),compile:ca}}function Xh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Yh=34918,ph=34919,Kh=35007,$h=function(X,Oe){if(!Oe.ext_disjoint_timer_query)return null;var qe=[];function lr(){return qe.pop()||Oe.ext_disjoint_timer_query.createQueryEXT()}function Ir(Yr){qe.push(Yr)}var or=[];function Cr(Yr){var wn=lr();Oe.ext_disjoint_timer_query.beginQueryEXT(Kh,wn),or.push(wn),Wr(or.length-1,or.length,Yr)}function Nr(){Oe.ext_disjoint_timer_query.endQueryEXT(Kh)}function Hr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Kr=[];function Jr(){return Kr.pop()||new Hr}function rn(Yr){Kr.push(Yr)}var dn=[];function Wr(Yr,wn,Ar){var En=Jr();En.startQueryIndex=Yr,En.endQueryIndex=wn,En.sum=0,En.stats=Ar,dn.push(En)}var en=[],Bt=[];function yr(){var Yr,wn,Ar=or.length;if(Ar!==0){Bt.length=Math.max(Bt.length,Ar+1),en.length=Math.max(en.length,Ar+1),en[0]=0,Bt[0]=0;var En=0;for(Yr=0,wn=0;wn<or.length;++wn){var qr=or[wn];Oe.ext_disjoint_timer_query.getQueryObjectEXT(qr,ph)?(En+=Oe.ext_disjoint_timer_query.getQueryObjectEXT(qr,Yh),Ir(qr)):or[Yr++]=qr,en[wn+1]=En,Bt[wn+1]=Yr}for(or.length=Yr,Yr=0,wn=0;wn<dn.length;++wn){var li=dn[wn],Pr=li.startQueryIndex,Sr=li.endQueryIndex;li.sum+=en[Sr]-en[Pr];var Wn=Bt[Pr],hn=Bt[Sr];hn===Wn?(li.stats.gpuTime+=li.sum/1e6,rn(li)):(li.startQueryIndex=Wn,li.endQueryIndex=hn,dn[Yr++]=li)}dn.length=Yr}}return{beginQuery:Cr,endQuery:Nr,pushScopeStats:Wr,update:yr,getNumPendingQueries:function(){return or.length},clear:function(){qe.push.apply(qe,or);for(var Yr=0;Yr<qe.length;Yr++)Oe.ext_disjoint_timer_query.deleteQueryEXT(qe[Yr]);or.length=0,qe.length=0},restore:function(){or.length=0,qe.length=0}}},Ep=16384,Cp=256,Cf=1024,Jh=34962,Ac="webglcontextlost",wf="webglcontextrestored",$a=1,Qh=2,ac=3;function Pc(X,Oe){for(var qe=0;qe<X.length;++qe)if(X[qe]===Oe)return qe;return-1}function dh(X){var Oe=j(X);if(!Oe)return null;var qe=Oe.gl,lr=qe.getContextAttributes(),Ir=qe.isContextLost(),or=se(qe,Oe);if(!or)return null;var Cr=Hi(),Nr=Xh(),Hr=or.extensions,Kr=$h(qe,Hr),Jr=bi(),rn=qe.drawingBufferWidth,dn=qe.drawingBufferHeight,Wr={tick:0,time:0,viewportWidth:rn,viewportHeight:dn,framebufferWidth:rn,framebufferHeight:dn,drawingBufferWidth:rn,drawingBufferHeight:dn,pixelRatio:Oe.pixelRatio},en={},Bt={elements:null,primitive:4,count:-1,offset:0,instances:-1},yr=Ne(qe,Hr),Yr=W(qe,Nr,Oe,En),wn=Ns(qe,Hr,Yr,Nr),Ar=wt(qe,Hr,yr,Nr,Yr,wn,Bt);function En(di){return Ar.destroyBuffer(di)}var qr=zr(qe,Cr,Nr,Oe),li=uu(qe,Hr,yr,function(){Wn.procs.poll()},Wr,Nr,Oe),Pr=Bc(qe,Hr,yr,Nr,Oe),Sr=Ie(qe,Hr,yr,li,Pr,Nr),Wn=Wh(qe,Cr,Hr,yr,Yr,wn,li,Sr,en,Ar,qr,Bt,Wr,Kr,Oe),hn=fi(qe,Sr,Wn.procs.poll,Wr,lr,Hr,yr),$r=Wn.next,yn=qe.canvas,bn=[],Ri=[],Ii=[],An=[Oe.onDestroy],Tn=null;function Ei(){if(bn.length===0){Kr&&Kr.update(),Tn=null;return}Tn=Dn.next(Ei),Zo();for(var di=bn.length-1;di>=0;--di){var la=bn[di];la&&la(Wr,null,0)}qe.flush(),Kr&&Kr.update()}function Bi(){!Tn&&bn.length>0&&(Tn=Dn.next(Ei))}function Fi(){Tn&&(Dn.cancel(Ei),Tn=null)}function po(di){di.preventDefault(),Ir=!0,Fi(),Ri.forEach(function(la){la()})}function Co(di){qe.getError(),Ir=!1,or.restore(),qr.restore(),Yr.restore(),li.restore(),Pr.restore(),Sr.restore(),Ar.restore(),Kr&&Kr.restore(),Wn.procs.refresh(),Bi(),Ii.forEach(function(la){la()})}var oa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!oa&&yn&&(yn.addEventListener(Ac,po,!1),yn.addEventListener(wf,Co,!1));function Os(){bn.length=0,Fi(),!oa&&yn&&(yn.removeEventListener(Ac,po),yn.removeEventListener(wf,Co)),qr.clear(),Sr.clear(),Pr.clear(),Ar.clear(),li.clear(),wn.clear(),Yr.clear(),Kr&&Kr.clear(),An.forEach(function(di){di()})}function uo(di){ne(!!di,"invalid args to regl({...})"),ne.type(di,"object","invalid args to regl({...})");function la(yt){var dt=p({},yt);delete dt.uniforms,delete dt.attributes,delete dt.context,delete dt.vao,"stencil"in dt&&dt.stencil.op&&(dt.stencil.opBack=dt.stencil.opFront=dt.stencil.op,delete dt.stencil.op);function lt(De){if(De in dt){var it=dt[De];delete dt[De],Object.keys(it).forEach(function(Ue){dt[De+"."+Ue]=it[Ue]})}}return lt("blend"),lt("depth"),lt("cull"),lt("stencil"),lt("polygonOffset"),lt("scissor"),lt("sample"),"vao"in yt&&(dt.vao=yt.vao),dt}function Wa(yt,dt){var lt={},De={};return Object.keys(yt).forEach(function(it){var Ue=yt[it];if(wr.isDynamic(Ue)){De[it]=wr.unbox(Ue,it);return}else if(dt&&Array.isArray(Ue)){for(var Gt=0;Gt<Ue.length;++Gt)if(wr.isDynamic(Ue[Gt])){De[it]=wr.unbox(Ue,it);return}}lt[it]=Ue}),{dynamic:De,static:lt}}var lo=Wa(di.context||{},!0),tl=Wa(di.uniforms||{},!0),Ye=Wa(di.attributes||{},!1),dr=Wa(la(di),!1),er={gpuTime:0,cpuTime:0,count:0},Bn=Wn.compile(dr,Ye,tl,lo,er),ca=Bn.draw,ze=Bn.batch,Ee=Bn.scope,ut=[];function Ot(yt){for(;ut.length<yt;)ut.push(null);return ut}function sr(yt,dt){var lt;if(Ir&&ne.raise("context lost"),typeof yt=="function")return Ee.call(this,null,yt,0);if(typeof dt=="function")if(typeof yt=="number")for(lt=0;lt<yt;++lt)Ee.call(this,null,dt,lt);else if(Array.isArray(yt))for(lt=0;lt<yt.length;++lt)Ee.call(this,yt[lt],dt,lt);else return Ee.call(this,yt,dt,0);else if(typeof yt=="number"){if(yt>0)return ze.call(this,Ot(yt|0),yt|0)}else if(Array.isArray(yt)){if(yt.length)return ze.call(this,yt,yt.length)}else return ca.call(this,yt)}return p(sr,{stats:er,destroy:function(){Bn.destroy()}})}var ys=Sr.setFBO=uo({framebuffer:wr.define.call(null,$a,"framebuffer")});function Uo(di,la){var Wa=0;Wn.procs.poll();var lo=la.color;lo&&(qe.clearColor(+lo[0]||0,+lo[1]||0,+lo[2]||0,+lo[3]||0),Wa|=Ep),"depth"in la&&(qe.clearDepth(+la.depth),Wa|=Cp),"stencil"in la&&(qe.clearStencil(la.stencil|0),Wa|=Cf),ne(!!Wa,"called regl.clear with no buffer specified"),qe.clear(Wa)}function us(di){if(ne(typeof di=="object"&&di,"regl.clear() takes an object as input"),"framebuffer"in di)if(di.framebuffer&&di.framebuffer_reglType==="framebufferCube")for(var la=0;la<6;++la)ys(p({framebuffer:di.framebuffer.faces[la]},di),Uo);else ys(di,Uo);else Uo(null,di)}function Ko(di){ne.type(di,"function","regl.frame() callback must be a function"),bn.push(di);function la(){var Wa=Pc(bn,di);ne(Wa>=0,"cannot cancel a frame twice");function lo(){var tl=Pc(bn,lo);bn[tl]=bn[bn.length-1],bn.length-=1,bn.length<=0&&Fi()}bn[Wa]=lo}return Bi(),{cancel:la}}function wo(){var di=$r.viewport,la=$r.scissor_box;di[0]=di[1]=la[0]=la[1]=0,Wr.viewportWidth=Wr.framebufferWidth=Wr.drawingBufferWidth=di[2]=la[2]=qe.drawingBufferWidth,Wr.viewportHeight=Wr.framebufferHeight=Wr.drawingBufferHeight=di[3]=la[3]=qe.drawingBufferHeight}function Zo(){Wr.tick+=1,Wr.time=$o(),wo(),Wn.procs.poll()}function Wi(){li.refresh(),wo(),Wn.procs.refresh(),Kr&&Kr.update()}function $o(){return(bi()-Jr)/1e3}Wi();function Ea(di,la){ne.type(la,"function","listener callback must be a function");var Wa;switch(di){case"frame":return Ko(la);case"lost":Wa=Ri;break;case"restore":Wa=Ii;break;case"destroy":Wa=An;break;default:ne.raise("invalid event, must be one of frame,lost,restore,destroy")}return Wa.push(la),{cancel:function(){for(var lo=0;lo<Wa.length;++lo)if(Wa[lo]===la){Wa[lo]=Wa[Wa.length-1],Wa.pop();return}}}}var no=p(uo,{clear:us,prop:wr.define.bind(null,$a),context:wr.define.bind(null,Qh),this:wr.define.bind(null,ac),draw:uo({}),buffer:function(di){return Yr.create(di,Jh,!1,!1)},elements:function(di){return wn.create(di,!1)},texture:li.create2D,cube:li.createCube,renderbuffer:Pr.create,framebuffer:Sr.create,framebufferCube:Sr.createCube,vao:Ar.createVAO,attributes:lr,frame:Ko,on:Ea,limits:yr,hasExtension:function(di){return yr.extensions.indexOf(di.toLowerCase())>=0},read:hn,destroy:Os,_gl:qe,_refresh:Wi,poll:function(){Zo(),Kr&&Kr.update()},now:$o,stats:Nr});return Oe.onDone(null,no),no}return dh})},58380:function(Qe){function D(g,U,b){switch(b.length){case 0:return g.call(U);case 1:return g.call(U,b[0]);case 2:return g.call(U,b[0],b[1]);case 3:return g.call(U,b[0],b[1],b[2])}return g.apply(U,b)}Qe.exports=D},77412:function(Qe){function D(g,U){for(var b=-1,p=g==null?0:g.length;++b<p&&U(g[b],b,g)!==!1;);return g}Qe.exports=D},47443:function(Qe,D,g){var U=g(42118);function b(p,E){var Z=p==null?0:p.length;return!!Z&&U(p,E,0)>-1}Qe.exports=b},1196:function(Qe){function D(g,U,b){for(var p=-1,E=g==null?0:g.length;++p<E;)if(b(U,g[p]))return!0;return!1}Qe.exports=D},29932:function(Qe){function D(g,U){for(var b=-1,p=g==null?0:g.length,E=Array(p);++b<p;)E[b]=U(g[b],b,g);return E}Qe.exports=D},62663:function(Qe){function D(g,U,b,p){var E=-1,Z=g==null?0:g.length;for(p&&Z&&(b=g[++E]);++E<Z;)b=U(b,g[E],E,g);return b}Qe.exports=D},49029:function(Qe){var D=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function g(U){return U.match(D)||[]}Qe.exports=g},86556:function(Qe,D,g){var U=g(89465),b=g(77813);function p(E,Z,V){(V!==void 0&&!b(E[Z],V)||V===void 0&&!(Z in E))&&U(E,Z,V)}Qe.exports=p},34865:function(Qe,D,g){var U=g(89465),b=g(77813),p=Object.prototype,E=p.hasOwnProperty;function Z(V,H,I){var L=V[H];(!(E.call(V,H)&&b(L,I))||I===void 0&&!(H in V))&&U(V,H,I)}Qe.exports=Z},44037:function(Qe,D,g){var U=g(98363),b=g(3674);function p(E,Z){return E&&U(Z,b(Z),E)}Qe.exports=p},63886:function(Qe,D,g){var U=g(98363),b=g(81704);function p(E,Z){return E&&U(Z,b(Z),E)}Qe.exports=p},89465:function(Qe,D,g){var U=g(38777);function b(p,E,Z){E=="__proto__"&&U?U(p,E,{configurable:!0,enumerable:!0,value:Z,writable:!0}):p[E]=Z}Qe.exports=b},29750:function(Qe){function D(g,U,b){return g===g&&(b!==void 0&&(g=g<=b?g:b),U!==void 0&&(g=g>=U?g:U)),g}Qe.exports=D},85990:function(Qe,D,g){var U=g(46384),b=g(77412),p=g(34865),E=g(44037),Z=g(63886),V=g(64626),H=g(278),I=g(18805),L=g(1911),_e=g(58234),xe=g(46904),Re=g(64160),$e=g(43824),Rt=g(29148),Lt=g(38517),zt=g(1469),St=g(44144),Et=g(56688),at=g(13218),ur=g(72928),ee=g(3674),fr=g(81704),At=1,Je=2,Pt=4,Ve="[object Arguments]",It="[object Array]",hr="[object Boolean]",Jt="[object Date]",Fr="[object Error]",fe="[object Function]",Fe="[object GeneratorFunction]",me="[object Map]",bt="[object Number]",vt="[object Object]",Zt="[object RegExp]",Ut="[object Set]",Rr="[object String]",ln="[object Symbol]",pn="[object WeakMap]",Vi="[object ArrayBuffer]",ar="[object DataView]",pe="[object Float32Array]",Pe="[object Float64Array]",Ge="[object Int8Array]",ke="[object Int16Array]",Ft="[object Int32Array]",ir="[object Uint8Array]",T="[object Uint8ClampedArray]",G="[object Uint16Array]",Se="[object Uint32Array]",Be={};Be[Ve]=Be[It]=Be[Vi]=Be[ar]=Be[hr]=Be[Jt]=Be[pe]=Be[Pe]=Be[Ge]=Be[ke]=Be[Ft]=Be[me]=Be[bt]=Be[vt]=Be[Zt]=Be[Ut]=Be[Rr]=Be[ln]=Be[ir]=Be[T]=Be[G]=Be[Se]=!0,Be[Fr]=Be[fe]=Be[pn]=!1;function et(tt,Ct,jt,Mt,Qt,ne){var Kt,Dr=Ct&At,Mr=Ct&Je,nt=Ct&Pt;if(jt&&(Kt=Qt?jt(tt,Mt,Qt,ne):jt(tt)),Kt!==void 0)return Kt;if(!at(tt))return tt;var xt=zt(tt);if(xt){if(Kt=$e(tt),!Dr)return H(tt,Kt)}else{var ht=Re(tt),vr=ht==fe||ht==Fe;if(St(tt))return V(tt,Dr);if(ht==vt||ht==Ve||vr&&!Qt){if(Kt=Mr||vr?{}:Lt(tt),!Dr)return Mr?L(tt,Z(Kt,tt)):I(tt,E(Kt,tt))}else{if(!Be[ht])return Qt?tt:{};Kt=Rt(tt,ht,Dr)}}ne||(ne=new U);var Zr=ne.get(tt);if(Zr)return Zr;ne.set(tt,Kt),ur(tt)?tt.forEach(function(jr){Kt.add(et(jr,Ct,jt,jr,tt,ne))}):Et(tt)&&tt.forEach(function(jr,wr){Kt.set(wr,et(jr,Ct,jt,wr,tt,ne))});var Ur=nt?Mr?xe:_e:Mr?fr:ee,tn=xt?void 0:Ur(tt);return b(tn||tt,function(jr,wr){tn&&(wr=jr,jr=tt[wr]),p(Kt,wr,et(jr,Ct,jt,wr,tt,ne))}),Kt}Qe.exports=et},3118:function(Qe,D,g){var U=g(13218),b=Object.create,p=function(){function E(){}return function(Z){if(!U(Z))return{};if(b)return b(Z);E.prototype=Z;var V=new E;return E.prototype=void 0,V}}();Qe.exports=p},41848:function(Qe){function D(g,U,b,p){for(var E=g.length,Z=b+(p?1:-1);p?Z--:++Z<E;)if(U(g[Z],Z,g))return Z;return-1}Qe.exports=D},28483:function(Qe,D,g){var U=g(25063),b=U();Qe.exports=b},42118:function(Qe,D,g){var U=g(41848),b=g(62722),p=g(42351);function E(Z,V,H){return V===V?p(Z,V,H):U(Z,b,H)}Qe.exports=E},25588:function(Qe,D,g){var U=g(64160),b=g(37005),p="[object Map]";function E(Z){return b(Z)&&U(Z)==p}Qe.exports=E},62722:function(Qe){function D(g){return g!==g}Qe.exports=D},29221:function(Qe,D,g){var U=g(64160),b=g(37005),p="[object Set]";function E(Z){return b(Z)&&U(Z)==p}Qe.exports=E},10313:function(Qe,D,g){var U=g(13218),b=g(25726),p=g(33498),E=Object.prototype,Z=E.hasOwnProperty;function V(H){if(!U(H))return p(H);var I=b(H),L=[];for(var _e in H)_e=="constructor"&&(I||!Z.call(H,_e))||L.push(_e);return L}Qe.exports=V},42980:function(Qe,D,g){var U=g(46384),b=g(86556),p=g(28483),E=g(59783),Z=g(13218),V=g(81704),H=g(36390);function I(L,_e,xe,Re,$e){L!==_e&&p(_e,function(Rt,Lt){if($e||($e=new U),Z(Rt))E(L,_e,Lt,xe,I,Re,$e);else{var zt=Re?Re(H(L,Lt),Rt,Lt+"",L,_e,$e):void 0;zt===void 0&&(zt=Rt),b(L,Lt,zt)}},V)}Qe.exports=I},59783:function(Qe,D,g){var U=g(86556),b=g(64626),p=g(77133),E=g(278),Z=g(38517),V=g(35694),H=g(1469),I=g(29246),L=g(44144),_e=g(23560),xe=g(13218),Re=g(68630),$e=g(36719),Rt=g(36390),Lt=g(59881);function zt(St,Et,at,ur,ee,fr,At){var Je=Rt(St,at),Pt=Rt(Et,at),Ve=At.get(Pt);if(Ve){U(St,at,Ve);return}var It=fr?fr(Je,Pt,at+"",St,Et,At):void 0,hr=It===void 0;if(hr){var Jt=H(Pt),Fr=!Jt&&L(Pt),fe=!Jt&&!Fr&&$e(Pt);It=Pt,Jt||Fr||fe?H(Je)?It=Je:I(Je)?It=E(Je):Fr?(hr=!1,It=b(Pt,!0)):fe?(hr=!1,It=p(Pt,!0)):It=[]:Re(Pt)||V(Pt)?(It=Je,V(Je)?It=Lt(Je):(!xe(Je)||_e(Je))&&(It=Z(Pt))):hr=!1}hr&&(At.set(Pt,It),ee(It,Pt,ur,fr,At),At.delete(Pt)),U(St,at,It)}Qe.exports=zt},40371:function(Qe){function D(g){return function(U){return U==null?void 0:U[g]}}Qe.exports=D},18674:function(Qe){function D(g){return function(U){return g==null?void 0:g[U]}}Qe.exports=D},5976:function(Qe,D,g){var U=g(6557),b=g(45357),p=g(30061);function E(Z,V){return p(b(Z,V,U),Z+"")}Qe.exports=E},56560:function(Qe,D,g){var U=g(75703),b=g(38777),p=g(6557),E=b?function(Z,V){return b(Z,"toString",{configurable:!0,enumerable:!1,value:U(V),writable:!0})}:p;Qe.exports=E},80531:function(Qe,D,g){var U=g(62705),b=g(29932),p=g(1469),E=g(33448),Z=1/0,V=U?U.prototype:void 0,H=V?V.toString:void 0;function I(L){if(typeof L=="string")return L;if(p(L))return b(L,I)+"";if(E(L))return H?H.call(L):"";var _e=L+"";return _e=="0"&&1/L==-Z?"-0":_e}Qe.exports=I},45652:function(Qe,D,g){var U=g(88668),b=g(47443),p=g(1196),E=g(74757),Z=g(23593),V=g(21814),H=200;function I(L,_e,xe){var Re=-1,$e=b,Rt=L.length,Lt=!0,zt=[],St=zt;if(xe)Lt=!1,$e=p;else if(Rt>=H){var Et=_e?null:Z(L);if(Et)return V(Et);Lt=!1,$e=E,St=new U}else St=_e?[]:zt;e:for(;++Re<Rt;){var at=L[Re],ur=_e?_e(at):at;if(at=xe||at!==0?at:0,Lt&&ur===ur){for(var ee=St.length;ee--;)if(St[ee]===ur)continue e;_e&&St.push(ur),zt.push(at)}else $e(St,ur,xe)||(St!==zt&&St.push(ur),zt.push(at))}return zt}Qe.exports=I},74318:function(Qe,D,g){var U=g(11149);function b(p){var E=new p.constructor(p.byteLength);return new U(E).set(new U(p)),E}Qe.exports=b},64626:function(Qe,D,g){Qe=g.nmd(Qe);var U=g(55639),b=D&&!D.nodeType&&D,p=b&&!0&&Qe&&!Qe.nodeType&&Qe,E=p&&p.exports===b,Z=E?U.Buffer:void 0,V=Z?Z.allocUnsafe:void 0;function H(I,L){if(L)return I.slice();var _e=I.length,xe=V?V(_e):new I.constructor(_e);return I.copy(xe),xe}Qe.exports=H},57157:function(Qe,D,g){var U=g(74318);function b(p,E){var Z=E?U(p.buffer):p.buffer;return new p.constructor(Z,p.byteOffset,p.byteLength)}Qe.exports=b},93147:function(Qe){var D=/\w*$/;function g(U){var b=new U.constructor(U.source,D.exec(U));return b.lastIndex=U.lastIndex,b}Qe.exports=g},40419:function(Qe,D,g){var U=g(62705),b=U?U.prototype:void 0,p=b?b.valueOf:void 0;function E(Z){return p?Object(p.call(Z)):{}}Qe.exports=E},77133:function(Qe,D,g){var U=g(74318);function b(p,E){var Z=E?U(p.buffer):p.buffer;return new p.constructor(Z,p.byteOffset,p.length)}Qe.exports=b},278:function(Qe){function D(g,U){var b=-1,p=g.length;for(U||(U=Array(p));++b<p;)U[b]=g[b];return U}Qe.exports=D},98363:function(Qe,D,g){var U=g(34865),b=g(89465);function p(E,Z,V,H){var I=!V;V||(V={});for(var L=-1,_e=Z.length;++L<_e;){var xe=Z[L],Re=H?H(V[xe],E[xe],xe,V,E):void 0;Re===void 0&&(Re=E[xe]),I?b(V,xe,Re):U(V,xe,Re)}return V}Qe.exports=p},18805:function(Qe,D,g){var U=g(98363),b=g(99551);function p(E,Z){return U(E,b(E),Z)}Qe.exports=p},1911:function(Qe,D,g){var U=g(98363),b=g(51442);function p(E,Z){return U(E,b(E),Z)}Qe.exports=p},21463:function(Qe,D,g){var U=g(5976),b=g(16612);function p(E){return U(function(Z,V){var H=-1,I=V.length,L=I>1?V[I-1]:void 0,_e=I>2?V[2]:void 0;for(L=E.length>3&&typeof L=="function"?(I--,L):void 0,_e&&b(V[0],V[1],_e)&&(L=I<3?void 0:L,I=1),Z=Object(Z);++H<I;){var xe=V[H];xe&&E(Z,xe,H,L)}return Z})}Qe.exports=p},25063:function(Qe){function D(g){return function(U,b,p){for(var E=-1,Z=Object(U),V=p(U),H=V.length;H--;){var I=V[g?H:++E];if(b(Z[I],I,Z)===!1)break}return U}}Qe.exports=D},98805:function(Qe,D,g){var U=g(40180),b=g(62689),p=g(83140),E=g(79833);function Z(V){return function(H){H=E(H);var I=b(H)?p(H):void 0,L=I?I[0]:H.charAt(0),_e=I?U(I,1).join(""):H.slice(1);return L[V]()+_e}}Qe.exports=Z},35393:function(Qe,D,g){var U=g(62663),b=g(53816),p=g(58748),E="['\u2019]",Z=RegExp(E,"g");function V(H){return function(I){return U(p(b(I).replace(Z,"")),H,"")}}Qe.exports=V},23593:function(Qe,D,g){var U=g(58525),b=g(50308),p=g(21814),E=1/0,Z=U&&1/p(new U([,-0]))[1]==E?function(V){return new U(V)}:b;Qe.exports=Z},69389:function(Qe,D,g){var U=g(18674),b={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=U(b);Qe.exports=p},38777:function(Qe,D,g){var U=g(10852),b=function(){try{var p=U(Object,"defineProperty");return p({},"",{}),p}catch(E){}}();Qe.exports=b},46904:function(Qe,D,g){var U=g(68866),b=g(51442),p=g(81704);function E(Z){return U(Z,p,b)}Qe.exports=E},85924:function(Qe,D,g){var U=g(5569),b=U(Object.getPrototypeOf,Object);Qe.exports=b},51442:function(Qe,D,g){var U=g(62488),b=g(85924),p=g(99551),E=g(70479),Z=Object.getOwnPropertySymbols,V=Z?function(H){for(var I=[];H;)U(I,p(H)),H=b(H);return I}:E;Qe.exports=V},93157:function(Qe){var D=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function g(U){return D.test(U)}Qe.exports=g},43824:function(Qe){var D=Object.prototype,g=D.hasOwnProperty;function U(b){var p=b.length,E=new b.constructor(p);return p&&typeof b[0]=="string"&&g.call(b,"index")&&(E.index=b.index,E.input=b.input),E}Qe.exports=U},29148:function(Qe,D,g){var U=g(74318),b=g(57157),p=g(93147),E=g(40419),Z=g(77133),V="[object Boolean]",H="[object Date]",I="[object Map]",L="[object Number]",_e="[object RegExp]",xe="[object Set]",Re="[object String]",$e="[object Symbol]",Rt="[object ArrayBuffer]",Lt="[object DataView]",zt="[object Float32Array]",St="[object Float64Array]",Et="[object Int8Array]",at="[object Int16Array]",ur="[object Int32Array]",ee="[object Uint8Array]",fr="[object Uint8ClampedArray]",At="[object Uint16Array]",Je="[object Uint32Array]";function Pt(Ve,It,hr){var Jt=Ve.constructor;switch(It){case Rt:return U(Ve);case V:case H:return new Jt(+Ve);case Lt:return b(Ve,hr);case zt:case St:case Et:case at:case ur:case ee:case fr:case At:case Je:return Z(Ve,hr);case I:return new Jt;case L:case Re:return new Jt(Ve);case _e:return p(Ve);case xe:return new Jt;case $e:return E(Ve)}}Qe.exports=Pt},38517:function(Qe,D,g){var U=g(3118),b=g(85924),p=g(25726);function E(Z){return typeof Z.constructor=="function"&&!p(Z)?U(b(Z)):{}}Qe.exports=E},16612:function(Qe,D,g){var U=g(77813),b=g(98612),p=g(65776),E=g(13218);function Z(V,H,I){if(!E(I))return!1;var L=typeof H;return(L=="number"?b(I)&&p(H,I.length):L=="string"&&H in I)?U(I[H],V):!1}Qe.exports=Z},33498:function(Qe){function D(g){var U=[];if(g!=null)for(var b in Object(g))U.push(b);return U}Qe.exports=D},45357:function(Qe,D,g){var U=g(58380),b=Math.max;function p(E,Z,V){return Z=b(Z===void 0?E.length-1:Z,0),function(){for(var H=arguments,I=-1,L=b(H.length-Z,0),_e=Array(L);++I<L;)_e[I]=H[Z+I];I=-1;for(var xe=Array(Z+1);++I<Z;)xe[I]=H[I];return xe[Z]=V(_e),U(E,this,xe)}}Qe.exports=p},36390:function(Qe){function D(g,U){if(!(U==="constructor"&&typeof g[U]=="function")&&U!="__proto__")return g[U]}Qe.exports=D},30061:function(Qe,D,g){var U=g(56560),b=g(21275),p=b(U);Qe.exports=p},21275:function(Qe){var D=800,g=16,U=Date.now;function b(p){var E=0,Z=0;return function(){var V=U(),H=g-(V-Z);if(Z=V,H>0){if(++E>=D)return arguments[0]}else E=0;return p.apply(void 0,arguments)}}Qe.exports=b},42351:function(Qe){function D(g,U,b){for(var p=b-1,E=g.length;++p<E;)if(g[p]===U)return p;return-1}Qe.exports=D},2757:function(Qe){var D="\\ud800-\\udfff",g="\\u0300-\\u036f",U="\\ufe20-\\ufe2f",b="\\u20d0-\\u20ff",p=g+U+b,E="\\u2700-\\u27bf",Z="a-z\\xdf-\\xf6\\xf8-\\xff",V="\\xac\\xb1\\xd7\\xf7",H="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",I="\\u2000-\\u206f",L=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",_e="A-Z\\xc0-\\xd6\\xd8-\\xde",xe="\\ufe0e\\ufe0f",Re=V+H+I+L,$e="['\u2019]",Rt="["+Re+"]",Lt="["+p+"]",zt="\\d+",St="["+E+"]",Et="["+Z+"]",at="[^"+D+Re+zt+E+Z+_e+"]",ur="\\ud83c[\\udffb-\\udfff]",ee="(?:"+Lt+"|"+ur+")",fr="[^"+D+"]",At="(?:\\ud83c[\\udde6-\\uddff]){2}",Je="[\\ud800-\\udbff][\\udc00-\\udfff]",Pt="["+_e+"]",Ve="\\u200d",It="(?:"+Et+"|"+at+")",hr="(?:"+Pt+"|"+at+")",Jt="(?:"+$e+"(?:d|ll|m|re|s|t|ve))?",Fr="(?:"+$e+"(?:D|LL|M|RE|S|T|VE))?",fe=ee+"?",Fe="["+xe+"]?",me="(?:"+Ve+"(?:"+[fr,At,Je].join("|")+")"+Fe+fe+")*",bt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Zt=Fe+fe+me,Ut="(?:"+[St,At,Je].join("|")+")"+Zt,Rr=RegExp([Pt+"?"+Et+"+"+Jt+"(?="+[Rt,Pt,"$"].join("|")+")",hr+"+"+Fr+"(?="+[Rt,Pt+It,"$"].join("|")+")",Pt+"?"+It+"+"+Jt,Pt+"+"+Fr,vt,bt,zt,Ut].join("|"),"g");function ln(pn){return pn.match(Rr)||[]}Qe.exports=ln},68929:function(Qe,D,g){var U=g(48403),b=g(35393),p=b(function(E,Z,V){return Z=Z.toLowerCase(),E+(V?U(Z):Z)});Qe.exports=p},48403:function(Qe,D,g){var U=g(79833),b=g(11700);function p(E){return b(U(E).toLowerCase())}Qe.exports=p},74691:function(Qe,D,g){var U=g(29750),b=g(14841);function p(E,Z,V){return V===void 0&&(V=Z,Z=void 0),V!==void 0&&(V=b(V),V=V===V?V:0),Z!==void 0&&(Z=b(Z),Z=Z===Z?Z:0),U(b(E),Z,V)}Qe.exports=p},50361:function(Qe,D,g){var U=g(85990),b=1,p=4;function E(Z){return U(Z,b|p)}Qe.exports=E},75703:function(Qe){function D(g){return function(){return g}}Qe.exports=D},53816:function(Qe,D,g){var U=g(69389),b=g(79833),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,E="\\u0300-\\u036f",Z="\\ufe20-\\ufe2f",V="\\u20d0-\\u20ff",H=E+Z+V,I="["+H+"]",L=RegExp(I,"g");function _e(xe){return xe=b(xe),xe&&xe.replace(p,U).replace(L,"")}Qe.exports=_e},6557:function(Qe){function D(g){return g}Qe.exports=D},29246:function(Qe,D,g){var U=g(98612),b=g(37005);function p(E){return b(E)&&U(E)}Qe.exports=p},56688:function(Qe,D,g){var U=g(25588),b=g(7518),p=g(31167),E=p&&p.isMap,Z=E?b(E):U;Qe.exports=Z},14293:function(Qe){function D(g){return g==null}Qe.exports=D},81763:function(Qe,D,g){var U=g(44239),b=g(37005),p="[object Number]";function E(Z){return typeof Z=="number"||b(Z)&&U(Z)==p}Qe.exports=E},68630:function(Qe,D,g){var U=g(44239),b=g(85924),p=g(37005),E="[object Object]",Z=Function.prototype,V=Object.prototype,H=Z.toString,I=V.hasOwnProperty,L=H.call(Object);function _e(xe){if(!p(xe)||U(xe)!=E)return!1;var Re=b(xe);if(Re===null)return!0;var $e=I.call(Re,"constructor")&&Re.constructor;return typeof $e=="function"&&$e instanceof $e&&H.call($e)==L}Qe.exports=_e},72928:function(Qe,D,g){var U=g(29221),b=g(7518),p=g(31167),E=p&&p.isSet,Z=E?b(E):U;Qe.exports=Z},47037:function(Qe,D,g){var U=g(44239),b=g(1469),p=g(37005),E="[object String]";function Z(V){return typeof V=="string"||!b(V)&&p(V)&&U(V)==E}Qe.exports=Z},81704:function(Qe,D,g){var U=g(14636),b=g(10313),p=g(98612);function E(Z){return p(Z)?U(Z,!0):b(Z)}Qe.exports=E},82492:function(Qe,D,g){var U=g(42980),b=g(21463),p=b(function(E,Z,V){U(E,Z,V)});Qe.exports=p},30236:function(Qe,D,g){var U=g(42980),b=g(21463),p=b(function(E,Z,V,H){U(E,Z,V,H)});Qe.exports=p},50308:function(Qe){function D(){}Qe.exports=D},59881:function(Qe,D,g){var U=g(98363),b=g(81704);function p(E){return U(E,b(E))}Qe.exports=p},79833:function(Qe,D,g){var U=g(80531);function b(p){return p==null?"":U(p)}Qe.exports=b},44908:function(Qe,D,g){var U=g(45652);function b(p){return p&&p.length?U(p):[]}Qe.exports=b},11700:function(Qe,D,g){var U=g(98805),b=U("toUpperCase");Qe.exports=b},58748:function(Qe,D,g){var U=g(49029),b=g(93157),p=g(79833),E=g(2757);function Z(V,H,I){return V=p(V),H=I?void 0:H,H===void 0?b(V)?E(V):U(V):V.match(H)||[]}Qe.exports=Z},6158:function(Qe){(function(D,g){Qe.exports=g()})(this,function(){"use strict";var D,g,U;function b(p,E){if(!D)D=E;else if(!g)g=E;else{var Z="var sharedChunk = {}; ("+D+")(sharedChunk); ("+g+")(sharedChunk);",V={};D(V),U=E(V),typeof window!="undefined"&&(U.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}return b(["exports"],function(p){"use strict";function E(e,t){return e(t={exports:{}},t.exports),t.exports}var Z=V;function V(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}V.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},V.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},V.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},V.prototype.solveCurveX=function(e,t){var r,f,v,y,S;for(t===void 0&&(t=1e-6),v=e,S=0;S<8;S++){if(y=this.sampleCurveX(v)-e,Math.abs(y)<t)return v;var M=this.sampleCurveDerivativeX(v);if(Math.abs(M)<1e-6)break;v-=y/M}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(y=this.sampleCurveX(v),Math.abs(y-e)<t)return v;e>y?r=v:f=v,v=.5*(f-r)+r}return v},V.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var H=I;function I(e,t){this.x=e,this.y=t}I.prototype={clone:function(){return new I(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),f=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=f,this},_rotateAround:function(e,t){var r=Math.cos(e),f=Math.sin(e),v=t.y+f*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-f*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},I.convert=function(e){return e instanceof I?e:Array.isArray(e)?new I(e[0],e[1]):e};var L=typeof self!="undefined"?self:{},_e=Math.pow(2,53)-1;function xe(e,t,r,f){var v=new Z(e,t,r,f);return function(y){return v.solve(y)}}var Re=xe(.25,.1,.25,1);function $e(e,t,r){return Math.min(r,Math.max(t,e))}function Rt(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function Lt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var y=v[f];for(var S in y)e[S]=y[S]}return e}var zt=1;function St(){return zt++}function Et(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function at(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function ur(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function ee(e,t){return e.indexOf(t,e.length-t.length)!==-1}function fr(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function At(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function Je(e){return Array.isArray(e)?e.map(Je):typeof e=="object"&&e?fr(e,Je):e}var Pt={};function Ve(e){Pt[e]||(typeof console!="undefined"&&console.warn(e),Pt[e]=!0)}function It(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function hr(e){for(var t=0,r=0,f=e.length,v=f-1,y=void 0,S=void 0;r<f;v=r++)t+=((S=e[v]).x-(y=e[r]).x)*(y.y+S.y);return t}function Jt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Fr(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,y,S){var M=y||S;return t[v]=!M||M.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var fe=null;function Fe(e){if(fe==null){var t=e.navigator?e.navigator.userAgent:null;fe=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return fe}function me(e){try{var t=L[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var bt,vt,Zt,Ut,Rr=L.performance&&L.performance.now?L.performance.now.bind(L.performance):Date.now.bind(Date),ln=L.requestAnimationFrame||L.mozRequestAnimationFrame||L.webkitRequestAnimationFrame||L.msRequestAnimationFrame,pn=L.cancelAnimationFrame||L.mozCancelAnimationFrame||L.webkitCancelAnimationFrame||L.msCancelAnimationFrame,Vi={now:Rr,frame:function(e){var t=ln(e);return{cancel:function(){return pn(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=L.document.createElement("canvas"),f=r.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return bt||(bt=L.document.createElement("a")),bt.href=e,bt.href},hardwareConcurrency:L.navigator&&L.navigator.hardwareConcurrency||4,get devicePixelRatio(){return L.devicePixelRatio},get prefersReducedMotion(){return!!L.matchMedia&&(vt==null&&(vt=L.matchMedia("(prefers-reduced-motion: reduce)")),vt.matches)}},ar={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},pe={supported:!1,testSupport:function(e){!Pe&&Ut&&(Ge?ke(e):Zt=e)}},Pe=!1,Ge=!1;function ke(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Ut),e.isContextLost())return;pe.supported=!0}catch(r){}e.deleteTexture(t),Pe=!0}L.document&&((Ut=L.document.createElement("img")).onload=function(){Zt&&ke(Zt),Zt=null,Ge=!0},Ut.onerror=function(){Pe=!0,Zt=null},Ut.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ft="01",ir=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function T(e){return e.indexOf("mapbox:")===0}ir.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ft,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},ir.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},ir.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},ir.prototype.normalizeStyleURL=function(e,t){if(!T(e))return e;var r=et(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},ir.prototype.normalizeGlyphsURL=function(e,t){if(!T(e))return e;var r=et(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},ir.prototype.normalizeSourceURL=function(e,t){if(!T(e))return e;var r=et(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},ir.prototype.normalizeSpriteURL=function(e,t,r,f){var v=et(e);return T(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,tt(v))},ir.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!T(e))return e;var r=et(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Vi.devicePixelRatio>=2||t===512?"@2x":"")+(pe.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var y=0,S=v;y<S.length;y+=1){var M=S[y].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(r.params)||ar.ACCESS_TOKEN;return ar.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},ir.prototype.canonicalizeTileURL=function(e,t){var r=et(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(y){return!y.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},ir.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&T(t),f=[],v=0,y=e.tiles||[];v<y.length;v+=1){var S=y[v];Se(S)?f.push(this.canonicalizeTileURL(S,r)):f.push(S)}return f},ir.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=et(ar.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!ar.REQUIRE_ACCESS_TOKEN)return tt(e);if(!(t=t||ar.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(y){return y.indexOf("access_token")===-1}),e.params.push("access_token="+t),tt(e)};var G=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Se(e){return G.test(e)}var Be=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function et(e){var t=e.match(Be);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function tt(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function Ct(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(L.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var jt=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};jt.prototype.getStorageKey=function(e){var t,r=Ct(ar.ACCESS_TOKEN);return t=r&&r.u?L.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):ar.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},jt.prototype.fetchEventData=function(){var e=me("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=L.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=L.localStorage.getItem(r);v&&(this.anonId=v)}catch(y){Ve("Unable to read from LocalStorage")}},jt.prototype.saveEventData=function(){var e=me("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{L.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&L.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){Ve("Unable to write to LocalStorage")}},jt.prototype.processRequests=function(e){},jt.prototype.postEvent=function(e,t,r,f){var v=this;if(ar.EVENTS_URL){var y=et(ar.EVENTS_URL);y.params.push("access_token="+(f||ar.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:Ft,userId:this.anonId},M=t?Lt(S,t):S,z={url:tt(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=Oi(z,function(Y){v.pendingRequest=null,r(Y),v.saveEventData(),v.processRequests(f)})}},jt.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var Mt,Qt,ne=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,y){this.skuToken=v,(ar.EVENTS_URL&&y||ar.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(S){return T(S)||Se(S)}))&&this.queueRequest({id:f,timestamp:Date.now()},y)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),y=v.id,S=v.timestamp;y&&this.success[y]||(this.anonId||this.fetchEventData(),at(this.anonId)||(this.anonId=Et()),this.postEvent(S,{skuToken:this.skuToken},function(M){M||y&&(f.success[y]=!0)},r))}},t}(jt),Kt=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){ar.EVENTS_URL&&ar.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return T(v)||Se(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=Ct(ar.ACCESS_TOKEN),y=v?v.u:ar.ACCESS_TOKEN,S=y!==this.eventData.tokenU;at(this.anonId)||(this.anonId=Et(),S=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var z=new Date(this.eventData.lastSuccess),Y=new Date(M),J=(M-this.eventData.lastSuccess)/864e5;S=S||J>=1||J<-1||z.getDate()!==Y.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(ae){ae||(f.eventData.lastSuccess=M,f.eventData.tokenU=y)},r)}},t}(jt)),Dr=Kt.postTurnstileEvent.bind(Kt),Mr=new ne,nt=Mr.postMapLoadEvent.bind(Mr),xt=500,ht=50;function vr(){L.caches&&!Mt&&(Mt=L.caches.open("mapbox-tiles"))}function Zr(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var Ur,tn=1/0;function jr(){return Ur==null&&(Ur=L.OffscreenCanvas&&new L.OffscreenCanvas(1,1).getContext("2d")&&typeof L.createImageBitmap=="function"),Ur}var wr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(wr);var Dn=function(e){function t(r,f,v){f===401&&Se(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),Zn=Jt()?function(){return self.worker&&self.worker.referrer}:function(){return(L.location.protocol==="blob:"?L.parent:L).location.href},bi,Hi,qi=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Zn())&&!/^\w+:/.test(r))){if(L.fetch&&L.Request&&L.AbortController&&L.Request.prototype.hasOwnProperty("signal"))return function(f,v){var y,S=new L.AbortController,M=new L.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Zn(),signal:S.signal}),z=!1,Y=!1,J=(y=M.url).indexOf("sku=")>0&&Se(y);f.type==="json"&&M.headers.set("Accept","application/json");var ae=function(ye,He,Xe){if(!Y){if(ye&&ye.message!=="SecurityError"&&Ve(ye),He&&Xe)return he(He);var gt=Date.now();L.fetch(M).then(function(rt){if(rt.ok){var Dt=J?rt.clone():null;return he(rt,Dt,gt)}return v(new Dn(rt.statusText,rt.status,f.url))}).catch(function(rt){rt.code!==20&&v(new Error(rt.message))})}},he=function(ye,He,Xe){(f.type==="arrayBuffer"?ye.arrayBuffer():f.type==="json"?ye.json():ye.text()).then(function(gt){Y||(He&&Xe&&function(rt,Dt,$t){if(vr(),Mt){var pr={status:Dt.status,statusText:Dt.statusText,headers:new L.Headers};Dt.headers.forEach(function(Or,nn){return pr.headers.set(nn,Or)});var mr=Fr(Dt.headers.get("Cache-Control")||"");mr["no-store"]||(mr["max-age"]&&pr.headers.set("Expires",new Date($t+1e3*mr["max-age"]).toUTCString()),new Date(pr.headers.get("Expires")).getTime()-$t<42e4||function(Or,nn){if(Qt===void 0)try{new Response(new ReadableStream),Qt=!0}catch(vn){Qt=!1}Qt?nn(Or.body):Or.blob().then(nn)}(Dt,function(Or){var nn=new L.Response(Or,pr);vr(),Mt&&Mt.then(function(vn){return vn.put(Zr(rt.url),nn)}).catch(function(vn){return Ve(vn.message)})}))}}(M,He,Xe),z=!0,v(null,gt,ye.headers.get("Cache-Control"),ye.headers.get("Expires")))}).catch(function(gt){Y||v(new Error(gt.message))})};return J?function(ye,He){if(vr(),!Mt)return He(null);var Xe=Zr(ye.url);Mt.then(function(gt){gt.match(Xe).then(function(rt){var Dt=function($t){if(!$t)return!1;var pr=new Date($t.headers.get("Expires")||0),mr=Fr($t.headers.get("Cache-Control")||"");return pr>Date.now()&&!mr["no-cache"]}(rt);gt.delete(Xe),Dt&&gt.put(Xe,rt.clone()),He(null,rt,Dt)}).catch(He)}).catch(He)}(M,ae):ae(null,null),{cancel:function(){Y=!0,z||S.abort()}}}(e,t);if(Jt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(f,v){var y=new L.XMLHttpRequest;for(var S in y.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(y.responseType="arraybuffer"),f.headers)y.setRequestHeader(S,f.headers[S]);return f.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=f.credentials==="include",y.onerror=function(){v(new Error(y.statusText))},y.onload=function(){if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){var M=y.response;if(f.type==="json")try{M=JSON.parse(y.response)}catch(z){return v(z)}v(null,M,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else v(new Dn(y.statusText,y.status,f.url))},y.send(f.body),{cancel:function(){return y.abort()}}}(e,t)},ki=function(e,t){return qi(Lt(e,{type:"arrayBuffer"}),t)},Oi=function(e,t){return qi(Lt(e,{method:"POST"}),t)},$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";bi=[],Hi=0;var ce=function(e,t){if(pe.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Hi>=ar.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return bi.push(r),r}Hi++;var f=!1,v=function(){if(!f)for(f=!0,Hi--;bi.length&&Hi<ar.MAX_PARALLEL_IMAGE_REQUESTS;){var S=bi.shift();S.cancelled||(S.cancel=ce(S.requestParameters,S.callback).cancel)}},y=ki(e,function(S,M,z,Y){v(),S?t(S):M&&(jr()?function(J,ae){var he=new L.Blob([new Uint8Array(J)],{type:"image/png"});L.createImageBitmap(he).then(function(ye){ae(null,ye)}).catch(function(ye){ae(new Error("Could not load image because of "+ye.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,t):function(J,ae,he,ye){var He=new L.Image,Xe=L.URL;He.onload=function(){ae(null,He),Xe.revokeObjectURL(He.src),He.onload=null,L.requestAnimationFrame(function(){He.src=$})},He.onerror=function(){return ae(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var gt=new L.Blob([new Uint8Array(J)],{type:"image/png"});He.cacheControl=he,He.expires=ye,He.src=J.byteLength?Xe.createObjectURL(gt):$}(M,t,z,Y))});return{cancel:function(){y.cancel(),v()}}};function ve(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function j(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var se=function(e,t){t===void 0&&(t={}),Lt(this,t),this.type=e},de=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",Lt({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(se),Me=function(){};Me.prototype.on=function(e,t){return this._listeners=this._listeners||{},ve(e,t,this._listeners),this},Me.prototype.off=function(e,t){return j(e,t,this._listeners),j(e,t,this._oneTimeListeners),this},Me.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},ve(e,t,this._oneTimeListeners),this},Me.prototype.fire=function(e,t){typeof e=="string"&&(e=new se(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var y=0,S=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];y<S.length;y+=1){var M=S[y];j(r,M,this._oneTimeListeners),M.call(this,e)}var z=this._eventedParent;z&&(Lt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),z.fire(e))}else e instanceof de&&console.error(e.error);return this},Me.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Me.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var ue={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Te=function(e,t,r,f){this.message=(e?e+": ":"")+r,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function mt(e){var t=e.value;return t?[new Te(e.key,t,"constants have been deprecated as of v8")]:[]}function br(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var y=v[f];for(var S in y)e[S]=y[S]}return e}function Yt(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function nr(e){if(Array.isArray(e))return e.map(nr);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=nr(e[r]);return t}return Yt(e)}var kr=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),Mn=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,f=t;r<f.length;r+=1){var v=f[r];this.bindings[v[0]]=v[1]}};Mn.prototype.concat=function(e){return new Mn(this,e)},Mn.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},Mn.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Pn={kind:"null"},tr={kind:"number"},Sn={kind:"string"},on={kind:"boolean"},cn={kind:"color"},wi={kind:"object"},xn={kind:"value"},Li={kind:"collator"},$i={kind:"formatted"},ai={kind:"resolvedImage"};function Ji(e,t){return{kind:"array",itemType:e,N:t}}function Ni(e){if(e.kind==="array"){var t=Ni(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var Ai=[Pn,tr,Sn,on,cn,$i,wi,Ji(xn),ai];function ha(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ha(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=Ai;r<f.length;r+=1)if(!ha(f[r],t))return null}}return"Expected "+Ni(e)+" but found "+Ni(t)+" instead."}function Ca(e,t){return t.some(function(r){return r.kind===e.kind})}function ii(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var ti=E(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(M){return(M=Math.round(M))<0?0:M>255?255:M}function v(M){return f(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function y(M){return(z=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:z>1?1:z;var z}function S(M,z,Y){return Y<0?Y+=1:Y>1&&(Y-=1),6*Y<1?M+(z-M)*Y*6:2*Y<1?z:3*Y<2?M+(z-M)*(2/3-Y)*6:M}try{t.parseCSSColor=function(M){var z,Y=M.replace(/ /g,"").toLowerCase();if(Y in r)return r[Y].slice();if(Y[0]==="#")return Y.length===4?(z=parseInt(Y.substr(1),16))>=0&&z<=4095?[(3840&z)>>4|(3840&z)>>8,240&z|(240&z)>>4,15&z|(15&z)<<4,1]:null:Y.length===7&&(z=parseInt(Y.substr(1),16))>=0&&z<=16777215?[(16711680&z)>>16,(65280&z)>>8,255&z,1]:null;var J=Y.indexOf("("),ae=Y.indexOf(")");if(J!==-1&&ae+1===Y.length){var he=Y.substr(0,J),ye=Y.substr(J+1,ae-(J+1)).split(","),He=1;switch(he){case"rgba":if(ye.length!==4)return null;He=y(ye.pop());case"rgb":return ye.length!==3?null:[v(ye[0]),v(ye[1]),v(ye[2]),He];case"hsla":if(ye.length!==4)return null;He=y(ye.pop());case"hsl":if(ye.length!==3)return null;var Xe=(parseFloat(ye[0])%360+360)%360/360,gt=y(ye[1]),rt=y(ye[2]),Dt=rt<=.5?rt*(gt+1):rt+gt-rt*gt,$t=2*rt-Dt;return[f(255*S($t,Dt,Xe+1/3)),f(255*S($t,Dt,Xe)),f(255*S($t,Dt,Xe-1/3)),He];default:return null}}return null}}catch(M){}}).parseCSSColor,Xi=function(e,t,r,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=r,this.a=f};Xi.parse=function(e){if(e){if(e instanceof Xi)return e;if(typeof e=="string"){var t=ti(e);if(t)return new Xi(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Xi.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},Xi.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Xi.black=new Xi(0,0,0,1),Xi.white=new Xi(1,1,1,1),Xi.transparent=new Xi(0,0,0,0),Xi.red=new Xi(1,0,0,1);var va=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};va.prototype.compare=function(e,t){return this.collator.compare(e,t)},va.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Vo=function(e,t,r,f,v){this.text=e,this.image=t,this.scale=r,this.fontStack=f,this.textColor=v},ba=function(e){this.sections=e};ba.fromString=function(e){return new ba([new Vo(e,null,null,null,null)])},ba.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},ba.factory=function(e){return e instanceof ba?e:ba.fromString(e)},ba.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},ba.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var gi=function(e){this.name=e.name,this.available=e.available};function Bs(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function nu(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Xi||e instanceof va||e instanceof ba||e instanceof gi)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!nu(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!nu(e[f]))return!1;return!0}return!1}function Aa(e){if(e===null)return Pn;if(typeof e=="string")return Sn;if(typeof e=="boolean")return on;if(typeof e=="number")return tr;if(e instanceof Xi)return cn;if(e instanceof va)return Li;if(e instanceof ba)return $i;if(e instanceof gi)return ai;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var y=Aa(v[f]);if(t){if(t===y)continue;t=xn;break}t=y}return Ji(t||xn,r)}return wi}function Io(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Xi||e instanceof ba||e instanceof gi?e.toString():JSON.stringify(e)}gi.prototype.toString=function(){return this.name},gi.fromString=function(e){return e?new gi({name:e,available:!1}):null},gi.prototype.serialize=function(){return["image",this.name]};var zi=function(e,t){this.type=e,this.value=t};zi.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!nu(e[1]))return t.error("invalid value");var r=e[1],f=Aa(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new zi(f,r)},zi.prototype.evaluate=function(){return this.value},zi.prototype.eachChild=function(){},zi.prototype.outputDefined=function(){return!0},zi.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Xi?["rgba"].concat(this.value.toArray()):this.value instanceof ba?this.value.serialize():this.value};var Ka=function(e){this.name="ExpressionEvaluationError",this.message=e};Ka.prototype.toJSON=function(){return this.message};var Go={string:Sn,number:tr,boolean:on,object:wi},ea=function(e,t){this.type=e,this.args=t};ea.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var y,S;if(e.length>2){var M=e[1];if(typeof M!="string"||!(M in Go)||M==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);y=Go[M],f++}else y=xn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);S=e[2],f++}r=Ji(y,S)}else r=Go[v];for(var z=[];f<e.length;f++){var Y=t.parse(e[f],f,xn);if(!Y)return null;z.push(Y)}return new ea(r,z)},ea.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!ha(this.type,Aa(r)))return r;if(t===this.args.length-1)throw new Ka("Expected value to be of type "+Ni(this.type)+", but found "+Ni(Aa(r))+" instead.")}return null},ea.prototype.eachChild=function(e){this.args.forEach(e)},ea.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},ea.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var To=function(e){this.type=$i,this.sections=e};To.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,y=1;y<=e.length-1;++y){var S=e[y];if(v&&typeof S=="object"&&!Array.isArray(S)){v=!1;var M=null;if(S["font-scale"]&&!(M=t.parse(S["font-scale"],1,tr)))return null;var z=null;if(S["text-font"]&&!(z=t.parse(S["text-font"],1,Ji(Sn))))return null;var Y=null;if(S["text-color"]&&!(Y=t.parse(S["text-color"],1,cn)))return null;var J=f[f.length-1];J.scale=M,J.font=z,J.textColor=Y}else{var ae=t.parse(e[y],1,xn);if(!ae)return null;var he=ae.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:ae,scale:null,font:null,textColor:null})}}return new To(f)},To.prototype.evaluate=function(e){return new ba(this.sections.map(function(t){var r=t.content.evaluate(e);return Aa(r)===ai?new Vo("",r,null,null,null):new Vo(Io(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},To.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},To.prototype.outputDefined=function(){return!1},To.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var Oo=function(e){this.type=ai,this.input=e};Oo.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,Sn);return r?new Oo(r):t.error("No image name provided.")},Oo.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=gi.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},Oo.prototype.eachChild=function(e){e(this.input)},Oo.prototype.outputDefined=function(){return!1},Oo.prototype.serialize=function(){return["image",this.input.serialize()]};var co={"to-boolean":on,"to-color":cn,"to-number":tr,"to-string":Sn},fo=function(e,t){this.type=e,this.args=t};fo.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=co[r],v=[],y=1;y<e.length;y++){var S=t.parse(e[y],y,xn);if(!S)return null;v.push(S)}return new fo(f,v)},fo.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof Xi)return t;if(typeof t=="string"){var y=e.parseColor(t);if(y)return y}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":Bs(t[0],t[1],t[2],t[3])))return new Xi(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ka(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var S=null,M=0,z=this.args;M<z.length;M+=1){if((S=z[M].evaluate(e))===null)return 0;var Y=Number(S);if(!isNaN(Y))return Y}throw new Ka("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?ba.fromString(Io(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?gi.fromString(Io(this.args[0].evaluate(e))):Io(this.args[0].evaluate(e))},fo.prototype.eachChild=function(e){this.args.forEach(e)},fo.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},fo.prototype.serialize=function(){if(this.type.kind==="formatted")return new To([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Oo(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var Yi=["Unknown","Point","LineString","Polygon"],Da=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Da.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Da.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Yi[this.feature.type]:this.feature.type:null},Da.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Da.prototype.canonicalID=function(){return this.canonical},Da.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Da.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Xi.parse(e)),t};var ka=function(e,t,r,f){this.name=e,this.type=t,this._evaluate=r,this.args=f};ka.prototype.evaluate=function(e){return this._evaluate(e,this.args)},ka.prototype.eachChild=function(e){this.args.forEach(e)},ka.prototype.outputDefined=function(){return!1},ka.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},ka.parse=function(e,t){var r,f=e[0],v=ka.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var y=Array.isArray(v)?v[0]:v.type,S=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,M=S.filter(function(si){var zn=si[0];return!Array.isArray(zn)||zn.length===e.length-1}),z=null,Y=0,J=M;Y<J.length;Y+=1){var ae=J[Y],he=ae[0],ye=ae[1];z=new Ds(t.registry,t.path,null,t.scope);for(var He=[],Xe=!1,gt=1;gt<e.length;gt++){var rt=e[gt],Dt=Array.isArray(he)?he[gt-1]:he.type,$t=z.parse(rt,1+He.length,Dt);if(!$t){Xe=!0;break}He.push($t)}if(!Xe)if(Array.isArray(he)&&he.length!==He.length)z.error("Expected "+he.length+" arguments, but found "+He.length+" instead.");else{for(var pr=0;pr<He.length;pr++){var mr=Array.isArray(he)?he[pr]:he.type,Or=He[pr];z.concat(pr+1).checkSubtype(mr,Or.type)}if(z.errors.length===0)return new ka(f,y,ye,He)}}if(M.length===1)(r=t.errors).push.apply(r,z.errors);else{for(var nn=(M.length?M:S).map(function(si){var zn;return zn=si[0],Array.isArray(zn)?"("+zn.map(Ni).join(", ")+")":"("+Ni(zn.type)+"...)"}).join(" | "),vn=[],Qn=1;Qn<e.length;Qn++){var Ln=t.parse(e[Qn],1+vn.length);if(!Ln)return null;vn.push(Ni(Ln.type))}t.error("Expected arguments of type "+nn+", but found ("+vn.join(", ")+") instead.")}return null},ka.register=function(e,t){for(var r in ka.definitions=t,t)e[r]=ka};var fs=function(e,t,r){this.type=Li,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function Sa(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function be(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Ne(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function pt(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function rr(e,t){for(var r,f,v,y,S,M,z,Y=!1,J=0,ae=t.length;J<ae;J++)for(var he=t[J],ye=0,He=he.length;ye<He-1;ye++){if((y=(r=e)[0]-(f=he[ye])[0])*(z=r[1]-(v=he[ye+1])[1])-(M=r[0]-v[0])*(S=r[1]-f[1])==0&&y*M<=0&&S*z<=0)return!1;pt(e,he[ye],he[ye+1])&&(Y=!Y)}return Y}function Xr(e,t){for(var r=0;r<t.length;r++)if(rr(e,t[r]))return!0;return!1}function Kn(e,t,r,f){var v=f[0]-r[0],y=f[1]-r[1],S=(e[0]-r[0])*y-v*(e[1]-r[1]),M=(t[0]-r[0])*y-v*(t[1]-r[1]);return S>0&&M<0||S<0&&M>0}function vi(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var y=v[f],S=0;S<y.length-1;++S)if((ae=[(J=y[S+1])[0]-(Y=y[S])[0],J[1]-Y[1]])[0]*(he=[(z=t)[0]-(M=e)[0],z[1]-M[1]])[1]-ae[1]*he[0]!=0&&Kn(M,z,Y,J)&&Kn(Y,J,M,z))return!0;var M,z,Y,J,ae,he;return!1}function Ga(e,t){for(var r=0;r<e.length;++r)if(!rr(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(vi(e[f],e[f+1],t))return!1;return!0}function ao(e,t){for(var r=0;r<t.length;r++)if(Ga(e,t[r]))return!0;return!1}function oo(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var y=[],S=0;S<e[v].length;S++){var M=Ne(e[v][S],r);Sa(t,M),y.push(M)}f.push(y)}return f}function hs(e,t,r){for(var f=[],v=0;v<e.length;v++){var y=oo(e[v],t,r);f.push(y)}return f}function Xs(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,y=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;y===0&&(y=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=y}Sa(t,e)}function ws(e,t,r,f){for(var v=8192*Math.pow(2,f.z),y=[8192*f.x,8192*f.y],S=[],M=0,z=e;M<z.length;M+=1)for(var Y=0,J=z[M];Y<J.length;Y+=1){var ae=J[Y],he=[ae.x+y[0],ae.y+y[1]];Xs(he,t,r,v),S.push(he)}return S}function _o(e,t,r,f){for(var v,y=8192*Math.pow(2,f.z),S=[8192*f.x,8192*f.y],M=[],z=0,Y=e;z<Y.length;z+=1){for(var J=[],ae=0,he=Y[z];ae<he.length;ae+=1){var ye=he[ae],He=[ye.x+S[0],ye.y+S[1]];Sa(t,He),J.push(He)}M.push(J)}if(t[2]-t[0]<=y/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var Xe=0,gt=M;Xe<gt.length;Xe+=1)for(var rt=0,Dt=gt[Xe];rt<Dt.length;rt+=1)Xs(Dt[rt],t,r,y)}return M}fs.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,on);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,on);if(!v)return null;var y=null;return r.locale&&!(y=t.parse(r.locale,1,Sn))?null:new fs(f,v,y)},fs.prototype.evaluate=function(e){return new va(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},fs.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},fs.prototype.outputDefined=function(){return!1},fs.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var rs=function(e,t){this.type=on,this.geojson=e,this.geometries=t};function Ho(e){if(e instanceof ka&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof rs)return!1;var t=!0;return e.eachChild(function(r){t&&!Ho(r)&&(t=!1)}),t}function Lo(e){if(e instanceof ka&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!Lo(r)&&(t=!1)}),t}function xo(e,t){if(e instanceof ka&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!xo(f,t)&&(r=!1)}),r}rs.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(nu(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new rs(r,r.features[f].geometry)}else if(r.type==="Feature"){var y=r.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new rs(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new rs(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},rs.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],y=t.canonicalID();if(r.type==="Polygon"){var S=oo(r.coordinates,v,y),M=ws(t.geometry(),f,v,y);if(!be(f,v))return!1;for(var z=0,Y=M;z<Y.length;z+=1)if(!rr(Y[z],S))return!1}if(r.type==="MultiPolygon"){var J=hs(r.coordinates,v,y),ae=ws(t.geometry(),f,v,y);if(!be(f,v))return!1;for(var he=0,ye=ae;he<ye.length;he+=1)if(!Xr(ye[he],J))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],y=t.canonicalID();if(r.type==="Polygon"){var S=oo(r.coordinates,v,y),M=_o(t.geometry(),f,v,y);if(!be(f,v))return!1;for(var z=0,Y=M;z<Y.length;z+=1)if(!Ga(Y[z],S))return!1}if(r.type==="MultiPolygon"){var J=hs(r.coordinates,v,y),ae=_o(t.geometry(),f,v,y);if(!be(f,v))return!1;for(var he=0,ye=ae;he<ye.length;he+=1)if(!ao(ye[he],J))return!1}return!0}(e,this.geometries)}return!1},rs.prototype.eachChild=function(){},rs.prototype.outputDefined=function(){return!0},rs.prototype.serialize=function(){return["within",this.geojson]};var Si=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};Si.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new Si(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},Si.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},Si.prototype.eachChild=function(){},Si.prototype.outputDefined=function(){return!1},Si.prototype.serialize=function(){return["var",this.name]};var Ds=function(e,t,r,f,v){t===void 0&&(t=[]),f===void 0&&(f=new Mn),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(y){return"["+y+"]"}).join(""),this.scope=f,this.errors=v,this.expectedType=r};function ns(e,t){for(var r,f=e.length-1,v=0,y=f,S=0;v<=y;)if((r=e[S=Math.floor((v+y)/2)])<=t){if(S===f||t<e[S+1])return S;v=S+1}else{if(!(r>t))throw new Ka("Input is not a number.");y=S-1}return 0}Ds.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},Ds.prototype._parse=function(e,t){function r(Y,J,ae){return ae==="assert"?new ea(J,[Y]):ae==="coerce"?new fo(J,[Y]):Y}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var y=v.parse(e,this);if(!y)return null;if(this.expectedType){var S=this.expectedType,M=y.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||M.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(S,M))return null}else y=r(y,S,t.typeAnnotation||"coerce");else y=r(y,S,t.typeAnnotation||"assert")}if(!(y instanceof zi)&&y.type.kind!=="resolvedImage"&&function Y(J){if(J instanceof Si)return Y(J.boundExpression);if(J instanceof ka&&J.name==="error"||J instanceof fs||J instanceof rs)return!1;var ae=J instanceof fo||J instanceof ea,he=!0;return J.eachChild(function(ye){he=ae?he&&Y(ye):he&&ye instanceof zi}),!!he&&Ho(J)&&xo(J,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(y)){var z=new Da;try{y=new zi(y.type,y.evaluate(z))}catch(Y){return this.error(Y.message),null}}return y}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},Ds.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new Ds(this.registry,f,t||null,v,this.errors)},Ds.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new kr(f,e))},Ds.prototype.checkSubtype=function(e,t){var r=ha(e,t);return r&&this.error(r),r};var ps=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,v=r;f<v.length;f+=1){var y=v[f],S=y[1];this.labels.push(y[0]),this.outputs.push(S)}};function wa(e,t,r){return e*(1-r)+t*r}ps.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,tr);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var y=1;y<e.length;y+=2){var S=y===1?-1/0:e[y],M=e[y+1],z=y,Y=y+1;if(typeof S!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(f.length&&f[f.length-1][0]>=S)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);var J=t.parse(M,Y,v);if(!J)return null;v=v||J.type,f.push([S,J])}return new ps(v,r,f)},ps.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[ns(t,f)].evaluate(e)},ps.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},ps.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ps.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var vo=Object.freeze({__proto__:null,number:wa,color:function(e,t,r){return new Xi(wa(e.r,t.r,r),wa(e.g,t.g,r),wa(e.b,t.b,r),wa(e.a,t.a,r))},array:function(e,t,r){return e.map(function(f,v){return wa(f,t[v],r)})}}),ju=6/29*3*(6/29),Sl=Math.PI/180,wu=180/Math.PI;function Ul(e){return e>.008856451679035631?Math.pow(e,1/3):e/ju+4/29}function Vu(e){return e>6/29?e*e*e:ju*(e-4/29)}function Tu(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Na(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Gu(e){var t=Na(e.r),r=Na(e.g),f=Na(e.b),v=Ul((.4124564*t+.3575761*r+.1804375*f)/.95047),y=Ul((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*y-16,a:500*(v-y),b:200*(y-Ul((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function m(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*Vu(t),r=.95047*Vu(r),f=1.08883*Vu(f),new Xi(Tu(3.2404542*r-1.5371385*t-.4985314*f),Tu(-.969266*r+1.8760108*t+.041556*f),Tu(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function w(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var W={forward:Gu,reverse:m,interpolate:function(e,t,r){return{l:wa(e.l,t.l,r),a:wa(e.a,t.a,r),b:wa(e.b,t.b,r),alpha:wa(e.alpha,t.alpha,r)}}},R={forward:function(e){var t=Gu(e),r=t.l,f=t.a,v=t.b,y=Math.atan2(v,f)*wu;return{h:y<0?y+360:y,c:Math.sqrt(f*f+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*Sl,r=e.c;return m({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:w(e.h,t.h,r),c:wa(e.c,t.c,r),l:wa(e.l,t.l,r),alpha:wa(e.alpha,t.alpha,r)}}},le=Object.freeze({__proto__:null,lab:W,hcl:R}),Le=function(e,t,r,f,v){this.type=e,this.operator=t,this.interpolation=r,this.input=f,this.labels=[],this.outputs=[];for(var y=0,S=v;y<S.length;y+=1){var M=S[y],z=M[1];this.labels.push(M[0]),this.outputs.push(z)}};function ct(e,t,r,f){var v=f-r,y=e-r;return v===0?0:t===1?y/v:(Math.pow(t,y)-1)/(Math.pow(t,v)-1)}Le.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=ct(t,e.base,r,f);else if(e.name==="linear")v=ct(t,1,r,f);else if(e.name==="cubic-bezier"){var y=e.controlPoints;v=new Z(y[0],y[1],y[2],y[3]).solve(ct(t,1,r,f))}return v},Le.parse=function(e,t){var r=e[0],f=e[1],v=e[2],y=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var S=f[1];if(typeof S!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:S}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var M=f.slice(1);if(M.length!==4||M.some(function(gt){return typeof gt!="number"||gt<0||gt>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:M}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,tr)))return null;var z=[],Y=null;r==="interpolate-hcl"||r==="interpolate-lab"?Y=cn:t.expectedType&&t.expectedType.kind!=="value"&&(Y=t.expectedType);for(var J=0;J<y.length;J+=2){var ae=y[J],he=y[J+1],ye=J+3,He=J+4;if(typeof ae!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ye);if(z.length&&z[z.length-1][0]>=ae)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ye);var Xe=t.parse(he,He,Y);if(!Xe)return null;Y=Y||Xe.type,z.push([ae,Xe])}return Y.kind==="number"||Y.kind==="color"||Y.kind==="array"&&Y.itemType.kind==="number"&&typeof Y.N=="number"?new Le(Y,r,f,v,z):t.error("Type "+Ni(Y)+" is not interpolatable.")},Le.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var y=ns(t,f),S=Le.interpolationFactor(this.interpolation,f,t[y],t[y+1]),M=r[y].evaluate(e),z=r[y+1].evaluate(e);return this.operator==="interpolate"?vo[this.type.kind.toLowerCase()](M,z,S):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(M),R.forward(z),S)):W.reverse(W.interpolate(W.forward(M),W.forward(z),S))},Le.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Le.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Le.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Nt=function(e,t){this.type=e,this.args=t};Nt.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],y=0,S=e.slice(1);y<S.length;y+=1){var M=t.parse(S[y],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!M)return null;r=r||M.type,v.push(M)}var z=f&&v.some(function(Y){return ha(f,Y.type)});return new Nt(z?xn:r,v)},Nt.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,y=this.args;v<y.length&&(f++,(r=y[v].evaluate(e))&&r instanceof gi&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},Nt.prototype.eachChild=function(e){this.args.forEach(e)},Nt.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Nt.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var kt=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};kt.prototype.evaluate=function(e){return this.result.evaluate(e)},kt.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},kt.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var y=t.parse(e[f+1],f+1);if(!y)return null;r.push([v,y])}var S=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return S?new kt(r,S):null},kt.prototype.outputDefined=function(){return this.result.outputDefined()},kt.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var Tr=function(e,t,r){this.type=e,this.index=t,this.input=r};Tr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,tr),f=t.parse(e[2],2,Ji(t.expectedType||xn));return r&&f?new Tr(f.type.itemType,r,f):null},Tr.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Ka("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Ka("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Ka("Array index must be an integer, but found "+t+" instead.");return r[t]},Tr.prototype.eachChild=function(e){e(this.index),e(this.input)},Tr.prototype.outputDefined=function(){return!1},Tr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Gr=function(e,t){this.type=on,this.needle=e,this.haystack=t};Gr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,xn),f=t.parse(e[2],2,xn);return r&&f?Ca(r.type,[on,Sn,tr,Pn,xn])?new Gr(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ni(r.type)+" instead"):null},Gr.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!ii(t,["boolean","string","number","null"]))throw new Ka("Expected first argument to be of type boolean, string, number or null, but found "+Ni(Aa(t))+" instead.");if(!ii(r,["string","array"]))throw new Ka("Expected second argument to be of type array or string, but found "+Ni(Aa(r))+" instead.");return r.indexOf(t)>=0},Gr.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Gr.prototype.outputDefined=function(){return!0},Gr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Jn=function(e,t,r){this.type=tr,this.needle=e,this.haystack=t,this.fromIndex=r};Jn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,xn),f=t.parse(e[2],2,xn);if(!r||!f)return null;if(!Ca(r.type,[on,Sn,tr,Pn,xn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ni(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,tr);return v?new Jn(r,f,v):null}return new Jn(r,f)},Jn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!ii(t,["boolean","string","number","null"]))throw new Ka("Expected first argument to be of type boolean, string, number or null, but found "+Ni(Aa(t))+" instead.");if(!ii(r,["string","array"]))throw new Ka("Expected second argument to be of type array or string, but found "+Ni(Aa(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},Jn.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},Jn.prototype.outputDefined=function(){return!1},Jn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Mi=function(e,t,r,f,v,y){this.inputType=e,this.type=t,this.input=r,this.cases=f,this.outputs=v,this.otherwise=y};Mi.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},y=[],S=2;S<e.length-1;S+=2){var M=e[S],z=e[S+1];Array.isArray(M)||(M=[M]);var Y=t.concat(S);if(M.length===0)return Y.error("Expected at least one branch label.");for(var J=0,ae=M;J<ae.length;J+=1){var he=ae[J];if(typeof he!="number"&&typeof he!="string")return Y.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return Y.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof he=="number"&&Math.floor(he)!==he)return Y.error("Numeric branch labels must be integer values.");if(r){if(Y.checkSubtype(r,Aa(he)))return null}else r=Aa(he);if(v[String(he)]!==void 0)return Y.error("Branch labels must be unique.");v[String(he)]=y.length}var ye=t.parse(z,S,f);if(!ye)return null;f=f||ye.type,y.push(ye)}var He=t.parse(e[1],1,xn);if(!He)return null;var Xe=t.parse(e[e.length-1],e.length-1,f);return Xe?He.type.kind!=="value"&&t.concat(1).checkSubtype(r,He.type)?null:new Mi(r,f,He,v,y,Xe):null},Mi.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(Aa(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Mi.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Mi.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Mi.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,y=Object.keys(this.cases).sort();v<y.length;v+=1){var S=y[v];(ae=f[this.cases[S]])===void 0?(f[this.cases[S]]=r.length,r.push([this.cases[S],[S]])):r[ae][1].push(S)}for(var M=function(ye){return e.inputType.kind==="number"?Number(ye):ye},z=0,Y=r;z<Y.length;z+=1){var J=Y[z],ae=J[0],he=J[1];t.push(he.length===1?M(he[0]):he.map(M)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var ci=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};ci.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var y=t.parse(e[v],v,on);if(!y)return null;var S=t.parse(e[v+1],v+1,r);if(!S)return null;f.push([y,S]),r=r||S.type}var M=t.parse(e[e.length-1],e.length-1,r);return M?new ci(r,f,M):null},ci.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},ci.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},ci.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},ci.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ti=function(e,t,r,f){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=f};function Ui(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Fa(e,t,r,f){return f.compare(t,r)===0}function ta(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(y,S,M){this.type=on,this.lhs=y,this.rhs=S,this.collator=M,this.hasUntypedArgument=y.type.kind==="value"||S.type.kind==="value"}return v.parse=function(y,S){if(y.length!==3&&y.length!==4)return S.error("Expected two or three arguments.");var M=y[0],z=S.parse(y[1],1,xn);if(!z)return null;if(!Ui(M,z.type))return S.concat(1).error('"'+M+`" comparisons are not supported for type '`+Ni(z.type)+"'.");var Y=S.parse(y[2],2,xn);if(!Y)return null;if(!Ui(M,Y.type))return S.concat(2).error('"'+M+`" comparisons are not supported for type '`+Ni(Y.type)+"'.");if(z.type.kind!==Y.type.kind&&z.type.kind!=="value"&&Y.type.kind!=="value")return S.error("Cannot compare types '"+Ni(z.type)+"' and '"+Ni(Y.type)+"'.");f&&(z.type.kind==="value"&&Y.type.kind!=="value"?z=new ea(Y.type,[z]):z.type.kind!=="value"&&Y.type.kind==="value"&&(Y=new ea(z.type,[Y])));var J=null;if(y.length===4){if(z.type.kind!=="string"&&Y.type.kind!=="string"&&z.type.kind!=="value"&&Y.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(J=S.parse(y[3],3,Li)))return null}return new v(z,Y,J)},v.prototype.evaluate=function(y){var S=this.lhs.evaluate(y),M=this.rhs.evaluate(y);if(f&&this.hasUntypedArgument){var z=Aa(S),Y=Aa(M);if(z.kind!==Y.kind||z.kind!=="string"&&z.kind!=="number")throw new Ka('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+z.kind+", "+Y.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var J=Aa(S),ae=Aa(M);if(J.kind!=="string"||ae.kind!=="string")return t(y,S,M)}return this.collator?r(y,S,M,this.collator.evaluate(y)):t(y,S,M)},v.prototype.eachChild=function(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var y=[e];return this.eachChild(function(S){y.push(S.serialize())}),y},v}()}Ti.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,xn),f=t.parse(e[2],2,tr);if(!r||!f)return null;if(!Ca(r.type,[Ji(xn),Sn,xn]))return t.error("Expected first argument to be of type array or string, but found "+Ni(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,tr);return v?new Ti(r.type,r,f,v):null}return new Ti(r.type,r,f)},Ti.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!ii(t,["string","array"]))throw new Ka("Expected first argument to be of type array or string, but found "+Ni(Aa(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},Ti.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},Ti.prototype.outputDefined=function(){return!1},Ti.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ds=ta("==",function(e,t,r){return t===r},Fa),bo=ta("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!Fa(0,t,r,f)}),Ts=ta("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),iu=ta(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),Ns=ta("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),il=ta(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),Ys=function(e,t,r,f,v){this.type=Sn,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=f,this.maxFractionDigits=v};Ys.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,tr);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,Sn)))return null;var y=null;if(f.currency&&!(y=t.parse(f.currency,1,Sn)))return null;var S=null;if(f["min-fraction-digits"]&&!(S=t.parse(f["min-fraction-digits"],1,tr)))return null;var M=null;return f["max-fraction-digits"]&&!(M=t.parse(f["max-fraction-digits"],1,tr))?null:new Ys(r,v,y,S,M)},Ys.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Ys.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Ys.prototype.outputDefined=function(){return!1},Ys.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Ks=function(e){this.type=tr,this.input=e};Ks.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Ni(r.type)+" instead."):new Ks(r):null},Ks.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Ka("Expected value to be of type string or array, but found "+Ni(Aa(t))+" instead.")},Ks.prototype.eachChild=function(e){e(this.input)},Ks.prototype.outputDefined=function(){return!1},Ks.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var $s={"==":ds,"!=":bo,">":iu,"<":Ts,">=":il,"<=":Ns,array:ea,at:Tr,boolean:ea,case:ci,coalesce:Nt,collator:fs,format:To,image:Oo,in:Gr,"index-of":Jn,interpolate:Le,"interpolate-hcl":Le,"interpolate-lab":Le,length:Ks,let:kt,literal:zi,match:Mi,number:ea,"number-format":Ys,object:ea,slice:Ti,step:ps,string:ea,"to-boolean":fo,"to-color":fo,"to-number":fo,"to-string":fo,var:Si,within:rs};function so(e,t){var r=t[0],f=t[1],v=t[2],y=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var S=y?y.evaluate(e):1,M=Bs(r,f,v,S);if(M)throw new Ka(M);return new Xi(r/255*S,f/255*S,v/255*S,S)}function Au(e,t){return e in t}function al(e,t){var r=t[e];return r===void 0?null:r}function is(e){return{type:e}}function Zl(e){return{result:"success",value:e}}function au(e){return{result:"error",value:e}}function zs(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function cc(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Pu(e){return!!e.expression&&e.expression.interpolated}function Pa(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function Hu(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function jl(e){return e}function Mu(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function fc(e,t,r,f,v){return Mu(typeof r===v?f[r]:void 0,e.default,t.default)}function hf(e,t,r){if(Pa(r)!=="number")return Mu(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=ns(e.stops.map(function(y){return y[0]}),r);return e.stops[v][1]}function El(e,t,r){var f=e.base!==void 0?e.base:1;if(Pa(r)!=="number")return Mu(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var y=ns(e.stops.map(function(ae){return ae[0]}),r),S=function(ae,he,ye,He){var Xe=He-ye,gt=ae-ye;return Xe===0?0:he===1?gt/Xe:(Math.pow(he,gt)-1)/(Math.pow(he,Xe)-1)}(r,f,e.stops[y][0],e.stops[y+1][0]),M=e.stops[y][1],z=e.stops[y+1][1],Y=vo[t.type]||jl;if(e.colorSpace&&e.colorSpace!=="rgb"){var J=le[e.colorSpace];Y=function(ae,he){return J.reverse(J.interpolate(J.forward(ae),J.forward(he),S))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var ae=[],he=arguments.length;he--;)ae[he]=arguments[he];var ye=M.evaluate.apply(void 0,ae),He=z.evaluate.apply(void 0,ae);if(ye!==void 0&&He!==void 0)return Y(ye,He,S)}}:Y(M,z,S)}function hc(e,t,r){return t.type==="color"?r=Xi.parse(r):t.type==="formatted"?r=ba.fromString(r.toString()):t.type==="resolvedImage"?r=gi.fromString(r.toString()):Pa(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),Mu(r,e.default,t.default)}ka.register($s,{error:[{kind:"error"},[Sn],function(e,t){throw new Ka(t[0].evaluate(e))}],typeof:[Sn,[xn],function(e,t){return Ni(Aa(t[0].evaluate(e)))}],"to-rgba":[Ji(tr,4),[cn],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[cn,[tr,tr,tr],so],rgba:[cn,[tr,tr,tr,tr],so],has:{type:on,overloads:[[[Sn],function(e,t){return Au(t[0].evaluate(e),e.properties())}],[[Sn,wi],function(e,t){var r=t[1];return Au(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:xn,overloads:[[[Sn],function(e,t){return al(t[0].evaluate(e),e.properties())}],[[Sn,wi],function(e,t){var r=t[1];return al(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[xn,[Sn],function(e,t){return al(t[0].evaluate(e),e.featureState||{})}],properties:[wi,[],function(e){return e.properties()}],"geometry-type":[Sn,[],function(e){return e.geometryType()}],id:[xn,[],function(e){return e.id()}],zoom:[tr,[],function(e){return e.globals.zoom}],"heatmap-density":[tr,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[tr,[],function(e){return e.globals.lineProgress||0}],accumulated:[xn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[tr,is(tr),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[tr,is(tr),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:tr,overloads:[[[tr,tr],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[tr],function(e,t){return-t[0].evaluate(e)}]]},"/":[tr,[tr,tr],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[tr,[tr,tr],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[tr,[],function(){return Math.LN2}],pi:[tr,[],function(){return Math.PI}],e:[tr,[],function(){return Math.E}],"^":[tr,[tr,tr],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[tr,[tr],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[tr,[tr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[tr,[tr],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[tr,[tr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[tr,[tr],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[tr,[tr],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[tr,[tr],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[tr,[tr],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[tr,[tr],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[tr,[tr],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[tr,is(tr),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[tr,is(tr),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[tr,[tr],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[tr,[tr],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[tr,[tr],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[tr,[tr],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[on,[Sn,xn],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[on,[xn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[on,[Sn],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[on,[Sn,xn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v<y}],"filter-id-<":[on,[xn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[on,[Sn,xn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v>y}],"filter-id->":[on,[xn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[on,[Sn,xn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v<=y}],"filter-id-<=":[on,[xn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[on,[Sn,xn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v>=y}],"filter-id->=":[on,[xn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[on,[xn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[on,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[on,[Ji(Sn)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[on,[Ji(xn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[on,[Sn,Ji(xn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[on,[Sn,Ji(xn)],function(e,t){var r=t[0],f=t[1];return function(v,y,S,M){for(;S<=M;){var z=S+M>>1;if(y[z]===v)return!0;y[z]>v?M=z-1:S=z+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:on,overloads:[[[on,on],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[is(on),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:on,overloads:[[[on,on],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[is(on),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[on,[on],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[on,[Sn],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[Sn,[Sn],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[Sn,[Sn],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[Sn,is(xn),function(e,t){return t.map(function(r){return Io(r.evaluate(e))}).join("")}],"resolved-locale":[Sn,[Li],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var Cl=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Da,this._defaultValue=t?function(r){return r.type==="color"&&Hu(r.default)?new Xi(0,0,0,0):r.type==="color"?Xi.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function vu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in $s}function ol(e,t){var r=new Ds($s,[],t?function(v){var y={color:cn,string:Sn,number:tr,enum:Sn,boolean:on,formatted:$i,resolvedImage:ai};return v.type==="array"?Ji(y[v.value]||xn,v.length):y[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Zl(new Cl(f,t)):au(r.errors)}Cl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,y){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)},Cl.prototype.evaluate=function(e,t,r,f,v,y){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=y||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ka("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var sl=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!Lo(t.expression)};sl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,y){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,y)},sl.prototype.evaluate=function(e,t,r,f,v,y){return this._styleExpression.evaluate(e,t,r,f,v,y)};var Wu=function(e,t,r,f){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!Lo(t.expression),this.interpolationType=f};function ul(e,t){if((e=ol(e,t)).result==="error")return e;var r=e.value.expression,f=Ho(r);if(!f&&!zs(t))return au([new kr("","data expressions not supported")]);var v=xo(r,["zoom"]);if(!v&&!cc(t))return au([new kr("","zoom expressions not supported")]);var y=function S(M){var z=null;if(M instanceof kt)z=S(M.result);else if(M instanceof Nt)for(var Y=0,J=M.args;Y<J.length&&!(z=S(J[Y]));Y+=1);else(M instanceof ps||M instanceof Le)&&M.input instanceof ka&&M.input.name==="zoom"&&(z=M);return z instanceof kr||M.eachChild(function(ae){var he=S(ae);he instanceof kr?z=he:!z&&he?z=new kr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):z&&he&&z!==he&&(z=new kr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),z}(r);return y||v?y instanceof kr?au([y]):y instanceof Le&&!Pu(t)?au([new kr("",'"interpolate" expressions cannot be used with this property')]):Zl(y?new Wu(f?"camera":"composite",e.value,y.labels,y instanceof Le?y.interpolation:void 0):new sl(f?"constant":"source",e.value)):au([new kr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Wu.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,y){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,y)},Wu.prototype.evaluate=function(e,t,r,f,v,y){return this._styleExpression.evaluate(e,t,r,f,v,y)},Wu.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?Le.interpolationFactor(this.interpolationType,e,t,r):0};var Xu=function(e,t){this._parameters=e,this._specification=t,br(this,function r(f,v){var y,S,M,z=v.type==="color",Y=f.stops&&typeof f.stops[0][0]=="object",J=Y||!(Y||f.property!==void 0),ae=f.type||(Pu(v)?"exponential":"interval");if(z&&((f=br({},f)).stops&&(f.stops=f.stops.map(function(Ln){return[Ln[0],Xi.parse(Ln[1])]})),f.default=Xi.parse(f.default?f.default:v.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!le[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(ae==="exponential")y=El;else if(ae==="interval")y=hf;else if(ae==="categorical"){y=fc,S=Object.create(null);for(var he=0,ye=f.stops;he<ye.length;he+=1){var He=ye[he];S[He[0]]=He[1]}M=typeof f.stops[0][0]}else{if(ae!=="identity")throw new Error('Unknown function type "'+ae+'"');y=hc}if(Y){for(var Xe={},gt=[],rt=0;rt<f.stops.length;rt++){var Dt=f.stops[rt],$t=Dt[0].zoom;Xe[$t]===void 0&&(Xe[$t]={zoom:$t,type:f.type,property:f.property,default:f.default,stops:[]},gt.push($t)),Xe[$t].stops.push([Dt[0].value,Dt[1]])}for(var pr=[],mr=0,Or=gt;mr<Or.length;mr+=1){var nn=Or[mr];pr.push([Xe[nn].zoom,r(Xe[nn],v)])}var vn={name:"linear"};return{kind:"composite",interpolationType:vn,interpolationFactor:Le.interpolationFactor.bind(void 0,vn),zoomStops:pr.map(function(Ln){return Ln[0]}),evaluate:function(Ln,si){var zn=Ln.zoom;return El({stops:pr,base:f.base},v,zn).evaluate(zn,si)}}}if(J){var Qn=ae==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:Qn,interpolationFactor:Le.interpolationFactor.bind(void 0,Qn),zoomStops:f.stops.map(function(Ln){return Ln[0]}),evaluate:function(Ln){return y(f,v,Ln.zoom,S,M)}}}return{kind:"source",evaluate:function(Ln,si){var zn=si&&si.properties?si.properties[f.property]:void 0;return zn===void 0?Mu(f.default,v.default):y(f,v,zn,S,M)}}}(this._parameters,this._specification))};function Us(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},y=e.style,S=e.styleSpec,M=[],z=Pa(r);if(z!=="object")return[new Te(t,r,"object expected, "+z+" found")];for(var Y in r){var J=Y.split(".")[0],ae=f[J]||f["*"],he=void 0;if(v[J])he=v[J];else if(f[J])he=ra;else if(v["*"])he=v["*"];else{if(!f["*"]){M.push(new Te(t,r[Y],'unknown property "'+Y+'"'));continue}he=ra}M=M.concat(he({key:(t&&t+".")+Y,value:r[Y],valueSpec:ae,style:y,styleSpec:S,object:r,objectKey:Y},r))}for(var ye in f)v[ye]||f[ye].required&&f[ye].default===void 0&&r[ye]===void 0&&M.push(new Te(t,r,'missing required property "'+ye+'"'));return M}function pc(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,y=e.key,S=e.arrayElementValidator||ra;if(Pa(t)!=="array")return[new Te(y,t,"array expected, "+Pa(t)+" found")];if(r.length&&t.length!==r.length)return[new Te(y,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new Te(y,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var M={type:r.value,values:r.values};v.$version<7&&(M.function=r.function),Pa(r.value)==="object"&&(M=r.value);for(var z=[],Y=0;Y<t.length;Y++)z=z.concat(S({array:t,arrayIndex:Y,value:t[Y],valueSpec:M,style:f,styleSpec:v,key:y+"["+Y+"]"}));return z}function dc(e){var t=e.key,r=e.value,f=e.valueSpec,v=Pa(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new Te(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new Te(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new Te(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function kc(e){var t,r,f,v=e.valueSpec,y=Yt(e.value.type),S={},M=y!=="categorical"&&e.value.property===void 0,z=!M,Y=Pa(e.value.stops)==="array"&&Pa(e.value.stops[0])==="array"&&Pa(e.value.stops[0][0])==="object",J=Us({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(ye){if(y==="identity")return[new Te(ye.key,ye.value,'identity function may not have a "stops" property')];var He=[],Xe=ye.value;return He=He.concat(pc({key:ye.key,value:Xe,valueSpec:ye.valueSpec,style:ye.style,styleSpec:ye.styleSpec,arrayElementValidator:ae})),Pa(Xe)==="array"&&Xe.length===0&&He.push(new Te(ye.key,Xe,"array must have at least one stop")),He},default:function(ye){return ra({key:ye.key,value:ye.value,valueSpec:v,style:ye.style,styleSpec:ye.styleSpec})}}});return y==="identity"&&M&&J.push(new Te(e.key,e.value,'missing required property "property"')),y==="identity"||e.value.stops||J.push(new Te(e.key,e.value,'missing required property "stops"')),y==="exponential"&&e.valueSpec.expression&&!Pu(e.valueSpec)&&J.push(new Te(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(z&&!zs(e.valueSpec)?J.push(new Te(e.key,e.value,"property functions not supported")):M&&!cc(e.valueSpec)&&J.push(new Te(e.key,e.value,"zoom functions not supported"))),y!=="categorical"&&!Y||e.value.property!==void 0||J.push(new Te(e.key,e.value,'"property" property is required')),J;function ae(ye){var He=[],Xe=ye.value,gt=ye.key;if(Pa(Xe)!=="array")return[new Te(gt,Xe,"array expected, "+Pa(Xe)+" found")];if(Xe.length!==2)return[new Te(gt,Xe,"array length 2 expected, length "+Xe.length+" found")];if(Y){if(Pa(Xe[0])!=="object")return[new Te(gt,Xe,"object expected, "+Pa(Xe[0])+" found")];if(Xe[0].zoom===void 0)return[new Te(gt,Xe,"object stop key must have zoom")];if(Xe[0].value===void 0)return[new Te(gt,Xe,"object stop key must have value")];if(f&&f>Yt(Xe[0].zoom))return[new Te(gt,Xe[0].zoom,"stop zoom values must appear in ascending order")];Yt(Xe[0].zoom)!==f&&(f=Yt(Xe[0].zoom),r=void 0,S={}),He=He.concat(Us({key:gt+"[0]",value:Xe[0],valueSpec:{zoom:{}},style:ye.style,styleSpec:ye.styleSpec,objectElementValidators:{zoom:dc,value:he}}))}else He=He.concat(he({key:gt+"[0]",value:Xe[0],valueSpec:{},style:ye.style,styleSpec:ye.styleSpec},Xe));return vu(nr(Xe[1]))?He.concat([new Te(gt+"[1]",Xe[1],"expressions are not allowed in function stops.")]):He.concat(ra({key:gt+"[1]",value:Xe[1],valueSpec:v,style:ye.style,styleSpec:ye.styleSpec}))}function he(ye,He){var Xe=Pa(ye.value),gt=Yt(ye.value),rt=ye.value!==null?ye.value:He;if(t){if(Xe!==t)return[new Te(ye.key,rt,Xe+" stop domain type must match previous stop domain type "+t)]}else t=Xe;if(Xe!=="number"&&Xe!=="string"&&Xe!=="boolean")return[new Te(ye.key,rt,"stop domain value must be a number, string, or boolean")];if(Xe!=="number"&&y!=="categorical"){var Dt="number expected, "+Xe+" found";return zs(v)&&y===void 0&&(Dt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Te(ye.key,rt,Dt)]}return y!=="categorical"||Xe!=="number"||isFinite(gt)&&Math.floor(gt)===gt?y!=="categorical"&&Xe==="number"&&r!==void 0&&gt<r?[new Te(ye.key,rt,"stop domain values must appear in ascending order")]:(r=gt,y==="categorical"&&gt in S?[new Te(ye.key,rt,"stop domain values must be unique")]:(S[gt]=!0,[])):[new Te(ye.key,rt,"integer expected, found "+gt)]}}function Yu(e){var t=(e.expressionContext==="property"?ul:ol)(nr(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new Te(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new Te(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!Lo(r))return[new Te(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!Lo(r))return[new Te(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!xo(r,["zoom","feature-state"]))return[new Te(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!Ho(r))return[new Te(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wl(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(Yt(r))===-1&&v.push(new Te(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(Yt(r))===-1&&v.push(new Te(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function Vl(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!Vl(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}Xu.deserialize=function(e){return new Xu(e._parameters,e._specification)},Xu.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var vc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Gl(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Vl(e)||(e=Iu(e));var t=ol(e,vc);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,f,v){return t.value.evaluate(r,f,{},v)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function Hl(e,t){return e<t?-1:e>t?1:0}function Iu(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?Ou(e[1],e[2],"=="):r==="!="?mu(Ou(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Ou(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(Iu))):r==="all"?["all"].concat(e.slice(1).map(Iu)):r==="none"?["all"].concat(e.slice(1).map(Iu).map(mu)):r==="in"?Wl(e[1],e.slice(2)):r==="!in"?mu(Wl(e[1],e.slice(2))):r==="has"?Ha(e[1]):r==="!has"?mu(Ha(e[1])):r!=="within"||e}function Ou(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function Wl(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(Hl)]]:["filter-in-small",e,["literal",t]]}}function Ha(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function mu(e){return["!",e]}function Xl(e){return Vl(nr(e.value))?Yu(br({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(Pa(f)!=="array")return[new Te(v,f,"array expected, "+Pa(f)+" found")];var y,S=r.styleSpec,M=[];if(f.length<1)return[new Te(v,f,"filter array must have at least 1 element")];switch(M=M.concat(wl({key:v+"[0]",value:f[0],valueSpec:S.filter_operator,style:r.style,styleSpec:r.styleSpec})),Yt(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&Yt(f[1])==="$type"&&M.push(new Te(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&M.push(new Te(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(y=Pa(f[1]))!=="string"&&M.push(new Te(v+"[1]",f[1],"string expected, "+y+" found"));for(var z=2;z<f.length;z++)y=Pa(f[z]),Yt(f[1])==="$type"?M=M.concat(wl({key:v+"["+z+"]",value:f[z],valueSpec:S.geometry_type,style:r.style,styleSpec:r.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&M.push(new Te(v+"["+z+"]",f[z],"string, number, or boolean expected, "+y+" found"));break;case"any":case"all":case"none":for(var Y=1;Y<f.length;Y++)M=M.concat(t({key:v+"["+Y+"]",value:f[Y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":y=Pa(f[1]),f.length!==2?M.push(new Te(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):y!=="string"&&M.push(new Te(v+"[1]",f[1],"string expected, "+y+" found"));break;case"within":y=Pa(f[1]),f.length!==2?M.push(new Te(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):y!=="object"&&M.push(new Te(v+"[1]",f[1],"object expected, "+y+" found"))}return M}(e)}function ll(e,t){var r=e.key,f=e.style,v=e.styleSpec,y=e.value,S=e.objectKey,M=v[t+"_"+e.layerType];if(!M)return[];var z=S.match(/^(.*)-transition$/);if(t==="paint"&&z&&M[z[1]]&&M[z[1]].transition)return ra({key:r,value:y,valueSpec:v.transition,style:f,styleSpec:v});var Y,J=e.valueSpec||M[S];if(!J)return[new Te(r,y,'unknown property "'+S+'"')];if(Pa(y)==="string"&&zs(J)&&!J.tokens&&(Y=/^{([^}]+)}$/.exec(y)))return[new Te(r,y,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(Y[1])+" }`.")];var ae=[];return e.layerType==="symbol"&&(S==="text-field"&&f&&!f.glyphs&&ae.push(new Te(r,y,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Hu(nr(y))&&Yt(y.type)==="identity"&&ae.push(new Te(r,y,'"text-font" does not support identity functions'))),ae.concat(ra({key:e.key,value:y,valueSpec:J,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:S}))}function Yl(e){return ll(e,"paint")}function Lu(e){return ll(e,"layout")}function Kc(e){var t=[],r=e.value,f=e.key,v=e.style,y=e.styleSpec;r.type||r.ref||t.push(new Te(f,r,'either "type" or "ref" is required'));var S,M=Yt(r.type),z=Yt(r.ref);if(r.id)for(var Y=Yt(r.id),J=0;J<e.arrayIndex;J++){var ae=v.layers[J];Yt(ae.id)===Y&&t.push(new Te(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+ae.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(He){He in r&&t.push(new Te(f,r[He],'"'+He+'" is prohibited for ref layers'))}),v.layers.forEach(function(He){Yt(He.id)===z&&(S=He)}),S?S.ref?t.push(new Te(f,r.ref,"ref cannot reference another ref layer")):M=Yt(S.type):t.push(new Te(f,r.ref,'ref layer "'+z+'" not found'));else if(M!=="background")if(r.source){var he=v.sources&&v.sources[r.source],ye=he&&Yt(he.type);he?ye==="vector"&&M==="raster"?t.push(new Te(f,r.source,'layer "'+r.id+'" requires a raster source')):ye==="raster"&&M!=="raster"?t.push(new Te(f,r.source,'layer "'+r.id+'" requires a vector source')):ye!=="vector"||r["source-layer"]?ye==="raster-dem"&&M!=="hillshade"?t.push(new Te(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!r.paint||!r.paint["line-gradient"]||ye==="geojson"&&he.lineMetrics||t.push(new Te(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Te(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new Te(f,r.source,'source "'+r.source+'" not found'))}else t.push(new Te(f,r,'missing required property "source"'));return t=t.concat(Us({key:f,value:r,valueSpec:y.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ra({key:f+".type",value:r.type,valueSpec:y.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:Xl,layout:function(He){return Us({layer:r,key:He.key,value:He.value,style:He.style,styleSpec:He.styleSpec,objectElementValidators:{"*":function(Xe){return Lu(br({layerType:M},Xe))}}})},paint:function(He){return Us({layer:r,key:He.key,value:He.value,style:He.style,styleSpec:He.styleSpec,objectElementValidators:{"*":function(Xe){return Yl(br({layerType:M},Xe))}}})}}}))}function cl(e){var t=e.value,r=e.key,f=Pa(t);return f!=="string"?[new Te(r,t,"string expected, "+f+" found")]:[]}var to={promoteId:function(e){var t=e.key,r=e.value;if(Pa(r)==="string")return cl({key:t,value:r});var f=[];for(var v in r)f.push.apply(f,cl({key:t+"."+v,value:r[v]}));return f}};function fl(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new Te(r,t,'"type" is required')];var y,S=Yt(t.type);switch(S){case"vector":case"raster":case"raster-dem":return Us({key:r,value:t,valueSpec:f["source_"+S.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:to});case"geojson":if(y=Us({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:to}),t.cluster)for(var M in t.clusterProperties){var z=t.clusterProperties[M],Y=z[0],J=typeof Y=="string"?[Y,["accumulated"],["get",M]]:Y;y.push.apply(y,Yu({key:r+"."+M+".map",value:z[1],expressionContext:"cluster-map"})),y.push.apply(y,Yu({key:r+"."+M+".reduce",value:J,expressionContext:"cluster-reduce"}))}return y;case"video":return Us({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return Us({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new Te(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wl({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function Ku(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,y=[],S=Pa(t);if(t===void 0)return y;if(S!=="object")return y.concat([new Te("light",t,"object expected, "+S+" found")]);for(var M in t){var z=M.match(/^(.*)-transition$/);y=y.concat(z&&f[z[1]]&&f[z[1]].transition?ra({key:M,value:t[M],valueSpec:r.transition,style:v,styleSpec:r}):f[M]?ra({key:M,value:t[M],valueSpec:f[M],style:v,styleSpec:r}):[new Te(M,t[M],'unknown property "'+M+'"')])}return y}var ou={"*":function(){return[]},array:pc,boolean:function(e){var t=e.value,r=e.key,f=Pa(t);return f!=="boolean"?[new Te(r,t,"boolean expected, "+f+" found")]:[]},number:dc,color:function(e){var t=e.key,r=e.value,f=Pa(r);return f!=="string"?[new Te(t,r,"color expected, "+f+" found")]:ti(r)===null?[new Te(t,r,'color expected, "'+r+'" found')]:[]},constants:mt,enum:wl,filter:Xl,function:kc,layer:Kc,object:Us,source:fl,light:Ku,string:cl,formatted:function(e){return cl(e).length===0?[]:Yu(e)},resolvedImage:function(e){return cl(e).length===0?[]:Yu(e)}};function ra(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&Hu(Yt(t))?kc(e):r.expression&&vu(nr(t))?Yu(e):r.type&&ou[r.type]?ou[r.type](e):Us(br({},e,{valueSpec:r.type?f[r.type]:r}))}function za(e){var t=e.value,r=e.key,f=cl(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new Te(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new Te(r,t,'"glyphs" url must include a "{range}" token'))),f}function _s(e,t){t===void 0&&(t=ue);var r=[];return r=r.concat(ra({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:za,"*":function(){return[]}}})),e.constants&&(r=r.concat(mt({key:"constants",value:e.constants,style:e,styleSpec:t}))),Kl(r)}function Kl(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function yu(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return Kl(e.apply(this,t))}}_s.source=yu(fl),_s.light=yu(Ku),_s.layer=yu(Kc),_s.filter=yu(Xl),_s.paintProperty=yu(Yl),_s.layoutProperty=yu(Lu);var $l=_s,$c=$l.light,Jc=$l.paintProperty,Tl=$l.layoutProperty;function Al(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new de(new Error(v[f].message))),r=!0;return r}var Ru=Ro;function Ro(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var y=0;y<this.d*this.d;y++){var S=v[3+y],M=v[3+y+1];f.push(S===M?null:v.subarray(S,M))}var z=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],z),this.bboxes=v.subarray(z),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var Y=0;Y<this.d*this.d;Y++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var J=r/t*e;this.min=-J,this.max=e+J}Ro.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},Ro.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ro.prototype._insertCell=function(e,t,r,f,v,y){this.cells[v].push(y)},Ro.prototype.query=function(e,t,r,f,v){var y=this.min,S=this.max;if(e<=y&&t<=y&&S<=r&&S<=f&&!v)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(e,t,r,f,this._queryCell,M,{},v),M},Ro.prototype._queryCell=function(e,t,r,f,v,y,S,M){var z=this.cells[v];if(z!==null)for(var Y=this.keys,J=this.bboxes,ae=0;ae<z.length;ae++){var he=z[ae];if(S[he]===void 0){var ye=4*he;(M?M(J[ye+0],J[ye+1],J[ye+2],J[ye+3]):e<=J[ye+2]&&t<=J[ye+3]&&r>=J[ye+0]&&f>=J[ye+1])?(S[he]=!0,y.push(Y[he])):S[he]=!1}}},Ro.prototype._forEachCell=function(e,t,r,f,v,y,S,M){for(var z=this._convertToCellCoord(e),Y=this._convertToCellCoord(t),J=this._convertToCellCoord(r),ae=this._convertToCellCoord(f),he=z;he<=J;he++)for(var ye=Y;ye<=ae;ye++){var He=this.d*ye+he;if((!M||M(this._convertFromCellCoord(he),this._convertFromCellCoord(ye),this._convertFromCellCoord(he+1),this._convertFromCellCoord(ye+1)))&&v.call(this,e,t,r,f,He,y,S,M))return}},Ro.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Ro.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Ro.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var y=t,S=0;S<e.length;S++){var M=e[S];v[3+S]=y,v.set(M,y),y+=M.length}return v[3+e.length]=y,v.set(this.keys,y),v[3+e.length+1]=y+=this.keys.length,v.set(this.bboxes,y),y+=this.bboxes.length,v.buffer};var Pl=L.ImageData,Zs=L.ImageBitmap,So={};function kn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),So[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var ho in kn("Object",Object),Ru.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Ru.deserialize=function(e){return new Ru(e.buffer)},kn("Grid",Ru),kn("Color",Xi),kn("Error",Error),kn("ResolvedImage",gi),kn("StylePropertyFunction",Xu),kn("StyleExpression",Cl,{omit:["_evaluator"]}),kn("ZoomDependentExpression",Wu),kn("ZoomConstantExpression",sl),kn("CompoundExpression",ka,{omit:["_evaluate"]}),$s)$s[ho]._classRegistryKey||kn("Expression_"+ho,$s[ho]);function gu(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function hl(e){return Zs&&e instanceof Zs}function Js(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(gu(e)||hl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof Pl)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,y=e;v<y.length;v+=1)f.push(Js(y[v],t));return f}if(typeof e=="object"){var S=e.constructor,M=S._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var z=S.serialize?S.serialize(e,t):{};if(!S.serialize){for(var Y in e)if(e.hasOwnProperty(Y)&&!(So[M].omit.indexOf(Y)>=0)){var J=e[Y];z[Y]=So[M].shallow.indexOf(Y)>=0?J:Js(J,t)}e instanceof Error&&(z.message=e.message)}if(z.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(z.$name=M),z}throw new Error("can't serialize object of type "+typeof e)}function As(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||gu(e)||hl(e)||ArrayBuffer.isView(e)||e instanceof Pl)return e;if(Array.isArray(e))return e.map(As);if(typeof e=="object"){var t=e.$name||"Object",r=So[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,y=Object.keys(e);v<y.length;v+=1){var S=y[v];if(S!=="$name"){var M=e[S];f[S]=So[t].shallow.indexOf(S)>=0?M:As(M)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var mc=function(){this.first=!0};mc.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var mn={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Jl(e){for(var t=0,r=e;t<r.length;t+=1)if(Ql(r[t].charCodeAt(0)))return!0;return!1}function Ql(e){return!(e!==746&&e!==747&&(e<4352||!(mn["Bopomofo Extended"](e)||mn.Bopomofo(e)||mn["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||mn["CJK Compatibility Ideographs"](e)||mn["CJK Compatibility"](e)||mn["CJK Radicals Supplement"](e)||mn["CJK Strokes"](e)||!(!mn["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||mn["CJK Unified Ideographs Extension A"](e)||mn["CJK Unified Ideographs"](e)||mn["Enclosed CJK Letters and Months"](e)||mn["Hangul Compatibility Jamo"](e)||mn["Hangul Jamo Extended-A"](e)||mn["Hangul Jamo Extended-B"](e)||mn["Hangul Jamo"](e)||mn["Hangul Syllables"](e)||mn.Hiragana(e)||mn["Ideographic Description Characters"](e)||mn.Kanbun(e)||mn["Kangxi Radicals"](e)||mn["Katakana Phonetic Extensions"](e)||mn.Katakana(e)&&e!==12540||!(!mn["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!mn["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||mn["Unified Canadian Aboriginal Syllabics"](e)||mn["Unified Canadian Aboriginal Syllabics Extended"](e)||mn["Vertical Forms"](e)||mn["Yijing Hexagram Symbols"](e)||mn["Yi Syllables"](e)||mn["Yi Radicals"](e))))}function Du(e){return!(Ql(e)||function(t){return!!(mn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||mn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||mn["Letterlike Symbols"](t)||mn["Number Forms"](t)||mn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||mn["Control Pictures"](t)&&t!==9251||mn["Optical Character Recognition"](t)||mn["Enclosed Alphanumerics"](t)||mn["Geometric Shapes"](t)||mn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||mn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||mn["CJK Symbols and Punctuation"](t)||mn.Katakana(t)||mn["Private Use Area"](t)||mn["CJK Compatibility Forms"](t)||mn["Small Form Variants"](t)||mn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function ja(e){return e>=1424&&e<=2303||mn["Arabic Presentation Forms-A"](e)||mn["Arabic Presentation Forms-B"](e)}function Ps(e,t){return!(!t&&ja(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||mn.Khmer(e))}function ql(e){for(var t=0,r=e;t<r.length;t+=1)if(ja(r[t].charCodeAt(0)))return!0;return!1}var _u=null,Ms="unavailable",xu=null,Fc=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Ms="error"),_u&&_u(e)};function Ml(){yc.fire(new se("pluginStateChange",{pluginStatus:Ms,pluginURL:xu}))}var yc=new Me,gc=function(){return Ms},Qs=function(){if(Ms!=="deferred"||!xu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ms="loading",Ml(),xu&&ki({url:xu},function(e){e?Fc(e):(Ms="loaded",Ml())})},Is={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ms==="loaded"||Is.applyArabicShaping!=null},isLoading:function(){return Ms==="loading"},setState:function(e){Ms=e.pluginStatus,xu=e.pluginURL},isParsed:function(){return Is.applyArabicShaping!=null&&Is.processBidirectionalText!=null&&Is.processStyledBidirectionalText!=null},getPluginURL:function(){return xu}},na=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new mc,this.transition={})};na.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!Ps(v[f].charCodeAt(0),r))return!1;return!0}(e,Is.isLoaded())},na.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},na.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var bu=function(e,t){this.property=e,this.value=t,this.expression=function(r,f){if(Hu(r))return new Xu(r,f);if(vu(r)){var v=ul(r,f);if(v.result==="error")throw new Error(v.value.map(function(S){return S.key+": "+S.message}).join(", "));return v.value}var y=r;return typeof r=="string"&&f.type==="color"&&(y=Xi.parse(r)),{kind:"constant",evaluate:function(){return y}}}(t===void 0?e.specification.default:t,e.specification)};bu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},bu.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var qs=function(e){this.property=e,this.value=new bu(e,void 0)};qs.prototype.transitioned=function(e,t){return new $u(this.property,this.value,t,Lt({},e.transition,this.transition),e.now)},qs.prototype.untransitioned=function(){return new $u(this.property,this.value,null,{},0)};var No=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};No.prototype.getValue=function(e){return Je(this._values[e].value.value)},No.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new qs(this._values[e].property)),this._values[e].value=new bu(this._values[e].property,t===null?void 0:Je(t))},No.prototype.getTransition=function(e){return Je(this._values[e].transition)},No.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new qs(this._values[e].property)),this._values[e].transition=Je(t)||void 0},No.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var y=this.getTransition(f);y!==void 0&&(e[f+"-transition"]=y)}return e},No.prototype.transitioned=function(e,t){for(var r=new su(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var y=v[f];r._values[y]=this._values[y].transitioned(e,t._values[y])}return r},No.prototype.untransitioned=function(){for(var e=new su(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var $u=function(e,t,r,f,v){this.property=e,this.value=t,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=r)};$u.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),y=this.prior;if(y){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return y.possiblyEvaluate(e,t,r);var S=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,t,r),v,function(M){if(M<=0)return 0;if(M>=1)return 1;var z=M*M,Y=z*M;return 4*(M<.5?Y:3*(M-z)+Y-.75)}(S))}return v};var su=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};su.prototype.possiblyEvaluate=function(e,t,r){for(var f=new ku(this._properties),v=0,y=Object.keys(this._values);v<y.length;v+=1){var S=y[v];f._values[S]=this._values[S].possiblyEvaluate(e,t,r)}return f},su.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var uu=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};uu.prototype.getValue=function(e){return Je(this._values[e].value)},uu.prototype.setValue=function(e,t){this._values[e]=new bu(this._values[e].property,t===null?void 0:Je(t))},uu.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},uu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new ku(this._properties),v=0,y=Object.keys(this._values);v<y.length;v+=1){var S=y[v];f._values[S]=this._values[S].possiblyEvaluate(e,t,r)}return f};var Eo=function(e,t,r){this.property=e,this.value=t,this.parameters=r};Eo.prototype.isConstant=function(){return this.value.kind==="constant"},Eo.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},Eo.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var ku=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};ku.prototype.get=function(e){return this._values[e]};var ni=function(e){this.specification=e};ni.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},ni.prototype.interpolate=function(e,t,r){var f=vo[this.specification.type];return f?f(e,t,r):e};var Hn=function(e,t){this.specification=e,this.overrides=t};Hn.prototype.possiblyEvaluate=function(e,t,r,f){return new Eo(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},Hn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new Eo(this,{kind:"constant",value:void 0},e.parameters);var f=vo[this.specification.type];return f?new Eo(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},Hn.prototype.evaluate=function(e,t,r,f,v,y){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,y)};var Il=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,y){if(r.value===void 0)return new Eo(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var S=r.expression.evaluate(f,null,{},v,y),M=r.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,z=this._calculate(M,M,M,f);return new Eo(this,{kind:"constant",value:z},f)}if(r.expression.kind==="camera"){var Y=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new Eo(this,{kind:"constant",value:Y},f)}return new Eo(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,y,S,M){if(r.kind==="source"){var z=r.evaluate(f,v,y,S,M);return this._calculate(z,z,z,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,y),r.evaluate({zoom:Math.floor(f.zoom)},v,y),r.evaluate({zoom:Math.floor(f.zoom)+1},v,y),f):r.value},t.prototype._calculate=function(r,f,v,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}(Hn),as=function(e){this.specification=e};as.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new na(Math.floor(t.zoom-1),t)),e.expression.evaluate(new na(Math.floor(t.zoom),t)),e.expression.evaluate(new na(Math.floor(t.zoom+1),t)),t)}},as.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},as.prototype.interpolate=function(e){return e};var js=function(e){this.specification=e};js.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},js.prototype.interpolate=function(){return!1};var Wo=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new bu(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new qs(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};kn("DataDrivenProperty",Hn),kn("DataConstantProperty",ni),kn("CrossFadedDataDrivenProperty",Il),kn("CrossFadedProperty",as),kn("ColorRampProperty",js);var lu=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new uu(f.layout)),f.paint)){for(var v in this._transitionablePaint=new No(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var y in r.layout)this.setLayoutProperty(y,r.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ku(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(Tl,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return ee(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(Jc,"layers."+this.id+".paint."+r,r,f,v))return!1;if(ee(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var y=this._transitionablePaint._values[r],S=y.property.specification["property-type"]==="cross-faded-data-driven",M=y.value.isDataDriven(),z=y.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var Y=this._transitionablePaint._values[r].value;return Y.isDataDriven()||M||S||this._handleOverridablePaintPropertyUpdate(r,z,Y)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),At(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,y,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Al(this,r.call($l,{key:f,layerType:this.type,objectKey:v,value:y,styleSpec:ue,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof Eo&&zs(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(Me),_c={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ec=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Qi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Do(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var y=_c[v.type].BYTES_PER_ELEMENT,S=r=Bc(r,Math.max(t,y)),M=v.components||1;return f=Math.max(f,y),r+=y*M,{name:v.name,type:v.type,components:M,offset:S}}),size:Bc(r,Math.max(f,t)),alignment:t}}function Bc(e,t){return Math.ceil(e/t)*t}Qi.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Qi.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Qi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Qi.prototype.clear=function(){this.length=0},Qi.prototype.resize=function(e){this.reserve(e),this.length=e},Qi.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Qi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var xs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var y=2*r;return this.int16[y+0]=f,this.int16[y+1]=v,r},t}(Qi);xs.prototype.bytesPerElement=4,kn("StructArrayLayout2i4",xs);var Ol=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y){var S=this.length;return this.resize(S+1),this.emplace(S,r,f,v,y)},t.prototype.emplace=function(r,f,v,y,S){var M=4*r;return this.int16[M+0]=f,this.int16[M+1]=v,this.int16[M+2]=y,this.int16[M+3]=S,r},t}(Qi);Ol.prototype.bytesPerElement=8,kn("StructArrayLayout4i8",Ol);var bs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,S,M){var z=this.length;return this.resize(z+1),this.emplace(z,r,f,v,y,S,M)},t.prototype.emplace=function(r,f,v,y,S,M,z){var Y=6*r;return this.int16[Y+0]=f,this.int16[Y+1]=v,this.int16[Y+2]=y,this.int16[Y+3]=S,this.int16[Y+4]=M,this.int16[Y+5]=z,r},t}(Qi);bs.prototype.bytesPerElement=12,kn("StructArrayLayout2i4i12",bs);var vs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,S,M){var z=this.length;return this.resize(z+1),this.emplace(z,r,f,v,y,S,M)},t.prototype.emplace=function(r,f,v,y,S,M,z){var Y=4*r,J=8*r;return this.int16[Y+0]=f,this.int16[Y+1]=v,this.uint8[J+4]=y,this.uint8[J+5]=S,this.uint8[J+6]=M,this.uint8[J+7]=z,r},t}(Qi);vs.prototype.bytesPerElement=8,kn("StructArrayLayout2i4ub8",vs);var pl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var y=2*r;return this.float32[y+0]=f,this.float32[y+1]=v,r},t}(Qi);pl.prototype.bytesPerElement=8,kn("StructArrayLayout2f8",pl);var cu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,S,M,z,Y,J,ae){var he=this.length;return this.resize(he+1),this.emplace(he,r,f,v,y,S,M,z,Y,J,ae)},t.prototype.emplace=function(r,f,v,y,S,M,z,Y,J,ae,he){var ye=10*r;return this.uint16[ye+0]=f,this.uint16[ye+1]=v,this.uint16[ye+2]=y,this.uint16[ye+3]=S,this.uint16[ye+4]=M,this.uint16[ye+5]=z,this.uint16[ye+6]=Y,this.uint16[ye+7]=J,this.uint16[ye+8]=ae,this.uint16[ye+9]=he,r},t}(Qi);cu.prototype.bytesPerElement=20,kn("StructArrayLayout10ui20",cu);var tc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,S,M,z,Y,J,ae,he,ye){var He=this.length;return this.resize(He+1),this.emplace(He,r,f,v,y,S,M,z,Y,J,ae,he,ye)},t.prototype.emplace=function(r,f,v,y,S,M,z,Y,J,ae,he,ye,He){var Xe=12*r;return this.int16[Xe+0]=f,this.int16[Xe+1]=v,this.int16[Xe+2]=y,this.int16[Xe+3]=S,this.uint16[Xe+4]=M,this.uint16[Xe+5]=z,this.uint16[Xe+6]=Y,this.uint16[Xe+7]=J,this.int16[Xe+8]=ae,this.int16[Xe+9]=he,this.int16[Xe+10]=ye,this.int16[Xe+11]=He,r},t}(Qi);tc.prototype.bytesPerElement=24,kn("StructArrayLayout4i4ui4i24",tc);var Ju=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var S=3*r;return this.float32[S+0]=f,this.float32[S+1]=v,this.float32[S+2]=y,r},t}(Qi);Ju.prototype.bytesPerElement=12,kn("StructArrayLayout3f12",Ju);var dl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}(Qi);dl.prototype.bytesPerElement=4,kn("StructArrayLayout1ul4",dl);var Nc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,S,M,z,Y,J){var ae=this.length;return this.resize(ae+1),this.emplace(ae,r,f,v,y,S,M,z,Y,J)},t.prototype.emplace=function(r,f,v,y,S,M,z,Y,J,ae){var he=10*r,ye=5*r;return this.int16[he+0]=f,this.int16[he+1]=v,this.int16[he+2]=y,this.int16[he+3]=S,this.int16[he+4]=M,this.int16[he+5]=z,this.uint32[ye+3]=Y,this.uint16[he+8]=J,this.uint16[he+9]=ae,r},t}(Qi);Nc.prototype.bytesPerElement=20,kn("StructArrayLayout6i1ul2ui20",Nc);var Ll=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,S,M){var z=this.length;return this.resize(z+1),this.emplace(z,r,f,v,y,S,M)},t.prototype.emplace=function(r,f,v,y,S,M,z){var Y=6*r;return this.int16[Y+0]=f,this.int16[Y+1]=v,this.int16[Y+2]=y,this.int16[Y+3]=S,this.int16[Y+4]=M,this.int16[Y+5]=z,r},t}(Qi);Ll.prototype.bytesPerElement=12,kn("StructArrayLayout2i2i2i12",Ll);var vl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,S){var M=this.length;return this.resize(M+1),this.emplace(M,r,f,v,y,S)},t.prototype.emplace=function(r,f,v,y,S,M){var z=4*r,Y=8*r;return this.float32[z+0]=f,this.float32[z+1]=v,this.float32[z+2]=y,this.int16[Y+6]=S,this.int16[Y+7]=M,r},t}(Qi);vl.prototype.bytesPerElement=16,kn("StructArrayLayout2f1f2i16",vl);var xc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y){var S=this.length;return this.resize(S+1),this.emplace(S,r,f,v,y)},t.prototype.emplace=function(r,f,v,y,S){var M=12*r,z=3*r;return this.uint8[M+0]=f,this.uint8[M+1]=v,this.float32[z+1]=y,this.float32[z+2]=S,r},t}(Qi);xc.prototype.bytesPerElement=12,kn("StructArrayLayout2ub2f12",xc);var Qu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var S=3*r;return this.uint16[S+0]=f,this.uint16[S+1]=v,this.uint16[S+2]=y,r},t}(Qi);Qu.prototype.bytesPerElement=6,kn("StructArrayLayout3ui6",Qu);var Fu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,S,M,z,Y,J,ae,he,ye,He,Xe,gt,rt,Dt){var $t=this.length;return this.resize($t+1),this.emplace($t,r,f,v,y,S,M,z,Y,J,ae,he,ye,He,Xe,gt,rt,Dt)},t.prototype.emplace=function(r,f,v,y,S,M,z,Y,J,ae,he,ye,He,Xe,gt,rt,Dt,$t){var pr=24*r,mr=12*r,Or=48*r;return this.int16[pr+0]=f,this.int16[pr+1]=v,this.uint16[pr+2]=y,this.uint16[pr+3]=S,this.uint32[mr+2]=M,this.uint32[mr+3]=z,this.uint32[mr+4]=Y,this.uint16[pr+10]=J,this.uint16[pr+11]=ae,this.uint16[pr+12]=he,this.float32[mr+7]=ye,this.float32[mr+8]=He,this.uint8[Or+36]=Xe,this.uint8[Or+37]=gt,this.uint8[Or+38]=rt,this.uint32[mr+10]=Dt,this.int16[pr+22]=$t,r},t}(Qi);Fu.prototype.bytesPerElement=48,kn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Fu);var rc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,S,M,z,Y,J,ae,he,ye,He,Xe,gt,rt,Dt,$t,pr,mr,Or,nn,vn,Qn,Ln,si,zn,sa){var xi=this.length;return this.resize(xi+1),this.emplace(xi,r,f,v,y,S,M,z,Y,J,ae,he,ye,He,Xe,gt,rt,Dt,$t,pr,mr,Or,nn,vn,Qn,Ln,si,zn,sa)},t.prototype.emplace=function(r,f,v,y,S,M,z,Y,J,ae,he,ye,He,Xe,gt,rt,Dt,$t,pr,mr,Or,nn,vn,Qn,Ln,si,zn,sa,xi){var qn=34*r,fa=17*r;return this.int16[qn+0]=f,this.int16[qn+1]=v,this.int16[qn+2]=y,this.int16[qn+3]=S,this.int16[qn+4]=M,this.int16[qn+5]=z,this.int16[qn+6]=Y,this.int16[qn+7]=J,this.uint16[qn+8]=ae,this.uint16[qn+9]=he,this.uint16[qn+10]=ye,this.uint16[qn+11]=He,this.uint16[qn+12]=Xe,this.uint16[qn+13]=gt,this.uint16[qn+14]=rt,this.uint16[qn+15]=Dt,this.uint16[qn+16]=$t,this.uint16[qn+17]=pr,this.uint16[qn+18]=mr,this.uint16[qn+19]=Or,this.uint16[qn+20]=nn,this.uint16[qn+21]=vn,this.uint16[qn+22]=Qn,this.uint32[fa+12]=Ln,this.float32[fa+13]=si,this.float32[fa+14]=zn,this.float32[fa+15]=sa,this.float32[fa+16]=xi,r},t}(Qi);rc.prototype.bytesPerElement=68,kn("StructArrayLayout8i15ui1ul4f68",rc);var Bu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}(Qi);Bu.prototype.bytesPerElement=4,kn("StructArrayLayout1f4",Bu);var Vs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var S=3*r;return this.int16[S+0]=f,this.int16[S+1]=v,this.int16[S+2]=y,r},t}(Qi);Vs.prototype.bytesPerElement=6,kn("StructArrayLayout3i6",Vs);var bc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var S=4*r;return this.uint32[2*r+0]=f,this.uint16[S+2]=v,this.uint16[S+3]=y,r},t}(Qi);bc.prototype.bytesPerElement=8,kn("StructArrayLayout1ul2ui8",bc);var Nu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var y=2*r;return this.uint16[y+0]=f,this.uint16[y+1]=v,r},t}(Qi);Nu.prototype.bytesPerElement=4,kn("StructArrayLayout2ui4",Nu);var nc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}(Qi);nc.prototype.bytesPerElement=2,kn("StructArrayLayout1ui2",nc);var qu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y){var S=this.length;return this.resize(S+1),this.emplace(S,r,f,v,y)},t.prototype.emplace=function(r,f,v,y,S){var M=4*r;return this.float32[M+0]=f,this.float32[M+1]=v,this.float32[M+2]=y,this.float32[M+3]=S,r},t}(Qi);qu.prototype.bytesPerElement=16,kn("StructArrayLayout4f16",qu);var n=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new H(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(ec);n.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new n(this,r)},t}(Nc);kn("CollisionBoxArray",u);var a=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(ec);a.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new a(this,r)},t}(Fu);kn("PlacedSymbolArray",h);var _=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(ec);_.prototype.size=68;var C=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new _(this,r)},t}(rc);kn("SymbolInstanceArray",C);var P=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(Bu);kn("GlyphOffsetArray",P);var N=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(Vs);kn("SymbolLineVertexArray",N);var K=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(ec);K.prototype.size=8;var oe=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new K(this,r)},t}(bc);kn("FeatureIndexArray",oe);var Ce=Do([{name:"a_pos",components:2,type:"Int16"}],4).members,we=function(e){e===void 0&&(e=[]),this.segments=e};function Ie(e,t){return 256*(e=$e(Math.floor(e),0,255))+$e(Math.floor(t),0,255)}we.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>we.MAX_VERTEX_ARRAY_LENGTH&&Ve("Max vertices per segment is "+we.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>we.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},we.prototype.get=function(){return this.segments},we.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},we.simpleSegment=function(e,t,r,f){return new we([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},we.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,kn("SegmentVector",we);var Ke=Do([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),We=E(function(e){e.exports=function(t,r){var f,v,y,S,M,z,Y,J;for(v=t.length-(f=3&t.length),y=r,M=3432918353,z=461845907,J=0;J<v;)Y=255&t.charCodeAt(J)|(255&t.charCodeAt(++J))<<8|(255&t.charCodeAt(++J))<<16|(255&t.charCodeAt(++J))<<24,++J,y=27492+(65535&(S=5*(65535&(y=(y^=Y=(65535&(Y=(Y=(65535&Y)*M+(((Y>>>16)*M&65535)<<16)&4294967295)<<15|Y>>>17))*z+(((Y>>>16)*z&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(Y=0,f){case 3:Y^=(255&t.charCodeAt(J+2))<<16;case 2:Y^=(255&t.charCodeAt(J+1))<<8;case 1:y^=Y=(65535&(Y=(Y=(65535&(Y^=255&t.charCodeAt(J)))*M+(((Y>>>16)*M&65535)<<16)&4294967295)<<15|Y>>>17))*z+(((Y>>>16)*z&65535)<<16)&4294967295}return y^=t.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}}),ot=E(function(e){e.exports=function(t,r){for(var f,v=t.length,y=r^v,S=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(S)|(255&t.charCodeAt(++S))<<8|(255&t.charCodeAt(++S))<<16|(255&t.charCodeAt(++S))<<24))+((1540483477*(f>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++S;switch(v){case 3:y^=(255&t.charCodeAt(S+2))<<16;case 2:y^=(255&t.charCodeAt(S+1))<<8;case 1:y=1540483477*(65535&(y^=255&t.charCodeAt(S)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}}),je=We,st=ot;je.murmur3=We,je.murmur2=st;var wt=function(){this.ids=[],this.positions=[],this.indexed=!1};wt.prototype.add=function(e,t,r,f){this.ids.push(gr(e)),this.positions.push(t,r,f)},wt.prototype.getPositions=function(e){for(var t=gr(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var y=[];this.ids[r]===t;)y.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return y},wt.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(y,S,M,z){for(;M<z;){for(var Y=y[M+z>>1],J=M-1,ae=z+1;;){do J++;while(y[J]<Y);do ae--;while(y[ae]>Y);if(J>=ae)break;cr(y,J,ae),cr(S,3*J,3*ae),cr(S,3*J+1,3*ae+1),cr(S,3*J+2,3*ae+2)}ae-M<z-ae?(v(y,S,M,ae),M=ae+1):(v(y,S,ae+1,z),z=ae)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},wt.deserialize=function(e){var t=new wt;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Wt=Math.pow(2,53)-1;function gr(e){var t=+e;return!isNaN(t)&&t<=Wt?t:je(String(e))}function cr(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}kn("FeaturePositionMap",wt);var xr=function(e,t){this.gl=e.gl,this.location=t},zr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(xr),an=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(xr),Qr=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(xr),Cn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(xr),ei=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(xr),fi=function(e){function t(r,f){e.call(this,r,f),this.current=Xi.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(xr),ri=new Float32Array(16),ia=function(e){function t(r,f){e.call(this,r,f),this.current=ri}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(xr);function Nn(e){return[Ie(255*e.r,255*e.g),Ie(255*e.b,255*e.a)]}var _i=function(e,t,r){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=r};_i.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},_i.prototype.getBinding=function(e,t,r){return this.type==="color"?new fi(e,t):new an(e,t)};var Zi=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Zi.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Zi.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},Zi.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new ei(e,t):new an(e,t)};var q=function(e,t,r,f){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new f};q.prototype.populatePaintArray=function(e,t,r,f,v){var y=this.paintVertexArray.length,S=this.expression.evaluate(new na(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(y,e,S)},q.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},q.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=Nn(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var y=e;y<t;y++)this.paintVertexArray.emplace(y,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},q.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},q.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var te=function(e,t,r,f,v,y){this.expression=e,this.uniformNames=t.map(function(S){return"u_"+S+"_t"}),this.type=r,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(S){return{name:"a_"+S,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new y};te.prototype.populatePaintArray=function(e,t,r,f,v){var y=this.expression.evaluate(new na(this.zoom),t,{},f,[],v),S=this.expression.evaluate(new na(this.zoom+1),t,{},f,[],v),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,y,S)},te.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),y=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,y)},te.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=Nn(r),y=Nn(f),S=e;S<t;S++)this.paintVertexArray.emplace(S,v[0],v[1],y[0],y[1]);else{for(var M=e;M<t;M++)this.paintVertexArray.emplace(M,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},te.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},te.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},te.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=$e(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},te.prototype.getBinding=function(e,t,r){return new an(e,t)};var k=function(e,t,r,f,v,y){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=f,this.layerId=y,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};k.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},k.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},k.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],y=f[r.mid],S=f[r.max];if(v&&y&&S)for(var M=e;M<t;M++)this.zoomInPaintVertexArray.emplace(M,y.tl[0],y.tl[1],y.br[0],y.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],y.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,y.tl[0],y.tl[1],y.br[0],y.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],y.pixelRatio,S.pixelRatio)}},k.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ke.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ke.members,this.expression.isStateDependent))},k.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var F=function(e,t,r){this.binders={},this._buffers=[];var f=[];for(var v in e.paint._values)if(r(v)){var y=e.paint.get(v);if(y instanceof Eo&&zs(y.property.specification)){var S=Ae(v,e.type),M=y.value,z=y.property.specification.type,Y=y.property.useIntegerZoom,J=y.property.specification["property-type"],ae=J==="cross-faded"||J==="cross-faded-data-driven";if(M.kind==="constant")this.binders[v]=ae?new Zi(M.value,S):new _i(M.value,S,z),f.push("/u_"+v);else if(M.kind==="source"||ae){var he=ft(v,z,"source");this.binders[v]=ae?new k(M,z,Y,t,he,e.id):new q(M,S,z,he),f.push("/a_"+v)}else{var ye=ft(v,z,"composite");this.binders[v]=new te(M,S,z,Y,t,ye),f.push("/z_"+v)}}}this.cacheKey=f.sort().join("")};F.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof q||t instanceof te?t.maxValue:0},F.prototype.populatePaintArrays=function(e,t,r,f,v){for(var y in this.binders){var S=this.binders[y];(S instanceof q||S instanceof te||S instanceof k)&&S.populatePaintArray(e,t,r,f,v)}},F.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof Zi&&f.setConstantPatternPositions(e,t)}},F.prototype.updatePaintArrays=function(e,t,r,f,v){var y=!1;for(var S in e)for(var M=0,z=t.getPositions(S);M<z.length;M+=1){var Y=z[M],J=r.feature(Y.index);for(var ae in this.binders){var he=this.binders[ae];if((he instanceof q||he instanceof te||he instanceof k)&&he.expression.isStateDependent===!0){var ye=f.paint.get(ae);he.expression=ye.value,he.updatePaintArray(Y.start,Y.end,J,e[S],v),y=!0}}}return y},F.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof _i||r instanceof Zi)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},F.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof q||r instanceof te)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof k)for(var v=0;v<Ke.members.length;v++)e.push(Ke.members[v].name)}return e},F.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof _i||r instanceof Zi||r instanceof te)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},F.prototype.getPaintVertexBuffers=function(){return this._buffers},F.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof _i||v instanceof Zi||v instanceof te)for(var y=0,S=v.uniformNames;y<S.length;y+=1){var M=S[y];if(t[M]){var z=v.getBinding(e,t[M],M);r.push({name:M,property:f,binding:z})}}}return r},F.prototype.setUniforms=function(e,t,r,f){for(var v=0,y=t;v<y.length;v+=1){var S=y[v],M=S.name,z=S.property;this.binders[z].setUniform(S.binding,f,r.get(z),M)}},F.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof k){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof q||r instanceof te)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},F.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof q||r instanceof te||r instanceof k)&&r.upload(e)}this.updatePaintBuffers()},F.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof q||t instanceof te||t instanceof k)&&t.destroy()}};var ie=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var f=0,v=e;f<v.length;f+=1){var y=v[f];this.programConfigurations[y.id]=new F(y,t,r)}this.needsUpload=!1,this._featureMap=new wt,this._bufferOffset=0};function Ae(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function ft(e,t,r){var f={color:{source:pl,composite:qu},number:{source:Bu,composite:pl}},v=function(y){return{"line-pattern":{source:cu,composite:cu},"fill-pattern":{source:cu,composite:cu},"fill-extrusion-pattern":{source:cu,composite:cu}}[y]}(e);return v&&v[r]||f[t][r]}ie.prototype.populatePaintArrays=function(e,t,r,f,v,y){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,t,f,v,y);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},ie.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,y=r;v<y.length;v+=1){var S=y[v];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,t,S,f)||this.needsUpload}},ie.prototype.get=function(e){return this.programConfigurations[e]},ie.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},ie.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},kn("ConstantBinder",_i),kn("CrossFadedConstantBinder",Zi),kn("SourceExpressionBinder",q),kn("CrossFadedCompositeBinder",k),kn("CompositeExpressionBinder",te),kn("ProgramConfiguration",F,{omit:["_buffers"]}),kn("ProgramConfigurationSet",ie);var Vt=Math.pow(2,14)-1,Tt=-Vt-1;function qt(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],y=0;y<v.length;y++){var S=v[y],M=Math.round(S.x*t),z=Math.round(S.y*t);S.x=$e(M,Tt,Vt),S.y=$e(z,Tt,Vt),(M<S.x||M>S.x+1||z<S.y||z>S.y+1)&&Ve("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function Lr(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?qt(e):[]}}function In(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var Fn=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new xs,this.indexArray=new Qu,this.segments=new we,this.programConfigurations=new ie(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function oi(e,t){for(var r=0;r<e.length;r++)if(Ma(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(Ma(e,t[f]))return!0;return!!ma(e,t)}function ui(e,t,r){return!!Ma(e,t)||!!ro(t,e,r)}function mi(e,t){if(e.length===1)return mo(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(Ma(e,f[v]))return!0;for(var y=0;y<e.length;y++)if(mo(t,e[y]))return!0;for(var S=0;S<t.length;S++)if(ma(e,t[S]))return!0;return!1}function Gi(e,t,r){if(e.length>1){if(ma(e,t))return!0;for(var f=0;f<t.length;f++)if(ro(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(ro(e[v],t,r))return!0;return!1}function ma(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],y=0;y<t.length-1;y++)if(ya(f,v,t[y],t[y+1]))return!0;return!1}function ya(e,t,r,f){return It(e,r,f)!==It(t,r,f)&&It(e,t,r)!==It(e,t,f)}function ro(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(Oa(e,t[v-1],t[v])<f)return!0;return!1}function Oa(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function mo(e,t){for(var r,f,v,y=!1,S=0;S<e.length;S++)for(var M=0,z=(r=e[S]).length-1;M<r.length;z=M++)(f=r[M]).y>t.y!=(v=r[z]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(y=!y);return y}function Ma(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var y=e[f],S=e[v];y.y>t.y!=S.y>t.y&&t.x<(S.x-y.x)*(t.y-y.y)/(S.y-y.y)+y.x&&(r=!r)}return r}function ga(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var y=It(e,t,r[0]);return y!==It(e,t,r[1])||y!==It(e,t,r[2])||y!==It(e,t,r[3])}function aa(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function pa(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ua(e,t,r,f,v){if(!t[0]&&!t[1])return e;var y=H.convert(t)._mult(v);r==="viewport"&&y._rotate(-f);for(var S=[],M=0;M<e.length;M++)S.push(e[M].sub(y));return S}Fn.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],y=null;f.type==="circle"&&(y=f.layout.get("circle-sort-key"));for(var S=0,M=e;S<M.length;S+=1){var z=M[S],Y=z.feature,J=z.id,ae=z.index,he=z.sourceLayerIndex,ye=this.layers[0]._featureFilter.needGeometry,He=Lr(Y,ye);if(this.layers[0]._featureFilter.filter(new na(this.zoom),He,r)){var Xe=y?y.evaluate(He,{},r):void 0,gt={id:J,properties:Y.properties,type:Y.type,sourceLayerIndex:he,index:ae,geometry:ye?He.geometry:qt(Y),patterns:{},sortKey:Xe};v.push(gt)}}y&&v.sort(function(vn,Qn){return vn.sortKey-Qn.sortKey});for(var rt=0,Dt=v;rt<Dt.length;rt+=1){var $t=Dt[rt],pr=$t.geometry,mr=$t.index,Or=$t.sourceLayerIndex,nn=e[mr].feature;this.addFeature($t,pr,mr,r),t.featureIndex.insert(nn,pr,mr,Or,this.index)}},Fn.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Fn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Fn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Fn.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ce),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Fn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Fn.prototype.addFeature=function(e,t,r,f){for(var v=0,y=t;v<y.length;v+=1)for(var S=0,M=y[v];S<M.length;S+=1){var z=M[S],Y=z.x,J=z.y;if(!(Y<0||Y>=8192||J<0||J>=8192)){var ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),he=ae.vertexLength;In(this.layoutVertexArray,Y,J,-1,-1),In(this.layoutVertexArray,Y,J,1,-1),In(this.layoutVertexArray,Y,J,1,1),In(this.layoutVertexArray,Y,J,-1,1),this.indexArray.emplaceBack(he,he+1,he+2),this.indexArray.emplaceBack(he,he+3,he+2),ae.vertexLength+=4,ae.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},kn("CircleBucket",Fn,{omit:["layers"]});var Za=new Wo({"circle-sort-key":new Hn(ue.layout_circle["circle-sort-key"])}),ko={paint:new Wo({"circle-radius":new Hn(ue.paint_circle["circle-radius"]),"circle-color":new Hn(ue.paint_circle["circle-color"]),"circle-blur":new Hn(ue.paint_circle["circle-blur"]),"circle-opacity":new Hn(ue.paint_circle["circle-opacity"]),"circle-translate":new ni(ue.paint_circle["circle-translate"]),"circle-translate-anchor":new ni(ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ni(ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ni(ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Hn(ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Hn(ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Hn(ue.paint_circle["circle-stroke-opacity"])}),layout:Za},ji=typeof Float32Array!="undefined"?Float32Array:Array;function Xo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fo(e,t,r){var f=t[0],v=t[1],y=t[2],S=t[3],M=t[4],z=t[5],Y=t[6],J=t[7],ae=t[8],he=t[9],ye=t[10],He=t[11],Xe=t[12],gt=t[13],rt=t[14],Dt=t[15],$t=r[0],pr=r[1],mr=r[2],Or=r[3];return e[0]=$t*f+pr*M+mr*ae+Or*Xe,e[1]=$t*v+pr*z+mr*he+Or*gt,e[2]=$t*y+pr*Y+mr*ye+Or*rt,e[3]=$t*S+pr*J+mr*He+Or*Dt,e[4]=($t=r[4])*f+(pr=r[5])*M+(mr=r[6])*ae+(Or=r[7])*Xe,e[5]=$t*v+pr*z+mr*he+Or*gt,e[6]=$t*y+pr*Y+mr*ye+Or*rt,e[7]=$t*S+pr*J+mr*He+Or*Dt,e[8]=($t=r[8])*f+(pr=r[9])*M+(mr=r[10])*ae+(Or=r[11])*Xe,e[9]=$t*v+pr*z+mr*he+Or*gt,e[10]=$t*y+pr*Y+mr*ye+Or*rt,e[11]=$t*S+pr*J+mr*He+Or*Dt,e[12]=($t=r[12])*f+(pr=r[13])*M+(mr=r[14])*ae+(Or=r[15])*Xe,e[13]=$t*v+pr*z+mr*he+Or*gt,e[14]=$t*y+pr*Y+mr*ye+Or*rt,e[15]=$t*S+pr*J+mr*He+Or*Dt,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var Yo,Sc=Fo;function zu(e,t,r){var f=t[0],v=t[1],y=t[2],S=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*y+r[12]*S,e[1]=r[1]*f+r[5]*v+r[9]*y+r[13]*S,e[2]=r[2]*f+r[6]*v+r[10]*y+r[14]*S,e[3]=r[3]*f+r[7]*v+r[11]*y+r[15]*S,e}Yo=new ji(3),ji!=Float32Array&&(Yo[0]=0,Yo[1]=0,Yo[2]=0),function(){var e=new ji(4);ji!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var el=(function(){var e=new ji(2);ji!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,ko)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Fn(r)},t.prototype.queryRadius=function(r){var f=r;return aa("circle-radius",this,f)+aa("circle-stroke-width",this,f)+pa(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,y,S,M,z,Y){for(var J=Ua(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,z),ae=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),he=this.paint.get("circle-pitch-alignment")==="map",ye=he?J:function(nn,vn){return nn.map(function(Qn){return fu(Qn,vn)})}(J,Y),He=he?ae*z:ae,Xe=0,gt=y;Xe<gt.length;Xe+=1)for(var rt=0,Dt=gt[Xe];rt<Dt.length;rt+=1){var $t=Dt[rt],pr=he?$t:fu($t,Y),mr=He,Or=zu([],[$t.x,$t.y,0,1],Y);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?mr*=Or[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(mr*=M.cameraToCenterDistance/Or[3]),ui(ye,pr,mr))return!0}return!1},t}(lu));function fu(e,t){var r=zu([],[e.x,e.y,0,1],t);return new H(r[0]/r[3],r[1]/r[3])}var Rl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Fn);function Gs(e,t,r,f){var v=t.width,y=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*y*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*y*r);return e.width=v,e.height=y,e.data=f,e}function ml(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var y=Gs({},{width:f,height:v},r);yl(e,y,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=y.data}}function yl(e,t,r,f,v,y){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=e.data,M=t.data,z=0;z<v.height;z++)for(var Y=((r.y+z)*e.width+r.x)*y,J=((f.y+z)*t.width+f.x)*y,ae=0;ae<v.width*y;ae++)M[J+ae]=S[Y+ae];return t}kn("HeatmapBucket",Rl,{omit:["layers"]});var hu=function(e,t){Gs(this,e,1,t)};hu.prototype.resize=function(e){ml(this,e,1)},hu.prototype.clone=function(){return new hu({width:this.width,height:this.height},new Uint8Array(this.data))},hu.copy=function(e,t,r,f,v){yl(e,t,r,f,v,1)};var Ao=function(e,t){Gs(this,e,4,t)};Ao.prototype.resize=function(e){ml(this,e,4)},Ao.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},Ao.prototype.clone=function(){return new Ao({width:this.width,height:this.height},new Uint8Array(this.data))},Ao.copy=function(e,t,r,f,v){yl(e,t,r,f,v,4)},kn("AlphaImage",hu),kn("RGBAImage",Ao);var Qc={paint:new Wo({"heatmap-radius":new Hn(ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Hn(ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ni(ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new js(ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ni(ue.paint_heatmap["heatmap-opacity"])})};function qc(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new Ao({width:r,height:f}),y=function(He,Xe,gt){t[e.evaluationKey]=gt;var rt=e.expression.evaluate(t);v.data[He+Xe+0]=Math.floor(255*rt.r/rt.a),v.data[He+Xe+1]=Math.floor(255*rt.g/rt.a),v.data[He+Xe+2]=Math.floor(255*rt.b/rt.a),v.data[He+Xe+3]=Math.floor(255*rt.a)};if(e.clips)for(var S=0,M=0;S<f;++S,M+=4*r)for(var z=0,Y=0;z<r;z++,Y+=4){var J=z/(r-1),ae=e.clips[S];y(M,Y,ae.start*(1-J)+ae.end*J)}else for(var he=0,ye=0;he<r;he++,ye+=4)y(0,ye,he/(r-1));return v}var pf=function(e){function t(r){e.call(this,r,Qc),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Rl(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=qc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(lu),Rf={paint:new Wo({"hillshade-illumination-direction":new ni(ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ni(ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ni(ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ni(ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ni(ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ni(ue.paint_hillshade["hillshade-accent-color"])})},eu=function(e){function t(r){e.call(this,r,Rf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(lu),ef=Do([{name:"a_pos",components:2,type:"Int16"}],4).members,Ec=Dl,_p=Dl;function Dl(e,t,r){r=r||2;var f,v,y,S,M,z,Y,J=t&&t.length,ae=J?t[0]*r:e.length,he=nh(e,0,ae,r,!0),ye=[];if(!he||he.next===he.prev)return ye;if(J&&(he=function(Xe,gt,rt,Dt){var $t,pr,mr,Or=[];for($t=0,pr=gt.length;$t<pr;$t++)(mr=nh(Xe,gt[$t]*Dt,$t<pr-1?gt[$t+1]*Dt:Xe.length,Dt,!1))===mr.next&&(mr.steiner=!0),Or.push(Bh(mr));for(Or.sort(xp),$t=0;$t<Or.length;$t++)ih(Or[$t],rt),rt=Cc(rt,rt.next);return rt}(e,t,he,r)),e.length>80*r){f=y=e[0],v=S=e[1];for(var He=r;He<ae;He+=r)(M=e[He])<f&&(f=M),(z=e[He+1])<v&&(v=z),M>y&&(y=M),z>S&&(S=z);Y=(Y=Math.max(y-f,S-v))!==0?1/Y:0}return df(he,ye,r,f,v,Y),ye}function nh(e,t,r,f,v){var y,S;if(v===nf(e,t,r,f)>0)for(y=t;y<r;y+=f)S=Bf(y,e[y],e[y+1],S);else for(y=r-f;y>=t;y-=f)S=Bf(y,e[y],e[y+1],S);return S&&kf(S,S.next)&&(gl(S),S=S.next),S}function Cc(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!kf(f,f.next)&&os(f.prev,f,f.next)!==0)f=f.next;else{if(gl(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function df(e,t,r,f,v,y,S){if(e){!S&&y&&function(J,ae,he,ye){var He=J;do He.z===null&&(He.z=Df(He.x,He.y,ae,he,ye)),He.prevZ=He.prev,He.nextZ=He.next,He=He.next;while(He!==J);He.prevZ.nextZ=null,He.prevZ=null,function(Xe){var gt,rt,Dt,$t,pr,mr,Or,nn,vn=1;do{for(rt=Xe,Xe=null,pr=null,mr=0;rt;){for(mr++,Dt=rt,Or=0,gt=0;gt<vn&&(Or++,Dt=Dt.nextZ);gt++);for(nn=vn;Or>0||nn>0&&Dt;)Or!==0&&(nn===0||!Dt||rt.z<=Dt.z)?($t=rt,rt=rt.nextZ,Or--):($t=Dt,Dt=Dt.nextZ,nn--),pr?pr.nextZ=$t:Xe=$t,$t.prevZ=pr,pr=$t;rt=Dt}pr.nextZ=null,vn*=2}while(mr>1)}(He)}(e,f,v,y);for(var M,z,Y=e;e.prev!==e.next;)if(M=e.prev,z=e.next,y?vf(e,f,v,y):Vp(e))t.push(M.i/r),t.push(e.i/r),t.push(z.i/r),gl(e),e=z.next,Y=z.next;else if((e=z)===Y){S?S===1?df(e=kh(Cc(e),t,r),t,r,f,v,y,2):S===2&&Gp(e,t,r,f,v,y):df(Cc(e),t,r,f,v,y,1);break}}}function Vp(e){var t=e.prev,r=e,f=e.next;if(os(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(tf(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&os(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function vf(e,t,r,f){var v=e.prev,y=e,S=e.next;if(os(v,y,S)>=0)return!1;for(var M=v.x>y.x?v.x>S.x?v.x:S.x:y.x>S.x?y.x:S.x,z=v.y>y.y?v.y>S.y?v.y:S.y:y.y>S.y?y.y:S.y,Y=Df(v.x<y.x?v.x<S.x?v.x:S.x:y.x<S.x?y.x:S.x,v.y<y.y?v.y<S.y?v.y:S.y:y.y<S.y?y.y:S.y,t,r,f),J=Df(M,z,t,r,f),ae=e.prevZ,he=e.nextZ;ae&&ae.z>=Y&&he&&he.z<=J;){if(ae!==e.prev&&ae!==e.next&&tf(v.x,v.y,y.x,y.y,S.x,S.y,ae.x,ae.y)&&os(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,he!==e.prev&&he!==e.next&&tf(v.x,v.y,y.x,y.y,S.x,S.y,he.x,he.y)&&os(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ae&&ae.z>=Y;){if(ae!==e.prev&&ae!==e.next&&tf(v.x,v.y,y.x,y.y,S.x,S.y,ae.x,ae.y)&&os(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;he&&he.z<=J;){if(he!==e.prev&&he!==e.next&&tf(v.x,v.y,y.x,y.y,S.x,S.y,he.x,he.y)&&os(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function kh(e,t,r){var f=e;do{var v=f.prev,y=f.next.next;!kf(v,y)&&zh(v,f,f.next,y)&&rf(v,y)&&rf(y,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(y.i/r),gl(f),gl(f.next),f=e=y),f=f.next}while(f!==e);return Cc(f)}function Gp(e,t,r,f,v,y){var S=e;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&Nh(S,M)){var z=Ff(S,M);return S=Cc(S,S.next),z=Cc(z,z.next),df(S,t,r,f,v,y),void df(z,t,r,f,v,y)}M=M.next}S=S.next}while(S!==e)}function xp(e,t){return e.x-t.x}function ih(e,t){if(t=function(f,v){var y,S=v,M=f.x,z=f.y,Y=-1/0;do{if(z<=S.y&&z>=S.next.y&&S.next.y!==S.y){var J=S.x+(z-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(J<=M&&J>Y){if(Y=J,J===M){if(z===S.y)return S;if(z===S.next.y)return S.next}y=S.x<S.next.x?S:S.next}}S=S.next}while(S!==v);if(!y)return null;if(M===Y)return y;var ae,he=y,ye=y.x,He=y.y,Xe=1/0;S=y;do M>=S.x&&S.x>=ye&&M!==S.x&&tf(z<He?M:Y,z,ye,He,z<He?Y:M,z,S.x,S.y)&&(ae=Math.abs(z-S.y)/(M-S.x),rf(S,f)&&(ae<Xe||ae===Xe&&(S.x>y.x||S.x===y.x&&Fh(y,S)))&&(y=S,Xe=ae)),S=S.next;while(S!==he);return y}(e,t)){var r=Ff(t,e);Cc(t,t.next),Cc(r,r.next)}}function Fh(e,t){return os(e.prev,e,t.prev)<0&&os(t.next,e,e.next)<0}function Df(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Bh(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function tf(e,t,r,f,v,y,S,M){return(v-S)*(t-M)-(e-S)*(y-M)>=0&&(e-S)*(f-M)-(r-S)*(t-M)>=0&&(r-S)*(y-M)-(v-S)*(f-M)>=0}function Nh(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&zh(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(rf(e,t)&&rf(t,e)&&function(r,f){var v=r,y=!1,S=(r.x+f.x)/2,M=(r.y+f.y)/2;do v.y>M!=v.next.y>M&&v.next.y!==v.y&&S<(v.next.x-v.x)*(M-v.y)/(v.next.y-v.y)+v.x&&(y=!y),v=v.next;while(v!==r);return y}(e,t)&&(os(e.prev,e,t.prev)||os(e,t.prev,t))||kf(e,t)&&os(e.prev,e,e.next)>0&&os(t.prev,t,t.next)>0)}function os(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function kf(e,t){return e.x===t.x&&e.y===t.y}function zh(e,t,r,f){var v=oh(os(e,t,r)),y=oh(os(e,t,f)),S=oh(os(r,f,e)),M=oh(os(r,f,t));return v!==y&&S!==M||!(v!==0||!ah(e,r,t))||!(y!==0||!ah(e,f,t))||!(S!==0||!ah(r,e,f))||!(M!==0||!ah(r,t,f))}function ah(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function oh(e){return e>0?1:e<0?-1:0}function rf(e,t){return os(e.prev,e,e.next)<0?os(e,t,e.next)>=0&&os(e,e.prev,t)>=0:os(e,t,e.prev)<0||os(e,e.next,t)<0}function Ff(e,t){var r=new Nf(e.i,e.x,e.y),f=new Nf(t.i,t.x,t.y),v=e.next,y=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,y.next=f,f.prev=y,f}function Bf(e,t,r,f){var v=new Nf(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function gl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Nf(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function nf(e,t,r,f){for(var v=0,y=t,S=r-f;y<r;y+=f)v+=(e[S]-e[y])*(e[y+1]+e[S+1]),S=y;return v}function sh(e,t,r,f,v){(function y(S,M,z,Y,J){for(;Y>z;){if(Y-z>600){var ae=Y-z+1,he=M-z+1,ye=Math.log(ae),He=.5*Math.exp(2*ye/3),Xe=.5*Math.sqrt(ye*He*(ae-He)/ae)*(he-ae/2<0?-1:1);y(S,M,Math.max(z,Math.floor(M-he*He/ae+Xe)),Math.min(Y,Math.floor(M+(ae-he)*He/ae+Xe)),J)}var gt=S[M],rt=z,Dt=Y;for(wc(S,z,M),J(S[Y],gt)>0&&wc(S,z,Y);rt<Dt;){for(wc(S,rt,Dt),rt++,Dt--;J(S[rt],gt)<0;)rt++;for(;J(S[Dt],gt)>0;)Dt--}J(S[z],gt)===0?wc(S,z,Dt):wc(S,++Dt,Y),Dt<=M&&(z=Dt+1),M<=Dt&&(Y=Dt-1)}})(e,t,r||0,f||e.length-1,v||Uh)}function wc(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function Uh(e,t){return e<t?-1:e>t?1:0}function mf(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,y=[],S=0;S<r;S++){var M=hr(e[S]);M!==0&&(e[S].area=Math.abs(M),v===void 0&&(v=M<0),v===M<0?(f&&y.push(f),f=[e[S]]):f.push(e[S]))}if(f&&y.push(f),t>1)for(var z=0;z<y.length;z++)y[z].length<=t||(sh(y[z],t,1,y[z].length-1,yf),y[z]=y[z].slice(0,t));return y}function yf(e,t){return t.area-e.area}function gf(e,t,r){for(var f=r.patternDependencies,v=!1,y=0,S=t;y<S.length;y+=1){var M=S[y].paint.get(e+"-pattern");M.isConstant()||(v=!0);var z=M.constantOr(null);z&&(v=!0,f[z.to]=!0,f[z.from]=!0)}return v}function kl(e,t,r,f,v){for(var y=v.patternDependencies,S=0,M=t;S<M.length;S+=1){var z=M[S],Y=z.paint.get(e+"-pattern").value;if(Y.kind!=="constant"){var J=Y.evaluate({zoom:f-1},r,{},v.availableImages),ae=Y.evaluate({zoom:f},r,{},v.availableImages),he=Y.evaluate({zoom:f+1},r,{},v.availableImages);ae=ae&&ae.name?ae.name:ae,he=he&&he.name?he.name:he,y[J=J&&J.name?J.name:J]=!0,y[ae]=!0,y[he]=!0,r.patterns[z.id]={min:J,mid:ae,max:he}}}return r}Dl.deviation=function(e,t,r,f){var v=t&&t.length,y=Math.abs(nf(e,0,v?t[0]*r:e.length,r));if(v)for(var S=0,M=t.length;S<M;S++)y-=Math.abs(nf(e,t[S]*r,S<M-1?t[S+1]*r:e.length,r));var z=0;for(S=0;S<f.length;S+=3){var Y=f[S]*r,J=f[S+1]*r,ae=f[S+2]*r;z+=Math.abs((e[Y]-e[ae])*(e[J+1]-e[Y+1])-(e[Y]-e[J])*(e[ae+1]-e[Y+1]))}return y===0&&z===0?0:Math.abs((z-y)/y)},Dl.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var y=0;y<e[v].length;y++)for(var S=0;S<t;S++)r.vertices.push(e[v][y][S]);v>0&&r.holes.push(f+=e[v-1].length)}return r},Ec.default=_p;var Su=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xs,this.indexArray=new Qu,this.indexArray2=new Nu,this.programConfigurations=new ie(e.layers,e.zoom),this.segments=new we,this.segments2=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};Su.prototype.populate=function(e,t,r){this.hasPattern=gf("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],y=0,S=e;y<S.length;y+=1){var M=S[y],z=M.feature,Y=M.id,J=M.index,ae=M.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,ye=Lr(z,he);if(this.layers[0]._featureFilter.filter(new na(this.zoom),ye,r)){var He=f?f.evaluate(ye,{},r,t.availableImages):void 0,Xe={id:Y,properties:z.properties,type:z.type,sourceLayerIndex:ae,index:J,geometry:he?ye.geometry:qt(z),patterns:{},sortKey:He};v.push(Xe)}}f&&v.sort(function(nn,vn){return nn.sortKey-vn.sortKey});for(var gt=0,rt=v;gt<rt.length;gt+=1){var Dt=rt[gt],$t=Dt.geometry,pr=Dt.index,mr=Dt.sourceLayerIndex;if(this.hasPattern){var Or=kl("fill",this.layers,Dt,this.zoom,t);this.patternFeatures.push(Or)}else this.addFeature(Dt,$t,pr,r,{});t.featureIndex.insert(e[pr].feature,$t,pr,mr,this.index)}},Su.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Su.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var y=v[f];this.addFeature(y,y.geometry,y.index,t,r)}},Su.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Su.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Su.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ef),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},Su.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Su.prototype.addFeature=function(e,t,r,f,v){for(var y=0,S=mf(t,500);y<S.length;y+=1){for(var M=S[y],z=0,Y=0,J=M;Y<J.length;Y+=1)z+=J[Y].length;for(var ae=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray),he=ae.vertexLength,ye=[],He=[],Xe=0,gt=M;Xe<gt.length;Xe+=1){var rt=gt[Xe];if(rt.length!==0){rt!==M[0]&&He.push(ye.length/2);var Dt=this.segments2.prepareSegment(rt.length,this.layoutVertexArray,this.indexArray2),$t=Dt.vertexLength;this.layoutVertexArray.emplaceBack(rt[0].x,rt[0].y),this.indexArray2.emplaceBack($t+rt.length-1,$t),ye.push(rt[0].x),ye.push(rt[0].y);for(var pr=1;pr<rt.length;pr++)this.layoutVertexArray.emplaceBack(rt[pr].x,rt[pr].y),this.indexArray2.emplaceBack($t+pr-1,$t+pr),ye.push(rt[pr].x),ye.push(rt[pr].y);Dt.vertexLength+=rt.length,Dt.primitiveLength+=rt.length}}for(var mr=Ec(ye,He),Or=0;Or<mr.length;Or+=3)this.indexArray.emplaceBack(he+mr[Or],he+mr[Or+1],he+mr[Or+2]);ae.vertexLength+=z,ae.primitiveLength+=mr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},kn("FillBucket",Su,{omit:["layers","patternFeatures"]});var _f=new Wo({"fill-sort-key":new Hn(ue.layout_fill["fill-sort-key"])}),zf={paint:new Wo({"fill-antialias":new ni(ue.paint_fill["fill-antialias"]),"fill-opacity":new Hn(ue.paint_fill["fill-opacity"]),"fill-color":new Hn(ue.paint_fill["fill-color"]),"fill-outline-color":new Hn(ue.paint_fill["fill-outline-color"]),"fill-translate":new ni(ue.paint_fill["fill-translate"]),"fill-translate-anchor":new ni(ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new Il(ue.paint_fill["fill-pattern"])}),layout:_f},xf=function(e){function t(r){e.call(this,r,zf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new Su(r)},t.prototype.queryRadius=function(){return pa(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,y,S,M,z){return mi(Ua(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,z),y)},t.prototype.isTileClipped=function(){return!0},t}(lu),Zh=Do([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,bf=_l;function _l(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(uh,this,t)}function uh(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var y=f.readVarint()+f.pos;f.pos<y;){var S=v._keys[f.readVarint()],M=v._values[f.readVarint()];v.properties[S]=M}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Uf(e){for(var t,r,f=0,v=0,y=e.length,S=y-1;v<y;S=v++)f+=((r=e[S]).x-(t=e[v]).x)*(t.y+r.y);return f}_l.types=["Unknown","Point","LineString","Polygon"],_l.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,y=0,S=0,M=[];e.pos<r;){if(v<=0){var z=e.readVarint();f=7&z,v=z>>3}if(v--,f===1||f===2)y+=e.readSVarint(),S+=e.readSVarint(),f===1&&(t&&M.push(t),t=[]),t.push(new H(y,S));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&M.push(t),M},_l.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,y=0,S=1/0,M=-1/0,z=1/0,Y=-1/0;e.pos<t;){if(f<=0){var J=e.readVarint();r=7&J,f=J>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<S&&(S=v),v>M&&(M=v),(y+=e.readSVarint())<z&&(z=y),y>Y&&(Y=y);else if(r!==7)throw new Error("unknown command "+r)}return[S,z,M,Y]},_l.prototype.toGeoJSON=function(e,t,r){var f,v,y=this.extent*Math.pow(2,r),S=this.extent*e,M=this.extent*t,z=this.loadGeometry(),Y=_l.types[this.type];function J(ye){for(var He=0;He<ye.length;He++){var Xe=ye[He];ye[He]=[360*(Xe.x+S)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(Xe.y+M)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var ae=[];for(f=0;f<z.length;f++)ae[f]=z[f][0];J(z=ae);break;case 2:for(f=0;f<z.length;f++)J(z[f]);break;case 3:for(z=function(ye){var He=ye.length;if(He<=1)return[ye];for(var Xe,gt,rt=[],Dt=0;Dt<He;Dt++){var $t=Uf(ye[Dt]);$t!==0&&(gt===void 0&&(gt=$t<0),gt===$t<0?(Xe&&rt.push(Xe),Xe=[ye[Dt]]):Xe.push(ye[Dt]))}return Xe&&rt.push(Xe),rt}(z),f=0;f<z.length;f++)for(v=0;v<z[f].length;v++)J(z[f][v])}z.length===1?z=z[0]:Y="Multi"+Y;var he={type:"Feature",geometry:{type:Y,coordinates:z},properties:this.properties};return"id"in this&&(he.id=this.id),he};var jh=lh;function lh(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(bp,this,t),this.length=this._features.length}function bp(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,y=f.readVarint()+f.pos;f.pos<y;){var S=f.readVarint()>>3;v=S===1?f.readString():S===2?f.readFloat():S===3?f.readDouble():S===4?f.readVarint64():S===5?f.readVarint():S===6?f.readSVarint():S===7?f.readBoolean():null}return v}(r))}function Tc(e,t,r){if(e===3){var f=new jh(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}lh.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new bf(this._pbf,t,this.extent,this._keys,this._values)};var zc={VectorTile:function(e,t){this.layers=e.readFields(Tc,{},t)},VectorTileFeature:bf,VectorTileLayer:jh},Vh=zc.VectorTileFeature.types,Sf=Math.pow(2,13);function af(e,t,r,f,v,y,S,M){e.emplaceBack(t,r,2*Math.floor(f*Sf)+S,v*Sf*2,y*Sf*2,Math.round(M))}var Uu=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new bs,this.indexArray=new Qu,this.programConfigurations=new ie(e.layers,e.zoom),this.segments=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Sp(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}Uu.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=gf("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var y=v[f],S=y.feature,M=y.id,z=y.index,Y=y.sourceLayerIndex,J=this.layers[0]._featureFilter.needGeometry,ae=Lr(S,J);if(this.layers[0]._featureFilter.filter(new na(this.zoom),ae,r)){var he={id:M,sourceLayerIndex:Y,index:z,geometry:J?ae.geometry:qt(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(kl("fill-extrusion",this.layers,he,this.zoom,t)):this.addFeature(he,he.geometry,z,r,{}),t.featureIndex.insert(S,he.geometry,z,Y,this.index,!0)}}},Uu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var y=v[f];this.addFeature(y,y.geometry,y.index,t,r)}},Uu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Uu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Uu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Uu.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Uu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Uu.prototype.addFeature=function(e,t,r,f,v){for(var y=0,S=mf(t,500);y<S.length;y+=1){for(var M=S[y],z=0,Y=0,J=M;Y<J.length;Y+=1)z+=J[Y].length;for(var ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),he=0,ye=M;he<ye.length;he+=1){var He=ye[he];if(He.length!==0&&!((fa=He).every(function(Ki){return Ki.x<0})||fa.every(function(Ki){return Ki.x>8192})||fa.every(function(Ki){return Ki.y<0})||fa.every(function(Ki){return Ki.y>8192})))for(var Xe=0,gt=0;gt<He.length;gt++){var rt=He[gt];if(gt>=1){var Dt=He[gt-1];if(!Sp(rt,Dt)){ae.vertexLength+4>we.MAX_VERTEX_ARRAY_LENGTH&&(ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var $t=rt.sub(Dt)._perp()._unit(),pr=Dt.dist(rt);Xe+pr>32768&&(Xe=0),af(this.layoutVertexArray,rt.x,rt.y,$t.x,$t.y,0,0,Xe),af(this.layoutVertexArray,rt.x,rt.y,$t.x,$t.y,0,1,Xe),af(this.layoutVertexArray,Dt.x,Dt.y,$t.x,$t.y,0,0,Xe+=pr),af(this.layoutVertexArray,Dt.x,Dt.y,$t.x,$t.y,0,1,Xe);var mr=ae.vertexLength;this.indexArray.emplaceBack(mr,mr+2,mr+1),this.indexArray.emplaceBack(mr+1,mr+2,mr+3),ae.vertexLength+=4,ae.primitiveLength+=2}}}}if(ae.vertexLength+z>we.MAX_VERTEX_ARRAY_LENGTH&&(ae=this.segments.prepareSegment(z,this.layoutVertexArray,this.indexArray)),Vh[e.type]==="Polygon"){for(var Or=[],nn=[],vn=ae.vertexLength,Qn=0,Ln=M;Qn<Ln.length;Qn+=1){var si=Ln[Qn];if(si.length!==0){si!==M[0]&&nn.push(Or.length/2);for(var zn=0;zn<si.length;zn++){var sa=si[zn];af(this.layoutVertexArray,sa.x,sa.y,0,0,1,1,0),Or.push(sa.x),Or.push(sa.y)}}}for(var xi=Ec(Or,nn),qn=0;qn<xi.length;qn+=3)this.indexArray.emplaceBack(vn+xi[qn],vn+xi[qn+2],vn+xi[qn+1]);ae.primitiveLength+=xi.length/3,ae.vertexLength+=z}}var fa;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},kn("FillExtrusionBucket",Uu,{omit:["layers","features"]});var Fl={paint:new Wo({"fill-extrusion-opacity":new ni(ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Hn(ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ni(ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ni(ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Il(ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Hn(ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Hn(ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ni(ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Gh=function(e){function t(r){e.call(this,r,Fl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Uu(r)},t.prototype.queryRadius=function(){return pa(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,y,S,M,z,Y){var J=Ua(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,z),ae=this.paint.get("fill-extrusion-height").evaluate(f,v),he=this.paint.get("fill-extrusion-base").evaluate(f,v),ye=function(Xe,gt,rt,Dt){for(var $t=[],pr=0,mr=Xe;pr<mr.length;pr+=1){var Or=mr[pr],nn=[Or.x,Or.y,0,1];zu(nn,nn,gt),$t.push(new H(nn[0]/nn[3],nn[1]/nn[3]))}return $t}(J,Y),He=function(Xe,gt,rt,Dt){for(var $t=[],pr=[],mr=Dt[8]*gt,Or=Dt[9]*gt,nn=Dt[10]*gt,vn=Dt[11]*gt,Qn=Dt[8]*rt,Ln=Dt[9]*rt,si=Dt[10]*rt,zn=Dt[11]*rt,sa=0,xi=Xe;sa<xi.length;sa+=1){for(var qn=[],fa=[],Ki=0,Ta=xi[sa];Ki<Ta.length;Ki+=1){var yi=Ta[Ki],Ba=yi.x,Po=yi.y,Jo=Dt[0]*Ba+Dt[4]*Po+Dt[12],jo=Dt[1]*Ba+Dt[5]*Po+Dt[13],yo=Dt[2]*Ba+Dt[6]*Po+Dt[14],Mo=Dt[3]*Ba+Dt[7]*Po+Dt[15],Ls=yo+nn,gs=Mo+vn,tu=Jo+Qn,ks=jo+Ln,Hs=yo+si,Qo=Mo+zn,Fs=new H((Jo+mr)/gs,(jo+Or)/gs);Fs.z=Ls/gs,qn.push(Fs);var da=new H(tu/Qo,ks/Qo);da.z=Hs/Qo,fa.push(da)}$t.push(qn),pr.push(fa)}return[$t,pr]}(y,he,ae,Y);return function(Xe,gt,rt){var Dt=1/0;mi(rt,gt)&&(Dt=ic(rt,gt[0]));for(var $t=0;$t<gt.length;$t++)for(var pr=gt[$t],mr=Xe[$t],Or=0;Or<pr.length-1;Or++){var nn=pr[Or],vn=[nn,pr[Or+1],mr[Or+1],mr[Or],nn];oi(rt,vn)&&(Dt=Math.min(Dt,ic(rt,vn)))}return Dt!==1/0&&Dt}(He[0],He[1],ye)},t}(lu);function xl(e,t){return e.x*t.x+e.y*t.y}function ic(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var y=t[f],S=e[0],M=r.sub(v),z=y.sub(v),Y=S.sub(v),J=xl(M,M),ae=xl(M,z),he=xl(z,z),ye=xl(Y,M),He=xl(Y,z),Xe=J*he-ae*ae,gt=(he*ye-ae*He)/Xe,rt=(J*He-ae*ye)/Xe,Dt=v.z*(1-gt-rt)+r.z*gt+y.z*rt;if(isFinite(Dt))return Dt}return 1/0}for(var $t=1/0,pr=0,mr=t;pr<mr.length;pr+=1)$t=Math.min($t,mr[pr].z);return $t}var Hh=Do([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,ch=Do([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Ef=zc.VectorTileFeature.types,fh=Math.cos(Math.PI/180*37.5),ms=Math.pow(2,14)/.5,zo=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new vs,this.layoutVertexArray2=new pl,this.indexArray=new Qu,this.programConfigurations=new ie(e.layers,e.zoom),this.segments=new we,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};zo.prototype.populate=function(e,t,r){this.hasPattern=gf("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],y=0,S=e;y<S.length;y+=1){var M=S[y],z=M.feature,Y=M.id,J=M.index,ae=M.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,ye=Lr(z,he);if(this.layers[0]._featureFilter.filter(new na(this.zoom),ye,r)){var He=f?f.evaluate(ye,{},r):void 0,Xe={id:Y,properties:z.properties,type:z.type,sourceLayerIndex:ae,index:J,geometry:he?ye.geometry:qt(z),patterns:{},sortKey:He};v.push(Xe)}}f&&v.sort(function(nn,vn){return nn.sortKey-vn.sortKey});for(var gt=0,rt=v;gt<rt.length;gt+=1){var Dt=rt[gt],$t=Dt.geometry,pr=Dt.index,mr=Dt.sourceLayerIndex;if(this.hasPattern){var Or=kl("line",this.layers,Dt,this.zoom,t);this.patternFeatures.push(Or)}else this.addFeature(Dt,$t,pr,r,{});t.featureIndex.insert(e[pr].feature,$t,pr,mr,this.index)}},zo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},zo.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var y=v[f];this.addFeature(y,y.geometry,y.index,t,r)}},zo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zo.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ch)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},zo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},zo.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},zo.prototype.addFeature=function(e,t,r,f,v){var y=this.layers[0].layout,S=y.get("line-join").evaluate(e,{}),M=y.get("line-cap"),z=y.get("line-miter-limit"),Y=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var J=0,ae=t;J<ae.length;J+=1)this.addLine(ae[J],e,S,M,z,Y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},zo.prototype.addLine=function(e,t,r,f,v,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<e.length-1;S++)this.totalDistance+=e[S].dist(e[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Ef[t.type]==="Polygon",z=e.length;z>=2&&e[z-1].equals(e[z-2]);)z--;for(var Y=0;Y<z-1&&e[Y].equals(e[Y+1]);)Y++;if(!(z<(M?3:2))){r==="bevel"&&(v=1.05);var J,ae=this.overscaling<=16?122880/(512*this.overscaling):0,he=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray),ye=void 0,He=void 0,Xe=void 0,gt=void 0;this.e1=this.e2=-1,M&&(gt=e[Y].sub(J=e[z-2])._unit()._perp());for(var rt=Y;rt<z;rt++)if(!(He=rt===z-1?M?e[Y+1]:void 0:e[rt+1])||!e[rt].equals(He)){gt&&(Xe=gt),J&&(ye=J),J=e[rt],gt=He?He.sub(J)._unit()._perp():Xe;var Dt=(Xe=Xe||gt).add(gt);Dt.x===0&&Dt.y===0||Dt._unit();var $t=Xe.x*gt.x+Xe.y*gt.y,pr=Dt.x*gt.x+Dt.y*gt.y,mr=pr!==0?1/pr:1/0,Or=2*Math.sqrt(2-2*pr),nn=pr<fh&&ye&&He,vn=Xe.x*gt.y-Xe.y*gt.x>0;if(nn&&rt>Y){var Qn=J.dist(ye);if(Qn>2*ae){var Ln=J.sub(J.sub(ye)._mult(ae/Qn)._round());this.updateDistance(ye,Ln),this.addCurrentVertex(Ln,Xe,0,0,he),ye=Ln}}var si=ye&&He,zn=si?r:M?"butt":f;if(si&&zn==="round"&&(mr<y?zn="miter":mr<=2&&(zn="fakeround")),zn==="miter"&&mr>v&&(zn="bevel"),zn==="bevel"&&(mr>2&&(zn="flipbevel"),mr<v&&(zn="miter")),ye&&this.updateDistance(ye,J),zn==="miter")Dt._mult(mr),this.addCurrentVertex(J,Dt,0,0,he);else if(zn==="flipbevel"){if(mr>100)Dt=gt.mult(-1);else{var sa=mr*Xe.add(gt).mag()/Xe.sub(gt).mag();Dt._perp()._mult(sa*(vn?-1:1))}this.addCurrentVertex(J,Dt,0,0,he),this.addCurrentVertex(J,Dt.mult(-1),0,0,he)}else if(zn==="bevel"||zn==="fakeround"){var xi=-Math.sqrt(mr*mr-1),qn=vn?xi:0,fa=vn?0:xi;if(ye&&this.addCurrentVertex(J,Xe,qn,fa,he),zn==="fakeround")for(var Ki=Math.round(180*Or/Math.PI/20),Ta=1;Ta<Ki;Ta++){var yi=Ta/Ki;if(yi!==.5){var Ba=yi-.5;yi+=yi*Ba*(yi-1)*((1.0904+$t*($t*(3.55645-1.43519*$t)-3.2452))*Ba*Ba+(.848013+$t*(.215638*$t-1.06021)))}var Po=gt.sub(Xe)._mult(yi)._add(Xe)._unit()._mult(vn?-1:1);this.addHalfVertex(J,Po.x,Po.y,!1,vn,0,he)}He&&this.addCurrentVertex(J,gt,-qn,-fa,he)}else if(zn==="butt")this.addCurrentVertex(J,Dt,0,0,he);else if(zn==="square"){var Jo=ye?1:-1;this.addCurrentVertex(J,Dt,Jo,Jo,he)}else zn==="round"&&(ye&&(this.addCurrentVertex(J,Xe,0,0,he),this.addCurrentVertex(J,Xe,1,1,he,!0)),He&&(this.addCurrentVertex(J,gt,-1,-1,he,!0),this.addCurrentVertex(J,gt,0,0,he)));if(nn&&rt<z-1){var jo=J.dist(He);if(jo>2*ae){var yo=J.add(He.sub(J)._mult(ae/jo)._round());this.updateDistance(J,yo),this.addCurrentVertex(yo,gt,0,0,he),J=yo}}}}},zo.prototype.addCurrentVertex=function(e,t,r,f,v,y){y===void 0&&(y=!1);var S=t.y*f-t.x,M=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,y,!1,r,v),this.addHalfVertex(e,S,M,y,!0,-f,v),this.distance>ms/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,y))},zo.prototype.addHalfVertex=function(e,t,r,f,v,y,S){var M=.5*(this.lineClips?this.scaledDistance*(ms-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(y===0?0:y<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var z=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),S.primitiveLength++),v?this.e2=z:this.e1=z},zo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},zo.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},kn("LineBucket",zo,{omit:["layers","patternFeatures"]});var ss=new Wo({"line-cap":new ni(ue.layout_line["line-cap"]),"line-join":new Hn(ue.layout_line["line-join"]),"line-miter-limit":new ni(ue.layout_line["line-miter-limit"]),"line-round-limit":new ni(ue.layout_line["line-round-limit"]),"line-sort-key":new Hn(ue.layout_line["line-sort-key"])}),pu={paint:new Wo({"line-opacity":new Hn(ue.paint_line["line-opacity"]),"line-color":new Hn(ue.paint_line["line-color"]),"line-translate":new ni(ue.paint_line["line-translate"]),"line-translate-anchor":new ni(ue.paint_line["line-translate-anchor"]),"line-width":new Hn(ue.paint_line["line-width"]),"line-gap-width":new Hn(ue.paint_line["line-gap-width"]),"line-offset":new Hn(ue.paint_line["line-offset"]),"line-blur":new Hn(ue.paint_line["line-blur"]),"line-dasharray":new as(ue.paint_line["line-dasharray"]),"line-pattern":new Il(ue.paint_line["line-pattern"]),"line-gradient":new js(ue.paint_line["line-gradient"])}),layout:ss},hh=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new na(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,y){return f=Lt({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,y)},t}(Hn))(pu.paint.properties["line-width"].specification);hh.useIntegerZoom=!0;var Wh=function(e){function t(r){e.call(this,r,pu),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ps,this.gradientVersion=(this.gradientVersion+1)%_e)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=hh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new zo(r)},t.prototype.queryRadius=function(r){var f=r,v=Xh(aa("line-width",this,f),aa("line-gap-width",this,f)),y=aa("line-offset",this,f);return v/2+Math.abs(y)+pa(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,y,S,M,z){var Y=Ua(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,z),J=z/2*Xh(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),ae=this.paint.get("line-offset").evaluate(f,v);return ae&&(y=function(he,ye){for(var He=[],Xe=new H(0,0),gt=0;gt<he.length;gt++){for(var rt=he[gt],Dt=[],$t=0;$t<rt.length;$t++){var pr=rt[$t],mr=rt[$t+1],Or=$t===0?Xe:pr.sub(rt[$t-1])._unit()._perp(),nn=$t===rt.length-1?Xe:mr.sub(pr)._unit()._perp(),vn=Or._add(nn)._unit();vn._mult(1/(vn.x*nn.x+vn.y*nn.y)),Dt.push(vn._mult(ye)._add(pr))}He.push(Dt)}return He}(y,ae*z)),function(he,ye,He){for(var Xe=0;Xe<ye.length;Xe++){var gt=ye[Xe];if(he.length>=3){for(var rt=0;rt<gt.length;rt++)if(Ma(he,gt[rt]))return!0}if(Gi(he,gt,He))return!0}return!1}(Y,y,J)},t.prototype.isTileClipped=function(){return!0},t}(lu);function Xh(e,t){return t>0?t+2*e:e}var Yh=Do([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ph=Do([{name:"a_projected_pos",components:3,type:"Float32"}],4),Kh=(Do([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Do([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),$h=(Do([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Do([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ep=Do([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Cp(e,t,r){return e.sections.forEach(function(f){f.text=function(v,y,S){var M=y.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?v=v.toLocaleUpperCase():M==="lowercase"&&(v=v.toLocaleLowerCase()),Is.applyArabicShaping&&(v=Is.applyArabicShaping(v)),v}(f.text,t,r)}),e}Do([{name:"triangle",components:3,type:"Uint16"}]),Do([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Do([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Do([{type:"Float32",name:"offsetX"}]),Do([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Cf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Jh=function(e,t,r,f,v){var y,S,M=8*v-f-1,z=(1<<M)-1,Y=z>>1,J=-7,ae=r?v-1:0,he=r?-1:1,ye=e[t+ae];for(ae+=he,y=ye&(1<<-J)-1,ye>>=-J,J+=M;J>0;y=256*y+e[t+ae],ae+=he,J-=8);for(S=y&(1<<-J)-1,y>>=-J,J+=f;J>0;S=256*S+e[t+ae],ae+=he,J-=8);if(y===0)y=1-Y;else{if(y===z)return S?NaN:1/0*(ye?-1:1);S+=Math.pow(2,f),y-=Y}return(ye?-1:1)*S*Math.pow(2,y-f)},Ac=function(e,t,r,f,v,y){var S,M,z,Y=8*y-v-1,J=(1<<Y)-1,ae=J>>1,he=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,ye=f?0:y-1,He=f?1:-1,Xe=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(M=isNaN(t)?1:0,S=J):(S=Math.floor(Math.log(t)/Math.LN2),t*(z=Math.pow(2,-S))<1&&(S--,z*=2),(t+=S+ae>=1?he/z:he*Math.pow(2,1-ae))*z>=2&&(S++,z/=2),S+ae>=J?(M=0,S=J):S+ae>=1?(M=(t*z-1)*Math.pow(2,v),S+=ae):(M=t*Math.pow(2,ae-1)*Math.pow(2,v),S=0));v>=8;e[r+ye]=255&M,ye+=He,M/=256,v-=8);for(S=S<<v|M,Y+=v;Y>0;e[r+ye]=255&S,ye+=He,S/=256,Y-=8);e[r+ye-He]|=128*Xe},wf=$a;function $a(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}$a.Varint=0,$a.Fixed64=1,$a.Bytes=2,$a.Fixed32=5;var Qh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function ac(e){return e.type===$a.Bytes?e.readVarint()+e.pos:e.pos+1}function Pc(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function dh(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function X(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Oe(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function qe(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function lr(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Ir(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function or(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Cr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Nr(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Hr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function Kr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Jr(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function rn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function dn(e,t,r){e===1&&r.readMessage(Wr,t)}function Wr(e,t,r){if(e===3){var f=r.readMessage(en,{}),v=f.width,y=f.height,S=f.left,M=f.top,z=f.advance;t.push({id:f.id,bitmap:new hu({width:v+6,height:y+6},f.bitmap),metrics:{width:v,height:y,left:S,top:M,advance:z}})}}function en(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function Bt(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var y=v[f];t+=y.w*y.h,r=Math.max(r,y.w)}e.sort(function(Xe,gt){return gt.h-Xe.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],M=0,z=0,Y=0,J=e;Y<J.length;Y+=1)for(var ae=J[Y],he=S.length-1;he>=0;he--){var ye=S[he];if(!(ae.w>ye.w||ae.h>ye.h)){if(ae.x=ye.x,ae.y=ye.y,z=Math.max(z,ae.y+ae.h),M=Math.max(M,ae.x+ae.w),ae.w===ye.w&&ae.h===ye.h){var He=S.pop();he<S.length&&(S[he]=He)}else ae.h===ye.h?(ye.x+=ae.w,ye.w-=ae.w):ae.w===ye.w?(ye.y+=ae.h,ye.h-=ae.h):(S.push({x:ye.x+ae.w,y:ye.y,w:ye.w-ae.w,h:ae.h}),ye.y+=ae.h,ye.h-=ae.h);break}}return{w:M,h:z,fill:t/(M*z)||0}}$a.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var f=this.readVarint(),v=f>>3,y=this.pos;this.type=7&f,e(v,t,this),this.pos===y&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Kr(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=rn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Kr(this.buf,this.pos)+4294967296*Kr(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=Kr(this.buf,this.pos)+4294967296*rn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Jh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Jh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,f=this.buf;return t=127&(r=f[this.pos++]),r<128?t:(t|=(127&(r=f[this.pos++]))<<7,r<128?t:(t|=(127&(r=f[this.pos++]))<<14,r<128?t:(t|=(127&(r=f[this.pos++]))<<21,r<128?t:function(v,y,S){var M,z,Y=S.buf;if(M=(112&(z=Y[S.pos++]))>>4,z<128||(M|=(127&(z=Y[S.pos++]))<<3,z<128)||(M|=(127&(z=Y[S.pos++]))<<10,z<128)||(M|=(127&(z=Y[S.pos++]))<<17,z<128)||(M|=(127&(z=Y[S.pos++]))<<24,z<128)||(M|=(1&(z=Y[S.pos++]))<<31,z<128))return Pc(v,M,y);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Qh?function(r,f,v){return Qh.decode(r.subarray(f,v))}(this.buf,t,e):function(r,f,v){for(var y="",S=f;S<v;){var M,z,Y,J=r[S],ae=null,he=J>239?4:J>223?3:J>191?2:1;if(S+he>v)break;he===1?J<128&&(ae=J):he===2?(192&(M=r[S+1]))==128&&(ae=(31&J)<<6|63&M)<=127&&(ae=null):he===3?(z=r[S+2],(192&(M=r[S+1]))==128&&(192&z)==128&&((ae=(15&J)<<12|(63&M)<<6|63&z)<=2047||ae>=55296&&ae<=57343)&&(ae=null)):he===4&&(z=r[S+2],Y=r[S+3],(192&(M=r[S+1]))==128&&(192&z)==128&&(192&Y)==128&&((ae=(15&J)<<18|(63&M)<<12|(63&z)<<6|63&Y)<=65535||ae>=1114112)&&(ae=null)),ae===null?(ae=65533,he=1):ae>65535&&(ae-=65536,y+=String.fromCharCode(ae>>>10&1023|55296),ae=56320|1023&ae),y+=String.fromCharCode(ae),S+=he}return y}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==$a.Bytes)return e.push(this.readVarint(t));var r=ac(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==$a.Bytes)return e.push(this.readSVarint());var t=ac(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==$a.Bytes)return e.push(this.readBoolean());var t=ac(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==$a.Bytes)return e.push(this.readFloat());var t=ac(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==$a.Bytes)return e.push(this.readDouble());var t=ac(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==$a.Bytes)return e.push(this.readFixed32());var t=ac(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==$a.Bytes)return e.push(this.readSFixed32());var t=ac(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==$a.Bytes)return e.push(this.readFixed64());var t=ac(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==$a.Bytes)return e.push(this.readSFixed64());var t=ac(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===$a.Varint)for(;this.buf[this.pos++]>127;);else if(t===$a.Bytes)this.pos=this.readVarint()+this.pos;else if(t===$a.Fixed32)this.pos+=4;else{if(t!==$a.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Jr(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Jr(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Jr(this.buf,-1&e,this.pos),Jr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Jr(this.buf,-1&e,this.pos),Jr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var f,v;if(t>=0?(f=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(y,S,M){M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,M.buf[M.pos]=127&(y>>>=7)}(f,0,r),function(y,S){var M=(7&y)<<4;S.buf[S.pos++]|=M|((y>>>=3)?128:0),y&&(S.buf[S.pos++]=127&y|((y>>>=7)?128:0),y&&(S.buf[S.pos++]=127&y|((y>>>=7)?128:0),y&&(S.buf[S.pos++]=127&y|((y>>>=7)?128:0),y&&(S.buf[S.pos++]=127&y|((y>>>=7)?128:0),y&&(S.buf[S.pos++]=127&y)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,v,y){for(var S,M,z=0;z<v.length;z++){if((S=v.charCodeAt(z))>55295&&S<57344){if(!M){S>56319||z+1===v.length?(f[y++]=239,f[y++]=191,f[y++]=189):M=S;continue}if(S<56320){f[y++]=239,f[y++]=191,f[y++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(f[y++]=239,f[y++]=191,f[y++]=189,M=null);S<128?f[y++]=S:(S<2048?f[y++]=S>>6|192:(S<65536?f[y++]=S>>12|224:(f[y++]=S>>18|240,f[y++]=S>>12&63|128),f[y++]=S>>6&63|128),f[y++]=63&S|128)}return y}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&dh(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),Ac(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Ac(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var f=this.pos-r;f>=128&&dh(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,r){this.writeTag(e,$a.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,X,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Oe,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Ir,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,qe,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,lr,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,or,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Cr,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Nr,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Hr,t)},writeBytesField:function(e,t){this.writeTag(e,$a.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,$a.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,$a.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,$a.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,$a.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,$a.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,$a.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,$a.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,$a.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,$a.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var yr=function(e,t){var r=t.pixelRatio,f=t.version,v=t.stretchX,y=t.stretchY,S=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=y,this.content=S,this.version=f},Yr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Yr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Yr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Yr.tlbr.get=function(){return this.tl.concat(this.br)},Yr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(yr.prototype,Yr);var wn=function(e,t){var r={},f={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,f,v);var y=Bt(v),S=new Ao({width:y.w||1,height:y.h||1});for(var M in e){var z=e[M],Y=r[M].paddedRect;Ao.copy(z.data,S,{x:0,y:0},{x:Y.x+1,y:Y.y+1},z.data)}for(var J in t){var ae=t[J],he=f[J].paddedRect,ye=he.x+1,He=he.y+1,Xe=ae.data.width,gt=ae.data.height;Ao.copy(ae.data,S,{x:0,y:0},{x:ye,y:He},ae.data),Ao.copy(ae.data,S,{x:0,y:gt-1},{x:ye,y:He-1},{width:Xe,height:1}),Ao.copy(ae.data,S,{x:0,y:0},{x:ye,y:He+gt},{width:Xe,height:1}),Ao.copy(ae.data,S,{x:Xe-1,y:0},{x:ye-1,y:He},{width:1,height:gt}),Ao.copy(ae.data,S,{x:0,y:0},{x:ye+Xe,y:He},{width:1,height:gt})}this.image=S,this.iconPositions=r,this.patternPositions=f};wn.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],y={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(y),t[f]=new yr(y,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},wn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},wn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},kn("ImagePosition",yr),kn("ImageAtlas",wn);var Ar={horizontal:1,vertical:2,horizontalOnly:3},En=function(){this.scale=1,this.fontStack="",this.imageName=null};En.forText=function(e,t){var r=new En;return r.scale=e||1,r.fontStack=t,r},En.forImage=function(e){var t=new En;return t.imageName=e,t};var qr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function li(e,t,r,f,v,y,S,M,z,Y,J,ae,he,ye,He,Xe){var gt,rt=qr.fromFeature(e,v);ae===Ar.vertical&&rt.verticalizePunctuation();var Dt=Is.processBidirectionalText,$t=Is.processStyledBidirectionalText;if(Dt&&rt.sections.length===1){gt=[];for(var pr=0,mr=Dt(rt.toString(),bn(rt,Y,y,t,f,ye,He));pr<mr.length;pr+=1){var Or=mr[pr],nn=new qr;nn.text=Or,nn.sections=rt.sections;for(var vn=0;vn<Or.length;vn++)nn.sectionIndex.push(0);gt.push(nn)}}else if($t){gt=[];for(var Qn=0,Ln=$t(rt.text,rt.sectionIndex,bn(rt,Y,y,t,f,ye,He));Qn<Ln.length;Qn+=1){var si=Ln[Qn],zn=new qr;zn.text=si[0],zn.sectionIndex=si[1],zn.sections=rt.sections,gt.push(zn)}}else gt=function(qn,fa){for(var Ki=[],Ta=qn.text,yi=0,Ba=0,Po=fa;Ba<Po.length;Ba+=1){var Jo=Po[Ba];Ki.push(qn.substring(yi,Jo)),yi=Jo}return yi<Ta.length&&Ki.push(qn.substring(yi,Ta.length)),Ki}(rt,bn(rt,Y,y,t,f,ye,He));var sa=[],xi={positionedLines:sa,text:rt.toString(),top:J[1],bottom:J[1],left:J[0],right:J[0],writingMode:ae,iconsInText:!1,verticalizable:!1};return function(qn,fa,Ki,Ta,yi,Ba,Po,Jo,jo,yo,Mo,Ls){for(var gs=0,tu=-17,ks=0,Hs=0,Qo=Jo==="right"?1:Jo==="left"?0:.5,Fs=0,da=0,io=yi;da<io.length;da+=1){var Qa=io[da];Qa.trim();var _a=Qa.getMaxScale(),du=24*(_a-1),ru={positionedGlyphs:[],lineOffset:0};qn.positionedLines[Fs]=ru;var Va=ru.positionedGlyphs,qo=0;if(Qa.length()){for(var Cs=0;Cs<Qa.length();Cs++){var Ra=Qa.getSection(Cs),Oc=Qa.getSectionIndex(Cs),Ws=Qa.getCharCode(Cs),Lc=0,es=null,jc=null,oc=null,yh=24,Gf=!(jo===Ar.horizontal||!Mo&&!Ql(Ws)||Mo&&(Pr[Ws]||(uf=Ws,mn.Arabic(uf)||mn["Arabic Supplement"](uf)||mn["Arabic Extended-A"](uf)||mn["Arabic Presentation Forms-A"](uf)||mn["Arabic Presentation Forms-B"](uf))));if(Ra.imageName){var gh=Ta[Ra.imageName];if(!gh)continue;oc=Ra.imageName,qn.iconsInText=qn.iconsInText||!0,jc=gh.paddedRect;var of=gh.displaySize;Ra.scale=24*Ra.scale/Ls,Lc=du+(24-of[1]*Ra.scale),yh=(es={width:of[0],height:of[1],left:1,top:-3,advance:Gf?of[1]:of[0]}).advance;var _h=Gf?of[0]*Ra.scale-24*_a:of[1]*Ra.scale-24*_a;_h>0&&_h>qo&&(qo=_h)}else{var xh=Ki[Ra.fontStack],Af=xh&&xh[Ws];if(Af&&Af.rect)jc=Af.rect,es=Af.metrics;else{var ep=fa[Ra.fontStack],Hf=ep&&ep[Ws];if(!Hf)continue;es=Hf.metrics}Lc=24*(_a-Ra.scale)}Gf?(qn.verticalizable=!0,Va.push({glyph:Ws,imageName:oc,x:gs,y:tu+Lc,vertical:Gf,scale:Ra.scale,fontStack:Ra.fontStack,sectionIndex:Oc,metrics:es,rect:jc}),gs+=yh*Ra.scale+yo):(Va.push({glyph:Ws,imageName:oc,x:gs,y:tu+Lc,vertical:Gf,scale:Ra.scale,fontStack:Ra.fontStack,sectionIndex:Oc,metrics:es,rect:jc}),gs+=es.advance*Ra.scale+yo)}Va.length!==0&&(ks=Math.max(gs-yo,ks),Ii(Va,0,Va.length-1,Qo,qo)),gs=0;var sf=Ba*_a+qo;ru.lineOffset=Math.max(qo,du),tu+=sf,Hs=Math.max(sf,Hs),++Fs}else tu+=Ba,++Fs}var uf,Pf=tu- -17,lf=Ri(Po),Bl=lf.horizontalAlign,Wf=lf.verticalAlign;(function(bh,Rs,Sh,Eh,Ya,Ch,Vc,Gc,tp){var Xf,rp=(Rs-Sh)*Ya;Xf=Ch!==Vc?-Gc*Eh- -17:(-Eh*tp+.5)*Vc;for(var Yf=0,wh=bh;Yf<wh.length;Yf+=1)for(var cf=0,Kf=wh[Yf].positionedGlyphs;cf<Kf.length;cf+=1){var $f=Kf[cf];$f.x+=rp,$f.y+=Xf}})(qn.positionedLines,Qo,Bl,Wf,ks,Hs,Ba,Pf,yi.length),qn.top+=-Wf*Pf,qn.bottom=qn.top+Pf,qn.left+=-Bl*ks,qn.right=qn.left+ks}(xi,t,r,f,gt,S,M,z,ae,Y,he,Xe),!function(qn){for(var fa=0,Ki=qn;fa<Ki.length;fa+=1)if(Ki[fa].positionedGlyphs.length!==0)return!1;return!0}(sa)&&xi}qr.fromFeature=function(e,t){for(var r=new qr,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},qr.prototype.length=function(){return this.text.length},qr.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},qr.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},qr.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},qr.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&Du(f)&&!Cf[e[r+1]]||v&&Du(v)&&!Cf[e[r-1]]||!Cf[e[r]]?e[r]:Cf[e[r]]}return t}(this.text)},qr.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&Pr[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&Pr[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},qr.prototype.substring=function(e,t){var r=new qr;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},qr.prototype.toString=function(){return this.text},qr.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},qr.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(En.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},qr.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(En.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Ve("Reached maximum number of images 6401")}else Ve("Can't add FormattedSection with an empty image.")},qr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Pr={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Sr={};function Wn(e,t,r,f,v,y){if(t.imageName){var S=f[t.imageName];return S?S.displaySize[0]*t.scale*24/y+v:0}var M=r[t.fontStack],z=M&&M[e];return z?z.metrics.advance*t.scale+v:0}function hn(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function $r(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function yn(e,t,r,f,v,y){for(var S=null,M=hn(t,r,v,y),z=0,Y=f;z<Y.length;z+=1){var J=Y[z],ae=hn(t-J.x,r,v,y)+J.badness;ae<=M&&(S=J,M=ae)}return{index:e,x:t,priorBreak:S,badness:M}}function bn(e,t,r,f,v,y,S){if(y!=="point")return[];if(!e)return[];for(var M,z=[],Y=function(gt,rt,Dt,$t,pr,mr){for(var Or=0,nn=0;nn<gt.length();nn++){var vn=gt.getSection(nn);Or+=Wn(gt.getCharCode(nn),vn,$t,pr,rt,mr)}return Or/Math.max(1,Math.ceil(Or/Dt))}(e,t,r,f,v,S),J=e.text.indexOf("\u200B")>=0,ae=0,he=0;he<e.length();he++){var ye=e.getSection(he),He=e.getCharCode(he);if(Pr[He]||(ae+=Wn(He,ye,f,v,t,S)),he<e.length()-1){var Xe=!((M=He)<11904||!(mn["Bopomofo Extended"](M)||mn.Bopomofo(M)||mn["CJK Compatibility Forms"](M)||mn["CJK Compatibility Ideographs"](M)||mn["CJK Compatibility"](M)||mn["CJK Radicals Supplement"](M)||mn["CJK Strokes"](M)||mn["CJK Symbols and Punctuation"](M)||mn["CJK Unified Ideographs Extension A"](M)||mn["CJK Unified Ideographs"](M)||mn["Enclosed CJK Letters and Months"](M)||mn["Halfwidth and Fullwidth Forms"](M)||mn.Hiragana(M)||mn["Ideographic Description Characters"](M)||mn["Kangxi Radicals"](M)||mn["Katakana Phonetic Extensions"](M)||mn.Katakana(M)||mn["Vertical Forms"](M)||mn["Yi Radicals"](M)||mn["Yi Syllables"](M)));(Sr[He]||Xe||ye.imageName)&&z.push(yn(he+1,ae,Y,z,$r(He,e.getCharCode(he+1),Xe&&J),!1))}}return function gt(rt){return rt?gt(rt.priorBreak).concat(rt.index):[]}(yn(e.length(),ae,Y,z,0,!0))}function Ri(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Ii(e,t,r,f,v){if(f||v)for(var y=e[r],S=(e[r].x+y.metrics.advance*y.scale)*f,M=t;M<=r;M++)e[M].x-=S,e[M].y+=v}function An(e,t,r,f,v,y){var S,M=e.image;if(M.content){var z=M.content,Y=M.pixelRatio||1;S=[z[0]/Y,z[1]/Y,M.displaySize[0]-z[2]/Y,M.displaySize[1]-z[3]/Y]}var J,ae,he,ye,He=t.left*y,Xe=t.right*y;r==="width"||r==="both"?(ye=v[0]+He-f[3],ae=v[0]+Xe+f[1]):ae=(ye=v[0]+(He+Xe-M.displaySize[0])/2)+M.displaySize[0];var gt=t.top*y,rt=t.bottom*y;return r==="height"||r==="both"?(J=v[1]+gt-f[0],he=v[1]+rt+f[2]):he=(J=v[1]+(gt+rt-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:J,right:ae,bottom:he,left:ye,collisionPadding:S}}Sr[10]=!0,Sr[32]=!0,Sr[38]=!0,Sr[40]=!0,Sr[41]=!0,Sr[43]=!0,Sr[45]=!0,Sr[47]=!0,Sr[173]=!0,Sr[183]=!0,Sr[8203]=!0,Sr[8208]=!0,Sr[8211]=!0,Sr[8231]=!0;var Tn=function(e){function t(r,f,v,y){e.call(this,r,f),this.angle=v,y!==void 0&&(this.segment=y)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(H);function Ei(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new na(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,y=0;y<f.length&&f[y]<=e;)y++;for(var S=y=Math.max(0,y-1);S<f.length&&f[S]<e+1;)S++;S=Math.min(f.length-1,S);var M=f[y],z=f[S];return r.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:z,interpolationType:v}:{kind:"camera",minZoom:M,maxZoom:z,minSize:r.evaluate(new na(M)),maxSize:r.evaluate(new na(z)),interpolationType:v}}function Bi(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?wa(v/128,r.upperSize/128,t.uSizeT):f}function Fi(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,y=v?$e(Le.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=wa(e.minSize,e.maxSize,y):r=y}return{uSizeT:r,uSize:f}}kn("Anchor",Tn);var po=Object.freeze({__proto__:null,getSizeData:Ei,evaluateSizeForFeature:Bi,evaluateSizeForZoom:Fi,SIZE_PACK_FACTOR:128});function Co(e,t,r,f,v){if(t.segment===void 0)return!0;for(var y=t,S=t.segment+1,M=0;M>-r/2;){if(--S<0)return!1;M-=e[S].dist(y),y=e[S]}M+=e[S].dist(e[S+1]),S++;for(var z=[],Y=0;M<r/2;){var J=e[S],ae=e[S+1];if(!ae)return!1;var he=e[S-1].angleTo(J)-J.angleTo(ae);for(he=Math.abs((he+3*Math.PI)%(2*Math.PI)-Math.PI),z.push({distance:M,angleDelta:he}),Y+=he;M-z[0].distance>f;)Y-=z.shift().angleDelta;if(Y>v)return!1;S++,M+=J.dist(ae)}return!0}function oa(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Os(e,t,r){return e?.6*t*r:0}function uo(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function ys(e,t,r,f,v,y){for(var S=Os(r,v,y),M=uo(r,f)*y,z=0,Y=oa(e)/2,J=0;J<e.length-1;J++){var ae=e[J],he=e[J+1],ye=ae.dist(he);if(z+ye>Y){var He=(Y-z)/ye,Xe=wa(ae.x,he.x,He),gt=wa(ae.y,he.y,He),rt=new Tn(Xe,gt,he.angleTo(ae),J);return rt._round(),!S||Co(e,rt,M,S,t)?rt:void 0}z+=ye}}function Uo(e,t,r,f,v,y,S,M,z){var Y=Os(f,y,S),J=uo(f,v),ae=J*S,he=e[0].x===0||e[0].x===z||e[0].y===0||e[0].y===z;return t-ae<t/4&&(t=ae+t/4),function ye(He,Xe,gt,rt,Dt,$t,pr,mr,Or){for(var nn=$t/2,vn=oa(He),Qn=0,Ln=Xe-gt,si=[],zn=0;zn<He.length-1;zn++){for(var sa=He[zn],xi=He[zn+1],qn=sa.dist(xi),fa=xi.angleTo(sa);Ln+gt<Qn+qn;){var Ki=((Ln+=gt)-Qn)/qn,Ta=wa(sa.x,xi.x,Ki),yi=wa(sa.y,xi.y,Ki);if(Ta>=0&&Ta<Or&&yi>=0&&yi<Or&&Ln-nn>=0&&Ln+nn<=vn){var Ba=new Tn(Ta,yi,fa,zn);Ba._round(),rt&&!Co(He,Ba,$t,rt,Dt)||si.push(Ba)}}Qn+=qn}return mr||si.length||pr||(si=ye(He,Qn/2,gt,rt,Dt,$t,pr,!0,Or)),si}(e,he?t/2*M%t:(J/2+2*y)*S*M%t,t,Y,r,ae,he,!1,z)}function us(e,t,r,f,v){for(var y=[],S=0;S<e.length;S++)for(var M=e[S],z=void 0,Y=0;Y<M.length-1;Y++){var J=M[Y],ae=M[Y+1];J.x<t&&ae.x<t||(J.x<t?J=new H(t,J.y+(t-J.x)/(ae.x-J.x)*(ae.y-J.y))._round():ae.x<t&&(ae=new H(t,J.y+(t-J.x)/(ae.x-J.x)*(ae.y-J.y))._round()),J.y<r&&ae.y<r||(J.y<r?J=new H(J.x+(r-J.y)/(ae.y-J.y)*(ae.x-J.x),r)._round():ae.y<r&&(ae=new H(J.x+(r-J.y)/(ae.y-J.y)*(ae.x-J.x),r)._round()),J.x>=f&&ae.x>=f||(J.x>=f?J=new H(f,J.y+(f-J.x)/(ae.x-J.x)*(ae.y-J.y))._round():ae.x>=f&&(ae=new H(f,J.y+(f-J.x)/(ae.x-J.x)*(ae.y-J.y))._round()),J.y>=v&&ae.y>=v||(J.y>=v?J=new H(J.x+(v-J.y)/(ae.y-J.y)*(ae.x-J.x),v)._round():ae.y>=v&&(ae=new H(J.x+(v-J.y)/(ae.y-J.y)*(ae.x-J.x),v)._round()),z&&J.equals(z[z.length-1])||y.push(z=[J]),z.push(ae)))))}return y}function Ko(e,t,r,f){var v=[],y=e.image,S=y.pixelRatio,M=y.paddedRect.w-2,z=y.paddedRect.h-2,Y=e.right-e.left,J=e.bottom-e.top,ae=y.stretchX||[[0,M]],he=y.stretchY||[[0,z]],ye=function(Ta,yi){return Ta+yi[1]-yi[0]},He=ae.reduce(ye,0),Xe=he.reduce(ye,0),gt=M-He,rt=z-Xe,Dt=0,$t=He,pr=0,mr=Xe,Or=0,nn=gt,vn=0,Qn=rt;if(y.content&&f){var Ln=y.content;Dt=wo(ae,0,Ln[0]),pr=wo(he,0,Ln[1]),$t=wo(ae,Ln[0],Ln[2]),mr=wo(he,Ln[1],Ln[3]),Or=Ln[0]-Dt,vn=Ln[1]-pr,nn=Ln[2]-Ln[0]-$t,Qn=Ln[3]-Ln[1]-mr}var si=function(Ta,yi,Ba,Po){var Jo=Wi(Ta.stretch-Dt,$t,Y,e.left),jo=$o(Ta.fixed-Or,nn,Ta.stretch,He),yo=Wi(yi.stretch-pr,mr,J,e.top),Mo=$o(yi.fixed-vn,Qn,yi.stretch,Xe),Ls=Wi(Ba.stretch-Dt,$t,Y,e.left),gs=$o(Ba.fixed-Or,nn,Ba.stretch,He),tu=Wi(Po.stretch-pr,mr,J,e.top),ks=$o(Po.fixed-vn,Qn,Po.stretch,Xe),Hs=new H(Jo,yo),Qo=new H(Ls,yo),Fs=new H(Ls,tu),da=new H(Jo,tu),io=new H(jo/S,Mo/S),Qa=new H(gs/S,ks/S),_a=t*Math.PI/180;if(_a){var du=Math.sin(_a),ru=Math.cos(_a),Va=[ru,-du,du,ru];Hs._matMult(Va),Qo._matMult(Va),da._matMult(Va),Fs._matMult(Va)}var qo=Ta.stretch+Ta.fixed,Cs=yi.stretch+yi.fixed;return{tl:Hs,tr:Qo,bl:da,br:Fs,tex:{x:y.paddedRect.x+1+qo,y:y.paddedRect.y+1+Cs,w:Ba.stretch+Ba.fixed-qo,h:Po.stretch+Po.fixed-Cs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:io,pixelOffsetBR:Qa,minFontScaleX:nn/S/Y,minFontScaleY:Qn/S/J,isSDF:r}};if(f&&(y.stretchX||y.stretchY))for(var zn=Zo(ae,gt,He),sa=Zo(he,rt,Xe),xi=0;xi<zn.length-1;xi++)for(var qn=zn[xi],fa=zn[xi+1],Ki=0;Ki<sa.length-1;Ki++)v.push(si(qn,sa[Ki],fa,sa[Ki+1]));else v.push(si({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:z+1}));return v}function wo(e,t,r){for(var f=0,v=0,y=e;v<y.length;v+=1){var S=y[v];f+=Math.max(t,Math.min(r,S[1]))-Math.max(t,Math.min(r,S[0]))}return f}function Zo(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,y=e;v<y.length;v+=1){var S=y[v],M=S[0],z=S[1],Y=f[f.length-1];f.push({fixed:M-Y.stretch,stretch:Y.stretch}),f.push({fixed:M-Y.stretch,stretch:Y.stretch+(z-M)})}return f.push({fixed:t+1,stretch:r}),f}function Wi(e,t,r,f){return e/t*r+f}function $o(e,t,r,f){return e-t*r/f}var Ea=function(e,t,r,f,v,y,S,M,z,Y){if(this.boxStartIndex=e.length,z){var J=y.top,ae=y.bottom,he=y.collisionPadding;he&&(J-=he[1],ae+=he[3]);var ye=ae-J;ye>0&&(ye=Math.max(10,ye),this.circleDiameter=ye)}else{var He=y.top*S-M,Xe=y.bottom*S+M,gt=y.left*S-M,rt=y.right*S+M,Dt=y.collisionPadding;if(Dt&&(gt-=Dt[0]*S,He-=Dt[1]*S,rt+=Dt[2]*S,Xe+=Dt[3]*S),Y){var $t=new H(gt,He),pr=new H(rt,He),mr=new H(gt,Xe),Or=new H(rt,Xe),nn=Y*Math.PI/180;$t._rotate(nn),pr._rotate(nn),mr._rotate(nn),Or._rotate(nn),gt=Math.min($t.x,pr.x,mr.x,Or.x),rt=Math.max($t.x,pr.x,mr.x,Or.x),He=Math.min($t.y,pr.y,mr.y,Or.y),Xe=Math.max($t.y,pr.y,mr.y,Or.y)}e.emplaceBack(t.x,t.y,gt,He,rt,Xe,r,f,v)}this.boxEndIndex=e.length},no=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=di),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function di(e,t){return e<t?-1:e>t?1:0}function la(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,y=-1/0,S=-1/0,M=e[0],z=0;z<M.length;z++){var Y=M[z];(!z||Y.x<f)&&(f=Y.x),(!z||Y.y<v)&&(v=Y.y),(!z||Y.x>y)&&(y=Y.x),(!z||Y.y>S)&&(S=Y.y)}var J=Math.min(y-f,S-v),ae=J/2,he=new no([],Wa);if(J===0)return new H(f,v);for(var ye=f;ye<y;ye+=J)for(var He=v;He<S;He+=J)he.push(new lo(ye+ae,He+ae,ae,e));for(var Xe=function(Dt){for(var $t=0,pr=0,mr=0,Or=Dt[0],nn=0,vn=Or.length,Qn=vn-1;nn<vn;Qn=nn++){var Ln=Or[nn],si=Or[Qn],zn=Ln.x*si.y-si.x*Ln.y;pr+=(Ln.x+si.x)*zn,mr+=(Ln.y+si.y)*zn,$t+=3*zn}return new lo(pr/$t,mr/$t,0,Dt)}(e),gt=he.length;he.length;){var rt=he.pop();(rt.d>Xe.d||!Xe.d)&&(Xe=rt,r&&console.log("found best %d after %d probes",Math.round(1e4*rt.d)/1e4,gt)),rt.max-Xe.d<=t||(he.push(new lo(rt.p.x-(ae=rt.h/2),rt.p.y-ae,ae,e)),he.push(new lo(rt.p.x+ae,rt.p.y-ae,ae,e)),he.push(new lo(rt.p.x-ae,rt.p.y+ae,ae,e)),he.push(new lo(rt.p.x+ae,rt.p.y+ae,ae,e)),gt+=4)}return r&&(console.log("num probes: "+gt),console.log("best distance: "+Xe.d)),Xe.p}function Wa(e,t){return t.max-e.max}function lo(e,t,r,f){this.p=new H(e,t),this.h=r,this.d=function(v,y){for(var S=!1,M=1/0,z=0;z<y.length;z++)for(var Y=y[z],J=0,ae=Y.length,he=ae-1;J<ae;he=J++){var ye=Y[J],He=Y[he];ye.y>v.y!=He.y>v.y&&v.x<(He.x-ye.x)*(v.y-ye.y)/(He.y-ye.y)+ye.x&&(S=!S),M=Math.min(M,Oa(v,ye,He))}return(S?1:-1)*Math.sqrt(M)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}no.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},no.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},no.prototype.peek=function(){return this.data[0]},no.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,y=t[v];if(r(f,y)>=0)break;t[e]=y,e=v}t[e]=f},no.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var y=1+(e<<1),S=t[y],M=y+1;if(M<this.length&&r(t[M],S)<0&&(y=M,S=t[M]),r(S,v)>=0)break;t[e]=S,e=y}t[e]=v};var tl=Number.POSITIVE_INFINITY;function Ye(e,t){return t[1]!==tl?function(r,f,v){var y=0,S=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":S=v-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-v}switch(r){case"top-right":case"bottom-right":case"right":y=-f;break;case"top-left":case"bottom-left":case"left":y=f}return[y,S]}(e,t[0],t[1]):function(r,f){var v=0,y=0;f<0&&(f=0);var S=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":y=S-7;break;case"bottom-right":case"bottom-left":y=7-S;break;case"bottom":y=7-f;break;case"top":y=f-7}switch(r){case"top-right":case"bottom-right":v=-S;break;case"top-left":case"bottom-left":v=S;break;case"left":v=f;break;case"right":v=-f}return[v,y]}(e,t[0])}function dr(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function er(e,t,r,f,v,y,S,M,z,Y,J,ae,he,ye,He){var Xe=function(pr,mr,Or,nn,vn,Qn,Ln,si){for(var zn=nn.layout.get("text-rotate").evaluate(Qn,{})*Math.PI/180,sa=[],xi=0,qn=mr.positionedLines;xi<qn.length;xi+=1)for(var fa=qn[xi],Ki=0,Ta=fa.positionedGlyphs;Ki<Ta.length;Ki+=1){var yi=Ta[Ki];if(yi.rect){var Ba=yi.rect||{},Po=4,Jo=!0,jo=1,yo=0,Mo=(vn||si)&&yi.vertical,Ls=yi.metrics.advance*yi.scale/2;if(si&&mr.verticalizable&&(yo=fa.lineOffset/2-(yi.imageName?-(24-yi.metrics.width*yi.scale)/2:24*(yi.scale-1))),yi.imageName){var gs=Ln[yi.imageName];Jo=gs.sdf,Po=1/(jo=gs.pixelRatio)}var tu=vn?[yi.x+Ls,yi.y]:[0,0],ks=vn?[0,0]:[yi.x+Ls+Or[0],yi.y+Or[1]-yo],Hs=[0,0];Mo&&(Hs=ks,ks=[0,0]);var Qo=(yi.metrics.left-Po)*yi.scale-Ls+ks[0],Fs=(-yi.metrics.top-Po)*yi.scale+ks[1],da=Qo+Ba.w*yi.scale/jo,io=Fs+Ba.h*yi.scale/jo,Qa=new H(Qo,Fs),_a=new H(da,Fs),du=new H(Qo,io),ru=new H(da,io);if(Mo){var Va=new H(-Ls,Ls- -17),qo=-Math.PI/2,Cs=12-Ls,Ra=new H(22-Cs,-(yi.imageName?Cs:0)),Oc=new(Function.prototype.bind.apply(H,[null].concat(Hs)));Qa._rotateAround(qo,Va)._add(Ra)._add(Oc),_a._rotateAround(qo,Va)._add(Ra)._add(Oc),du._rotateAround(qo,Va)._add(Ra)._add(Oc),ru._rotateAround(qo,Va)._add(Ra)._add(Oc)}if(zn){var Ws=Math.sin(zn),Lc=Math.cos(zn),es=[Lc,-Ws,Ws,Lc];Qa._matMult(es),_a._matMult(es),du._matMult(es),ru._matMult(es)}var jc=new H(0,0),oc=new H(0,0);sa.push({tl:Qa,tr:_a,bl:du,br:ru,tex:Ba,writingMode:mr.writingMode,glyphOffset:tu,sectionIndex:yi.sectionIndex,isSDF:Jo,pixelOffsetTL:jc,pixelOffsetBR:oc,minFontScaleX:0,minFontScaleY:0})}}return sa}(0,r,M,v,y,S,f,e.allowVerticalPlacement),gt=e.textSizeData,rt=null;gt.kind==="source"?(rt=[128*v.layout.get("text-size").evaluate(S,{})])[0]>32640&&Ve(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):gt.kind==="composite"&&((rt=[128*ye.compositeTextSizes[0].evaluate(S,{},He),128*ye.compositeTextSizes[1].evaluate(S,{},He)])[0]>32640||rt[1]>32640)&&Ve(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,Xe,rt,M,y,S,Y,t,z.lineStartIndex,z.lineLength,he,He);for(var Dt=0,$t=J;Dt<$t.length;Dt+=1)ae[$t[Dt]]=e.text.placedSymbolArray.length-1;return 4*Xe.length}function Bn(e){for(var t in e)return e[t];return null}function ca(e,t,r,f){var v=e.compareText;if(t in v){for(var y=v[t],S=y.length-1;S>=0;S--)if(f.dist(y[S])<r)return!0}else v[t]=[];return v[t].push(f),!1}var ze=zc.VectorTileFeature.types,Ee=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ut(e,t,r,f,v,y,S,M,z,Y,J,ae,he){var ye=M?Math.min(32640,Math.round(M[0])):0,He=M?Math.min(32640,Math.round(M[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),y,S,(ye<<1)+(z?1:0),He,16*Y,16*J,256*ae,256*he)}function Ot(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function sr(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(ql(r[t].text))return!0;return!1}var yt=function(e){this.layoutVertexArray=new tc,this.indexArray=new Qu,this.programConfigurations=e,this.segments=new we,this.dynamicLayoutVertexArray=new Ju,this.opacityVertexArray=new dl,this.placedSymbolArray=new h};yt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},yt.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ph.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Ee,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},yt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},kn("SymbolBuffers",yt);var dt=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new we,this.collisionVertexArray=new xc};dt.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Kh.members,!0)},dt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},kn("CollisionBuffers",dt);var lt=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(y){return y.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Xo([]),this.placementViewportMatrix=Xo([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ei(this.zoom,t["text-size"]),this.iconSizeData=Ei(this.zoom,t["icon-size"]);var r=this.layers[0].layout,f=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(y){return Ar[y]})),this.stateDependentLayerIds=this.layers.filter(function(y){return y.isStateDependent()}).map(function(y){return y.id}),this.sourceID=e.sourceID};lt.prototype.createArrays=function(){this.text=new yt(new ie(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new yt(new ie(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new P,this.lineVertexArray=new N,this.symbolInstances=new C},lt.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var y=0;y<e.length;y++)if(t[e.charCodeAt(y)]=!0,(r||f)&&v){var S=Cf[e.charAt(y)];S&&(t[S.charCodeAt(0)]=!0)}},lt.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,y=v.get("text-font"),S=v.get("text-field"),M=v.get("icon-image"),z=(S.value.kind!=="constant"||S.value.value instanceof ba&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),Y=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,J=v.get("symbol-sort-key");if(this.features=[],z||Y){for(var ae=t.iconDependencies,he=t.glyphDependencies,ye=t.availableImages,He=new na(this.zoom),Xe=0,gt=e;Xe<gt.length;Xe+=1){var rt=gt[Xe],Dt=rt.feature,$t=rt.id,pr=rt.index,mr=rt.sourceLayerIndex,Or=f._featureFilter.needGeometry,nn=Lr(Dt,Or);if(f._featureFilter.filter(He,nn,r)){Or||(nn.geometry=qt(Dt));var vn=void 0;if(z){var Qn=f.getValueAndResolveTokens("text-field",nn,r,ye),Ln=ba.factory(Qn);sr(Ln)&&(this.hasRTLText=!0),(!this.hasRTLText||gc()==="unavailable"||this.hasRTLText&&Is.isParsed())&&(vn=Cp(Ln,f,nn))}var si=void 0;if(Y){var zn=f.getValueAndResolveTokens("icon-image",nn,r,ye);si=zn instanceof gi?zn:gi.fromString(zn)}if(vn||si){var sa=this.sortFeaturesByKey?J.evaluate(nn,{},r):void 0;if(this.features.push({id:$t,text:vn,icon:si,index:pr,sourceLayerIndex:mr,geometry:nn.geometry,properties:Dt.properties,type:ze[Dt.type],sortKey:sa}),si&&(ae[si.name]=!0),vn){var xi=y.evaluate(nn,{},r).join(","),qn=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ar.vertical)>=0;for(var fa=0,Ki=vn.sections;fa<Ki.length;fa+=1){var Ta=Ki[fa];if(Ta.image)ae[Ta.image.name]=!0;else{var yi=Jl(vn.toString()),Ba=Ta.fontStack||xi,Po=he[Ba]=he[Ba]||{};this.calculateGlyphDependencies(Ta.text,Po,qn,this.allowVerticalPlacement,yi)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(Jo){var jo={},yo={},Mo=[],Ls=0;function gs(Va){Mo.push(Jo[Va]),Ls++}function tu(Va,qo,Cs){var Ra=yo[Va];return delete yo[Va],yo[qo]=Ra,Mo[Ra].geometry[0].pop(),Mo[Ra].geometry[0]=Mo[Ra].geometry[0].concat(Cs[0]),Ra}function ks(Va,qo,Cs){var Ra=jo[qo];return delete jo[qo],jo[Va]=Ra,Mo[Ra].geometry[0].shift(),Mo[Ra].geometry[0]=Cs[0].concat(Mo[Ra].geometry[0]),Ra}function Hs(Va,qo,Cs){var Ra=Cs?qo[0][qo[0].length-1]:qo[0][0];return Va+":"+Ra.x+":"+Ra.y}for(var Qo=0;Qo<Jo.length;Qo++){var Fs=Jo[Qo],da=Fs.geometry,io=Fs.text?Fs.text.toString():null;if(io){var Qa=Hs(io,da),_a=Hs(io,da,!0);if(Qa in yo&&_a in jo&&yo[Qa]!==jo[_a]){var du=ks(Qa,_a,da),ru=tu(Qa,_a,Mo[du].geometry);delete jo[Qa],delete yo[_a],yo[Hs(io,Mo[ru].geometry,!0)]=ru,Mo[du].geometry=null}else Qa in yo?tu(Qa,_a,da):_a in jo?ks(Qa,_a,da):(gs(Qo),jo[Qa]=Ls-1,yo[_a]=Ls-1)}else gs(Qo)}return Mo.filter(function(Va){return Va.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Jo,jo){return Jo.sortKey-jo.sortKey})}},lt.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},lt.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},lt.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},lt.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},lt.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},lt.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},lt.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),y={},S=e.segment+1;S<t.length;S++)y[S]={x:t[S].x,y:t[S].y,tileUnitDistanceFromAnchor:f},S<t.length-1&&(f+=t[S+1].dist(t[S]));for(var M=e.segment||0;M>=0;M--)y[M]={x:t[M].x,y:t[M].y,tileUnitDistanceFromAnchor:v},M>0&&(v+=t[M-1].dist(t[M]));for(var z=0;z<t.length;z++){var Y=y[z];this.lineVertexArray.emplaceBack(Y.x,Y.y,Y.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},lt.prototype.addSymbols=function(e,t,r,f,v,y,S,M,z,Y,J,ae){for(var he=e.indexArray,ye=e.layoutVertexArray,He=e.segments.prepareSegment(4*t.length,ye,he,this.canOverlap?y.sortKey:void 0),Xe=this.glyphOffsetArray.length,gt=He.vertexLength,rt=this.allowVerticalPlacement&&S===Ar.vertical?Math.PI/2:0,Dt=y.text&&y.text.sections,$t=0;$t<t.length;$t++){var pr=t[$t],mr=pr.tl,Or=pr.tr,nn=pr.bl,vn=pr.br,Qn=pr.tex,Ln=pr.pixelOffsetTL,si=pr.pixelOffsetBR,zn=pr.minFontScaleX,sa=pr.minFontScaleY,xi=pr.glyphOffset,qn=pr.isSDF,fa=pr.sectionIndex,Ki=He.vertexLength,Ta=xi[1];ut(ye,M.x,M.y,mr.x,Ta+mr.y,Qn.x,Qn.y,r,qn,Ln.x,Ln.y,zn,sa),ut(ye,M.x,M.y,Or.x,Ta+Or.y,Qn.x+Qn.w,Qn.y,r,qn,si.x,Ln.y,zn,sa),ut(ye,M.x,M.y,nn.x,Ta+nn.y,Qn.x,Qn.y+Qn.h,r,qn,Ln.x,si.y,zn,sa),ut(ye,M.x,M.y,vn.x,Ta+vn.y,Qn.x+Qn.w,Qn.y+Qn.h,r,qn,si.x,si.y,zn,sa),Ot(e.dynamicLayoutVertexArray,M,rt),he.emplaceBack(Ki,Ki+1,Ki+2),he.emplaceBack(Ki+1,Ki+2,Ki+3),He.vertexLength+=4,He.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xi[0]),$t!==t.length-1&&fa===t[$t+1].sectionIndex||e.programConfigurations.populatePaintArrays(ye.length,y,y.index,{},ae,Dt&&Dt[fa])}e.placedSymbolArray.emplaceBack(M.x,M.y,Xe,this.glyphOffsetArray.length-Xe,gt,z,Y,M.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],S,0,!1,0,J)},lt.prototype._addCollisionDebugVertex=function(e,t,r,f,v,y){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(y.x),Math.round(y.y))},lt.prototype.addCollisionDebugVertices=function(e,t,r,f,v,y,S){var M=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),z=M.vertexLength,Y=v.layoutVertexArray,J=v.collisionVertexArray,ae=S.anchorX,he=S.anchorY;this._addCollisionDebugVertex(Y,J,y,ae,he,new H(e,t)),this._addCollisionDebugVertex(Y,J,y,ae,he,new H(r,t)),this._addCollisionDebugVertex(Y,J,y,ae,he,new H(r,f)),this._addCollisionDebugVertex(Y,J,y,ae,he,new H(e,f)),M.vertexLength+=4;var ye=v.indexArray;ye.emplaceBack(z,z+1),ye.emplaceBack(z+1,z+2),ye.emplaceBack(z+2,z+3),ye.emplaceBack(z+3,z),M.primitiveLength+=4},lt.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var y=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,f?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,r)}},lt.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new dt(Ll,$h.members,Nu),this.iconCollisionBox=new dt(Ll,$h.members,Nu);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},lt.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,y,S,M,z){for(var Y={},J=t;J<r;J++){var ae=e.get(J);Y.textBox={x1:ae.x1,y1:ae.y1,x2:ae.x2,y2:ae.y2,anchorPointX:ae.anchorPointX,anchorPointY:ae.anchorPointY},Y.textFeatureIndex=ae.featureIndex;break}for(var he=f;he<v;he++){var ye=e.get(he);Y.verticalTextBox={x1:ye.x1,y1:ye.y1,x2:ye.x2,y2:ye.y2,anchorPointX:ye.anchorPointX,anchorPointY:ye.anchorPointY},Y.verticalTextFeatureIndex=ye.featureIndex;break}for(var He=y;He<S;He++){var Xe=e.get(He);Y.iconBox={x1:Xe.x1,y1:Xe.y1,x2:Xe.x2,y2:Xe.y2,anchorPointX:Xe.anchorPointX,anchorPointY:Xe.anchorPointY},Y.iconFeatureIndex=Xe.featureIndex;break}for(var gt=M;gt<z;gt++){var rt=e.get(gt);Y.verticalIconBox={x1:rt.x1,y1:rt.y1,x2:rt.x2,y2:rt.y2,anchorPointX:rt.anchorPointX,anchorPointY:rt.anchorPointY},Y.verticalIconFeatureIndex=rt.featureIndex;break}return Y},lt.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},lt.prototype.hasTextData=function(){return this.text.segments.get().length>0},lt.prototype.hasIconData=function(){return this.icon.segments.get().length>0},lt.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},lt.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},lt.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},lt.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},lt.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],y=[],S=0;S<this.symbolInstances.length;++S){y.push(S);var M=this.symbolInstances.get(S);f.push(0|Math.round(t*M.anchorX+r*M.anchorY)),v.push(M.featureIndex)}return y.sort(function(z,Y){return f[z]-f[Y]||v[Y]-v[z]}),y},lt.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},lt.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(y,S,M){y>=0&&M.indexOf(y)===S&&t.addIndicesForPlacedSymbol(t.text,y)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},kn("SymbolBucket",lt,{omit:["layers","collisionBoxArray","features","compareText"]}),lt.MAX_GLYPHS=65535,lt.addDynamicAttributes=Ot;var De=new Wo({"symbol-placement":new ni(ue.layout_symbol["symbol-placement"]),"symbol-spacing":new ni(ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ni(ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Hn(ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ni(ue.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ni(ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ni(ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new ni(ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ni(ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new Hn(ue.layout_symbol["icon-size"]),"icon-text-fit":new ni(ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ni(ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new Hn(ue.layout_symbol["icon-image"]),"icon-rotate":new Hn(ue.layout_symbol["icon-rotate"]),"icon-padding":new ni(ue.layout_symbol["icon-padding"]),"icon-keep-upright":new ni(ue.layout_symbol["icon-keep-upright"]),"icon-offset":new Hn(ue.layout_symbol["icon-offset"]),"icon-anchor":new Hn(ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ni(ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ni(ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ni(ue.layout_symbol["text-rotation-alignment"]),"text-field":new Hn(ue.layout_symbol["text-field"]),"text-font":new Hn(ue.layout_symbol["text-font"]),"text-size":new Hn(ue.layout_symbol["text-size"]),"text-max-width":new Hn(ue.layout_symbol["text-max-width"]),"text-line-height":new ni(ue.layout_symbol["text-line-height"]),"text-letter-spacing":new Hn(ue.layout_symbol["text-letter-spacing"]),"text-justify":new Hn(ue.layout_symbol["text-justify"]),"text-radial-offset":new Hn(ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ni(ue.layout_symbol["text-variable-anchor"]),"text-anchor":new Hn(ue.layout_symbol["text-anchor"]),"text-max-angle":new ni(ue.layout_symbol["text-max-angle"]),"text-writing-mode":new ni(ue.layout_symbol["text-writing-mode"]),"text-rotate":new Hn(ue.layout_symbol["text-rotate"]),"text-padding":new ni(ue.layout_symbol["text-padding"]),"text-keep-upright":new ni(ue.layout_symbol["text-keep-upright"]),"text-transform":new Hn(ue.layout_symbol["text-transform"]),"text-offset":new Hn(ue.layout_symbol["text-offset"]),"text-allow-overlap":new ni(ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ni(ue.layout_symbol["text-ignore-placement"]),"text-optional":new ni(ue.layout_symbol["text-optional"])}),it={paint:new Wo({"icon-opacity":new Hn(ue.paint_symbol["icon-opacity"]),"icon-color":new Hn(ue.paint_symbol["icon-color"]),"icon-halo-color":new Hn(ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new Hn(ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Hn(ue.paint_symbol["icon-halo-blur"]),"icon-translate":new ni(ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new ni(ue.paint_symbol["icon-translate-anchor"]),"text-opacity":new Hn(ue.paint_symbol["text-opacity"]),"text-color":new Hn(ue.paint_symbol["text-color"],{runtimeType:cn,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Hn(ue.paint_symbol["text-halo-color"]),"text-halo-width":new Hn(ue.paint_symbol["text-halo-width"]),"text-halo-blur":new Hn(ue.paint_symbol["text-halo-blur"]),"text-translate":new ni(ue.paint_symbol["text-translate"]),"text-translate-anchor":new ni(ue.paint_symbol["text-translate-anchor"])}),layout:De},Ue=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Pn,this.defaultValue=e};Ue.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Ue.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Ue.prototype.outputDefined=function(){return!1},Ue.prototype.serialize=function(){return null},kn("FormatSectionOverride",Ue,{omit:["defaultValue"]});var Gt=function(e){function t(r){e.call(this,r,it)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var y=[],S=0,M=v;S<M.length;S+=1){var z=M[S];y.indexOf(z)<0&&y.push(z)}this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,y){var S=this.layout.get(r).evaluate(f,{},v,y),M=this._unevaluatedLayout._values[r];return M.isDataDriven()||vu(M.value)||!S?S:function(z,Y){return Y.replace(/{([^{}]+)}/g,function(J,ae){return ae in z?String(z[ae]):""})}(f.properties,S)},t.prototype.createBucket=function(r){return new lt(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=it.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var y,S=this.paint.get(v),M=new Ue(S),z=new Cl(M,S.property.specification);y=S.value.kind==="constant"||S.value.kind==="source"?new sl("source",z):new Wu("composite",z,S.value.zoomStops,S.value._interpolationType),this.paint._values[v]=new Eo(S.property,y,S.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),y=it.paint.properties[f],S=!1,M=function(J){for(var ae=0,he=J;ae<he.length;ae+=1)if(y.overrides&&y.overrides.hasOverride(he[ae]))return void(S=!0)};if(v.value.kind==="constant"&&v.value.value instanceof ba)M(v.value.value.sections);else if(v.value.kind==="source"){var z=function(J){S||(J instanceof zi&&Aa(J.value)===$i?M(J.value.sections):J instanceof To?M(J.sections):J.eachChild(z))},Y=v.value;Y._styleExpression&&z(Y._styleExpression.expression)}return S},t}(lu),Xt={paint:new Wo({"background-color":new ni(ue.paint_background["background-color"]),"background-pattern":new as(ue.paint_background["background-pattern"]),"background-opacity":new ni(ue.paint_background["background-opacity"])})},Br=function(e){function t(r){e.call(this,r,Xt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(lu),fn={paint:new Wo({"raster-opacity":new ni(ue.paint_raster["raster-opacity"]),"raster-hue-rotate":new ni(ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ni(ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ni(ue.paint_raster["raster-brightness-max"]),"raster-saturation":new ni(ue.paint_raster["raster-saturation"]),"raster-contrast":new ni(ue.paint_raster["raster-contrast"]),"raster-resampling":new ni(ue.paint_raster["raster-resampling"]),"raster-fade-duration":new ni(ue.paint_raster["raster-fade-duration"])})},sn=function(e){function t(r){e.call(this,r,fn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(lu),gn=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(lu),un={circle:el,heatmap:pf,hillshade:eu,fill:xf,"fill-extrusion":Gh,line:Wh,symbol:Gt,background:Br,raster:sn},Yn=L.HTMLImageElement,On=L.HTMLCanvasElement,jn=L.HTMLVideoElement,Vn=L.ImageData,Gn=L.ImageBitmap,hi=function(e,t,r,f){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,f)};hi.prototype.update=function(e,t,r){var f=e.width,v=e.height,y=!(this.size&&this.size[0]===f&&this.size[1]===v||r),S=this.context,M=S.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!t||t.premultiply!==!1)),y)this.size=[f,v],e instanceof Yn||e instanceof On||e instanceof jn||e instanceof Vn||Gn&&e instanceof Gn?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,e):M.texImage2D(M.TEXTURE_2D,0,this.format,f,v,0,this.format,M.UNSIGNED_BYTE,e.data);else{var z=r||{x:0,y:0},Y=z.x,J=z.y;e instanceof Yn||e instanceof On||e instanceof jn||e instanceof Vn||Gn&&e instanceof Gn?M.texSubImage2D(M.TEXTURE_2D,0,Y,J,M.RGBA,M.UNSIGNED_BYTE,e):M.texSubImage2D(M.TEXTURE_2D,0,Y,J,f,v,M.RGBA,M.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},hi.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},hi.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},hi.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Xa=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Xa.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Xa.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Bo=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ur(["receive","process"],this),this.invoker=new Xa(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Jt()?e:L};function bl(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}Bo.prototype.send=function(e,t,r,f,v){var y=this;v===void 0&&(v=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[S]=r);var M=Fe(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:Js(t,M)},M),{cancel:function(){r&&delete y.callbacks[S],y.target.postMessage({id:S,type:"<cancel>",targetMapId:f,sourceMapId:y.mapId})}}},Bo.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else Jt()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},Bo.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Bo.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(As(t.error)):f(null,As(t.data)))}else{var v=!1,y=Fe(this.globalScope)?void 0:[],S=t.hasCallback?function(J,ae){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:J?Js(J):null,data:Js(ae,y)},y)}:function(J){v=!0},M=null,z=As(t.data);if(this.parent[t.type])M=this.parent[t.type](t.sourceMapId,z,S);else if(this.parent.getWorkerSource){var Y=t.type.split(".");M=this.parent.getWorkerSource(t.sourceMapId,Y[0],z.source)[Y[1]](z,S)}else S(new Error("Could not find function "+t.type));!v&&M&&M.cancel&&(this.cancelCallbacks[e]=M.cancel)}},Bo.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ja=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Ja.prototype.setNorthEast=function(e){return this._ne=e instanceof La?new La(e.lng,e.lat):La.convert(e),this},Ja.prototype.setSouthWest=function(e){return this._sw=e instanceof La?new La(e.lng,e.lat):La.convert(e),this},Ja.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof La)t=e,r=e;else{if(!(e instanceof Ja))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ja.convert(e)):this.extend(La.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new La(t.lng,t.lat),this._ne=new La(r.lng,r.lat)),this},Ja.prototype.getCenter=function(){return new La((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ja.prototype.getSouthWest=function(){return this._sw},Ja.prototype.getNorthEast=function(){return this._ne},Ja.prototype.getNorthWest=function(){return new La(this.getWest(),this.getNorth())},Ja.prototype.getSouthEast=function(){return new La(this.getEast(),this.getSouth())},Ja.prototype.getWest=function(){return this._sw.lng},Ja.prototype.getSouth=function(){return this._sw.lat},Ja.prototype.getEast=function(){return this._ne.lng},Ja.prototype.getNorth=function(){return this._ne.lat},Ja.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ja.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ja.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ja.prototype.contains=function(e){var t=La.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},Ja.convert=function(e){return!e||e instanceof Ja?e:new Ja(e)};var La=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};La.prototype.wrap=function(){return new La(Rt(this.lng,-180,180),this.lat)},La.prototype.toArray=function(){return[this.lng,this.lat]},La.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},La.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},La.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new Ja(new La(this.lng-r,this.lat-t),new La(this.lng+r,this.lat+t))},La.convert=function(e){if(e instanceof La)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new La(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new La(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Ss=2*Math.PI*63710088e-1;function Zu(e){return Ss*Math.cos(e*Math.PI/180)}function Eu(e){return(180+e)/360}function vh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function rl(e,t){return e/Zu(t)}function Zf(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Tf=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Tf.fromLngLat=function(e,t){t===void 0&&(t=0);var r=La.convert(e);return new Tf(Eu(r.lng),vh(r.lat),rl(t,r.lat))},Tf.prototype.toLngLat=function(){return new La(360*this.x-180,Zf(this.y))},Tf.prototype.toAltitude=function(){return this.z*Zu(Zf(this.y))},Tf.prototype.meterInMercatorCoordinateUnits=function(){return 1/Ss*(e=Zf(this.y),1/Math.cos(e*Math.PI/180));var e};var Mc=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=jf(0,e,e,t,r)};Mc.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Mc.prototype.url=function(e,t){var r,f,v,y,S,M=(f=this.y,v=this.z,y=bl(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),S=bl(256*(r+1),256*(f+1),v),y[0]+","+y[1]+","+S[0]+","+S[1]),z=function(Y,J,ae){for(var he,ye="",He=Y;He>0;He--)ye+=(J&(he=1<<He-1)?1:0)+(ae&he?2:0);return ye}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",z).replace("{bbox-epsg-3857}",M)},Mc.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new H(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Mc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var wp=function(e,t){this.wrap=e,this.canonical=t,this.key=jf(e,t.z,t.z,t.x,t.y)},ls=function(e,t,r,f,v){this.overscaledZ=e,this.wrap=t,this.canonical=new Mc(r,+f,+v),this.key=jf(t,e,r,f,v)};function jf(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var y=1<<r;return(y*y*e+y*v+f).toString(36)+r.toString(36)+t.toString(36)}ls.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},ls.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new ls(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ls(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},ls.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?jf(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):jf(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},ls.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},ls.prototype.children=function(e){if(this.overscaledZ>=e)return[new ls(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new ls(t,this.wrap,t,r,f),new ls(t,this.wrap,t,r+1,f),new ls(t,this.wrap,t,r,f+1),new ls(t,this.wrap,t,r+1,f+1)]},ls.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},ls.prototype.wrapped=function(){return new ls(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.unwrapTo=function(e){return new ls(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ls.prototype.toUnwrapped=function(){return new wp(this.wrap,this.canonical)},ls.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ls.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Tf(e.x-this.wrap,e.y))},kn("CanonicalTileID",Mc),kn("OverscaledTileID",ls,{omit:["posMatrix"]});var Ic=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Ve('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<f;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(f,v)]=this.data[this._idx(f-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,f)]=this.data[this._idx(v,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};Ic.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},Ic.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Ic.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Ic.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},Ic.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},Ic.prototype.getPixels=function(){return new Ao({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Ic.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,y=r*this.dim,S=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:y=S-1;break;case 1:S=y+1}for(var M=-t*this.dim,z=-r*this.dim,Y=y;Y<S;Y++)for(var J=f;J<v;J++)this.data[this._idx(J,Y)]=e.data[this._idx(J+M,Y+z)]},kn("DEMData",Ic);var mh=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};mh.prototype.encode=function(e){return this._stringToNumber[e]},mh.prototype.decode=function(e){return this._numberToString[e]};var qh=function(e,t,r,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=f,this.properties=e.properties,this.id=v},Tp={geometry:{configurable:!0}};Tp.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Tp.geometry.set=function(e){this._geometry=e},qh.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(qh.prototype,Tp);var Vf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Vf.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Lt(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var y in this.deletedStates[e][f]={},this.state[e][f])r[y]||(this.deletedStates[e][f][y]=null);else for(var S in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][S]===null&&delete this.deletedStates[e][f][S]},Vf.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},Vf.prototype.getState=function(e,t){var r=String(t),f=Lt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var y in v)delete f[y]}return f},Vf.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},Vf.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),Lt(this.state[f][y],this.stateChanges[f][y]),v[y]=this.state[f][y];r[f]=v}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var M={};if(this.deletedStates[S]===null)for(var z in this.state[S])M[z]={},this.state[S][z]={};else for(var Y in this.deletedStates[S]){if(this.deletedStates[S][Y]===null)this.state[S][Y]={};else for(var J=0,ae=Object.keys(this.deletedStates[S][Y]);J<ae.length;J+=1)delete this.state[S][Y][ae[J]];M[Y]=this.state[S][Y]}r[S]=r[S]||{},Lt(r[S],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var he in e)e[he].setFeatureState(r,t)};var Uc=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ru(8192,16,0),this.grid3D=new Ru(8192,16,0),this.featureIndexArray=new oe,this.promoteId=t};function Hp(e,t,r,f,v){return fr(e,function(y,S){var M=t instanceof ku?t.get(S):null;return M&&M.evaluate?M.evaluate(r,f,v):M})}function Ap(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,y=0,S=e;y<S.length;y+=1){var M=S[y];t=Math.min(t,M.x),r=Math.min(r,M.y),f=Math.max(f,M.x),v=Math.max(v,M.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function Cd(e,t){return t-e}Uc.prototype.insert=function(e,t,r,f,v,y){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var M=y?this.grid3D:this.grid,z=0;z<t.length;z++){for(var Y=t[z],J=[1/0,1/0,-1/0,-1/0],ae=0;ae<Y.length;ae++){var he=Y[ae];J[0]=Math.min(J[0],he.x),J[1]=Math.min(J[1],he.y),J[2]=Math.max(J[2],he.x),J[3]=Math.max(J[3],he.y)}J[0]<8192&&J[1]<8192&&J[2]>=0&&J[3]>=0&&M.insert(S,J[0],J[1],J[2],J[3])}},Uc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new zc.VectorTile(new wf(this.rawTileData)).layers,this.sourceLayerCoder=new mh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Uc.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var y=e.params||{},S=8192/e.tileSize/e.scale,M=Gl(y.filter),z=e.queryGeometry,Y=e.queryPadding*S,J=Ap(z),ae=this.grid.query(J.minX-Y,J.minY-Y,J.maxX+Y,J.maxY+Y),he=Ap(e.cameraQueryGeometry),ye=this.grid3D.query(he.minX-Y,he.minY-Y,he.maxX+Y,he.maxY+Y,function(pr,mr,Or,nn){return function(vn,Qn,Ln,si,zn){for(var sa=0,xi=vn;sa<xi.length;sa+=1){var qn=xi[sa];if(Qn<=qn.x&&Ln<=qn.y&&si>=qn.x&&zn>=qn.y)return!0}var fa=[new H(Qn,Ln),new H(Qn,zn),new H(si,zn),new H(si,Ln)];if(vn.length>2){for(var Ki=0,Ta=fa;Ki<Ta.length;Ki+=1)if(Ma(vn,Ta[Ki]))return!0}for(var yi=0;yi<vn.length-1;yi++)if(ga(vn[yi],vn[yi+1],fa))return!0;return!1}(e.cameraQueryGeometry,pr-Y,mr-Y,Or+Y,nn+Y)}),He=0,Xe=ye;He<Xe.length;He+=1)ae.push(Xe[He]);ae.sort(Cd);for(var gt,rt={},Dt=function(pr){var mr=ae[pr];if(mr!==gt){gt=mr;var Or=v.featureIndexArray.get(mr),nn=null;v.loadMatchingFeature(rt,Or.bucketIndex,Or.sourceLayerIndex,Or.featureIndex,M,y.layers,y.availableImages,t,r,f,function(vn,Qn,Ln){return nn||(nn=qt(vn)),Qn.queryIntersectsFeature(z,vn,Ln,nn,v.z,e.transform,S,e.pixelPosMatrix)})}},$t=0;$t<ae.length;$t++)Dt($t);return rt},Uc.prototype.loadMatchingFeature=function(e,t,r,f,v,y,S,M,z,Y,J){var ae=this.bucketLayerIDs[t];if(!y||function(vn,Qn){for(var Ln=0;Ln<vn.length;Ln++)if(Qn.indexOf(vn[Ln])>=0)return!0;return!1}(y,ae)){var he=this.sourceLayerCoder.decode(r),ye=this.vtLayers[he].feature(f);if(v.needGeometry){var He=Lr(ye,!0);if(!v.filter(new na(this.tileID.overscaledZ),He,this.tileID.canonical))return}else if(!v.filter(new na(this.tileID.overscaledZ),ye))return;for(var Xe=this.getId(ye,he),gt=0;gt<ae.length;gt++){var rt=ae[gt];if(!(y&&y.indexOf(rt)<0)){var Dt=M[rt];if(Dt){var $t={};Xe!==void 0&&Y&&($t=Y.getState(Dt.sourceLayer||"_geojsonTileLayer",Xe));var pr=Lt({},z[rt]);pr.paint=Hp(pr.paint,Dt.paint,ye,$t,S),pr.layout=Hp(pr.layout,Dt.layout,ye,$t,S);var mr=!J||J(ye,Dt,$t);if(mr){var Or=new qh(ye,this.z,this.x,this.y,Xe);Or.layer=pr;var nn=e[rt];nn===void 0&&(nn=e[rt]=[]),nn.push({featureIndex:f,feature:Or,intersectionZ:mr})}}}}}},Uc.prototype.lookupSymbolFeatures=function(e,t,r,f,v,y,S,M){var z={};this.loadVTLayers();for(var Y=Gl(v),J=0,ae=e;J<ae.length;J+=1)this.loadMatchingFeature(z,r,f,ae[J],Y,y,S,M,t);return z},Uc.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},Uc.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},kn("FeatureIndex",Uc,{omit:["rawTileData","sourceLayerCoder"]});var Es=function(e,t){this.tileID=e,this.uid=St(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Es.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<Vi.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},Es.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Es.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(Y,J){var ae={};if(!J)return ae;for(var he=function(){var Xe=He[ye],gt=Xe.layerIds.map(function($t){return J.getLayer($t)}).filter(Boolean);if(gt.length!==0){Xe.layers=gt,Xe.stateDependentLayerIds&&(Xe.stateDependentLayers=Xe.stateDependentLayerIds.map(function($t){return gt.filter(function(pr){return pr.id===$t})[0]}));for(var rt=0,Dt=gt;rt<Dt.length;rt+=1)ae[Dt[rt].id]=Xe}},ye=0,He=Y;ye<He.length;ye+=1)he();return ae}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof lt){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var y in this.buckets){var S=this.buckets[y];if(S instanceof lt&&S.hasRTLText){this.hasRTLText=!0,Is.isLoading()||Is.isLoaded()||gc()!=="deferred"||Qs();break}}for(var M in this.queryPadding=0,this.buckets){var z=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(M).queryRadius(z))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},Es.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Es.prototype.getBucket=function(e){return this.buckets[e.id]},Es.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new hi(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new hi(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},Es.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},Es.prototype.queryRenderedFeatures=function(e,t,r,f,v,y,S,M,z,Y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:y,tileSize:this.tileSize,pixelPosMatrix:Y,transform:M,params:S,queryPadding:this.queryPadding*z},e,t,r):{}},Es.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",y=f._geojsonTileLayer||f[v];if(y)for(var S=Gl(t&&t.filter),M=this.tileID.canonical,z=M.z,Y=M.x,J=M.y,ae={z,x:Y,y:J},he=0;he<y.length;he++){var ye=y.feature(he);if(S.needGeometry){var He=Lr(ye,!0);if(!S.filter(new na(this.tileID.overscaledZ),He,this.tileID.canonical))continue}else if(!S.filter(new na(this.tileID.overscaledZ),ye))continue;var Xe=r.getId(ye,v),gt=new qh(ye,z,Y,J,Xe);gt.tile=ae,e.push(gt)}}},Es.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Es.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Es.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=Fr(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var y=this.expirationTime-t;y?this.expirationTime=f+Math.max(y,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Es.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Es.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],y=v.layers[0].sourceLayer||"_geojsonTileLayer",S=r[y],M=e[y];if(S&&M&&Object.keys(M).length!==0){v.update(M,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var z=t&&t.style&&t.style.getLayer(f);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(v)))}}}},Es.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Es.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Vi.now()},Es.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Es.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=Vi.now()+e},Es.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},Es.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var y=0,S=t;y<S.length;y+=1)if(v[S[y]])return!0}}return!1};var Zc=L.performance,Pp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},Zc.mark(this._marks.start)};Pp.prototype.finish=function(){Zc.mark(this._marks.end);var e=Zc.getEntriesByName(this._marks.measure);return e.length===0&&(Zc.measure(this._marks.measure,this._marks.start,this._marks.end),e=Zc.getEntriesByName(this._marks.measure),Zc.clearMarks(this._marks.start),Zc.clearMarks(this._marks.end),Zc.clearMeasures(this._marks.measure)),e},p.Actor=Bo,p.AlphaImage=hu,p.CanonicalTileID=Mc,p.CollisionBoxArray=u,p.Color=Xi,p.DEMData=Ic,p.DataConstantProperty=ni,p.DictionaryCoder=mh,p.EXTENT=8192,p.ErrorEvent=de,p.EvaluationParameters=na,p.Event=se,p.Evented=Me,p.FeatureIndex=Uc,p.FillBucket=Su,p.FillExtrusionBucket=Uu,p.ImageAtlas=wn,p.ImagePosition=yr,p.LineBucket=zo,p.LngLat=La,p.LngLatBounds=Ja,p.MercatorCoordinate=Tf,p.ONE_EM=24,p.OverscaledTileID=ls,p.Point=H,p.Point$1=H,p.Properties=Wo,p.Protobuf=wf,p.RGBAImage=Ao,p.RequestManager=ir,p.RequestPerformance=Pp,p.ResourceType=wr,p.SegmentVector=we,p.SourceFeatureState=Vf,p.StructArrayLayout1ui2=nc,p.StructArrayLayout2f1f2i16=vl,p.StructArrayLayout2i4=xs,p.StructArrayLayout3ui6=Qu,p.StructArrayLayout4i8=Ol,p.SymbolBucket=lt,p.Texture=hi,p.Tile=Es,p.Transitionable=No,p.Uniform1f=an,p.Uniform1i=zr,p.Uniform2f=Qr,p.Uniform3f=Cn,p.Uniform4f=ei,p.UniformColor=fi,p.UniformMatrix4f=ia,p.UnwrappedTileID=wp,p.ValidationError=Te,p.WritingMode=Ar,p.ZoomHistory=mc,p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},p.addDynamicAttributes=Ot,p.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),y=null;e.forEach(function(S,M){t(S,function(z,Y){z&&(y=z),v[M]=Y,--f==0&&r(y,v)})})},p.bezier=xe,p.bindAll=ur,p.browser=Vi,p.cacheEntryPossiblyAdded=function(e){++tn>ht&&(e.getActor().send("enforceCacheSizeLimit",xt),tn=0)},p.clamp=$e,p.clearTileCache=function(e){var t=L.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=us,p.clone=function(e){var t=new ji(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=Je,p.clone$2=function(e){var t=new ji(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=Ep,p.config=ar,p.create=function(){var e=new ji(16);return ji!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new ji(9);return ji!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new ji(4);return ji!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=E,p.createExpression=ol,p.createLayout=Do,p.createStyleLayer=function(e){return e.type==="custom"?new gn(e):new un[e.type](e)},p.cross=function(e,t,r){var f=t[0],v=t[1],y=t[2],S=r[0],M=r[1],z=r[2];return e[0]=v*z-y*M,e[1]=y*S-f*z,e[2]=f*M-v*S,e},p.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=Re,p.emitValidationErrors=Al,p.endsWith=ee,p.enforceCacheSizeLimit=function(e){vr(),Mt&&Mt.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},p.evaluateSizeForFeature=Bi,p.evaluateSizeForZoom=Fi,p.evaluateVariableOffset=Ye,p.evented=yc,p.extend=Lt,p.featureFilter=Gl,p.filterObject=At,p.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=Ri,p.getAnchorJustification=dr,p.getArrayBuffer=ki,p.getImage=ce,p.getJSON=function(e,t){return qi(Lt(e,{type:"json"}),t)},p.getRTLTextPluginStatus=gc,p.getReferrer=Zn,p.getVideo=function(e,t){var r,f,v=L.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var y=0;y<e.length;y++){var S=L.document.createElement("source");r=e[y],f=void 0,(f=L.document.createElement("a")).href=r,(f.protocol!==L.document.location.protocol||f.host!==L.document.location.host)&&(v.crossOrigin="Anonymous"),S.src=e[y],v.appendChild(S)}return{cancel:function(){}}},p.identity=Xo,p.invert=function(e,t){var r=t[0],f=t[1],v=t[2],y=t[3],S=t[4],M=t[5],z=t[6],Y=t[7],J=t[8],ae=t[9],he=t[10],ye=t[11],He=t[12],Xe=t[13],gt=t[14],rt=t[15],Dt=r*M-f*S,$t=r*z-v*S,pr=r*Y-y*S,mr=f*z-v*M,Or=f*Y-y*M,nn=v*Y-y*z,vn=J*Xe-ae*He,Qn=J*gt-he*He,Ln=J*rt-ye*He,si=ae*gt-he*Xe,zn=ae*rt-ye*Xe,sa=he*rt-ye*gt,xi=Dt*sa-$t*zn+pr*si+mr*Ln-Or*Qn+nn*vn;return xi?(e[0]=(M*sa-z*zn+Y*si)*(xi=1/xi),e[1]=(v*zn-f*sa-y*si)*xi,e[2]=(Xe*nn-gt*Or+rt*mr)*xi,e[3]=(he*Or-ae*nn-ye*mr)*xi,e[4]=(z*Ln-S*sa-Y*Qn)*xi,e[5]=(r*sa-v*Ln+y*Qn)*xi,e[6]=(gt*pr-He*nn-rt*$t)*xi,e[7]=(J*nn-he*pr+ye*$t)*xi,e[8]=(S*zn-M*Ln+Y*vn)*xi,e[9]=(f*Ln-r*zn-y*vn)*xi,e[10]=(He*Or-Xe*pr+rt*Dt)*xi,e[11]=(ae*pr-J*Or-ye*Dt)*xi,e[12]=(M*Qn-S*si-z*vn)*xi,e[13]=(r*si-f*Qn+v*vn)*xi,e[14]=(Xe*$t-He*mr-gt*Dt)*xi,e[15]=(J*mr-ae*$t+he*Dt)*xi,e):null},p.isChar=mn,p.isMapboxURL=T,p.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},p.makeRequest=qi,p.mapObject=fr,p.mercatorXfromLng=Eu,p.mercatorYfromLat=vh,p.mercatorZfromAltitude=rl,p.mul=Sc,p.multiply=Fo,p.mvt=zc,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],y=r*r+f*f+v*v;return y>0&&(y=1/Math.sqrt(y)),e[0]=t[0]*y,e[1]=t[1]*y,e[2]=t[2]*y,e},p.number=wa,p.offscreenCanvasSupported=jr,p.ortho=function(e,t,r,f,v,y,S){var M=1/(t-r),z=1/(f-v),Y=1/(y-S);return e[0]=-2*M,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*z,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*Y,e[11]=0,e[12]=(t+r)*M,e[13]=(v+f)*z,e[14]=(S+y)*Y,e[15]=1,e},p.parseGlyphPBF=function(e){return new wf(e).readFields(dn,[])},p.pbf=wf,p.performSymbolLayout=function(e,t,r,f,v,y,S){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var M=e.layers[0].layout,z=e.layers[0]._unevaluatedLayout._values,Y={};if(e.textSizeData.kind==="composite"){var J=e.textSizeData,ae=J.maxZoom;Y.compositeTextSizes=[z["text-size"].possiblyEvaluate(new na(J.minZoom),S),z["text-size"].possiblyEvaluate(new na(ae),S)]}if(e.iconSizeData.kind==="composite"){var he=e.iconSizeData,ye=he.maxZoom;Y.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new na(he.minZoom),S),z["icon-size"].possiblyEvaluate(new na(ye),S)]}Y.layoutTextSize=z["text-size"].possiblyEvaluate(new na(e.zoom+1),S),Y.layoutIconSize=z["icon-size"].possiblyEvaluate(new na(e.zoom+1),S),Y.textMaxSize=z["text-size"].possiblyEvaluate(new na(18));for(var He=24*M.get("text-line-height"),Xe=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",gt=M.get("text-keep-upright"),rt=M.get("text-size"),Dt=function(){var mr=pr[$t],Or=M.get("text-font").evaluate(mr,{},S).join(","),nn=rt.evaluate(mr,{},S),vn=Y.layoutTextSize.evaluate(mr,{},S),Qn=Y.layoutIconSize.evaluate(mr,{},S),Ln={horizontal:{},vertical:void 0},si=mr.text,zn=[0,0];if(si){var sa=si.toString(),xi=24*M.get("text-letter-spacing").evaluate(mr,{},S),qn=function(da){for(var io=0,Qa=da;io<Qa.length;io+=1)if(_a=Qa[io].charCodeAt(0),mn.Arabic(_a)||mn["Arabic Supplement"](_a)||mn["Arabic Extended-A"](_a)||mn["Arabic Presentation Forms-A"](_a)||mn["Arabic Presentation Forms-B"](_a))return!1;var _a;return!0}(sa)?xi:0,fa=M.get("text-anchor").evaluate(mr,{},S),Ki=M.get("text-variable-anchor");if(!Ki){var Ta=M.get("text-radial-offset").evaluate(mr,{},S);zn=Ta?Ye(fa,[24*Ta,tl]):M.get("text-offset").evaluate(mr,{},S).map(function(da){return 24*da})}var yi=Xe?"center":M.get("text-justify").evaluate(mr,{},S),Ba=M.get("symbol-placement"),Po=Ba==="point"?24*M.get("text-max-width").evaluate(mr,{},S):0,Jo=function(){e.allowVerticalPlacement&&Jl(sa)&&(Ln.vertical=li(si,t,r,v,Or,Po,He,fa,"left",qn,zn,Ar.vertical,!0,Ba,vn,nn))};if(!Xe&&Ki){for(var jo=yi==="auto"?Ki.map(function(da){return dr(da)}):[yi],yo=!1,Mo=0;Mo<jo.length;Mo++){var Ls=jo[Mo];if(!Ln.horizontal[Ls])if(yo)Ln.horizontal[Ls]=Ln.horizontal[0];else{var gs=li(si,t,r,v,Or,Po,He,"center",Ls,qn,zn,Ar.horizontal,!1,Ba,vn,nn);gs&&(Ln.horizontal[Ls]=gs,yo=gs.positionedLines.length===1)}}Jo()}else{yi==="auto"&&(yi=dr(fa));var tu=li(si,t,r,v,Or,Po,He,fa,yi,qn,zn,Ar.horizontal,!1,Ba,vn,nn);tu&&(Ln.horizontal[yi]=tu),Jo(),Jl(sa)&&Xe&&gt&&(Ln.vertical=li(si,t,r,v,Or,Po,He,fa,yi,qn,zn,Ar.vertical,!1,Ba,vn,nn))}}var ks=void 0,Hs=!1;if(mr.icon&&mr.icon.name){var Qo=f[mr.icon.name];Qo&&(ks=function(da,io,Qa){var _a=Ri(Qa),du=io[0]-da.displaySize[0]*_a.horizontalAlign,ru=io[1]-da.displaySize[1]*_a.verticalAlign;return{image:da,top:ru,bottom:ru+da.displaySize[1],left:du,right:du+da.displaySize[0]}}(v[mr.icon.name],M.get("icon-offset").evaluate(mr,{},S),M.get("icon-anchor").evaluate(mr,{},S)),Hs=Qo.sdf,e.sdfIcons===void 0?e.sdfIcons=Qo.sdf:e.sdfIcons!==Qo.sdf&&Ve("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Qo.pixelRatio!==e.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Fs=Bn(Ln.horizontal)||Ln.vertical;e.iconsInText=!!Fs&&Fs.iconsInText,(Fs||ks)&&function(da,io,Qa,_a,du,ru,Va,qo,Cs,Ra,Oc){var Ws=ru.textMaxSize.evaluate(io,{});Ws===void 0&&(Ws=Va);var Lc,es=da.layers[0].layout,jc=es.get("icon-offset").evaluate(io,{},Oc),oc=Bn(Qa.horizontal),yh=Va/24,Gf=da.tilePixelRatio*yh,gh=da.tilePixelRatio*Ws/24,of=da.tilePixelRatio*qo,_h=da.tilePixelRatio*es.get("symbol-spacing"),xh=es.get("text-padding")*da.tilePixelRatio,Af=es.get("icon-padding")*da.tilePixelRatio,ep=es.get("text-max-angle")/180*Math.PI,Hf=es.get("text-rotation-alignment")==="map"&&es.get("symbol-placement")!=="point",sf=es.get("icon-rotation-alignment")==="map"&&es.get("symbol-placement")!=="point",uf=es.get("symbol-placement"),Pf=_h/2,lf=es.get("icon-text-fit");_a&&lf!=="none"&&(da.allowVerticalPlacement&&Qa.vertical&&(Lc=An(_a,Qa.vertical,lf,es.get("icon-text-fit-padding"),jc,yh)),oc&&(_a=An(_a,oc,lf,es.get("icon-text-fit-padding"),jc,yh)));var Bl=function(wd,Th){Th.x<0||Th.x>=8192||Th.y<0||Th.y>=8192||function(ts,sc,Td,ff,Ip,Op,ap,Rc,op,Jf,sp,up,Lp,Yp,Ah,Kp,Rp,$p,Jp,Qp,nl,lp,qp,Dc,Ad){var Dp,Mf,Qf,qf,If,eh=ts.addToLineVertexArray(sc,Td),ed=0,td=0,rd=0,nd=0,kp=-1,cp=-1,Hc={},id=je(""),Fp=0,Bp=0;if(Rc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Fp=(Dp=Rc.layout.get("text-offset").evaluate(nl,{},Dc).map(function(rh){return 24*rh}))[0],Bp=Dp[1]):(Fp=24*Rc.layout.get("text-radial-offset").evaluate(nl,{},Dc),Bp=tl),ts.allowVerticalPlacement&&ff.vertical){var ad=Rc.layout.get("text-rotate").evaluate(nl,{},Dc)+90;qf=new Ea(op,sc,Jf,sp,up,ff.vertical,Lp,Yp,Ah,ad),ap&&(If=new Ea(op,sc,Jf,sp,up,ap,Rp,$p,Ah,ad))}if(Ip){var Np=Rc.layout.get("icon-rotate").evaluate(nl,{}),od=Rc.layout.get("icon-text-fit")!=="none",sd=Ko(Ip,Np,qp,od),fp=ap?Ko(ap,Np,qp,od):void 0;Qf=new Ea(op,sc,Jf,sp,up,Ip,Rp,$p,!1,Np),ed=4*sd.length;var zp=ts.iconSizeData,th=null;zp.kind==="source"?(th=[128*Rc.layout.get("icon-size").evaluate(nl,{})])[0]>32640&&Ve(ts.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):zp.kind==="composite"&&((th=[128*lp.compositeIconSizes[0].evaluate(nl,{},Dc),128*lp.compositeIconSizes[1].evaluate(nl,{},Dc)])[0]>32640||th[1]>32640)&&Ve(ts.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),ts.addSymbols(ts.icon,sd,th,Qp,Jp,nl,!1,sc,eh.lineStartIndex,eh.lineLength,-1,Dc),kp=ts.icon.placedSymbolArray.length-1,fp&&(td=4*fp.length,ts.addSymbols(ts.icon,fp,th,Qp,Jp,nl,Ar.vertical,sc,eh.lineStartIndex,eh.lineLength,-1,Dc),cp=ts.icon.placedSymbolArray.length-1)}for(var Of in ff.horizontal){var Ph=ff.horizontal[Of];if(!Mf){id=je(Ph.text);var Pd=Rc.layout.get("text-rotate").evaluate(nl,{},Dc);Mf=new Ea(op,sc,Jf,sp,up,Ph,Lp,Yp,Ah,Pd)}var ud=Ph.positionedLines.length===1;if(rd+=er(ts,sc,Ph,Op,Rc,Ah,nl,Kp,eh,ff.vertical?Ar.horizontal:Ar.horizontalOnly,ud?Object.keys(ff.horizontal):[Of],Hc,kp,lp,Dc),ud)break}ff.vertical&&(nd+=er(ts,sc,ff.vertical,Op,Rc,Ah,nl,Kp,eh,Ar.vertical,["vertical"],Hc,cp,lp,Dc));var Md=Mf?Mf.boxStartIndex:ts.collisionBoxArray.length,Id=Mf?Mf.boxEndIndex:ts.collisionBoxArray.length,Mh=qf?qf.boxStartIndex:ts.collisionBoxArray.length,Ih=qf?qf.boxEndIndex:ts.collisionBoxArray.length,Oh=Qf?Qf.boxStartIndex:ts.collisionBoxArray.length,Lh=Qf?Qf.boxEndIndex:ts.collisionBoxArray.length,Od=If?If.boxStartIndex:ts.collisionBoxArray.length,ld=If?If.boxEndIndex:ts.collisionBoxArray.length,Nl=-1,hp=function(rh,fd){return rh&&rh.circleDiameter?Math.max(rh.circleDiameter,fd):fd};Nl=hp(Mf,Nl),Nl=hp(qf,Nl),Nl=hp(Qf,Nl);var cd=(Nl=hp(If,Nl))>-1?1:0;cd&&(Nl*=Ad/24),ts.glyphOffsetArray.length>=lt.MAX_GLYPHS&&Ve("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),nl.sortKey!==void 0&&ts.addToSortKeyRanges(ts.symbolInstances.length,nl.sortKey),ts.symbolInstances.emplaceBack(sc.x,sc.y,Hc.right>=0?Hc.right:-1,Hc.center>=0?Hc.center:-1,Hc.left>=0?Hc.left:-1,Hc.vertical||-1,kp,cp,id,Md,Id,Mh,Ih,Oh,Lh,Od,ld,Jf,rd,nd,ed,td,cd,0,Lp,Fp,Bp,Nl)}(da,Th,wd,Qa,_a,du,Lc,da.layers[0],da.collisionBoxArray,io.index,io.sourceLayerIndex,da.index,Gf,xh,Hf,Cs,of,Af,sf,jc,io,ru,Ra,Oc,Va)};if(uf==="line")for(var Wf=0,bh=us(io.geometry,0,0,8192,8192);Wf<bh.length;Wf+=1)for(var Rs=bh[Wf],Sh=0,Eh=Uo(Rs,_h,ep,Qa.vertical||oc,_a,24,gh,da.overscaling,8192);Sh<Eh.length;Sh+=1){var Ya=Eh[Sh];oc&&ca(da,oc.text,Pf,Ya)||Bl(Rs,Ya)}else if(uf==="line-center")for(var Ch=0,Vc=io.geometry;Ch<Vc.length;Ch+=1){var Gc=Vc[Ch];if(Gc.length>1){var tp=ys(Gc,ep,Qa.vertical||oc,_a,24,gh);tp&&Bl(Gc,tp)}}else if(io.type==="Polygon")for(var Xf=0,rp=mf(io.geometry,0);Xf<rp.length;Xf+=1){var Yf=rp[Xf],wh=la(Yf,16);Bl(Yf[0],new Tn(wh.x,wh.y,0))}else if(io.type==="LineString")for(var cf=0,Kf=io.geometry;cf<Kf.length;cf+=1){var $f=Kf[cf];Bl($f,new Tn($f[0].x,$f[0].y,0))}else if(io.type==="Point")for(var Mp=0,Wp=io.geometry;Mp<Wp.length;Mp+=1)for(var np=0,Xp=Wp[Mp];np<Xp.length;np+=1){var ip=Xp[np];Bl([ip],new Tn(ip.x,ip.y,0))}}(e,mr,Ln,ks,f,Y,vn,Qn,zn,Hs,S)},$t=0,pr=e.features;$t<pr.length;$t+=1)Dt();y&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,r,f,v){var y,S=1/Math.tan(t/2);return e[0]=S/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=S,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(y=1/(f-v)),e[14]=2*v*f*y):(e[10]=-1,e[14]=-2*f),e},p.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},p.plugin=Is,p.polygonIntersectsPolygon=oi,p.postMapLoadEvent=nt,p.postTurnstileEvent=Dr,p.potpack=Bt,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=kn,p.registerForPluginStateChange=function(e){return e({pluginStatus:Ms,pluginURL:xu}),yc.on("pluginStateChange",e),e},p.renderColorRamp=qc,p.rotate=function(e,t,r){var f=t[0],v=t[1],y=t[2],S=t[3],M=Math.sin(r),z=Math.cos(r);return e[0]=f*z+y*M,e[1]=v*z+S*M,e[2]=f*-M+y*z,e[3]=v*-M+S*z,e},p.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),y=t[4],S=t[5],M=t[6],z=t[7],Y=t[8],J=t[9],ae=t[10],he=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=y*v+Y*f,e[5]=S*v+J*f,e[6]=M*v+ae*f,e[7]=z*v+he*f,e[8]=Y*v-y*f,e[9]=J*v-S*f,e[10]=ae*v-M*f,e[11]=he*v-z*f,e},p.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),y=t[0],S=t[1],M=t[2],z=t[3],Y=t[4],J=t[5],ae=t[6],he=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=y*v+Y*f,e[1]=S*v+J*f,e[2]=M*v+ae*f,e[3]=z*v+he*f,e[4]=Y*v-y*f,e[5]=J*v-S*f,e[6]=ae*v-M*f,e[7]=he*v-z*f,e},p.scale=function(e,t,r){var f=r[0],v=r[1],y=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*y,e[9]=t[9]*y,e[10]=t[10]*y,e[11]=t[11]*y,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},p.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},p.setCacheLimits=function(e,t){xt=e,ht=t},p.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Ms==="deferred"||Ms==="loading"||Ms==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");xu=Vi.resolveURL(e),Ms="deferred",_u=t,Ml(),r||Qs()},p.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},p.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},p.styleSpec=ue,p.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p.symbolSize=po,p.transformMat3=function(e,t,r){var f=t[0],v=t[1],y=t[2];return e[0]=f*r[0]+v*r[3]+y*r[6],e[1]=f*r[1]+v*r[4]+y*r[7],e[2]=f*r[2]+v*r[5]+y*r[8],e},p.transformMat4=zu,p.translate=function(e,t,r){var f,v,y,S,M,z,Y,J,ae,he,ye,He,Xe=r[0],gt=r[1],rt=r[2];return t===e?(e[12]=t[0]*Xe+t[4]*gt+t[8]*rt+t[12],e[13]=t[1]*Xe+t[5]*gt+t[9]*rt+t[13],e[14]=t[2]*Xe+t[6]*gt+t[10]*rt+t[14],e[15]=t[3]*Xe+t[7]*gt+t[11]*rt+t[15]):(v=t[1],y=t[2],S=t[3],M=t[4],z=t[5],Y=t[6],J=t[7],ae=t[8],he=t[9],ye=t[10],He=t[11],e[0]=f=t[0],e[1]=v,e[2]=y,e[3]=S,e[4]=M,e[5]=z,e[6]=Y,e[7]=J,e[8]=ae,e[9]=he,e[10]=ye,e[11]=He,e[12]=f*Xe+M*gt+ae*rt+t[12],e[13]=v*Xe+z*gt+he*rt+t[13],e[14]=y*Xe+Y*gt+ye*rt+t[14],e[15]=S*Xe+J*gt+He*rt+t[15]),e},p.triggerPluginCompletionEvent=Fc,p.uniqueId=St,p.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=$c,p.validateStyle=$l,p.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},p.vectorTile=zc,p.version="1.13.1",p.warnOnce=Ve,p.webpSupported=pe,p.window=L,p.wrap=Rt}),b(["./shared"],function(p){"use strict";function E($){var ce=typeof $;if(ce==="number"||ce==="boolean"||ce==="string"||$==null)return JSON.stringify($);if(Array.isArray($)){for(var ve="[",j=0,se=$;j<se.length;j+=1)ve+=E(se[j])+",";return ve+"]"}for(var de=Object.keys($).sort(),Me="{",ue=0;ue<de.length;ue++)Me+=JSON.stringify(de[ue])+":"+E($[de[ue]])+",";return Me+"}"}function Z($){for(var ce="",ve=0,j=p.refProperties;ve<j.length;ve+=1)ce+="/"+E($[j[ve]]);return ce}var V=function($){this.keyCache={},$&&this.replace($)};V.prototype.replace=function($){this._layerConfigs={},this._layers={},this.update($,[])},V.prototype.update=function($,ce){for(var ve=this,j=0,se=$;j<se.length;j+=1){var de=se[j];this._layerConfigs[de.id]=de;var Me=this._layers[de.id]=p.createStyleLayer(de);Me._featureFilter=p.featureFilter(Me.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(var ue=0,Te=ce;ue<Te.length;ue+=1){var mt=Te[ue];delete this.keyCache[mt],delete this._layerConfigs[mt],delete this._layers[mt]}this.familiesBySource={};for(var br=0,Yt=function(on,cn){for(var wi={},xn=0;xn<on.length;xn++){var Li=cn&&cn[on[xn].id]||Z(on[xn]);cn&&(cn[on[xn].id]=Li);var $i=wi[Li];$i||($i=wi[Li]=[]),$i.push(on[xn])}var ai=[];for(var Ji in wi)ai.push(wi[Ji]);return ai}(p.values(this._layerConfigs),this.keyCache);br<Yt.length;br+=1){var nr=Yt[br].map(function(on){return ve._layers[on.id]}),kr=nr[0];if(kr.visibility!=="none"){var Mn=kr.source||"",Pn=this.familiesBySource[Mn];Pn||(Pn=this.familiesBySource[Mn]={});var tr=kr.sourceLayer||"_geojsonTileLayer",Sn=Pn[tr];Sn||(Sn=Pn[tr]=[]),Sn.push(nr)}}};var H=function($){var ce={},ve=[];for(var j in $){var se=$[j],de=ce[j]={};for(var Me in se){var ue=se[+Me];if(ue&&ue.bitmap.width!==0&&ue.bitmap.height!==0){var Te={x:0,y:0,w:ue.bitmap.width+2,h:ue.bitmap.height+2};ve.push(Te),de[Me]={rect:Te,metrics:ue.metrics}}}}var mt=p.potpack(ve),br=new p.AlphaImage({width:mt.w||1,height:mt.h||1});for(var Yt in $){var nr=$[Yt];for(var kr in nr){var Mn=nr[+kr];if(Mn&&Mn.bitmap.width!==0&&Mn.bitmap.height!==0){var Pn=ce[Yt][kr].rect;p.AlphaImage.copy(Mn.bitmap,br,{x:0,y:0},{x:Pn.x+1,y:Pn.y+1},Mn.bitmap)}}}this.image=br,this.positions=ce};p.register("GlyphAtlas",H);var I=function($){this.tileID=new p.OverscaledTileID($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.uid=$.uid,this.zoom=$.zoom,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.returnDependencies=!!$.returnDependencies,this.promoteId=$.promoteId};function L($,ce,ve){for(var j=new p.EvaluationParameters(ce),se=0,de=$;se<de.length;se+=1)de[se].recalculate(j,ve)}function _e($,ce){var ve=p.getArrayBuffer($.request,function(j,se,de,Me){j?ce(j):se&&ce(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(se)),rawData:se,cacheControl:de,expires:Me})});return function(){ve.cancel(),ce()}}I.prototype.parse=function($,ce,ve,j,se){var de=this;this.status="parsing",this.data=$,this.collisionBoxArray=new p.CollisionBoxArray;var Me=new p.DictionaryCoder(Object.keys($.layers).sort()),ue=new p.FeatureIndex(this.tileID,this.promoteId);ue.bucketLayerIDs=[];var Te,mt,br,Yt,nr={},kr={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ve},Mn=ce.familiesBySource[this.source];for(var Pn in Mn){var tr=$.layers[Pn];if(tr){tr.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+Pn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Sn=Me.encode(Pn),on=[],cn=0;cn<tr.length;cn++){var wi=tr.feature(cn),xn=ue.getId(wi,Pn);on.push({feature:wi,id:xn,index:cn,sourceLayerIndex:Sn})}for(var Li=0,$i=Mn[Pn];Li<$i.length;Li+=1){var ai=$i[Li],Ji=ai[0];Ji.minzoom&&this.zoom<Math.floor(Ji.minzoom)||Ji.maxzoom&&this.zoom>=Ji.maxzoom||Ji.visibility!=="none"&&(L(ai,this.zoom,ve),(nr[Ji.id]=Ji.createBucket({index:ue.bucketLayerIDs.length,layers:ai,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Sn,sourceID:this.source})).populate(on,kr,this.tileID.canonical),ue.bucketLayerIDs.push(ai.map(function(ii){return ii.id})))}}}var Ni=p.mapObject(kr.glyphDependencies,function(ii){return Object.keys(ii).map(Number)});Object.keys(Ni).length?j.send("getGlyphs",{uid:this.uid,stacks:Ni},function(ii,ti){Te||(Te=ii,mt=ti,Ca.call(de))}):mt={};var Ai=Object.keys(kr.iconDependencies);Ai.length?j.send("getImages",{icons:Ai,source:this.source,tileID:this.tileID,type:"icons"},function(ii,ti){Te||(Te=ii,br=ti,Ca.call(de))}):br={};var ha=Object.keys(kr.patternDependencies);function Ca(){if(Te)return se(Te);if(mt&&br&&Yt){var ii=new H(mt),ti=new p.ImageAtlas(br,Yt);for(var Xi in nr){var va=nr[Xi];va instanceof p.SymbolBucket?(L(va.layers,this.zoom,ve),p.performSymbolLayout(va,mt,ii.positions,br,ti.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):va.hasPattern&&(va instanceof p.LineBucket||va instanceof p.FillBucket||va instanceof p.FillExtrusionBucket)&&(L(va.layers,this.zoom,ve),va.addFeatures(kr,this.tileID.canonical,ti.patternPositions))}this.status="done",se(null,{buckets:p.values(nr).filter(function(Vo){return!Vo.isEmpty()}),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ii.image,imageAtlas:ti,glyphMap:this.returnDependencies?mt:null,iconMap:this.returnDependencies?br:null,glyphPositions:this.returnDependencies?ii.positions:null})}}ha.length?j.send("getImages",{icons:ha,source:this.source,tileID:this.tileID,type:"patterns"},function(ii,ti){Te||(Te=ii,Yt=ti,Ca.call(de))}):Yt={},Ca.call(this)};var xe=function($,ce,ve,j){this.actor=$,this.layerIndex=ce,this.availableImages=ve,this.loadVectorData=j||_e,this.loading={},this.loaded={}};xe.prototype.loadTile=function($,ce){var ve=this,j=$.uid;this.loading||(this.loading={});var se=!!($&&$.request&&$.request.collectResourceTiming)&&new p.RequestPerformance($.request),de=this.loading[j]=new I($);de.abort=this.loadVectorData($,function(Me,ue){if(delete ve.loading[j],Me||!ue)return de.status="done",ve.loaded[j]=de,ce(Me);var Te=ue.rawData,mt={};ue.expires&&(mt.expires=ue.expires),ue.cacheControl&&(mt.cacheControl=ue.cacheControl);var br={};if(se){var Yt=se.finish();Yt&&(br.resourceTiming=JSON.parse(JSON.stringify(Yt)))}de.vectorTile=ue.vectorTile,de.parse(ue.vectorTile,ve.layerIndex,ve.availableImages,ve.actor,function(nr,kr){if(nr||!kr)return ce(nr);ce(null,p.extend({rawTileData:Te.slice(0)},kr,mt,br))}),ve.loaded=ve.loaded||{},ve.loaded[j]=de})},xe.prototype.reloadTile=function($,ce){var ve=this,j=this.loaded,se=$.uid,de=this;if(j&&j[se]){var Me=j[se];Me.showCollisionBoxes=$.showCollisionBoxes;var ue=function(Te,mt){var br=Me.reloadCallback;br&&(delete Me.reloadCallback,Me.parse(Me.vectorTile,de.layerIndex,ve.availableImages,de.actor,br)),ce(Te,mt)};Me.status==="parsing"?Me.reloadCallback=ue:Me.status==="done"&&(Me.vectorTile?Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.actor,ue):ue())}},xe.prototype.abortTile=function($,ce){var ve=this.loading,j=$.uid;ve&&ve[j]&&ve[j].abort&&(ve[j].abort(),delete ve[j]),ce()},xe.prototype.removeTile=function($,ce){var ve=this.loaded,j=$.uid;ve&&ve[j]&&delete ve[j],ce()};var Re=p.window.ImageBitmap,$e=function(){this.loaded={}};function Rt($,ce){if($.length!==0){Lt($[0],ce);for(var ve=1;ve<$.length;ve++)Lt($[ve],!ce)}}function Lt($,ce){for(var ve=0,j=0,se=$.length,de=se-1;j<se;de=j++)ve+=($[j][0]-$[de][0])*($[de][1]+$[j][1]);ve>=0!=!!ce&&$.reverse()}$e.prototype.loadTile=function($,ce){var ve=$.uid,j=$.encoding,se=$.rawImageData,de=Re&&se instanceof Re?this.getImageData(se):se,Me=new p.DEMData(ve,de,j);this.loaded=this.loaded||{},this.loaded[ve]=Me,ce(null,Me)},$e.prototype.getImageData=function($){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);var ce=this.offscreenCanvasContext.getImageData(-1,-1,$.width+2,$.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:ce.width,height:ce.height},ce.data)},$e.prototype.removeTile=function($){var ce=this.loaded,ve=$.uid;ce&&ce[ve]&&delete ce[ve]};var zt=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,St=function($){this._feature=$,this.extent=p.EXTENT,this.type=$.type,this.properties=$.tags,"id"in $&&!isNaN($.id)&&(this.id=parseInt($.id,10))};St.prototype.loadGeometry=function(){if(this._feature.type===1){for(var $=[],ce=0,ve=this._feature.geometry;ce<ve.length;ce+=1){var j=ve[ce];$.push([new p.Point$1(j[0],j[1])])}return $}for(var se=[],de=0,Me=this._feature.geometry;de<Me.length;de+=1){for(var ue=[],Te=0,mt=Me[de];Te<mt.length;Te+=1){var br=mt[Te];ue.push(new p.Point$1(br[0],br[1]))}se.push(ue)}return se},St.prototype.toGeoJSON=function($,ce,ve){return zt.call(this,$,ce,ve)};var Et=function($){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=$.length,this._features=$};Et.prototype.feature=function($){return new St(this._features[$])};var at=p.vectorTile.VectorTileFeature,ur=ee;function ee($,ce){this.options=ce||{},this.features=$,this.length=$.length}function fr($,ce){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=ce||4096}ee.prototype.feature=function($){return new fr(this.features[$],this.options.extent)},fr.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var ce=0;ce<$.length;ce++){for(var ve=$[ce],j=[],se=0;se<ve.length;se++)j.push(new p.Point$1(ve[se][0],ve[se][1]));this.geometry.push(j)}return this.geometry},fr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,ce=1/0,ve=-1/0,j=1/0,se=-1/0,de=0;de<$.length;de++)for(var Me=$[de],ue=0;ue<Me.length;ue++){var Te=Me[ue];ce=Math.min(ce,Te.x),ve=Math.max(ve,Te.x),j=Math.min(j,Te.y),se=Math.max(se,Te.y)}return[ce,j,ve,se]},fr.prototype.toGeoJSON=at.prototype.toGeoJSON;var At=Pt,Je=ur;function Pt($){var ce=new p.pbf;return function(ve,j){for(var se in ve.layers)j.writeMessage(3,Ve,ve.layers[se])}($,ce),ce.finish()}function Ve($,ce){var ve;ce.writeVarintField(15,$.version||1),ce.writeStringField(1,$.name||""),ce.writeVarintField(5,$.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(ve=0;ve<$.length;ve++)j.feature=$.feature(ve),ce.writeMessage(2,It,j);var se=j.keys;for(ve=0;ve<se.length;ve++)ce.writeStringField(3,se[ve]);var de=j.values;for(ve=0;ve<de.length;ve++)ce.writeMessage(4,Fe,de[ve])}function It($,ce){var ve=$.feature;ve.id!==void 0&&ce.writeVarintField(1,ve.id),ce.writeMessage(2,hr,$),ce.writeVarintField(3,ve.type),ce.writeMessage(4,fe,ve)}function hr($,ce){var ve=$.feature,j=$.keys,se=$.values,de=$.keycache,Me=$.valuecache;for(var ue in ve.properties){var Te=de[ue];Te===void 0&&(j.push(ue),de[ue]=Te=j.length-1),ce.writeVarint(Te);var mt=ve.properties[ue],br=typeof mt;br!=="string"&&br!=="boolean"&&br!=="number"&&(mt=JSON.stringify(mt));var Yt=br+":"+mt,nr=Me[Yt];nr===void 0&&(se.push(mt),Me[Yt]=nr=se.length-1),ce.writeVarint(nr)}}function Jt($,ce){return(ce<<3)+(7&$)}function Fr($){return $<<1^$>>31}function fe($,ce){for(var ve=$.loadGeometry(),j=$.type,se=0,de=0,Me=ve.length,ue=0;ue<Me;ue++){var Te=ve[ue],mt=1;j===1&&(mt=Te.length),ce.writeVarint(Jt(1,mt));for(var br=j===3?Te.length-1:Te.length,Yt=0;Yt<br;Yt++){Yt===1&&j!==1&&ce.writeVarint(Jt(2,br-1));var nr=Te[Yt].x-se,kr=Te[Yt].y-de;ce.writeVarint(Fr(nr)),ce.writeVarint(Fr(kr)),se+=nr,de+=kr}j===3&&ce.writeVarint(Jt(7,1))}}function Fe($,ce){var ve=typeof $;ve==="string"?ce.writeStringField(1,$):ve==="boolean"?ce.writeBooleanField(7,$):ve==="number"&&($%1!=0?ce.writeDoubleField(3,$):$<0?ce.writeSVarintField(6,$):ce.writeVarintField(5,$))}function me($,ce,ve,j){bt($,ve,j),bt(ce,2*ve,2*j),bt(ce,2*ve+1,2*j+1)}function bt($,ce,ve){var j=$[ce];$[ce]=$[ve],$[ve]=j}function vt($,ce,ve,j){var se=$-ve,de=ce-j;return se*se+de*de}At.fromVectorTileJs=Pt,At.fromGeojsonVt=function($,ce){ce=ce||{};var ve={};for(var j in $)ve[j]=new ur($[j].features,ce),ve[j].name=j,ve[j].version=ce.version,ve[j].extent=ce.extent;return Pt({layers:ve})},At.GeoJSONWrapper=Je;var Zt=function($){return $[0]},Ut=function($){return $[1]},Rr=function($,ce,ve,j,se){ce===void 0&&(ce=Zt),ve===void 0&&(ve=Ut),j===void 0&&(j=64),se===void 0&&(se=Float64Array),this.nodeSize=j,this.points=$;for(var de=$.length<65536?Uint16Array:Uint32Array,Me=this.ids=new de($.length),ue=this.coords=new se(2*$.length),Te=0;Te<$.length;Te++)Me[Te]=Te,ue[2*Te]=ce($[Te]),ue[2*Te+1]=ve($[Te]);(function mt(br,Yt,nr,kr,Mn,Pn){if(!(Mn-kr<=nr)){var tr=kr+Mn>>1;(function Sn(on,cn,wi,xn,Li,$i){for(;Li>xn;){if(Li-xn>600){var ai=Li-xn+1,Ji=wi-xn+1,Ni=Math.log(ai),Ai=.5*Math.exp(2*Ni/3),ha=.5*Math.sqrt(Ni*Ai*(ai-Ai)/ai)*(Ji-ai/2<0?-1:1);Sn(on,cn,wi,Math.max(xn,Math.floor(wi-Ji*Ai/ai+ha)),Math.min(Li,Math.floor(wi+(ai-Ji)*Ai/ai+ha)),$i)}var Ca=cn[2*wi+$i],ii=xn,ti=Li;for(me(on,cn,xn,wi),cn[2*Li+$i]>Ca&&me(on,cn,xn,Li);ii<ti;){for(me(on,cn,ii,ti),ii++,ti--;cn[2*ii+$i]<Ca;)ii++;for(;cn[2*ti+$i]>Ca;)ti--}cn[2*xn+$i]===Ca?me(on,cn,xn,ti):me(on,cn,++ti,Li),ti<=wi&&(xn=ti+1),wi<=ti&&(Li=ti-1)}})(br,Yt,tr,kr,Mn,Pn%2),mt(br,Yt,nr,kr,tr-1,Pn+1),mt(br,Yt,nr,tr+1,Mn,Pn+1)}})(Me,ue,j,0,Me.length-1,0)};Rr.prototype.range=function($,ce,ve,j){return function(se,de,Me,ue,Te,mt,br){for(var Yt,nr,kr=[0,se.length-1,0],Mn=[];kr.length;){var Pn=kr.pop(),tr=kr.pop(),Sn=kr.pop();if(tr-Sn<=br)for(var on=Sn;on<=tr;on++)nr=de[2*on+1],(Yt=de[2*on])>=Me&&Yt<=Te&&nr>=ue&&nr<=mt&&Mn.push(se[on]);else{var cn=Math.floor((Sn+tr)/2);nr=de[2*cn+1],(Yt=de[2*cn])>=Me&&Yt<=Te&&nr>=ue&&nr<=mt&&Mn.push(se[cn]);var wi=(Pn+1)%2;(Pn===0?Me<=Yt:ue<=nr)&&(kr.push(Sn),kr.push(cn-1),kr.push(wi)),(Pn===0?Te>=Yt:mt>=nr)&&(kr.push(cn+1),kr.push(tr),kr.push(wi))}}return Mn}(this.ids,this.coords,$,ce,ve,j,this.nodeSize)},Rr.prototype.within=function($,ce,ve){return function(j,se,de,Me,ue,Te){for(var mt=[0,j.length-1,0],br=[],Yt=ue*ue;mt.length;){var nr=mt.pop(),kr=mt.pop(),Mn=mt.pop();if(kr-Mn<=Te)for(var Pn=Mn;Pn<=kr;Pn++)vt(se[2*Pn],se[2*Pn+1],de,Me)<=Yt&&br.push(j[Pn]);else{var tr=Math.floor((Mn+kr)/2),Sn=se[2*tr],on=se[2*tr+1];vt(Sn,on,de,Me)<=Yt&&br.push(j[tr]);var cn=(nr+1)%2;(nr===0?de-ue<=Sn:Me-ue<=on)&&(mt.push(Mn),mt.push(tr-1),mt.push(cn)),(nr===0?de+ue>=Sn:Me+ue>=on)&&(mt.push(tr+1),mt.push(kr),mt.push(cn))}}return br}(this.ids,this.coords,$,ce,ve,this.nodeSize)};var ln={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function($){return $}},pn=function($){this.options=Ft(Object.create(ln),$),this.trees=new Array(this.options.maxZoom+1)};function Vi($,ce,ve,j,se){return{x:$,y:ce,zoom:1/0,id:ve,parentId:-1,numPoints:j,properties:se}}function ar($,ce){var ve=$.geometry.coordinates,j=ve[1];return{x:Ge(ve[0]),y:ke(j),zoom:1/0,index:ce,parentId:-1}}function pe($){return{type:"Feature",id:$.id,properties:Pe($),geometry:{type:"Point",coordinates:[(j=$.x,360*(j-.5)),(ce=$.y,ve=(180-360*ce)*Math.PI/180,360*Math.atan(Math.exp(ve))/Math.PI-90)]}};var ce,ve,j}function Pe($){var ce=$.numPoints,ve=ce>=1e4?Math.round(ce/1e3)+"k":ce>=1e3?Math.round(ce/100)/10+"k":ce;return Ft(Ft({},$.properties),{cluster:!0,cluster_id:$.id,point_count:ce,point_count_abbreviated:ve})}function Ge($){return $/360+.5}function ke($){var ce=Math.sin($*Math.PI/180),ve=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return ve<0?0:ve>1?1:ve}function Ft($,ce){for(var ve in ce)$[ve]=ce[ve];return $}function ir($){return $.x}function T($){return $.y}function G($,ce,ve,j,se,de){var Me=se-ve,ue=de-j;if(Me!==0||ue!==0){var Te=(($-ve)*Me+(ce-j)*ue)/(Me*Me+ue*ue);Te>1?(ve=se,j=de):Te>0&&(ve+=Me*Te,j+=ue*Te)}return(Me=$-ve)*Me+(ue=ce-j)*ue}function Se($,ce,ve,j){var se={id:$===void 0?null:$,type:ce,geometry:ve,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var Me=de.geometry,ue=de.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Be(de,Me);else if(ue==="Polygon"||ue==="MultiLineString")for(var Te=0;Te<Me.length;Te++)Be(de,Me[Te]);else if(ue==="MultiPolygon")for(Te=0;Te<Me.length;Te++)for(var mt=0;mt<Me[Te].length;mt++)Be(de,Me[Te][mt])}(se),se}function Be($,ce){for(var ve=0;ve<ce.length;ve+=3)$.minX=Math.min($.minX,ce[ve]),$.minY=Math.min($.minY,ce[ve+1]),$.maxX=Math.max($.maxX,ce[ve]),$.maxY=Math.max($.maxY,ce[ve+1])}function et($,ce,ve,j){if(ce.geometry){var se=ce.geometry.coordinates,de=ce.geometry.type,Me=Math.pow(ve.tolerance/((1<<ve.maxZoom)*ve.extent),2),ue=[],Te=ce.id;if(ve.promoteId?Te=ce.properties[ve.promoteId]:ve.generateId&&(Te=j||0),de==="Point")tt(se,ue);else if(de==="MultiPoint")for(var mt=0;mt<se.length;mt++)tt(se[mt],ue);else if(de==="LineString")Ct(se,ue,Me,!1);else if(de==="MultiLineString"){if(ve.lineMetrics){for(mt=0;mt<se.length;mt++)Ct(se[mt],ue=[],Me,!1),$.push(Se(Te,"LineString",ue,ce.properties));return}jt(se,ue,Me,!1)}else if(de==="Polygon")jt(se,ue,Me,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(mt=0;mt<ce.geometry.geometries.length;mt++)et($,{id:Te,geometry:ce.geometry.geometries[mt],properties:ce.properties},ve,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(mt=0;mt<se.length;mt++){var br=[];jt(se[mt],br,Me,!0),ue.push(br)}}$.push(Se(Te,de,ue,ce.properties))}}function tt($,ce){ce.push(Mt($[0])),ce.push(Qt($[1])),ce.push(0)}function Ct($,ce,ve,j){for(var se,de,Me=0,ue=0;ue<$.length;ue++){var Te=Mt($[ue][0]),mt=Qt($[ue][1]);ce.push(Te),ce.push(mt),ce.push(0),ue>0&&(Me+=j?(se*mt-Te*de)/2:Math.sqrt(Math.pow(Te-se,2)+Math.pow(mt-de,2))),se=Te,de=mt}var br=ce.length-3;ce[2]=1,function Yt(nr,kr,Mn,Pn){for(var tr,Sn=Pn,on=Mn-kr>>1,cn=Mn-kr,wi=nr[kr],xn=nr[kr+1],Li=nr[Mn],$i=nr[Mn+1],ai=kr+3;ai<Mn;ai+=3){var Ji=G(nr[ai],nr[ai+1],wi,xn,Li,$i);if(Ji>Sn)tr=ai,Sn=Ji;else if(Ji===Sn){var Ni=Math.abs(ai-on);Ni<cn&&(tr=ai,cn=Ni)}}Sn>Pn&&(tr-kr>3&&Yt(nr,kr,tr,Pn),nr[tr+2]=Sn,Mn-tr>3&&Yt(nr,tr,Mn,Pn))}(ce,0,br,ve),ce[br+2]=1,ce.size=Math.abs(Me),ce.start=0,ce.end=ce.size}function jt($,ce,ve,j){for(var se=0;se<$.length;se++){var de=[];Ct($[se],de,ve,j),ce.push(de)}}function Mt($){return $/360+.5}function Qt($){var ce=Math.sin($*Math.PI/180),ve=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return ve<0?0:ve>1?1:ve}function ne($,ce,ve,j,se,de,Me,ue){if(j/=ce,de>=(ve/=ce)&&Me<j)return $;if(Me<ve||de>=j)return null;for(var Te=[],mt=0;mt<$.length;mt++){var br=$[mt],Yt=br.geometry,nr=br.type,kr=se===0?br.minX:br.minY,Mn=se===0?br.maxX:br.maxY;if(kr>=ve&&Mn<j)Te.push(br);else if(!(Mn<ve||kr>=j)){var Pn=[];if(nr==="Point"||nr==="MultiPoint")Kt(Yt,Pn,ve,j,se);else if(nr==="LineString")Dr(Yt,Pn,ve,j,se,!1,ue.lineMetrics);else if(nr==="MultiLineString")nt(Yt,Pn,ve,j,se,!1);else if(nr==="Polygon")nt(Yt,Pn,ve,j,se,!0);else if(nr==="MultiPolygon")for(var tr=0;tr<Yt.length;tr++){var Sn=[];nt(Yt[tr],Sn,ve,j,se,!0),Sn.length&&Pn.push(Sn)}if(Pn.length){if(ue.lineMetrics&&nr==="LineString"){for(tr=0;tr<Pn.length;tr++)Te.push(Se(br.id,nr,Pn[tr],br.tags));continue}nr!=="LineString"&&nr!=="MultiLineString"||(Pn.length===1?(nr="LineString",Pn=Pn[0]):nr="MultiLineString"),nr!=="Point"&&nr!=="MultiPoint"||(nr=Pn.length===3?"Point":"MultiPoint"),Te.push(Se(br.id,nr,Pn,br.tags))}}}return Te.length?Te:null}function Kt($,ce,ve,j,se){for(var de=0;de<$.length;de+=3){var Me=$[de+se];Me>=ve&&Me<=j&&(ce.push($[de]),ce.push($[de+1]),ce.push($[de+2]))}}function Dr($,ce,ve,j,se,de,Me){for(var ue,Te,mt=Mr($),br=se===0?ht:vr,Yt=$.start,nr=0;nr<$.length-3;nr+=3){var kr=$[nr],Mn=$[nr+1],Pn=$[nr+2],tr=$[nr+3],Sn=$[nr+4],on=se===0?kr:Mn,cn=se===0?tr:Sn,wi=!1;Me&&(ue=Math.sqrt(Math.pow(kr-tr,2)+Math.pow(Mn-Sn,2))),on<ve?cn>ve&&(Te=br(mt,kr,Mn,tr,Sn,ve),Me&&(mt.start=Yt+ue*Te)):on>j?cn<j&&(Te=br(mt,kr,Mn,tr,Sn,j),Me&&(mt.start=Yt+ue*Te)):xt(mt,kr,Mn,Pn),cn<ve&&on>=ve&&(Te=br(mt,kr,Mn,tr,Sn,ve),wi=!0),cn>j&&on<=j&&(Te=br(mt,kr,Mn,tr,Sn,j),wi=!0),!de&&wi&&(Me&&(mt.end=Yt+ue*Te),ce.push(mt),mt=Mr($)),Me&&(Yt+=ue)}var xn=$.length-3;kr=$[xn],Mn=$[xn+1],Pn=$[xn+2],(on=se===0?kr:Mn)>=ve&&on<=j&&xt(mt,kr,Mn,Pn),xn=mt.length-3,de&&xn>=3&&(mt[xn]!==mt[0]||mt[xn+1]!==mt[1])&&xt(mt,mt[0],mt[1],mt[2]),mt.length&&ce.push(mt)}function Mr($){var ce=[];return ce.size=$.size,ce.start=$.start,ce.end=$.end,ce}function nt($,ce,ve,j,se,de){for(var Me=0;Me<$.length;Me++)Dr($[Me],ce,ve,j,se,de,!1)}function xt($,ce,ve,j){$.push(ce),$.push(ve),$.push(j)}function ht($,ce,ve,j,se,de){var Me=(de-ce)/(j-ce);return $.push(de),$.push(ve+(se-ve)*Me),$.push(1),Me}function vr($,ce,ve,j,se,de){var Me=(de-ve)/(se-ve);return $.push(ce+(j-ce)*Me),$.push(de),$.push(1),Me}function Zr($,ce){for(var ve=[],j=0;j<$.length;j++){var se,de=$[j],Me=de.type;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")se=Ur(de.geometry,ce);else if(Me==="MultiLineString"||Me==="Polygon"){se=[];for(var ue=0;ue<de.geometry.length;ue++)se.push(Ur(de.geometry[ue],ce))}else if(Me==="MultiPolygon")for(se=[],ue=0;ue<de.geometry.length;ue++){for(var Te=[],mt=0;mt<de.geometry[ue].length;mt++)Te.push(Ur(de.geometry[ue][mt],ce));se.push(Te)}ve.push(Se(de.id,Me,se,de.tags))}return ve}function Ur($,ce){var ve=[];ve.size=$.size,$.start!==void 0&&(ve.start=$.start,ve.end=$.end);for(var j=0;j<$.length;j+=3)ve.push($[j]+ce,$[j+1],$[j+2]);return ve}function tn($,ce){if($.transformed)return $;var ve,j,se,de=1<<$.z,Me=$.x,ue=$.y;for(ve=0;ve<$.features.length;ve++){var Te=$.features[ve],mt=Te.geometry,br=Te.type;if(Te.geometry=[],br===1)for(j=0;j<mt.length;j+=2)Te.geometry.push(jr(mt[j],mt[j+1],ce,de,Me,ue));else for(j=0;j<mt.length;j++){var Yt=[];for(se=0;se<mt[j].length;se+=2)Yt.push(jr(mt[j][se],mt[j][se+1],ce,de,Me,ue));Te.geometry.push(Yt)}}return $.transformed=!0,$}function jr($,ce,ve,j,se,de){return[Math.round(ve*($*j-se)),Math.round(ve*(ce*j-de))]}function wr($,ce,ve,j,se){for(var de=ce===se.maxZoom?0:se.tolerance/((1<<ce)*se.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ve,y:j,z:ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<$.length;ue++){Me.numFeatures++,Dn(Me,$[ue],de,se);var Te=$[ue].minX,mt=$[ue].minY,br=$[ue].maxX,Yt=$[ue].maxY;Te<Me.minX&&(Me.minX=Te),mt<Me.minY&&(Me.minY=mt),br>Me.maxX&&(Me.maxX=br),Yt>Me.maxY&&(Me.maxY=Yt)}return Me}function Dn($,ce,ve,j){var se=ce.geometry,de=ce.type,Me=[];if(de==="Point"||de==="MultiPoint")for(var ue=0;ue<se.length;ue+=3)Me.push(se[ue]),Me.push(se[ue+1]),$.numPoints++,$.numSimplified++;else if(de==="LineString")Zn(Me,se,$,ve,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(ue=0;ue<se.length;ue++)Zn(Me,se[ue],$,ve,de==="Polygon",ue===0);else if(de==="MultiPolygon")for(var Te=0;Te<se.length;Te++){var mt=se[Te];for(ue=0;ue<mt.length;ue++)Zn(Me,mt[ue],$,ve,!0,ue===0)}if(Me.length){var br=ce.tags||null;if(de==="LineString"&&j.lineMetrics){for(var Yt in br={},ce.tags)br[Yt]=ce.tags[Yt];br.mapbox_clip_start=se.start/se.size,br.mapbox_clip_end=se.end/se.size}var nr={geometry:Me,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:br};ce.id!==null&&(nr.id=ce.id),$.features.push(nr)}}function Zn($,ce,ve,j,se,de){var Me=j*j;if(j>0&&ce.size<(se?Me:j))ve.numPoints+=ce.length/3;else{for(var ue=[],Te=0;Te<ce.length;Te+=3)(j===0||ce[Te+2]>Me)&&(ve.numSimplified++,ue.push(ce[Te]),ue.push(ce[Te+1])),ve.numPoints++;se&&function(mt,br){for(var Yt=0,nr=0,kr=mt.length,Mn=kr-2;nr<kr;Mn=nr,nr+=2)Yt+=(mt[nr]-mt[Mn])*(mt[nr+1]+mt[Mn+1]);if(Yt>0===br)for(nr=0,kr=mt.length;nr<kr/2;nr+=2){var Pn=mt[nr],tr=mt[nr+1];mt[nr]=mt[kr-2-nr],mt[nr+1]=mt[kr-1-nr],mt[kr-2-nr]=Pn,mt[kr-1-nr]=tr}}(ue,de),$.push(ue)}}function bi($,ce){var ve=(ce=this.options=function(se,de){for(var Me in de)se[Me]=de[Me];return se}(Object.create(this.options),ce)).debug;if(ve&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");var j=function(se,de){var Me=[];if(se.type==="FeatureCollection")for(var ue=0;ue<se.features.length;ue++)et(Me,se.features[ue],de,ue);else et(Me,se.type==="Feature"?se:{geometry:se},de);return Me}($,ce);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(j=function(se,de){var Me=de.buffer/de.extent,ue=se,Te=ne(se,1,-1-Me,Me,0,-1,2,de),mt=ne(se,1,1-Me,2+Me,0,-1,2,de);return(Te||mt)&&(ue=ne(se,1,-Me,1+Me,0,-1,2,de)||[],Te&&(ue=Zr(Te,1).concat(ue)),mt&&(ue=ue.concat(Zr(mt,-1)))),ue}(j,ce)).length&&this.splitTile(j,0,0,0),ve&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Hi($,ce,ve){return 32*((1<<$)*ve+ce)+$}function qi($,ce){var ve=$.tileID.canonical;if(!this._geoJSONIndex)return ce(null,null);var j=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!j)return ce(null,null);var se=new Et(j.features),de=At(se);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),ce(null,{vectorTile:se,rawData:de.buffer})}pn.prototype.load=function($){var ce=this.options,ve=ce.log,j=ce.minZoom,se=ce.maxZoom,de=ce.nodeSize;ve&&console.time("total time");var Me="prepare "+$.length+" points";ve&&console.time(Me),this.points=$;for(var ue=[],Te=0;Te<$.length;Te++)$[Te].geometry&&ue.push(ar($[Te],Te));this.trees[se+1]=new Rr(ue,ir,T,de,Float32Array),ve&&console.timeEnd(Me);for(var mt=se;mt>=j;mt--){var br=+Date.now();ue=this._cluster(ue,mt),this.trees[mt]=new Rr(ue,ir,T,de,Float32Array),ve&&console.log("z%d: %d clusters in %dms",mt,ue.length,+Date.now()-br)}return ve&&console.timeEnd("total time"),this},pn.prototype.getClusters=function($,ce){var ve=(($[0]+180)%360+360)%360-180,j=Math.max(-90,Math.min(90,$[1])),se=$[2]===180?180:(($[2]+180)%360+360)%360-180,de=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)ve=-180,se=180;else if(ve>se){var Me=this.getClusters([ve,j,180,de],ce),ue=this.getClusters([-180,j,se,de],ce);return Me.concat(ue)}for(var Te=this.trees[this._limitZoom(ce)],mt=[],br=0,Yt=Te.range(Ge(ve),ke(de),Ge(se),ke(j));br<Yt.length;br+=1){var nr=Te.points[Yt[br]];mt.push(nr.numPoints?pe(nr):this.points[nr.index])}return mt},pn.prototype.getChildren=function($){var ce=this._getOriginId($),ve=this._getOriginZoom($),j="No cluster with the specified id.",se=this.trees[ve];if(!se)throw new Error(j);var de=se.points[ce];if(!de)throw new Error(j);for(var Me=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),ue=[],Te=0,mt=se.within(de.x,de.y,Me);Te<mt.length;Te+=1){var br=se.points[mt[Te]];br.parentId===$&&ue.push(br.numPoints?pe(br):this.points[br.index])}if(ue.length===0)throw new Error(j);return ue},pn.prototype.getLeaves=function($,ce,ve){var j=[];return this._appendLeaves(j,$,ce=ce||10,ve=ve||0,0),j},pn.prototype.getTile=function($,ce,ve){var j=this.trees[this._limitZoom($)],se=Math.pow(2,$),de=this.options,Me=de.radius/de.extent,ue=(ve-Me)/se,Te=(ve+1+Me)/se,mt={features:[]};return this._addTileFeatures(j.range((ce-Me)/se,ue,(ce+1+Me)/se,Te),j.points,ce,ve,se,mt),ce===0&&this._addTileFeatures(j.range(1-Me/se,ue,1,Te),j.points,se,ve,se,mt),ce===se-1&&this._addTileFeatures(j.range(0,ue,Me/se,Te),j.points,-1,ve,se,mt),mt.features.length?mt:null},pn.prototype.getClusterExpansionZoom=function($){for(var ce=this._getOriginZoom($)-1;ce<=this.options.maxZoom;){var ve=this.getChildren($);if(ce++,ve.length!==1)break;$=ve[0].properties.cluster_id}return ce},pn.prototype._appendLeaves=function($,ce,ve,j,se){for(var de=0,Me=this.getChildren(ce);de<Me.length;de+=1){var ue=Me[de],Te=ue.properties;if(Te&&Te.cluster?se+Te.point_count<=j?se+=Te.point_count:se=this._appendLeaves($,Te.cluster_id,ve,j,se):se<j?se++:$.push(ue),$.length===ve)break}return se},pn.prototype._addTileFeatures=function($,ce,ve,j,se,de){for(var Me=0,ue=$;Me<ue.length;Me+=1){var Te=ce[ue[Me]],mt=Te.numPoints,br={type:1,geometry:[[Math.round(this.options.extent*(Te.x*se-ve)),Math.round(this.options.extent*(Te.y*se-j))]],tags:mt?Pe(Te):this.points[Te.index].properties},Yt=void 0;mt?Yt=Te.id:this.options.generateId?Yt=Te.index:this.points[Te.index].id&&(Yt=this.points[Te.index].id),Yt!==void 0&&(br.id=Yt),de.features.push(br)}},pn.prototype._limitZoom=function($){return Math.max(this.options.minZoom,Math.min(+$,this.options.maxZoom+1))},pn.prototype._cluster=function($,ce){for(var ve=[],j=this.options,se=j.reduce,de=j.minPoints,Me=j.radius/(j.extent*Math.pow(2,ce)),ue=0;ue<$.length;ue++){var Te=$[ue];if(!(Te.zoom<=ce)){Te.zoom=ce;for(var mt=this.trees[ce+1],br=mt.within(Te.x,Te.y,Me),Yt=Te.numPoints||1,nr=Yt,kr=0,Mn=br;kr<Mn.length;kr+=1){var Pn=mt.points[Mn[kr]];Pn.zoom>ce&&(nr+=Pn.numPoints||1)}if(nr>=de){for(var tr=Te.x*Yt,Sn=Te.y*Yt,on=se&&Yt>1?this._map(Te,!0):null,cn=(ue<<5)+(ce+1)+this.points.length,wi=0,xn=br;wi<xn.length;wi+=1){var Li=mt.points[xn[wi]];if(!(Li.zoom<=ce)){Li.zoom=ce;var $i=Li.numPoints||1;tr+=Li.x*$i,Sn+=Li.y*$i,Li.parentId=cn,se&&(on||(on=this._map(Te,!0)),se(on,this._map(Li)))}}Te.parentId=cn,ve.push(Vi(tr/nr,Sn/nr,cn,nr,on))}else if(ve.push(Te),nr>1)for(var ai=0,Ji=br;ai<Ji.length;ai+=1){var Ni=mt.points[Ji[ai]];Ni.zoom<=ce||(Ni.zoom=ce,ve.push(Ni))}}}return ve},pn.prototype._getOriginId=function($){return $-this.points.length>>5},pn.prototype._getOriginZoom=function($){return($-this.points.length)%32},pn.prototype._map=function($,ce){if($.numPoints)return ce?Ft({},$.properties):$.properties;var ve=this.points[$.index].properties,j=this.options.map(ve);return ce&&j===ve?Ft({},j):j},bi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},bi.prototype.splitTile=function($,ce,ve,j,se,de,Me){for(var ue=[$,ce,ve,j],Te=this.options,mt=Te.debug;ue.length;){j=ue.pop(),ve=ue.pop(),ce=ue.pop(),$=ue.pop();var br=1<<ce,Yt=Hi(ce,ve,j),nr=this.tiles[Yt];if(!nr&&(mt>1&&console.time("creation"),nr=this.tiles[Yt]=wr($,ce,ve,j,Te),this.tileCoords.push({z:ce,x:ve,y:j}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,ve,j,nr.numFeatures,nr.numPoints,nr.numSimplified),console.timeEnd("creation"));var kr="z"+ce;this.stats[kr]=(this.stats[kr]||0)+1,this.total++}if(nr.source=$,se){if(ce===Te.maxZoom||ce===se)continue;var Mn=1<<se-ce;if(ve!==Math.floor(de/Mn)||j!==Math.floor(Me/Mn))continue}else if(ce===Te.indexMaxZoom||nr.numPoints<=Te.indexMaxPoints)continue;if(nr.source=null,$.length!==0){mt>1&&console.time("clipping");var Pn,tr,Sn,on,cn,wi,xn=.5*Te.buffer/Te.extent,Li=.5-xn,$i=.5+xn,ai=1+xn;Pn=tr=Sn=on=null,cn=ne($,br,ve-xn,ve+$i,0,nr.minX,nr.maxX,Te),wi=ne($,br,ve+Li,ve+ai,0,nr.minX,nr.maxX,Te),$=null,cn&&(Pn=ne(cn,br,j-xn,j+$i,1,nr.minY,nr.maxY,Te),tr=ne(cn,br,j+Li,j+ai,1,nr.minY,nr.maxY,Te),cn=null),wi&&(Sn=ne(wi,br,j-xn,j+$i,1,nr.minY,nr.maxY,Te),on=ne(wi,br,j+Li,j+ai,1,nr.minY,nr.maxY,Te),wi=null),mt>1&&console.timeEnd("clipping"),ue.push(Pn||[],ce+1,2*ve,2*j),ue.push(tr||[],ce+1,2*ve,2*j+1),ue.push(Sn||[],ce+1,2*ve+1,2*j),ue.push(on||[],ce+1,2*ve+1,2*j+1)}}},bi.prototype.getTile=function($,ce,ve){var j=this.options,se=j.extent,de=j.debug;if($<0||$>24)return null;var Me=1<<$,ue=Hi($,ce=(ce%Me+Me)%Me,ve);if(this.tiles[ue])return tn(this.tiles[ue],se);de>1&&console.log("drilling down to z%d-%d-%d",$,ce,ve);for(var Te,mt=$,br=ce,Yt=ve;!Te&&mt>0;)mt--,br=Math.floor(br/2),Yt=Math.floor(Yt/2),Te=this.tiles[Hi(mt,br,Yt)];return Te&&Te.source?(de>1&&console.log("found parent tile z%d-%d-%d",mt,br,Yt),de>1&&console.time("drilling down"),this.splitTile(Te.source,mt,br,Yt,$,ce,ve),de>1&&console.timeEnd("drilling down"),this.tiles[ue]?tn(this.tiles[ue],se):null):null};var ki=function($){function ce(ve,j,se,de){$.call(this,ve,j,se,qi),de&&(this.loadGeoJSON=de)}return $&&(ce.__proto__=$),(ce.prototype=Object.create($&&$.prototype)).constructor=ce,ce.prototype.loadData=function(ve,j){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=j,this._pendingLoadDataParams=ve,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ce.prototype._loadData=function(){var ve=this;if(this._pendingCallback&&this._pendingLoadDataParams){var j=this._pendingCallback,se=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var de=!!(se&&se.request&&se.request.collectResourceTiming)&&new p.RequestPerformance(se.request);this.loadGeoJSON(se,function(Me,ue){if(Me||!ue)return j(Me);if(typeof ue!="object")return j(new Error("Input data given to '"+se.source+"' is not a valid GeoJSON object."));(function nr(kr,Mn){var Pn,tr=kr&&kr.type;if(tr==="FeatureCollection")for(Pn=0;Pn<kr.features.length;Pn++)nr(kr.features[Pn],Mn);else if(tr==="GeometryCollection")for(Pn=0;Pn<kr.geometries.length;Pn++)nr(kr.geometries[Pn],Mn);else if(tr==="Feature")nr(kr.geometry,Mn);else if(tr==="Polygon")Rt(kr.coordinates,Mn);else if(tr==="MultiPolygon")for(Pn=0;Pn<kr.coordinates.length;Pn++)Rt(kr.coordinates[Pn],Mn);return kr})(ue,!0);try{if(se.filter){var Te=p.createExpression(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Te.result==="error")throw new Error(Te.value.map(function(nr){return nr.key+": "+nr.message}).join(", "));var mt=ue.features.filter(function(nr){return Te.value.evaluate({zoom:0},nr)});ue={type:"FeatureCollection",features:mt}}ve._geoJSONIndex=se.cluster?new pn(function(nr){var kr=nr.superclusterOptions,Mn=nr.clusterProperties;if(!Mn||!kr)return kr;for(var Pn={},tr={},Sn={accumulated:null,zoom:0},on={properties:null},cn=Object.keys(Mn),wi=0,xn=cn;wi<xn.length;wi+=1){var Li=xn[wi],$i=Mn[Li],ai=$i[0],Ji=p.createExpression($i[1]),Ni=p.createExpression(typeof ai=="string"?[ai,["accumulated"],["get",Li]]:ai);Pn[Li]=Ji.value,tr[Li]=Ni.value}return kr.map=function(Ai){on.properties=Ai;for(var ha={},Ca=0,ii=cn;Ca<ii.length;Ca+=1){var ti=ii[Ca];ha[ti]=Pn[ti].evaluate(Sn,on)}return ha},kr.reduce=function(Ai,ha){on.properties=ha;for(var Ca=0,ii=cn;Ca<ii.length;Ca+=1){var ti=ii[Ca];Sn.accumulated=Ai[ti],Ai[ti]=tr[ti].evaluate(Sn,on)}},kr}(se)).load(ue.features):function(nr,kr){return new bi(nr,kr)}(ue,se.geojsonVtOptions)}catch(nr){return j(nr)}ve.loaded={};var br={};if(de){var Yt=de.finish();Yt&&(br.resourceTiming={},br.resourceTiming[se.source]=JSON.parse(JSON.stringify(Yt)))}j(null,br)})}},ce.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ce.prototype.reloadTile=function(ve,j){var se=this.loaded;return se&&se[ve.uid]?$.prototype.reloadTile.call(this,ve,j):this.loadTile(ve,j)},ce.prototype.loadGeoJSON=function(ve,j){if(ve.request)p.getJSON(ve.request,j);else{if(typeof ve.data!="string")return j(new Error("Input data given to '"+ve.source+"' is not a valid GeoJSON object."));try{return j(null,JSON.parse(ve.data))}catch(se){return j(new Error("Input data given to '"+ve.source+"' is not a valid GeoJSON object."))}}},ce.prototype.removeSource=function(ve,j){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),j()},ce.prototype.getClusterExpansionZoom=function(ve,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(ve.clusterId))}catch(se){j(se)}},ce.prototype.getClusterChildren=function(ve,j){try{j(null,this._geoJSONIndex.getChildren(ve.clusterId))}catch(se){j(se)}},ce.prototype.getClusterLeaves=function(ve,j){try{j(null,this._geoJSONIndex.getLeaves(ve.clusterId,ve.limit,ve.offset))}catch(se){j(se)}},ce}(xe),Oi=function($){var ce=this;this.self=$,this.actor=new p.Actor($,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:xe,geojson:ki},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ve,j){if(ce.workerSourceTypes[ve])throw new Error('Worker source with name "'+ve+'" already registered.');ce.workerSourceTypes[ve]=j},this.self.registerRTLTextPlugin=function(ve){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=ve.applyArabicShaping,p.plugin.processBidirectionalText=ve.processBidirectionalText,p.plugin.processStyledBidirectionalText=ve.processStyledBidirectionalText}};return Oi.prototype.setReferrer=function($,ce){this.referrer=ce},Oi.prototype.setImages=function($,ce,ve){for(var j in this.availableImages[$]=ce,this.workerSources[$]){var se=this.workerSources[$][j];for(var de in se)se[de].availableImages=ce}ve()},Oi.prototype.setLayers=function($,ce,ve){this.getLayerIndex($).replace(ce),ve()},Oi.prototype.updateLayers=function($,ce,ve){this.getLayerIndex($).update(ce.layers,ce.removedIds),ve()},Oi.prototype.loadTile=function($,ce,ve){this.getWorkerSource($,ce.type,ce.source).loadTile(ce,ve)},Oi.prototype.loadDEMTile=function($,ce,ve){this.getDEMWorkerSource($,ce.source).loadTile(ce,ve)},Oi.prototype.reloadTile=function($,ce,ve){this.getWorkerSource($,ce.type,ce.source).reloadTile(ce,ve)},Oi.prototype.abortTile=function($,ce,ve){this.getWorkerSource($,ce.type,ce.source).abortTile(ce,ve)},Oi.prototype.removeTile=function($,ce,ve){this.getWorkerSource($,ce.type,ce.source).removeTile(ce,ve)},Oi.prototype.removeDEMTile=function($,ce){this.getDEMWorkerSource($,ce.source).removeTile(ce)},Oi.prototype.removeSource=function($,ce,ve){if(this.workerSources[$]&&this.workerSources[$][ce.type]&&this.workerSources[$][ce.type][ce.source]){var j=this.workerSources[$][ce.type][ce.source];delete this.workerSources[$][ce.type][ce.source],j.removeSource!==void 0?j.removeSource(ce,ve):ve()}},Oi.prototype.loadWorkerSource=function($,ce,ve){try{this.self.importScripts(ce.url),ve()}catch(j){ve(j.toString())}},Oi.prototype.syncRTLPluginState=function($,ce,ve){try{p.plugin.setState(ce);var j=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&j!=null){this.self.importScripts(j);var se=p.plugin.isParsed();ve(se?void 0:new Error("RTL Text Plugin failed to import scripts from "+j),se)}}catch(de){ve(de.toString())}},Oi.prototype.getAvailableImages=function($){var ce=this.availableImages[$];return ce||(ce=[]),ce},Oi.prototype.getLayerIndex=function($){var ce=this.layerIndexes[$];return ce||(ce=this.layerIndexes[$]=new V),ce},Oi.prototype.getWorkerSource=function($,ce,ve){var j=this;return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][ce]||(this.workerSources[$][ce]={}),this.workerSources[$][ce][ve]||(this.workerSources[$][ce][ve]=new this.workerSourceTypes[ce]({send:function(se,de,Me){j.actor.send(se,de,Me,$)}},this.getLayerIndex($),this.getAvailableImages($))),this.workerSources[$][ce][ve]},Oi.prototype.getDEMWorkerSource=function($,ce){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][ce]||(this.demWorkerSources[$][ce]=new $e),this.demWorkerSources[$][ce]},Oi.prototype.enforceCacheSizeLimit=function($,ce){p.enforceCacheSizeLimit(ce)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Oi(self)),Oi}),b(["./shared"],function(p){"use strict";var E=p.createCommonjsModule(function(n){function u(_){return!a(_)}function a(_){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,N,K=new Blob([""],{type:"text/javascript"}),oe=URL.createObjectURL(K);try{N=new Worker(oe),P=!0}catch(Ce){P=!1}return N&&N.terminate(),URL.revokeObjectURL(oe),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var N=P.getContext("2d");if(!N)return!1;var K=N.getImageData(0,0,1,1);return K&&K.width===P.width}()?(h[C=_&&_.failIfMajorPerformanceCaveat]===void 0&&(h[C]=function(P){var N=function(oe){var Ce=document.createElement("canvas"),we=Object.create(u.webGLContextAttributes);return we.failIfMajorPerformanceCaveat=oe,Ce.probablySupportsContext?Ce.probablySupportsContext("webgl",we)||Ce.probablySupportsContext("experimental-webgl",we):Ce.supportsContext?Ce.supportsContext("webgl",we)||Ce.supportsContext("experimental-webgl",we):Ce.getContext("webgl",we)||Ce.getContext("experimental-webgl",we)}(P);if(!N)return!1;var K=N.createShader(N.VERTEX_SHADER);return!(!K||N.isContextLost())&&(N.shaderSource(K,"void main() {}"),N.compileShader(K),N.getShaderParameter(K,N.COMPILE_STATUS)===!0)}(C)),h[C]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var C}n.exports?n.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=a);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Z={create:function(n,u,a){var h=p.window.document.createElement(n);return u!==void 0&&(h.className=u),a&&a.appendChild(h),h},createNS:function(n,u){return p.window.document.createElementNS(n,u)}},V=p.window.document&&p.window.document.documentElement.style;function H(n){if(!V)return n[0];for(var u=0;u<n.length;u++)if(n[u]in V)return n[u];return n[0]}var I,L=H(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Z.disableDrag=function(){V&&L&&(I=V[L],V[L]="none")},Z.enableDrag=function(){V&&L&&(V[L]=I)};var _e=H(["transform","WebkitTransform"]);Z.setTransform=function(n,u){n.style[_e]=u};var xe=!1;try{var Re=Object.defineProperty({},"passive",{get:function(){xe=!0}});p.window.addEventListener("test",Re,Re),p.window.removeEventListener("test",Re,Re)}catch(n){xe=!1}Z.addEventListener=function(n,u,a,h){h===void 0&&(h={}),n.addEventListener(u,a,"passive"in h&&xe?h:h.capture)},Z.removeEventListener=function(n,u,a,h){h===void 0&&(h={}),n.removeEventListener(u,a,"passive"in h&&xe?h:h.capture)};var $e=function(n){n.preventDefault(),n.stopPropagation(),p.window.removeEventListener("click",$e,!0)};function Rt(n){var u=n.userImage;return!!(u&&u.render&&u.render())&&(n.data.replace(new Uint8Array(u.data.buffer)),!0)}Z.suppressClick=function(){p.window.addEventListener("click",$e,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",$e,!0)},0)},Z.mousePos=function(n,u){var a=n.getBoundingClientRect();return new p.Point(u.clientX-a.left-n.clientLeft,u.clientY-a.top-n.clientTop)},Z.touchPos=function(n,u){for(var a=n.getBoundingClientRect(),h=[],_=0;_<u.length;_++)h.push(new p.Point(u[_].clientX-a.left-n.clientLeft,u[_].clientY-a.top-n.clientTop));return h},Z.mouseButton=function(n){return p.window.InstallTrigger!==void 0&&n.button===2&&n.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:n.button},Z.remove=function(n){n.parentNode&&n.parentNode.removeChild(n)};var Lt=function(n){function u(){n.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(a){if(this.loaded!==a&&(this.loaded=a,a)){for(var h=0,_=this.requestors;h<_.length;h+=1){var C=_[h];this._notify(C.ids,C.callback)}this.requestors=[]}},u.prototype.getImage=function(a){return this.images[a]},u.prototype.addImage=function(a,h){this._validate(a,h)&&(this.images[a]=h)},u.prototype._validate=function(a,h){var _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchX" value'))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchY" value'))),_=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "content" value'))),_=!1),_},u.prototype._validateStretch=function(a,h){if(!a)return!0;for(var _=0,C=0,P=a;C<P.length;C+=1){var N=P[C];if(N[0]<_||N[1]<N[0]||h<N[1])return!1;_=N[1]}return!0},u.prototype._validateContent=function(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))},u.prototype.updateImage=function(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0},u.prototype.removeImage=function(a){var h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(a,h){var _=!0;if(!this.isLoaded())for(var C=0,P=a;C<P.length;C+=1)this.images[P[C]]||(_=!1);this.isLoaded()||_?this._notify(a,h):this.requestors.push({ids:a,callback:h})},u.prototype._notify=function(a,h){for(var _={},C=0,P=a;C<P.length;C+=1){var N=P[C];this.images[N]||this.fire(new p.Event("styleimagemissing",{id:N}));var K=this.images[N];K?_[N]={data:K.data.clone(),pixelRatio:K.pixelRatio,sdf:K.sdf,version:K.version,stretchX:K.stretchX,stretchY:K.stretchY,content:K.content,hasRenderCallback:Boolean(K.userImage&&K.userImage.render)}:p.warnOnce('Image "'+N+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,_)},u.prototype.getPixelSize=function(){var a=this.atlasImage;return{width:a.width,height:a.height}},u.prototype.getPattern=function(a){var h=this.patterns[a],_=this.getImage(a);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{var C={w:_.data.width+2,h:_.data.height+2,x:0,y:0},P=new p.ImagePosition(C,_);this.patterns[a]={bin:C,position:P}}return this._updatePatternAtlas(),this.patterns[a].position},u.prototype.bind=function(a){var h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var a=[];for(var h in this.patterns)a.push(this.patterns[h].bin);var _=p.potpack(a),C=_.w,P=_.h,N=this.atlasImage;for(var K in N.resize({width:C||1,height:P||1}),this.patterns){var oe=this.patterns[K].bin,Ce=oe.x+1,we=oe.y+1,Ie=this.images[K].data,Ke=Ie.width,We=Ie.height;p.RGBAImage.copy(Ie,N,{x:0,y:0},{x:Ce,y:we},{width:Ke,height:We}),p.RGBAImage.copy(Ie,N,{x:0,y:We-1},{x:Ce,y:we-1},{width:Ke,height:1}),p.RGBAImage.copy(Ie,N,{x:0,y:0},{x:Ce,y:we+We},{width:Ke,height:1}),p.RGBAImage.copy(Ie,N,{x:Ke-1,y:0},{x:Ce-1,y:we},{width:1,height:We}),p.RGBAImage.copy(Ie,N,{x:0,y:0},{x:Ce+Ke,y:we},{width:1,height:We})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(a){for(var h=0,_=a;h<_.length;h+=1){var C=_[h];if(!this.callbackDispatchedThisFrame[C]){this.callbackDispatchedThisFrame[C]=!0;var P=this.images[C];Rt(P)&&this.updateImage(C,P)}}},u}(p.Evented),zt=at,St=at,Et=1e20;function at(n,u,a,h,_,C){this.fontSize=n||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=_||"sans-serif",this.fontWeight=C||"normal",this.radius=a||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ur(n,u,a,h,_,C,P){for(var N=0;N<u;N++){for(var K=0;K<a;K++)h[K]=n[K*u+N];for(ee(h,_,C,P,a),K=0;K<a;K++)n[K*u+N]=_[K]}for(K=0;K<a;K++){for(N=0;N<u;N++)h[N]=n[K*u+N];for(ee(h,_,C,P,u),N=0;N<u;N++)n[K*u+N]=Math.sqrt(_[N])}}function ee(n,u,a,h,_){a[0]=0,h[0]=-Et,h[1]=+Et;for(var C=1,P=0;C<_;C++){for(var N=(n[C]+C*C-(n[a[P]]+a[P]*a[P]))/(2*C-2*a[P]);N<=h[P];)P--,N=(n[C]+C*C-(n[a[P]]+a[P]*a[P]))/(2*C-2*a[P]);a[++P]=C,h[P]=N,h[P+1]=+Et}for(C=0,P=0;C<_;C++){for(;h[P+1]<C;)P++;u[C]=(C-a[P])*(C-a[P])+n[a[P]]}}at.prototype.draw=function(n){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(n,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),a=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var _=u.data[4*h+3]/255;this.gridOuter[h]=_===1?0:_===0?Et:Math.pow(Math.max(0,.5-_),2),this.gridInner[h]=_===1?Et:_===0?0:Math.pow(Math.max(0,_-.5),2)}for(ur(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),ur(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)a[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return a},zt.default=St;var fr=function(n,u){this.requestManager=n,this.localIdeographFontFamily=u,this.entries={}};fr.prototype.setURL=function(n){this.url=n},fr.prototype.getGlyphs=function(n,u){var a=this,h=[];for(var _ in n)for(var C=0,P=n[_];C<P.length;C+=1)h.push({stack:_,id:P[C]});p.asyncAll(h,function(N,K){var oe=N.stack,Ce=N.id,we=a.entries[oe];we||(we=a.entries[oe]={glyphs:{},requests:{},ranges:{}});var Ie=we.glyphs[Ce];if(Ie===void 0){if(Ie=a._tinySDF(we,oe,Ce))return we.glyphs[Ce]=Ie,void K(null,{stack:oe,id:Ce,glyph:Ie});var Ke=Math.floor(Ce/256);if(256*Ke>65535)K(new Error("glyphs > 65535 not supported"));else if(we.ranges[Ke])K(null,{stack:oe,id:Ce,glyph:Ie});else{var We=we.requests[Ke];We||(We=we.requests[Ke]=[],fr.loadGlyphRange(oe,Ke,a.url,a.requestManager,function(ot,je){if(je){for(var st in je)a._doesCharSupportLocalGlyph(+st)||(we.glyphs[+st]=je[+st]);we.ranges[Ke]=!0}for(var wt=0,Wt=We;wt<Wt.length;wt+=1)(0,Wt[wt])(ot,je);delete we.requests[Ke]})),We.push(function(ot,je){ot?K(ot):je&&K(null,{stack:oe,id:Ce,glyph:je[Ce]||null})})}}else K(null,{stack:oe,id:Ce,glyph:Ie})},function(N,K){if(N)u(N);else if(K){for(var oe={},Ce=0,we=K;Ce<we.length;Ce+=1){var Ie=we[Ce],Ke=Ie.stack,We=Ie.id,ot=Ie.glyph;(oe[Ke]||(oe[Ke]={}))[We]=ot&&{id:ot.id,bitmap:ot.bitmap.clone(),metrics:ot.metrics}}u(null,oe)}})},fr.prototype._doesCharSupportLocalGlyph=function(n){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](n)||p.isChar["Hangul Syllables"](n)||p.isChar.Hiragana(n)||p.isChar.Katakana(n))},fr.prototype._tinySDF=function(n,u,a){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(a)){var _=n.tinySDF;if(!_){var C="400";/bold/i.test(u)?C="900":/medium/i.test(u)?C="500":/light/i.test(u)&&(C="200"),_=n.tinySDF=new fr.TinySDF(24,3,8,.25,h,C)}return{id:a,bitmap:new p.AlphaImage({width:30,height:30},_.draw(String.fromCharCode(a))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},fr.loadGlyphRange=function(n,u,a,h,_){var C=256*u,P=C+255,N=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",n).replace("{range}",C+"-"+P),p.ResourceType.Glyphs);p.getArrayBuffer(N,function(K,oe){if(K)_(K);else if(oe){for(var Ce={},we=0,Ie=p.parseGlyphPBF(oe);we<Ie.length;we+=1){var Ke=Ie[we];Ce[Ke.id]=Ke}_(null,Ce)}})},fr.TinySDF=zt;var At=function(){this.specification=p.styleSpec.light.position};At.prototype.possiblyEvaluate=function(n,u){return p.sphericalToCartesian(n.expression.evaluate(u))},At.prototype.interpolate=function(n,u,a){return{x:p.number(n.x,u.x,a),y:p.number(n.y,u.y,a),z:p.number(n.z,u.z,a)}};var Je=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new At,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),Pt=function(n){function u(a){n.call(this),this._transitionable=new p.Transitionable(Je),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(a,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,a,h))for(var _ in a){var C=a[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-"-transition".length),C):this._transitionable.setValue(_,C)}},u.prototype.updateTransitions=function(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(a){this.properties=this._transitioning.possiblyEvaluate(a)},u.prototype._validate=function(a,h,_){return(!_||_.validate!==!1)&&p.emitValidationErrors(this,a.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},u}(p.Evented),Ve=function(n,u){this.width=n,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ve.prototype.getDash=function(n,u){var a=n.join(",")+String(u);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(n,u)),this.dashEntry[a]},Ve.prototype.getDashRanges=function(n,u,a){var h=[],_=n.length%2==1?-n[n.length-1]*a:0,C=n[0]*a,P=!0;h.push({left:_,right:C,isDash:P,zeroLength:n[0]===0});for(var N=n[0],K=1;K<n.length;K++){var oe=n[K];h.push({left:_=N*a,right:C=(N+=oe)*a,isDash:P=!P,zeroLength:oe===0})}return h},Ve.prototype.addRoundDash=function(n,u,a){for(var h=u/2,_=-a;_<=a;_++)for(var C=this.width*(this.nextRow+a+_),P=0,N=n[P],K=0;K<this.width;K++){K/N.right>1&&(N=n[++P]);var oe=Math.abs(K-N.left),Ce=Math.abs(K-N.right),we=Math.min(oe,Ce),Ie=void 0,Ke=_/a*(h+1);if(N.isDash){var We=h-Math.abs(Ke);Ie=Math.sqrt(we*we+We*We)}else Ie=h-Math.sqrt(we*we+Ke*Ke);this.data[C+K]=Math.max(0,Math.min(255,Ie+128))}},Ve.prototype.addRegularDash=function(n){for(var u=n.length-1;u>=0;--u){var a=n[u],h=n[u+1];a.zeroLength?n.splice(u,1):h&&h.isDash===a.isDash&&(h.left=a.left,n.splice(u,1))}var _=n[0],C=n[n.length-1];_.isDash===C.isDash&&(_.left=C.left-this.width,C.right=_.right+this.width);for(var P=this.width*this.nextRow,N=0,K=n[N],oe=0;oe<this.width;oe++){oe/K.right>1&&(K=n[++N]);var Ce=Math.abs(oe-K.left),we=Math.abs(oe-K.right),Ie=Math.min(Ce,we);this.data[P+oe]=Math.max(0,Math.min(255,(K.isDash?Ie:-Ie)+128))}},Ve.prototype.addDash=function(n,u){var a=u?7:0,h=2*a+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var _=0,C=0;C<n.length;C++)_+=n[C];if(_!==0){var P=this.width/_,N=this.getDashRanges(n,this.width,P);u?this.addRoundDash(N,P,a):this.addRegularDash(N)}var K={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:_};return this.nextRow+=h,this.dirty=!0,K},Ve.prototype.bind=function(n){var u=n.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var It=function n(u,a){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),_=0;_<h.length;_++){var C=new n.Actor(h[_],a,this.id);C.name="Worker "+_,this.actors.push(C)}};function hr(n,u,a){var h=function(_,C){if(_)return a(_);if(C){var P=p.pick(p.extend(C,n),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(P.vectorLayers=C.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(N){return N.id})),P.tiles=u.canonicalizeTileset(P,n.url),a(null,P)}};return n.url?p.getJSON(u.transformRequest(u.normalizeSourceURL(n.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,n)})}It.prototype.broadcast=function(n,u,a){p.asyncAll(this.actors,function(h,_){h.send(n,u,_)},a=a||function(){})},It.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},It.prototype.remove=function(){this.actors.forEach(function(n){n.remove()}),this.actors=[],this.workerPool.release(this.id)},It.Actor=p.Actor;var Jt=function(n,u,a){this.bounds=p.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=u||0,this.maxzoom=a||24};Jt.prototype.validateBounds=function(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]},Jt.prototype.contains=function(n){var u=Math.pow(2,n.z),a=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),_=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),C=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return n.x>=a&&n.x<_&&n.y>=h&&n.y<C};var Fr=function(n){function u(a,h,_,C){if(n.call(this),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=hr(this._options,this.map._requestManager,function(h,_){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):_&&(p.extend(a,_),_.bounds&&(a.tileBounds=new Jt(_.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(_.tiles,a.map._requestManager._customAccessToken),p.postMapLoadEvent(_.tiles,a.map._getMapId(),a.map._requestManager._skuToken,a.map._requestManager._customAccessToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setSourceProperty=function(a){this._tileJSONRequest&&this._tileJSONRequest.cancel(),a(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(a){var h=this;return this.setSourceProperty(function(){h._options.tiles=a}),this},u.prototype.setUrl=function(a){var h=this;return this.setSourceProperty(function(){h.url=a,h._options.url=a}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.loadTile=function(a,h){var _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(_,p.ResourceType.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(N,K){return delete a.request,a.aborted?h(null):N&&N.status!==404?h(N):(K&&K.resourceTiming&&(a.resourceTiming=K.resourceTiming),this.map._refreshExpiredTiles&&K&&a.setExpiryData(K),a.loadVectorData(K,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired"?a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",C,P.bind(this)):(a.actor=this.dispatcher.getActor(),a.request=a.actor.send("loadTile",C,P.bind(this)))},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(p.Evented),fe=function(n){function u(a,h,_,C){n.call(this),this.id=a,this.dispatcher=_,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=hr(this._options,this.map._requestManager,function(h,_){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):_&&(p.extend(a,_),_.bounds&&(a.tileBounds=new Jt(_.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(_.tiles),p.postMapLoadEvent(_.tiles,a.map._getMapId(),a.map._requestManager._skuToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.loadTile=function(a,h){var _=this,C=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);a.request=p.getImage(this.map._requestManager.transformRequest(C,p.ResourceType.Tile),function(P,N){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(P)a.state="errored",h(P);else if(N){_.map._refreshExpiredTiles&&a.setExpiryData(N),delete N.cacheControl,delete N.expires;var K=_.map.painter.context,oe=K.gl;a.texture=_.map.painter.getTileTexture(N.width),a.texture?a.texture.update(N,{useMipmap:!0}):(a.texture=new p.Texture(K,N,oe.RGBA,{useMipmap:!0}),a.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE,oe.LINEAR_MIPMAP_NEAREST),K.extTextureFilterAnisotropic&&oe.texParameterf(oe.TEXTURE_2D,K.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,K.extTextureFilterAnisotropicMax)),a.state="loaded",p.cacheEntryPossiblyAdded(_.dispatcher),h(null)}})},u.prototype.abortTile=function(a,h){a.request&&(a.request.cancel(),delete a.request),h()},u.prototype.unloadTile=function(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Fe=function(n){function u(a,h,_,C){n.call(this,a,h,_,C),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(a,h){var _=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function C(P,N){P&&(a.state="errored",h(P)),N&&(a.dem=N,a.needsHillshadePrepare=!0,a.state="loaded",h(null))}a.request=p.getImage(this.map._requestManager.transformRequest(_,p.ResourceType.Tile),function(P,N){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(P)a.state="errored",h(P);else if(N){this.map._refreshExpiredTiles&&a.setExpiryData(N),delete N.cacheControl,delete N.expires;var K=p.window.ImageBitmap&&N instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?N:p.browser.getImageData(N,1),oe={uid:a.uid,coord:a.tileID,source:this.id,rawImageData:K,encoding:this.encoding};a.actor&&a.state!=="expired"||(a.actor=this.dispatcher.getActor(),a.actor.send("loadDEMTile",oe,C.bind(this)))}}.bind(this)),a.neighboringTiles=this._getNeighboringTiles(a.tileID)},u.prototype._getNeighboringTiles=function(a){var h=a.canonical,_=Math.pow(2,h.z),C=(h.x-1+_)%_,P=h.x===0?a.wrap-1:a.wrap,N=(h.x+1+_)%_,K=h.x+1===_?a.wrap+1:a.wrap,oe={};return oe[new p.OverscaledTileID(a.overscaledZ,P,h.z,C,h.y).key]={backfilled:!1},oe[new p.OverscaledTileID(a.overscaledZ,K,h.z,N,h.y).key]={backfilled:!1},h.y>0&&(oe[new p.OverscaledTileID(a.overscaledZ,P,h.z,C,h.y-1).key]={backfilled:!1},oe[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},oe[new p.OverscaledTileID(a.overscaledZ,K,h.z,N,h.y-1).key]={backfilled:!1}),h.y+1<_&&(oe[new p.OverscaledTileID(a.overscaledZ,P,h.z,C,h.y+1).key]={backfilled:!1},oe[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},oe[new p.OverscaledTileID(a.overscaledZ,K,h.z,N,h.y+1).key]={backfilled:!1}),oe},u.prototype.unloadTile=function(a){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&a.actor.send("removeDEMTile",{uid:a.uid,source:this.id})},u}(fe),me=function(n){function u(a,h,_,C){n.call(this),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=_.getActor(),this.setEventedParent(C),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var P=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*P,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*P,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*P,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)a.fire(new p.ErrorEvent(h));else{var _={dataType:"source",sourceDataType:"metadata"};a._collectResourceTiming&&a._resourceTiming&&a._resourceTiming.length>0&&(_.resourceTiming=a._resourceTiming,a._resourceTiming=[]),a.fire(new p.Event("data",_))}})},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setData=function(a){var h=this;return this._data=a,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(_){if(_)h.fire(new p.ErrorEvent(_));else{var C={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(C.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",C))}}),this},u.prototype.getClusterExpansionZoom=function(a,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:a,source:this.id},h),this},u.prototype.getClusterChildren=function(a,h){return this.actor.send("geojson.getClusterChildren",{clusterId:a,source:this.id},h),this},u.prototype.getClusterLeaves=function(a,h,_,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:a,limit:h,offset:_},C),this},u.prototype._updateWorkerData=function(a){var h=this;this._loaded=!1;var _=p.extend({},this.workerOptions),C=this._data;typeof C=="string"?(_.request=this.map._requestManager.transformRequest(p.browser.resolveURL(C),p.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(C),this.actor.send(this.type+".loadData",_,function(P,N){h._removed||N&&N.abandoned||(h._loaded=!0,N&&N.resourceTiming&&N.resourceTiming[h.id]&&(h._resourceTiming=N.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:_.source},null),a(P))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(a,h){var _=this,C=a.actor?"reloadTile":"loadTile";a.actor=this.actor,a.request=this.actor.send(C,{type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,N){return delete a.request,a.unloadVectorData(),a.aborted?h(null):P?h(P):(a.loadVectorData(N,_.map.painter,C==="reloadTile"),h(null))})},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.aborted=!0},u.prototype.unloadTile=function(a){a.unloadVectorData(),this.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(p.Evented),bt=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),vt=function(n){function u(a,h,_,C){n.call(this),this.id=a,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(a,h){var _=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(C,P){_._loaded=!0,C?_.fire(new p.ErrorEvent(C)):P&&(_.image=P,a&&(_.coordinates=a),h&&h(),_._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(a){var h=this;return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setCoordinates=function(a){var h=this;this.coordinates=a;var _=a.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var N=1/0,K=1/0,oe=-1/0,Ce=-1/0,we=0,Ie=P;we<Ie.length;we+=1){var Ke=Ie[we];N=Math.min(N,Ke.x),K=Math.min(K,Ke.y),oe=Math.max(oe,Ke.x),Ce=Math.max(Ce,Ke.y)}var We=Math.max(oe-N,Ce-K),ot=Math.max(0,Math.floor(-Math.log(We)/Math.LN2)),je=Math.pow(2,ot);return new p.CanonicalTileID(ot,Math.floor((N+oe)/2*je),Math.floor((K+Ce)/2*je))}(_),this.minzoom=this.maxzoom=this.tileID.z;var C=_.map(function(P){return h.tileID.getTilePoint(P)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(C[0].x,C[0].y,0,0),this._boundsArray.emplaceBack(C[1].x,C[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(C[3].x,C[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(C[2].x,C[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var a=this.map.painter.context,h=a.gl;for(var _ in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,bt.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[_];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},u.prototype.loadTile=function(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Zt=function(n){function u(a,h,_,C){n.call(this,a,h,_,C),this.roundZoom=!0,this.type="video",this.options=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1;var h=this.options;this.urls=[];for(var _=0,C=h.urls;_<C.length;_+=1)this.urls.push(this.map._requestManager.transformRequest(C[_],p.ResourceType.Source).url);p.getVideo(this.urls,function(P,N){a._loaded=!0,P?a.fire(new p.ErrorEvent(P)):N&&(a.video=N,a.video.loop=!0,a.video.addEventListener("playing",function(){a.map.triggerRepaint()}),a.map&&a.video.play(),a._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(a){if(this.video){var h=this.video.seekable;a<h.start(0)||a>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=a}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var a=this.map.painter.context,h=a.gl;for(var _ in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,bt.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(a,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[_];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(vt),Ut=function(n){function u(a,h,_,C){n.call(this,a,h,_,C),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(N){return typeof N!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,_=h.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,bt.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,_.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[C];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var a=0,h=[this.canvas.width,this.canvas.height];a<h.length;a+=1){var _=h[a];if(isNaN(_)||_<=0)return!0}return!1},u}(vt),Rr={vector:Fr,raster:fe,"raster-dem":Fe,geojson:me,video:Zt,image:vt,canvas:Ut};function ln(n,u){var a=p.identity([]);return p.translate(a,a,[1,1,0]),p.scale(a,a,[.5*n.width,.5*n.height,1]),p.multiply(a,a,n.calculatePosMatrix(u.toUnwrapped()))}function pn(n,u,a,h,_,C){var P=function(ot,je,st){if(ot)for(var wt=0,Wt=ot;wt<Wt.length;wt+=1){var gr=je[Wt[wt]];if(gr&&gr.source===st&&gr.type==="fill-extrusion")return!0}else for(var cr in je){var xr=je[cr];if(xr.source===st&&xr.type==="fill-extrusion")return!0}return!1}(_&&_.layers,u,n.id),N=C.maxPitchScaleFactor(),K=n.tilesIn(h,N,P);K.sort(Vi);for(var oe=[],Ce=0,we=K;Ce<we.length;Ce+=1){var Ie=we[Ce];oe.push({wrappedTileID:Ie.tileID.wrapped().key,queryResults:Ie.tile.queryRenderedFeatures(u,a,n._state,Ie.queryGeometry,Ie.cameraQueryGeometry,Ie.scale,_,C,N,ln(n.transform,Ie.tileID))})}var Ke=function(ot){for(var je={},st={},wt=0,Wt=ot;wt<Wt.length;wt+=1){var gr=Wt[wt],cr=gr.queryResults,xr=gr.wrappedTileID,zr=st[xr]=st[xr]||{};for(var an in cr)for(var Qr=cr[an],Cn=zr[an]=zr[an]||{},ei=je[an]=je[an]||[],fi=0,ri=Qr;fi<ri.length;fi+=1){var ia=ri[fi];Cn[ia.featureIndex]||(Cn[ia.featureIndex]=!0,ei.push(ia))}}return je}(oe);for(var We in Ke)Ke[We].forEach(function(ot){var je=ot.feature,st=n.getFeatureState(je.layer["source-layer"],je.id);je.source=je.layer.source,je.layer["source-layer"]&&(je.sourceLayer=je.layer["source-layer"]),je.state=st});return Ke}function Vi(n,u){var a=n.tileID,h=u.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}var ar=function(n,u){this.max=n,this.onRemove=u,this.reset()};ar.prototype.reset=function(){for(var n in this.data)for(var u=0,a=this.data[n];u<a.length;u+=1){var h=a[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},ar.prototype.add=function(n,u,a){var h=this,_=n.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);var C={value:u,timeout:void 0};if(a!==void 0&&(C.timeout=setTimeout(function(){h.remove(n,C)},a)),this.data[_].push(C),this.order.push(_),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},ar.prototype.has=function(n){return n.wrapped().key in this.data},ar.prototype.getAndRemove=function(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null},ar.prototype._getAndRemoveByKey=function(n){var u=this.data[n].shift();return u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),u.value},ar.prototype.getByKey=function(n){var u=this.data[n];return u?u[0].value:null},ar.prototype.get=function(n){return this.has(n)?this.data[n.wrapped().key][0].value:null},ar.prototype.remove=function(n,u){if(!this.has(n))return this;var a=n.wrapped().key,h=u===void 0?0:this.data[a].indexOf(u),_=this.data[a][h];return this.data[a].splice(h,1),_.timeout&&clearTimeout(_.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(_.value),this.order.splice(this.order.indexOf(a),1),this},ar.prototype.setMaxSize=function(n){for(this.max=n;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},ar.prototype.filter=function(n){var u=[];for(var a in this.data)for(var h=0,_=this.data[a];h<_.length;h+=1){var C=_[h];n(C.value)||u.push(C)}for(var P=0,N=u;P<N.length;P+=1){var K=N[P];this.remove(K.value.tileID,K)}};var pe=function(n,u,a){this.context=n;var h=n.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};pe.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},pe.prototype.updateData=function(n){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)},pe.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Pe={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ge=function(n,u,a,h){this.length=u.length,this.attributes=a,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=n;var _=n.gl;this.buffer=_.createBuffer(),n.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};Ge.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ge.prototype.updateData=function(n){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)},Ge.prototype.enableAttributes=function(n,u){for(var a=0;a<this.attributes.length;a++){var h=u.attributes[this.attributes[a].name];h!==void 0&&n.enableVertexAttribArray(h)}},Ge.prototype.setVertexAttribPointers=function(n,u,a){for(var h=0;h<this.attributes.length;h++){var _=this.attributes[h],C=u.attributes[_.name];C!==void 0&&n.vertexAttribPointer(C,_.components,n[Pe[_.type]],!1,this.itemSize,_.offset+this.itemSize*(a||0))}},Ge.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ke=function(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ke.prototype.get=function(){return this.current},ke.prototype.set=function(n){},ke.prototype.getDefault=function(){return this.default},ke.prototype.setDefault=function(){this.set(this.default)};var Ft=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(ke),ir=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)},u}(ke),T=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)},u}(ke),G=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(ke),Se=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)},u}(ke),Be=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)},u}(ke),et=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(a){var h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)},u}(ke),tt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)},u}(ke),Ct=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}},u}(ke),jt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)},u}(ke),Mt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}},u}(ke),Qt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)},u}(ke),ne=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}},u}(ke),Kt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.ONE,a.ZERO]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)},u}(ke),Dr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(ke),Mr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)},u}(ke),nt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}},u}(ke),xt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)},u}(ke),ht=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)},u}(ke),vr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)},u}(ke),Zr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)},u}(ke),Ur=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(ke),tn=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}},u}(ke),jr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(ke),wr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}},u}(ke),Dn=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}},u}(ke),Zn=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1},u}(ke),bi=function(n){function u(a){n.call(this,a),this.vao=a.extVertexArrayObject}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)},u}(ke),Hi=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}},u}(ke),qi=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}},u}(ke),ki=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}},u}(ke),Oi=function(n){function u(a,h){n.call(this,a),this.context=a,this.parent=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(ke),$=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}},u}(Oi),ce=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(Oi),ve=function(n,u,a,h){this.context=n,this.width=u,this.height=a;var _=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new $(n,_),h&&(this.depthAttachment=new ce(n,_))};ve.prototype.destroy=function(){var n=this.context.gl,u=this.colorAttachment.get();if(u&&n.deleteTexture(u),this.depthAttachment){var a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}n.deleteFramebuffer(this.framebuffer)};var j=function(n,u,a){this.func=n,this.mask=u,this.range=a};j.ReadOnly=!1,j.ReadWrite=!0,j.disabled=new j(519,j.ReadOnly,[0,1]);var se=function(n,u,a,h,_,C){this.test=n,this.ref=u,this.mask=a,this.fail=h,this.depthFail=_,this.pass=C};se.disabled=new se({func:519,mask:0},0,0,7680,7680,7680);var de=function(n,u,a){this.blendFunction=n,this.blendColor=u,this.mask=a};de.disabled=new de(de.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),de.unblended=new de(de.Replace,p.Color.transparent,[!0,!0,!0,!0]),de.alphaBlended=new de([1,771],p.Color.transparent,[!0,!0,!0,!0]);var Me=function(n,u,a){this.enable=n,this.mode=u,this.frontFace=a};Me.disabled=new Me(!1,1029,2305),Me.backCCW=new Me(!0,1029,2305);var ue=function(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ft(this),this.clearDepth=new ir(this),this.clearStencil=new T(this),this.colorMask=new G(this),this.depthMask=new Se(this),this.stencilMask=new Be(this),this.stencilFunc=new et(this),this.stencilOp=new tt(this),this.stencilTest=new Ct(this),this.depthRange=new jt(this),this.depthTest=new Mt(this),this.depthFunc=new Qt(this),this.blend=new ne(this),this.blendFunc=new Kt(this),this.blendColor=new Dr(this),this.blendEquation=new Mr(this),this.cullFace=new nt(this),this.cullFaceSide=new xt(this),this.frontFace=new ht(this),this.program=new vr(this),this.activeTexture=new Zr(this),this.viewport=new Ur(this),this.bindFramebuffer=new tn(this),this.bindRenderbuffer=new jr(this),this.bindTexture=new wr(this),this.bindVertexBuffer=new Dn(this),this.bindElementBuffer=new Zn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new bi(this),this.pixelStoreUnpack=new Hi(this),this.pixelStoreUnpackPremultiplyAlpha=new qi(this),this.pixelStoreUnpackFlipY=new ki(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)};ue.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ue.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ue.prototype.createIndexBuffer=function(n,u){return new pe(this,n,u)},ue.prototype.createVertexBuffer=function(n,u,a){return new Ge(this,n,u,a)},ue.prototype.createRenderbuffer=function(n,u,a){var h=this.gl,_=h.createRenderbuffer();return this.bindRenderbuffer.set(_),h.renderbufferStorage(h.RENDERBUFFER,n,u,a),this.bindRenderbuffer.set(null),_},ue.prototype.createFramebuffer=function(n,u,a){return new ve(this,n,u,a)},ue.prototype.clear=function(n){var u=n.color,a=n.depth,h=this.gl,_=0;u&&(_|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(_|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h.clear(_)},ue.prototype.setCullFace=function(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))},ue.prototype.setDepthMode=function(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)},ue.prototype.setStencilMode=function(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)},ue.prototype.setColorMode=function(n){p.deepEqual(n.blendFunction,de.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)},ue.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Te=function(n){function u(a,h,_){var C=this;n.call(this),this.id=a,this.dispatcher=_,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(C._sourceLoaded=!0),C._sourceLoaded&&!C._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(C.reload(),C.transform&&C.update(C.transform))}),this.on("error",function(){C._sourceErrored=!0}),this._source=function(P,N,K,oe){var Ce=new Rr[N.type](P,N,K,oe);if(Ce.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+Ce.id);return p.bindAll(["load","abort","unload","serialize","prepare"],Ce),Ce}(a,h,_,this),this._tiles={},this._cache=new ar(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.onAdd=function(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(a)},u.prototype.onRemove=function(a){this._source&&this._source.onRemove&&this._source.onRemove(a)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var a in this._tiles){var h=this._tiles[a];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(a,h){return this._source.loadTile(a,h)},u.prototype._unloadTile=function(a){if(this._source.unloadTile)return this._source.unloadTile(a,function(){})},u.prototype._abortTile=function(a){if(this._source.abortTile)return this._source.abortTile(a,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(a){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var _=this._tiles[h];_.upload(a),_.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return p.values(this._tiles).map(function(a){return a.tileID}).sort(mt).map(function(a){return a.key})},u.prototype.getRenderableIds=function(a){var h=this,_=[];for(var C in this._tiles)this._isIdRenderable(C,a)&&_.push(this._tiles[C]);return a?_.sort(function(P,N){var K=P.tileID,oe=N.tileID,Ce=new p.Point(K.canonical.x,K.canonical.y)._rotate(h.transform.angle),we=new p.Point(oe.canonical.x,oe.canonical.y)._rotate(h.transform.angle);return K.overscaledZ-oe.overscaledZ||we.y-Ce.y||we.x-Ce.x}).map(function(P){return P.tileID.key}):_.map(function(P){return P.tileID}).sort(mt).map(function(P){return P.key})},u.prototype.hasRenderableParent=function(a){var h=this.findLoadedParent(a,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(a,h){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(h||!this._tiles[a].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var a in this._cache.reset(),this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")},u.prototype._reloadTile=function(a,h){var _=this._tiles[a];_&&(_.state!=="loading"&&(_.state=h),this._loadTile(_,this._tileLoaded.bind(this,_,a,h)))},u.prototype._tileLoaded=function(a,h,_,C){if(C)return a.state="errored",void(C.status!==404?this._source.fire(new p.ErrorEvent(C,{tile:a})):this.update(this.transform));a.timeAdded=p.browser.now(),_==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(h,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:a,coord:a.tileID}))},u.prototype._backfillDEM=function(a){for(var h=this.getRenderableIds(),_=0;_<h.length;_++){var C=h[_];if(a.neighboringTiles&&a.neighboringTiles[C]){var P=this.getTileByID(C);N(a,P),N(P,a)}}function N(K,oe){K.needsHillshadePrepare=!0;var Ce=oe.tileID.canonical.x-K.tileID.canonical.x,we=oe.tileID.canonical.y-K.tileID.canonical.y,Ie=Math.pow(2,K.tileID.canonical.z),Ke=oe.tileID.key;Ce===0&&we===0||Math.abs(we)>1||(Math.abs(Ce)>1&&(Math.abs(Ce+Ie)===1?Ce+=Ie:Math.abs(Ce-Ie)===1&&(Ce-=Ie)),oe.dem&&K.dem&&(K.dem.backfillBorder(oe.dem,Ce,we),K.neighboringTiles&&K.neighboringTiles[Ke]&&(K.neighboringTiles[Ke].backfilled=!0)))}},u.prototype.getTile=function(a){return this.getTileByID(a.key)},u.prototype.getTileByID=function(a){return this._tiles[a]},u.prototype._retainLoadedChildren=function(a,h,_,C){for(var P in this._tiles){var N=this._tiles[P];if(!(C[P]||!N.hasData()||N.tileID.overscaledZ<=h||N.tileID.overscaledZ>_)){for(var K=N.tileID;N&&N.tileID.overscaledZ>h+1;){var oe=N.tileID.scaledTo(N.tileID.overscaledZ-1);(N=this._tiles[oe.key])&&N.hasData()&&(K=oe)}for(var Ce=K;Ce.overscaledZ>h;)if(a[(Ce=Ce.scaledTo(Ce.overscaledZ-1)).key]){C[K.key]=K;break}}}},u.prototype.findLoadedParent=function(a,h){if(a.key in this._loadedParentTiles){var _=this._loadedParentTiles[a.key];return _&&_.tileID.overscaledZ>=h?_:null}for(var C=a.overscaledZ-1;C>=h;C--){var P=a.scaledTo(C),N=this._getLoadedTile(P);if(N)return N}},u.prototype._getLoadedTile=function(a){var h=this._tiles[a.key];return h&&h.hasData()?h:this._cache.getByKey(a.wrapped().key)},u.prototype.updateCacheSize=function(a){var h=Math.ceil(a.width/this._source.tileSize)+1,_=Math.ceil(a.height/this._source.tileSize)+1,C=Math.floor(h*_*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(P)},u.prototype.handleWrapJump=function(a){var h=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,h){var _={};for(var C in this._tiles){var P=this._tiles[C];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),_[P.tileID.key]=P}for(var N in this._tiles=_,this._timers)clearTimeout(this._timers[N]),delete this._timers[N];for(var K in this._tiles)this._setTileReloadTimer(K,this._tiles[K])}},u.prototype.update=function(a){var h=this;if(this.transform=a,this._sourceLoaded&&!this._paused){var _;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?_=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(zr){return new p.OverscaledTileID(zr.canonical.z,zr.wrap,zr.canonical.z,zr.canonical.x,zr.canonical.y)}):(_=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(_=_.filter(function(zr){return h._source.hasTile(zr)}))):_=[];var C=a.coveringZoomLevel(this._source),P=Math.max(C-u.maxOverzooming,this._source.minzoom),N=Math.max(C+u.maxUnderzooming,this._source.minzoom),K=this._updateRetainedTiles(_,C);if(br(this._source.type)){for(var oe={},Ce={},we=0,Ie=Object.keys(K);we<Ie.length;we+=1){var Ke=Ie[we],We=K[Ke],ot=this._tiles[Ke];if(ot&&!(ot.fadeEndTime&&ot.fadeEndTime<=p.browser.now())){var je=this.findLoadedParent(We,P);je&&(this._addTile(je.tileID),oe[je.tileID.key]=je.tileID),Ce[Ke]=We}}for(var st in this._retainLoadedChildren(Ce,C,N,K),oe)K[st]||(this._coveredTiles[st]=!0,K[st]=oe[st])}for(var wt in K)this._tiles[wt].clearFadeHold();for(var Wt=0,gr=p.keysDifference(this._tiles,K);Wt<gr.length;Wt+=1){var cr=gr[Wt],xr=this._tiles[cr];xr.hasSymbolBuckets&&!xr.holdingForFade()?xr.setHoldDuration(this.map._fadeDuration):xr.hasSymbolBuckets&&!xr.symbolFadeFinished()||this._removeTile(cr)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)},u.prototype._updateRetainedTiles=function(a,h){for(var _={},C={},P=Math.max(h-u.maxOverzooming,this._source.minzoom),N=Math.max(h+u.maxUnderzooming,this._source.minzoom),K={},oe=0,Ce=a;oe<Ce.length;oe+=1){var we=Ce[oe],Ie=this._addTile(we);_[we.key]=we,Ie.hasData()||h<this._source.maxzoom&&(K[we.key]=we)}this._retainLoadedChildren(K,h,N,_);for(var Ke=0,We=a;Ke<We.length;Ke+=1){var ot=We[Ke],je=this._tiles[ot.key];if(!je.hasData()){if(h+1>this._source.maxzoom){var st=ot.children(this._source.maxzoom)[0],wt=this.getTile(st);if(wt&&wt.hasData()){_[st.key]=st;continue}}else{var Wt=ot.children(this._source.maxzoom);if(_[Wt[0].key]&&_[Wt[1].key]&&_[Wt[2].key]&&_[Wt[3].key])continue}for(var gr=je.wasRequested(),cr=ot.overscaledZ-1;cr>=P;--cr){var xr=ot.scaledTo(cr);if(C[xr.key]||(C[xr.key]=!0,!(je=this.getTile(xr))&&gr&&(je=this._addTile(xr)),je&&(_[xr.key]=xr,gr=je.wasRequested(),je.hasData())))break}}}return _},u.prototype._updateLoadedParentTileCache=function(){for(var a in this._loadedParentTiles={},this._tiles){for(var h=[],_=void 0,C=this._tiles[a].tileID;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){_=this._loadedParentTiles[C.key];break}h.push(C.key);var P=C.scaledTo(C.overscaledZ-1);if(_=this._getLoadedTile(P))break;C=P}for(var N=0,K=h;N<K.length;N+=1)this._loadedParentTiles[K[N]]=_}},u.prototype._addTile=function(a){var h=this._tiles[a.key];if(h)return h;(h=this._cache.getAndRemove(a))&&(this._setTileReloadTimer(a.key,h),h.tileID=a,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,h)));var _=Boolean(h);return _||(h=new p.Tile(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,a.key,h.state))),h?(h.uses++,this._tiles[a.key]=h,_||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(a,h){var _=this;a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);var C=h.getExpiryTimeout();C&&(this._timers[a]=setTimeout(function(){_._reloadTile(a,"expired"),delete _._timers[a]},C))},u.prototype._removeTile=function(a){var h=this._tiles[a];h&&(h.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var a in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(a);this._cache.reset()},u.prototype.tilesIn=function(a,h,_){var C=this,P=[],N=this.transform;if(!N)return P;for(var K=_?N.getCameraQueryGeometry(a):a,oe=a.map(function(cr){return N.pointCoordinate(cr)}),Ce=K.map(function(cr){return N.pointCoordinate(cr)}),we=this.getIds(),Ie=1/0,Ke=1/0,We=-1/0,ot=-1/0,je=0,st=Ce;je<st.length;je+=1){var wt=st[je];Ie=Math.min(Ie,wt.x),Ke=Math.min(Ke,wt.y),We=Math.max(We,wt.x),ot=Math.max(ot,wt.y)}for(var Wt=function(cr){var xr=C._tiles[we[cr]];if(!xr.holdingForFade()){var zr=xr.tileID,an=Math.pow(2,N.zoom-xr.tileID.overscaledZ),Qr=h*xr.queryPadding*p.EXTENT/xr.tileSize/an,Cn=[zr.getTilePoint(new p.MercatorCoordinate(Ie,Ke)),zr.getTilePoint(new p.MercatorCoordinate(We,ot))];if(Cn[0].x-Qr<p.EXTENT&&Cn[0].y-Qr<p.EXTENT&&Cn[1].x+Qr>=0&&Cn[1].y+Qr>=0){var ei=oe.map(function(ri){return zr.getTilePoint(ri)}),fi=Ce.map(function(ri){return zr.getTilePoint(ri)});P.push({tile:xr,tileID:zr,queryGeometry:ei,cameraQueryGeometry:fi,scale:an})}}},gr=0;gr<we.length;gr++)Wt(gr);return P},u.prototype.getVisibleCoordinates=function(a){for(var h=this,_=this.getRenderableIds(a).map(function(K){return h._tiles[K].tileID}),C=0,P=_;C<P.length;C+=1){var N=P[C];N.posMatrix=this.transform.calculatePosMatrix(N.toUnwrapped())}return _},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(br(this._source.type))for(var a in this._tiles){var h=this._tiles[a];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},u.prototype.setFeatureState=function(a,h,_){this._state.updateState(a=a||"_geojsonTileLayer",h,_)},u.prototype.removeFeatureState=function(a,h,_){this._state.removeFeatureState(a=a||"_geojsonTileLayer",h,_)},u.prototype.getFeatureState=function(a,h){return this._state.getState(a=a||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(a,h,_){var C=this._tiles[a];C&&C.setDependencies(h,_)},u.prototype.reloadTilesForDependencies=function(a,h){for(var _ in this._tiles)this._tiles[_].hasDependency(a,h)&&this._reloadTile(_,"reloading");this._cache.filter(function(C){return!C.hasDependency(a,h)})},u}(p.Evented);function mt(n,u){var a=Math.abs(2*n.wrap)-+(n.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return n.overscaledZ-u.overscaledZ||h-a||u.canonical.y-n.canonical.y||u.canonical.x-n.canonical.x}function br(n){return n==="raster"||n==="image"||n==="video"}function Yt(){return new p.window.Worker(qu.workerUrl)}Te.maxOverzooming=10,Te.maxUnderzooming=3;var nr="mapboxgl_preloaded_worker_pool",kr=function(){this.active={}};kr.prototype.acquire=function(n){if(!this.workers)for(this.workers=[];this.workers.length<kr.workerCount;)this.workers.push(new Yt);return this.active[n]=!0,this.workers.slice()},kr.prototype.release=function(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},kr.prototype.isPreloaded=function(){return!!this.active[nr]},kr.prototype.numActive=function(){return Object.keys(this.active).length};var Mn,Pn=Math.floor(p.browser.hardwareConcurrency/2);function tr(){return Mn||(Mn=new kr),Mn}function Sn(n,u){var a={};for(var h in n)h!=="ref"&&(a[h]=n[h]);return p.refProperties.forEach(function(_){_ in u&&(a[_]=u[_])}),a}function on(n){n=n.slice();for(var u=Object.create(null),a=0;a<n.length;a++)u[n[a].id]=n[a];for(var h=0;h<n.length;h++)"ref"in n[h]&&(n[h]=Sn(n[h],u[n[h].ref]));return n}kr.workerCount=Math.max(Math.min(Pn,6),1);var cn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function wi(n,u,a){a.push({command:cn.addSource,args:[n,u[n]]})}function xn(n,u,a){u.push({command:cn.removeSource,args:[n]}),a[n]=!0}function Li(n,u,a,h){xn(n,a,h),wi(n,u,a)}function $i(n,u,a){var h;for(h in n[a])if(n[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[a][h],u[a][h]))return!1;for(h in u[a])if(u[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[a][h],u[a][h]))return!1;return!0}function ai(n,u,a,h,_,C){var P;for(P in u=u||{},n=n||{})n.hasOwnProperty(P)&&(p.deepEqual(n[P],u[P])||a.push({command:C,args:[h,P,u[P],_]}));for(P in u)u.hasOwnProperty(P)&&!n.hasOwnProperty(P)&&(p.deepEqual(n[P],u[P])||a.push({command:C,args:[h,P,u[P],_]}))}function Ji(n){return n.id}function Ni(n,u){return n[u.id]=u,n}var Ai=function(n,u){this.reset(n,u)};Ai.prototype.reset=function(n,u){this.points=n||[],this._distances=[0];for(var a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Ai.prototype.lerp=function(n){if(this.points.length===1)return this.points[0];n=p.clamp(n,0,1);for(var u=1,a=this._distances[u],h=n*this.paddedLength+this.padding;a<h&&u<this._distances.length;)a=this._distances[++u];var _=u-1,C=this._distances[_],P=a-C,N=P>0?(h-C)/P:0;return this.points[_].mult(1-N).add(this.points[u].mult(N))};var ha=function(n,u,a){var h=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(n/a),this.yCellCount=Math.ceil(u/a);for(var C=0;C<this.xCellCount*this.yCellCount;C++)h.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function Ca(n,u,a,h,_){var C=p.create();return u?(p.scale(C,C,[1/_,1/_,1]),a||p.rotateZ(C,C,h.angle)):p.multiply(C,h.labelPlaneMatrix,n),C}function ii(n,u,a,h,_){if(u){var C=p.clone(n);return p.scale(C,C,[_,_,1]),a||p.rotateZ(C,C,-h.angle),C}return h.glCoordMatrix}function ti(n,u){var a=[n.x,n.y,0,1];Ka(a,a,u);var h=a[3];return{point:new p.Point(a[0]/h,a[1]/h),signedDistanceFromCamera:h}}function Xi(n,u){return .5+n/u*.5}function va(n,u){var a=n[0]/n[3],h=n[1]/n[3];return a>=-u[0]&&a<=u[0]&&h>=-u[1]&&h<=u[1]}function Vo(n,u,a,h,_,C,P,N){var K=h?n.textSizeData:n.iconSizeData,oe=p.evaluateSizeForZoom(K,a.transform.zoom),Ce=[256/a.width*2+1,256/a.height*2+1],we=h?n.text.dynamicLayoutVertexArray:n.icon.dynamicLayoutVertexArray;we.clear();for(var Ie=n.lineVertexArray,Ke=h?n.text.placedSymbolArray:n.icon.placedSymbolArray,We=a.transform.width/a.transform.height,ot=!1,je=0;je<Ke.length;je++){var st=Ke.get(je);if(st.hidden||st.writingMode===p.WritingMode.vertical&&!ot)zi(st.numGlyphs,we);else{ot=!1;var wt=[st.anchorX,st.anchorY,0,1];if(p.transformMat4(wt,wt,u),va(wt,Ce)){var Wt=Xi(a.transform.cameraToCenterDistance,wt[3]),gr=p.evaluateSizeForFeature(K,oe,st),cr=P?gr/Wt:gr*Wt,xr=new p.Point(st.anchorX,st.anchorY),zr=ti(xr,_).point,an={},Qr=Bs(st,cr,!1,N,u,_,C,n.glyphOffsetArray,Ie,we,zr,xr,an,We);ot=Qr.useVertical,(Qr.notEnoughRoom||ot||Qr.needsFlipping&&Bs(st,cr,!0,N,u,_,C,n.glyphOffsetArray,Ie,we,zr,xr,an,We).notEnoughRoom)&&zi(st.numGlyphs,we)}else zi(st.numGlyphs,we)}}h?n.text.dynamicLayoutVertexBuffer.updateData(we):n.icon.dynamicLayoutVertexBuffer.updateData(we)}function ba(n,u,a,h,_,C,P,N,K,oe,Ce){var we=N.glyphStartIndex+N.numGlyphs,Ie=N.lineStartIndex,Ke=N.lineStartIndex+N.lineLength,We=u.getoffsetX(N.glyphStartIndex),ot=u.getoffsetX(we-1),je=Aa(n*We,a,h,_,C,P,N.segment,Ie,Ke,K,oe,Ce);if(!je)return null;var st=Aa(n*ot,a,h,_,C,P,N.segment,Ie,Ke,K,oe,Ce);return st?{first:je,last:st}:null}function gi(n,u,a,h){return n===p.WritingMode.horizontal&&Math.abs(a.y-u.y)>Math.abs(a.x-u.x)*h?{useVertical:!0}:(n===p.WritingMode.vertical?u.y<a.y:u.x>a.x)?{needsFlipping:!0}:null}function Bs(n,u,a,h,_,C,P,N,K,oe,Ce,we,Ie,Ke){var We,ot=u/24,je=n.lineOffsetX*ot,st=n.lineOffsetY*ot;if(n.numGlyphs>1){var wt=n.glyphStartIndex+n.numGlyphs,Wt=n.lineStartIndex,gr=n.lineStartIndex+n.lineLength,cr=ba(ot,N,je,st,a,Ce,we,n,K,C,Ie);if(!cr)return{notEnoughRoom:!0};var xr=ti(cr.first.point,P).point,zr=ti(cr.last.point,P).point;if(h&&!a){var an=gi(n.writingMode,xr,zr,Ke);if(an)return an}We=[cr.first];for(var Qr=n.glyphStartIndex+1;Qr<wt-1;Qr++)We.push(Aa(ot*N.getoffsetX(Qr),je,st,a,Ce,we,n.segment,Wt,gr,K,C,Ie));We.push(cr.last)}else{if(h&&!a){var Cn=ti(we,_).point,ei=n.lineStartIndex+n.segment+1,fi=new p.Point(K.getx(ei),K.gety(ei)),ri=ti(fi,_),ia=ri.signedDistanceFromCamera>0?ri.point:nu(we,fi,Cn,1,_),Nn=gi(n.writingMode,Cn,ia,Ke);if(Nn)return Nn}var _i=Aa(ot*N.getoffsetX(n.glyphStartIndex),je,st,a,Ce,we,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,K,C,Ie);if(!_i)return{notEnoughRoom:!0};We=[_i]}for(var Zi=0,q=We;Zi<q.length;Zi+=1){var te=q[Zi];p.addDynamicAttributes(oe,te.point,te.angle)}return{}}function nu(n,u,a,h,_){var C=ti(n.add(n.sub(u)._unit()),_).point,P=a.sub(C);return a.add(P._mult(h/P.mag()))}function Aa(n,u,a,h,_,C,P,N,K,oe,Ce,we){var Ie=h?n-u:n+u,Ke=Ie>0?1:-1,We=0;h&&(Ke*=-1,We=Math.PI),Ke<0&&(We+=Math.PI);for(var ot=Ke>0?N+P:N+P+1,je=_,st=_,wt=0,Wt=0,gr=Math.abs(Ie),cr=[];wt+Wt<=gr;){if((ot+=Ke)<N||ot>=K)return null;if(st=je,cr.push(je),(je=we[ot])===void 0){var xr=new p.Point(oe.getx(ot),oe.gety(ot)),zr=ti(xr,Ce);if(zr.signedDistanceFromCamera>0)je=we[ot]=zr.point;else{var an=ot-Ke;je=nu(wt===0?C:new p.Point(oe.getx(an),oe.gety(an)),xr,st,gr-wt+1,Ce)}}wt+=Wt,Wt=st.dist(je)}var Qr=(gr-wt)/Wt,Cn=je.sub(st),ei=Cn.mult(Qr)._add(st);ei._add(Cn._unit()._perp()._mult(a*Ke));var fi=We+Math.atan2(je.y-st.y,je.x-st.x);return cr.push(ei),{point:ei,angle:fi,path:cr}}ha.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ha.prototype.insert=function(n,u,a,h,_){this._forEachCell(u,a,h,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(_)},ha.prototype.insertCircle=function(n,u,a,h){this._forEachCell(u-h,a-h,u+h,a+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(a),this.circles.push(h)},ha.prototype._insertBoxCell=function(n,u,a,h,_,C){this.boxCells[_].push(C)},ha.prototype._insertCircleCell=function(n,u,a,h,_,C){this.circleCells[_].push(C)},ha.prototype._query=function(n,u,a,h,_,C){if(a<0||n>this.width||h<0||u>this.height)return!_&&[];var P=[];if(n<=0&&u<=0&&this.width<=a&&this.height<=h){if(_)return!0;for(var N=0;N<this.boxKeys.length;N++)P.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(var K=0;K<this.circleKeys.length;K++){var oe=this.circles[3*K],Ce=this.circles[3*K+1],we=this.circles[3*K+2];P.push({key:this.circleKeys[K],x1:oe-we,y1:Ce-we,x2:oe+we,y2:Ce+we})}return C?P.filter(C):P}return this._forEachCell(n,u,a,h,this._queryCell,P,{hitTest:_,seenUids:{box:{},circle:{}}},C),_?P.length>0:P},ha.prototype._queryCircle=function(n,u,a,h,_){var C=n-a,P=n+a,N=u-a,K=u+a;if(P<0||C>this.width||K<0||N>this.height)return!h&&[];var oe=[];return this._forEachCell(C,N,P,K,this._queryCellCircle,oe,{hitTest:h,circle:{x:n,y:u,radius:a},seenUids:{box:{},circle:{}}},_),h?oe.length>0:oe},ha.prototype.query=function(n,u,a,h,_){return this._query(n,u,a,h,!1,_)},ha.prototype.hitTest=function(n,u,a,h,_){return this._query(n,u,a,h,!0,_)},ha.prototype.hitTestCircle=function(n,u,a,h){return this._queryCircle(n,u,a,!0,h)},ha.prototype._queryCell=function(n,u,a,h,_,C,P,N){var K=P.seenUids,oe=this.boxCells[_];if(oe!==null)for(var Ce=this.bboxes,we=0,Ie=oe;we<Ie.length;we+=1){var Ke=Ie[we];if(!K.box[Ke]){K.box[Ke]=!0;var We=4*Ke;if(n<=Ce[We+2]&&u<=Ce[We+3]&&a>=Ce[We+0]&&h>=Ce[We+1]&&(!N||N(this.boxKeys[Ke]))){if(P.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Ke],x1:Ce[We],y1:Ce[We+1],x2:Ce[We+2],y2:Ce[We+3]})}}}var ot=this.circleCells[_];if(ot!==null)for(var je=this.circles,st=0,wt=ot;st<wt.length;st+=1){var Wt=wt[st];if(!K.circle[Wt]){K.circle[Wt]=!0;var gr=3*Wt;if(this._circleAndRectCollide(je[gr],je[gr+1],je[gr+2],n,u,a,h)&&(!N||N(this.circleKeys[Wt]))){if(P.hitTest)return C.push(!0),!0;var cr=je[gr],xr=je[gr+1],zr=je[gr+2];C.push({key:this.circleKeys[Wt],x1:cr-zr,y1:xr-zr,x2:cr+zr,y2:xr+zr})}}}},ha.prototype._queryCellCircle=function(n,u,a,h,_,C,P,N){var K=P.circle,oe=P.seenUids,Ce=this.boxCells[_];if(Ce!==null)for(var we=this.bboxes,Ie=0,Ke=Ce;Ie<Ke.length;Ie+=1){var We=Ke[Ie];if(!oe.box[We]){oe.box[We]=!0;var ot=4*We;if(this._circleAndRectCollide(K.x,K.y,K.radius,we[ot+0],we[ot+1],we[ot+2],we[ot+3])&&(!N||N(this.boxKeys[We])))return C.push(!0),!0}}var je=this.circleCells[_];if(je!==null)for(var st=this.circles,wt=0,Wt=je;wt<Wt.length;wt+=1){var gr=Wt[wt];if(!oe.circle[gr]){oe.circle[gr]=!0;var cr=3*gr;if(this._circlesCollide(st[cr],st[cr+1],st[cr+2],K.x,K.y,K.radius)&&(!N||N(this.circleKeys[gr])))return C.push(!0),!0}}},ha.prototype._forEachCell=function(n,u,a,h,_,C,P,N){for(var K=this._convertToXCellCoord(n),oe=this._convertToYCellCoord(u),Ce=this._convertToXCellCoord(a),we=this._convertToYCellCoord(h),Ie=K;Ie<=Ce;Ie++)for(var Ke=oe;Ke<=we;Ke++)if(_.call(this,n,u,a,h,this.xCellCount*Ke+Ie,C,P,N))return},ha.prototype._convertToXCellCoord=function(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))},ha.prototype._convertToYCellCoord=function(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))},ha.prototype._circlesCollide=function(n,u,a,h,_,C){var P=h-n,N=_-u,K=a+C;return K*K>P*P+N*N},ha.prototype._circleAndRectCollide=function(n,u,a,h,_,C,P){var N=(C-h)/2,K=Math.abs(n-(h+N));if(K>N+a)return!1;var oe=(P-_)/2,Ce=Math.abs(u-(_+oe));if(Ce>oe+a)return!1;if(K<=N||Ce<=oe)return!0;var we=K-N,Ie=Ce-oe;return we*we+Ie*Ie<=a*a};var Io=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function zi(n,u){for(var a=0;a<n;a++){var h=u.length;u.resize(h+4),u.float32.set(Io,3*h)}}function Ka(n,u,a){var h=u[0],_=u[1];return n[0]=a[0]*h+a[4]*_+a[12],n[1]=a[1]*h+a[5]*_+a[13],n[3]=a[3]*h+a[7]*_+a[15],n}var Go=function(n,u,a){u===void 0&&(u=new ha(n.width+200,n.height+200,25)),a===void 0&&(a=new ha(n.width+200,n.height+200,25)),this.transform=n,this.grid=u,this.ignoredGrid=a,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+100,this.screenBottomBoundary=n.height+100,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200};function ea(n,u,a){return u*(p.EXTENT/(n.tileSize*Math.pow(2,a-n.tileID.overscaledZ)))}Go.prototype.placeCollisionBox=function(n,u,a,h,_){var C=this.projectAndGetPerspectiveRatio(h,n.anchorPointX,n.anchorPointY),P=a*C.perspectiveRatio,N=n.x1*P+C.point.x,K=n.y1*P+C.point.y,oe=n.x2*P+C.point.x,Ce=n.y2*P+C.point.y;return!this.isInsideGrid(N,K,oe,Ce)||!u&&this.grid.hitTest(N,K,oe,Ce,_)?{box:[],offscreen:!1}:{box:[N,K,oe,Ce],offscreen:this.isOffscreen(N,K,oe,Ce)}},Go.prototype.placeCollisionCircles=function(n,u,a,h,_,C,P,N,K,oe,Ce,we,Ie){var Ke=[],We=new p.Point(u.anchorX,u.anchorY),ot=ti(We,C),je=Xi(this.transform.cameraToCenterDistance,ot.signedDistanceFromCamera),st=(oe?_/je:_*je)/p.ONE_EM,wt=ti(We,P).point,Wt=ba(st,h,u.lineOffsetX*st,u.lineOffsetY*st,!1,wt,We,u,a,P,{}),gr=!1,cr=!1,xr=!0;if(Wt){for(var zr=.5*we*je+Ie,an=new p.Point(-100,-100),Qr=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),Cn=new Ai,ei=Wt.first,fi=Wt.last,ri=[],ia=ei.path.length-1;ia>=1;ia--)ri.push(ei.path[ia]);for(var Nn=1;Nn<fi.path.length;Nn++)ri.push(fi.path[Nn]);var _i=2.5*zr;if(N){var Zi=ri.map(function(Gi){return ti(Gi,N)});ri=Zi.some(function(Gi){return Gi.signedDistanceFromCamera<=0})?[]:Zi.map(function(Gi){return Gi.point})}var q=[];if(ri.length>0){for(var te=ri[0].clone(),k=ri[0].clone(),F=1;F<ri.length;F++)te.x=Math.min(te.x,ri[F].x),te.y=Math.min(te.y,ri[F].y),k.x=Math.max(k.x,ri[F].x),k.y=Math.max(k.y,ri[F].y);q=te.x>=an.x&&k.x<=Qr.x&&te.y>=an.y&&k.y<=Qr.y?[ri]:k.x<an.x||te.x>Qr.x||k.y<an.y||te.y>Qr.y?[]:p.clipLine([ri],an.x,an.y,Qr.x,Qr.y)}for(var ie=0,Ae=q;ie<Ae.length;ie+=1){var ft;Cn.reset(Ae[ie],.25*zr),ft=Cn.length<=.5*zr?1:Math.ceil(Cn.paddedLength/_i)+1;for(var Vt=0;Vt<ft;Vt++){var Tt=Vt/Math.max(ft-1,1),qt=Cn.lerp(Tt),Lr=qt.x+100,In=qt.y+100;Ke.push(Lr,In,zr,0);var Fn=Lr-zr,oi=In-zr,ui=Lr+zr,mi=In+zr;if(xr=xr&&this.isOffscreen(Fn,oi,ui,mi),cr=cr||this.isInsideGrid(Fn,oi,ui,mi),!n&&this.grid.hitTestCircle(Lr,In,zr,Ce)&&(gr=!0,!K))return{circles:[],offscreen:!1,collisionDetected:gr}}}}return{circles:!K&&gr||!cr?[]:Ke,offscreen:xr,collisionDetected:gr}},Go.prototype.queryRenderedSymbols=function(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],a=1/0,h=1/0,_=-1/0,C=-1/0,P=0,N=n;P<N.length;P+=1){var K=N[P],oe=new p.Point(K.x+100,K.y+100);a=Math.min(a,oe.x),h=Math.min(h,oe.y),_=Math.max(_,oe.x),C=Math.max(C,oe.y),u.push(oe)}for(var Ce={},we={},Ie=0,Ke=this.grid.query(a,h,_,C).concat(this.ignoredGrid.query(a,h,_,C));Ie<Ke.length;Ie+=1){var We=Ke[Ie],ot=We.key;if(Ce[ot.bucketInstanceId]===void 0&&(Ce[ot.bucketInstanceId]={}),!Ce[ot.bucketInstanceId][ot.featureIndex]){var je=[new p.Point(We.x1,We.y1),new p.Point(We.x2,We.y1),new p.Point(We.x2,We.y2),new p.Point(We.x1,We.y2)];p.polygonIntersectsPolygon(u,je)&&(Ce[ot.bucketInstanceId][ot.featureIndex]=!0,we[ot.bucketInstanceId]===void 0&&(we[ot.bucketInstanceId]=[]),we[ot.bucketInstanceId].push(ot.featureIndex))}}return we},Go.prototype.insertCollisionBox=function(n,u,a,h,_){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:a,featureIndex:h,collisionGroupID:_},n[0],n[1],n[2],n[3])},Go.prototype.insertCollisionCircles=function(n,u,a,h,_){for(var C=u?this.ignoredGrid:this.grid,P={bucketInstanceId:a,featureIndex:h,collisionGroupID:_},N=0;N<n.length;N+=4)C.insertCircle(P,n[N],n[N+1],n[N+2])},Go.prototype.projectAndGetPerspectiveRatio=function(n,u,a){var h=[u,a,0,1];return Ka(h,h,n),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Go.prototype.isOffscreen=function(n,u,a,h){return a<100||n>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},Go.prototype.isInsideGrid=function(n,u,a,h){return a>=0&&n<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},Go.prototype.getViewportMatrix=function(){var n=p.identity([]);return p.translate(n,n,[-100,-100,0]),n};var To=function(n,u,a,h){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):h&&a?1:0,this.placed=a};To.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Oo=function(n,u,a,h,_){this.text=new To(n?n.text:null,u,a,_),this.icon=new To(n?n.icon:null,u,h,_)};Oo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var co=function(n,u,a){this.text=n,this.icon=u,this.skipFade=a},fo=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},Yi=function(n,u,a,h,_){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=a,this.bucketIndex=h,this.tileID=_},Da=function(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}};function ka(n,u,a,h,_){var C=p.getAnchorAlignment(n),P=-(C.horizontalAlign-.5)*u,N=-(C.verticalAlign-.5)*a,K=p.evaluateVariableOffset(n,h);return new p.Point(P+K[0]*_,N+K[1]*_)}function fs(n,u,a,h,_,C){var P=n.x1,N=n.x2,K=n.y1,oe=n.y2,Ce=n.anchorPointX,we=n.anchorPointY,Ie=new p.Point(u,a);return h&&Ie._rotate(_?C:-C),{x1:P+Ie.x,y1:K+Ie.y,x2:N+Ie.x,y2:oe+Ie.y,anchorPointX:Ce,anchorPointY:we}}Da.prototype.get=function(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){var u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:function(a){return a.collisionGroupID===u}}}return this.collisionGroups[n]};var Sa=function(n,u,a,h){this.transform=n.clone(),this.collisionIndex=new Go(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Da(a),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function be(n,u,a,h,_){n.emplaceBack(u?1:0,a?1:0,h||0,_||0),n.emplaceBack(u?1:0,a?1:0,h||0,_||0),n.emplaceBack(u?1:0,a?1:0,h||0,_||0),n.emplaceBack(u?1:0,a?1:0,h||0,_||0)}Sa.prototype.getBucketParts=function(n,u,a,h){var _=a.getBucket(u),C=a.latestFeatureIndex;if(_&&C&&u.id===_.layerIds[0]){var P=a.collisionBoxArray,N=_.layers[0].layout,K=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),oe=a.tileSize/p.EXTENT,Ce=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),we=N.get("text-pitch-alignment")==="map",Ie=N.get("text-rotation-alignment")==="map",Ke=ea(a,1,this.transform.zoom),We=Ca(Ce,we,Ie,this.transform,Ke),ot=null;if(we){var je=ii(Ce,we,Ie,this.transform,Ke);ot=p.multiply([],this.transform.labelPlaneMatrix,je)}this.retainedQueryData[_.bucketInstanceId]=new Yi(_.bucketInstanceId,C,_.sourceLayerIndex,_.index,a.tileID);var st={bucket:_,layout:N,posMatrix:Ce,textLabelPlaneMatrix:We,labelToScreenMatrix:ot,scale:K,textPixelRatio:oe,holdingForFade:a.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(h)for(var wt=0,Wt=_.sortKeyRanges;wt<Wt.length;wt+=1){var gr=Wt[wt];n.push({sortKey:gr.sortKey,symbolInstanceStart:gr.symbolInstanceStart,symbolInstanceEnd:gr.symbolInstanceEnd,parameters:st})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:st})}},Sa.prototype.attemptAnchorPlacement=function(n,u,a,h,_,C,P,N,K,oe,Ce,we,Ie,Ke,We){var ot,je=[we.textOffset0,we.textOffset1],st=ka(n,a,h,je,_),wt=this.collisionIndex.placeCollisionBox(fs(u,st.x,st.y,C,P,this.transform.angle),Ce,N,K,oe.predicate);if(!We||this.collisionIndex.placeCollisionBox(fs(We,st.x,st.y,C,P,this.transform.angle),Ce,N,K,oe.predicate).box.length!==0)return wt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID].text&&(ot=this.prevPlacement.variableOffsets[we.crossTileID].anchor),this.variableOffsets[we.crossTileID]={textOffset:je,width:a,height:h,anchor:n,textBoxScale:_,prevAnchor:ot},this.markUsedJustification(Ie,n,we,Ke),Ie.allowVerticalPlacement&&(this.markUsedOrientation(Ie,Ke,we),this.placedOrientations[we.crossTileID]=Ke),{shift:st,placedGlyphBoxes:wt}):void 0},Sa.prototype.placeLayerBucketPart=function(n,u,a){var h=this,_=n.parameters,C=_.bucket,P=_.layout,N=_.posMatrix,K=_.textLabelPlaneMatrix,oe=_.labelToScreenMatrix,Ce=_.textPixelRatio,we=_.holdingForFade,Ie=_.collisionBoxArray,Ke=_.partiallyEvaluatedTextSize,We=_.collisionGroup,ot=P.get("text-optional"),je=P.get("icon-optional"),st=P.get("text-allow-overlap"),wt=P.get("icon-allow-overlap"),Wt=P.get("text-rotation-alignment")==="map",gr=P.get("text-pitch-alignment")==="map",cr=P.get("icon-text-fit")!=="none",xr=P.get("symbol-z-order")==="viewport-y",zr=st&&(wt||!C.hasIconData()||je),an=wt&&(st||!C.hasTextData()||ot);!C.collisionArrays&&Ie&&C.deserializeCollisionBoxes(Ie);var Qr=function(Nn,_i){if(!u[Nn.crossTileID])if(we)h.placements[Nn.crossTileID]=new co(!1,!1,!1);else{var Zi,q=!1,te=!1,k=!0,F=null,ie={box:null,offscreen:null},Ae={box:null,offscreen:null},ft=null,Vt=null,Tt=0,qt=0,Lr=0;_i.textFeatureIndex?Tt=_i.textFeatureIndex:Nn.useRuntimeCollisionCircles&&(Tt=Nn.featureIndex),_i.verticalTextFeatureIndex&&(qt=_i.verticalTextFeatureIndex);var In=_i.textBox;if(In){var Fn=function(ji){var Xo=p.WritingMode.horizontal;if(C.allowVerticalPlacement&&!ji&&h.prevPlacement){var Fo=h.prevPlacement.placedOrientations[Nn.crossTileID];Fo&&(h.placedOrientations[Nn.crossTileID]=Fo,h.markUsedOrientation(C,Xo=Fo,Nn))}return Xo},oi=function(ji,Xo){if(C.allowVerticalPlacement&&Nn.numVerticalGlyphVertices>0&&_i.verticalTextBox)for(var Fo=0,Yo=C.writingModes;Fo<Yo.length&&(Yo[Fo]===p.WritingMode.vertical?(ie=Xo(),Ae=ie):ie=ji(),!(ie&&ie.box&&ie.box.length));Fo+=1);else ie=ji()};if(P.get("text-variable-anchor")){var ui=P.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[Nn.crossTileID]){var mi=h.prevPlacement.variableOffsets[Nn.crossTileID];ui.indexOf(mi.anchor)>0&&(ui=ui.filter(function(ji){return ji!==mi.anchor})).unshift(mi.anchor)}var Gi=function(ji,Xo,Fo){for(var Yo=ji.x2-ji.x1,Sc=ji.y2-ji.y1,zu=Nn.textBoxScale,el=cr&&!wt?Xo:null,fu={box:[],offscreen:!1},Rl=st?2*ui.length:ui.length,Gs=0;Gs<Rl;++Gs){var ml=h.attemptAnchorPlacement(ui[Gs%ui.length],ji,Yo,Sc,zu,Wt,gr,Ce,N,We,Gs>=ui.length,Nn,C,Fo,el);if(ml&&(fu=ml.placedGlyphBoxes)&&fu.box&&fu.box.length){q=!0,F=ml.shift;break}}return fu};oi(function(){return Gi(In,_i.iconBox,p.WritingMode.horizontal)},function(){var ji=_i.verticalTextBox;return C.allowVerticalPlacement&&!(ie&&ie.box&&ie.box.length)&&Nn.numVerticalGlyphVertices>0&&ji?Gi(ji,_i.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),ie&&(q=ie.box,k=ie.offscreen);var ma=Fn(ie&&ie.box);if(!q&&h.prevPlacement){var ya=h.prevPlacement.variableOffsets[Nn.crossTileID];ya&&(h.variableOffsets[Nn.crossTileID]=ya,h.markUsedJustification(C,ya.anchor,Nn,ma))}}else{var ro=function(ji,Xo){var Fo=h.collisionIndex.placeCollisionBox(ji,st,Ce,N,We.predicate);return Fo&&Fo.box&&Fo.box.length&&(h.markUsedOrientation(C,Xo,Nn),h.placedOrientations[Nn.crossTileID]=Xo),Fo};oi(function(){return ro(In,p.WritingMode.horizontal)},function(){var ji=_i.verticalTextBox;return C.allowVerticalPlacement&&Nn.numVerticalGlyphVertices>0&&ji?ro(ji,p.WritingMode.vertical):{box:null,offscreen:null}}),Fn(ie&&ie.box&&ie.box.length)}}if(q=(Zi=ie)&&Zi.box&&Zi.box.length>0,k=Zi&&Zi.offscreen,Nn.useRuntimeCollisionCircles){var Oa=C.text.placedSymbolArray.get(Nn.centerJustifiedTextSymbolIndex),mo=p.evaluateSizeForFeature(C.textSizeData,Ke,Oa),Ma=P.get("text-padding");ft=h.collisionIndex.placeCollisionCircles(st,Oa,C.lineVertexArray,C.glyphOffsetArray,mo,N,K,oe,a,gr,We.predicate,Nn.collisionCircleDiameter,Ma),q=st||ft.circles.length>0&&!ft.collisionDetected,k=k&&ft.offscreen}if(_i.iconFeatureIndex&&(Lr=_i.iconFeatureIndex),_i.iconBox){var ga=function(ji){var Xo=cr&&F?fs(ji,F.x,F.y,Wt,gr,h.transform.angle):ji;return h.collisionIndex.placeCollisionBox(Xo,wt,Ce,N,We.predicate)};te=Ae&&Ae.box&&Ae.box.length&&_i.verticalIconBox?(Vt=ga(_i.verticalIconBox)).box.length>0:(Vt=ga(_i.iconBox)).box.length>0,k=k&&Vt.offscreen}var aa=ot||Nn.numHorizontalGlyphVertices===0&&Nn.numVerticalGlyphVertices===0,pa=je||Nn.numIconVertices===0;if(aa||pa?pa?aa||(te=te&&q):q=te&&q:te=q=te&&q,q&&Zi&&Zi.box&&h.collisionIndex.insertCollisionBox(Zi.box,P.get("text-ignore-placement"),C.bucketInstanceId,Ae&&Ae.box&&qt?qt:Tt,We.ID),te&&Vt&&h.collisionIndex.insertCollisionBox(Vt.box,P.get("icon-ignore-placement"),C.bucketInstanceId,Lr,We.ID),ft&&(q&&h.collisionIndex.insertCollisionCircles(ft.circles,P.get("text-ignore-placement"),C.bucketInstanceId,Tt,We.ID),a)){var Ua=C.bucketInstanceId,Za=h.collisionCircleArrays[Ua];Za===void 0&&(Za=h.collisionCircleArrays[Ua]=new fo);for(var ko=0;ko<ft.circles.length;ko+=4)Za.circles.push(ft.circles[ko+0]),Za.circles.push(ft.circles[ko+1]),Za.circles.push(ft.circles[ko+2]),Za.circles.push(ft.collisionDetected?1:0)}h.placements[Nn.crossTileID]=new co(q||zr,te||an,k||C.justReloaded),u[Nn.crossTileID]=!0}};if(xr)for(var Cn=C.getSortedSymbolIndexes(this.transform.angle),ei=Cn.length-1;ei>=0;--ei){var fi=Cn[ei];Qr(C.symbolInstances.get(fi),C.collisionArrays[fi])}else for(var ri=n.symbolInstanceStart;ri<n.symbolInstanceEnd;ri++)Qr(C.symbolInstances.get(ri),C.collisionArrays[ri]);if(a&&C.bucketInstanceId in this.collisionCircleArrays){var ia=this.collisionCircleArrays[C.bucketInstanceId];p.invert(ia.invProjMatrix,N),ia.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1},Sa.prototype.markUsedJustification=function(n,u,a,h){var _;_=h===p.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];for(var C=0,P=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];C<P.length;C+=1){var N=P[C];N>=0&&(n.text.placedSymbolArray.get(N).crossTileID=_>=0&&N!==_?0:a.crossTileID)}},Sa.prototype.markUsedOrientation=function(n,u,a){for(var h=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,_=u===p.WritingMode.vertical?u:0,C=0,P=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];C<P.length;C+=1)n.text.placedSymbolArray.get(P[C]).placedOrientation=h;a.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=_)},Sa.prototype.commit=function(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,a=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(n):1,_=u?u.opacities:{},C=u?u.variableOffsets:{},P=u?u.placedOrientations:{};for(var N in this.placements){var K=this.placements[N],oe=_[N];oe?(this.opacities[N]=new Oo(oe,h,K.text,K.icon),a=a||K.text!==oe.text.placed||K.icon!==oe.icon.placed):(this.opacities[N]=new Oo(null,h,K.text,K.icon,K.skipFade),a=a||K.text||K.icon)}for(var Ce in _){var we=_[Ce];if(!this.opacities[Ce]){var Ie=new Oo(we,h,!1,!1);Ie.isHidden()||(this.opacities[Ce]=Ie,a=a||we.text.placed||we.icon.placed)}}for(var Ke in C)this.variableOffsets[Ke]||!this.opacities[Ke]||this.opacities[Ke].isHidden()||(this.variableOffsets[Ke]=C[Ke]);for(var We in P)this.placedOrientations[We]||!this.opacities[We]||this.opacities[We].isHidden()||(this.placedOrientations[We]=P[We]);a?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)},Sa.prototype.updateLayerOpacities=function(n,u){for(var a={},h=0,_=u;h<_.length;h+=1){var C=_[h],P=C.getBucket(n);P&&C.latestFeatureIndex&&n.id===P.layerIds[0]&&this.updateBucketOpacities(P,a,C.collisionBoxArray)}},Sa.prototype.updateBucketOpacities=function(n,u,a){var h=this;n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();var _=n.layers[0].layout,C=new Oo(null,0,!1,!1,!0),P=_.get("text-allow-overlap"),N=_.get("icon-allow-overlap"),K=_.get("text-variable-anchor"),oe=_.get("text-rotation-alignment")==="map",Ce=_.get("text-pitch-alignment")==="map",we=_.get("icon-text-fit")!=="none",Ie=new Oo(null,0,P&&(N||!n.hasIconData()||_.get("icon-optional")),N&&(P||!n.hasTextData()||_.get("text-optional")),!0);!n.collisionArrays&&a&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(a);for(var Ke=function(st,wt,Wt){for(var gr=0;gr<wt/4;gr++)st.opacityVertexArray.emplaceBack(Wt)},We=function(st){var wt=n.symbolInstances.get(st),Wt=wt.numHorizontalGlyphVertices,gr=wt.numVerticalGlyphVertices,cr=wt.crossTileID,xr=h.opacities[cr];u[cr]?xr=C:xr||(h.opacities[cr]=xr=Ie),u[cr]=!0;var zr=wt.numIconVertices>0,an=h.placedOrientations[wt.crossTileID],Qr=an===p.WritingMode.vertical,Cn=an===p.WritingMode.horizontal||an===p.WritingMode.horizontalOnly;if(Wt>0||gr>0){var ei=ao(xr.text);Ke(n.text,Wt,Qr?oo:ei),Ke(n.text,gr,Cn?oo:ei);var fi=xr.text.isHidden();[wt.rightJustifiedTextSymbolIndex,wt.centerJustifiedTextSymbolIndex,wt.leftJustifiedTextSymbolIndex].forEach(function(ie){ie>=0&&(n.text.placedSymbolArray.get(ie).hidden=fi||Qr?1:0)}),wt.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(wt.verticalPlacedTextSymbolIndex).hidden=fi||Cn?1:0);var ri=h.variableOffsets[wt.crossTileID];ri&&h.markUsedJustification(n,ri.anchor,wt,an);var ia=h.placedOrientations[wt.crossTileID];ia&&(h.markUsedJustification(n,"left",wt,ia),h.markUsedOrientation(n,ia,wt))}if(zr){var Nn=ao(xr.icon),_i=!(we&&wt.verticalPlacedIconSymbolIndex&&Qr);wt.placedIconSymbolIndex>=0&&(Ke(n.icon,wt.numIconVertices,_i?Nn:oo),n.icon.placedSymbolArray.get(wt.placedIconSymbolIndex).hidden=xr.icon.isHidden()),wt.verticalPlacedIconSymbolIndex>=0&&(Ke(n.icon,wt.numVerticalIconVertices,_i?oo:Nn),n.icon.placedSymbolArray.get(wt.verticalPlacedIconSymbolIndex).hidden=xr.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){var Zi=n.collisionArrays[st];if(Zi){var q=new p.Point(0,0);if(Zi.textBox||Zi.verticalTextBox){var te=!0;if(K){var k=h.variableOffsets[cr];k?(q=ka(k.anchor,k.width,k.height,k.textOffset,k.textBoxScale),oe&&q._rotate(Ce?h.transform.angle:-h.transform.angle)):te=!1}Zi.textBox&&be(n.textCollisionBox.collisionVertexArray,xr.text.placed,!te||Qr,q.x,q.y),Zi.verticalTextBox&&be(n.textCollisionBox.collisionVertexArray,xr.text.placed,!te||Cn,q.x,q.y)}var F=Boolean(!Cn&&Zi.verticalIconBox);Zi.iconBox&&be(n.iconCollisionBox.collisionVertexArray,xr.icon.placed,F,we?q.x:0,we?q.y:0),Zi.verticalIconBox&&be(n.iconCollisionBox.collisionVertexArray,xr.icon.placed,!F,we?q.x:0,we?q.y:0)}}},ot=0;ot<n.symbolInstances.length;ot++)We(ot);if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){var je=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=je.invProjMatrix,n.placementViewportMatrix=je.viewportMatrix,n.collisionCircleArray=je.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}},Sa.prototype.symbolFadeChange=function(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Sa.prototype.zoomAdjustment=function(n){return Math.max(0,(this.transform.zoom-n)/1.5)},Sa.prototype.hasTransitions=function(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration},Sa.prototype.stillRecent=function(n,u){var a=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*a>n},Sa.prototype.setStale=function(){this.stale=!0};var Ne=Math.pow(2,25),pt=Math.pow(2,24),rr=Math.pow(2,17),Xr=Math.pow(2,16),Kn=Math.pow(2,9),vi=Math.pow(2,8),Ga=Math.pow(2,1);function ao(n){if(n.opacity===0&&!n.placed)return 0;if(n.opacity===1&&n.placed)return 4294967295;var u=n.placed?1:0,a=Math.floor(127*n.opacity);return a*Ne+u*pt+a*rr+u*Xr+a*Kn+u*vi+a*Ga+u}var oo=0,hs=function(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};hs.prototype.continuePlacement=function(n,u,a,h,_){for(var C=this._bucketParts;this._currentTileIndex<n.length;)if(u.getBucketParts(C,h,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(function(P,N){return P.sortKey-N.sortKey}));this._currentPartIndex<C.length;)if(u.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,_())return!0;return!1};var Xs=function(n,u,a,h,_,C,P){this.placement=new Sa(n,_,C,P),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=h,this._done=!1};Xs.prototype.isDone=function(){return this._done},Xs.prototype.continuePlacement=function(n,u,a){for(var h=this,_=p.browser.now(),C=function(){var K=p.browser.now()-_;return!h._forceFullPlacement&&K>2};this._currentPlacementIndex>=0;){var P=u[n[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=N)&&(!P.maxzoom||P.maxzoom>N)){if(this._inProgressLayer||(this._inProgressLayer=new hs(P)),this._inProgressLayer.continuePlacement(a[P.source],this.placement,this._showCollisionBoxes,P,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Xs.prototype.commit=function(n){return this.placement.commit(n),this.placement};var ws=512/p.EXTENT/2,_o=function(n,u,a){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(var h=0;h<u.length;h++){var _=u.get(h),C=_.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,n)})}};_o.prototype.getScaledCoordinates=function(n,u){var a=ws/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+n.anchorX)*a),y:Math.floor((u.canonical.y*p.EXTENT+n.anchorY)*a)}},_o.prototype.findMatches=function(n,u,a){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),_=0;_<n.length;_++){var C=n.get(_);if(!C.crossTileID){var P=this.indexedSymbolInstances[C.key];if(P)for(var N=this.getScaledCoordinates(C,u),K=0,oe=P;K<oe.length;K+=1){var Ce=oe[K];if(Math.abs(Ce.coord.x-N.x)<=h&&Math.abs(Ce.coord.y-N.y)<=h&&!a[Ce.crossTileID]){a[Ce.crossTileID]=!0,C.crossTileID=Ce.crossTileID;break}}}}};var rs=function(){this.maxCrossTileID=0};rs.prototype.generate=function(){return++this.maxCrossTileID};var Ho=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ho.prototype.handleWrapJump=function(n){var u=Math.round((n-this.lng)/360);if(u!==0)for(var a in this.indexes){var h=this.indexes[a],_={};for(var C in h){var P=h[C];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+u),_[P.tileID.key]=P}this.indexes[a]=_}this.lng=n},Ho.prototype.addBucket=function(n,u,a){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});var _=this.usedCrossTileIDs[n.overscaledZ];for(var C in this.indexes){var P=this.indexes[C];if(Number(C)>n.overscaledZ)for(var N in P){var K=P[N];K.tileID.isChildOf(n)&&K.findMatches(u.symbolInstances,n,_)}else{var oe=P[n.scaledTo(Number(C)).key];oe&&oe.findMatches(u.symbolInstances,n,_)}}for(var Ce=0;Ce<u.symbolInstances.length;Ce++){var we=u.symbolInstances.get(Ce);we.crossTileID||(we.crossTileID=a.generate(),_[we.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new _o(n,u.symbolInstances,u.bucketInstanceId),!0},Ho.prototype.removeBucketCrossTileIDs=function(n,u){for(var a in u.indexedSymbolInstances)for(var h=0,_=u.indexedSymbolInstances[a];h<_.length;h+=1)delete this.usedCrossTileIDs[n][_[h].crossTileID]},Ho.prototype.removeStaleBuckets=function(n){var u=!1;for(var a in this.indexes){var h=this.indexes[a];for(var _ in h)n[h[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,h[_]),delete h[_],u=!0)}return u};var Lo=function(){this.layerIndexes={},this.crossTileIDs=new rs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Lo.prototype.addLayer=function(n,u,a){var h=this.layerIndexes[n.id];h===void 0&&(h=this.layerIndexes[n.id]=new Ho);var _=!1,C={};h.handleWrapJump(a);for(var P=0,N=u;P<N.length;P+=1){var K=N[P],oe=K.getBucket(n);oe&&n.id===oe.layerIds[0]&&(oe.bucketInstanceId||(oe.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(K.tileID,oe,this.crossTileIDs)&&(_=!0),C[oe.bucketInstanceId]=!0)}return h.removeStaleBuckets(C)&&(_=!0),_},Lo.prototype.pruneUnusedLayers=function(n){var u={};for(var a in n.forEach(function(h){u[h]=!0}),this.layerIndexes)u[a]||delete this.layerIndexes[a]};var xo=function(n,u){return p.emitValidationErrors(n,u&&u.filter(function(a){return a.identifier!=="source.canvas"}))},Si=p.pick(cn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ds=p.pick(cn,["setCenter","setZoom","setBearing","setPitch"]),ns=function(){var n={},u=p.styleSpec.$version;for(var a in p.styleSpec.$root){var h,_=p.styleSpec.$root[a];_.required&&(h=a==="version"?u:_.type==="array"?[]:{})!=null&&(n[a]=h)}return n}(),ps=function(n){function u(a,h){var _=this;h===void 0&&(h={}),n.call(this),this.map=a,this.dispatcher=new It(tr(),this),this.imageManager=new Lt,this.imageManager.setEventedParent(this),this.glyphManager=new fr(a._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ve(256,512),this.crossTileSymbolIndex=new Lo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var C=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(P){C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(N,K){if(p.triggerPluginCompletionEvent(N),K&&K.every(function(Ce){return Ce}))for(var oe in C.sourceCaches)C.sourceCaches[oe].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var N=_.sourceCaches[P.sourceId];if(N){var K=N.getSource();if(K&&K.vectorLayerIds)for(var oe in _._layers){var Ce=_._layers[oe];Ce.source===K.id&&_._validateLayer(Ce)}}}})}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.loadURL=function(a,h){var _=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var C=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);var P=this.map._requestManager.transformRequest(a,p.ResourceType.Style);this._request=p.getJSON(P,function(N,K){_._request=null,N?_.fire(new p.ErrorEvent(N)):K&&_._load(K,C)})},u.prototype.loadJSON=function(a,h){var _=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){_._request=null,_._load(a,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(ns,!1)},u.prototype._load=function(a,h){if(!h||!xo(this,p.validateStyle(a))){for(var _ in this._loaded=!0,this.stylesheet=a,a.sources)this.addSource(_,a.sources[_],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs);var C=on(this.stylesheet.layers);this._order=C.map(function(oe){return oe.id}),this._layers={},this._serializedLayers={};for(var P=0,N=C;P<N.length;P+=1){var K=N[P];(K=p.createStyleLayer(K)).setEventedParent(this,{layer:{id:K.id}}),this._layers[K.id]=K,this._serializedLayers[K.id]=K.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Pt(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},u.prototype._loadSprite=function(a){var h=this;this._spriteRequest=function(_,C,P){var N,K,oe,Ce=p.browser.devicePixelRatio>1?"@2x":"",we=p.getJSON(C.transformRequest(C.normalizeSpriteURL(_,Ce,".json"),p.ResourceType.SpriteJSON),function(We,ot){we=null,oe||(oe=We,N=ot,Ke())}),Ie=p.getImage(C.transformRequest(C.normalizeSpriteURL(_,Ce,".png"),p.ResourceType.SpriteImage),function(We,ot){Ie=null,oe||(oe=We,K=ot,Ke())});function Ke(){if(oe)P(oe);else if(N&&K){var We=p.browser.getImageData(K),ot={};for(var je in N){var st=N[je],wt=st.width,Wt=st.height,gr=st.x,cr=st.y,xr=st.sdf,zr=st.pixelRatio,an=st.stretchX,Qr=st.stretchY,Cn=st.content,ei=new p.RGBAImage({width:wt,height:Wt});p.RGBAImage.copy(We,ei,{x:gr,y:cr},{x:0,y:0},{width:wt,height:Wt}),ot[je]={data:ei,pixelRatio:zr,sdf:xr,stretchX:an,stretchY:Qr,content:Cn}}P(null,ot)}}return{cancel:function(){we&&(we.cancel(),we=null),Ie&&(Ie.cancel(),Ie=null)}}}(a,this.map._requestManager,function(_,C){if(h._spriteRequest=null,_)h.fire(new p.ErrorEvent(_));else if(C)for(var P in C)h.imageManager.addImage(P,C[P]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(a){var h=this.sourceCaches[a.source];if(h){var _=a.sourceLayer;if(_){var C=h.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(_)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+_+'" does not exist on source "'+C.id+'" as specified by style layer "'+a.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(a){for(var h=[],_=0,C=a;_<C.length;_+=1){var P=this._layers[C[_]];P.type!=="custom"&&h.push(P.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(a){if(this._loaded){var h=this._changed;if(this._changed){var _=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);for(var P in(_.length||C.length)&&this._updateWorkerLayers(_,C),this._updatedSources){var N=this._updatedSources[P];N==="reload"?this._reloadSource(P):N==="clear"&&this._clearSource(P)}for(var K in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[K].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}var oe={};for(var Ce in this.sourceCaches){var we=this.sourceCaches[Ce];oe[Ce]=we.used,we.used=!1}for(var Ie=0,Ke=this._order;Ie<Ke.length;Ie+=1){var We=this._layers[Ke[Ie]];We.recalculate(a,this._availableImages),!We.isHidden(a.zoom)&&We.source&&(this.sourceCaches[We.source].used=!0)}for(var ot in oe){var je=this.sourceCaches[ot];oe[ot]!==je.used&&je.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ot}))}this.light.recalculate(a),this.z=a.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var a=Object.keys(this._changedImages);if(a.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}},u.prototype._updateWorkerLayers=function(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(a){var h=this;if(this._checkLoaded(),xo(this,p.validateStyle(a)))return!1;(a=p.clone$1(a)).layers=on(a.layers);var _=function(P,N){if(!P)return[{command:cn.setStyle,args:[N]}];var K=[];try{if(!p.deepEqual(P.version,N.version))return[{command:cn.setStyle,args:[N]}];p.deepEqual(P.center,N.center)||K.push({command:cn.setCenter,args:[N.center]}),p.deepEqual(P.zoom,N.zoom)||K.push({command:cn.setZoom,args:[N.zoom]}),p.deepEqual(P.bearing,N.bearing)||K.push({command:cn.setBearing,args:[N.bearing]}),p.deepEqual(P.pitch,N.pitch)||K.push({command:cn.setPitch,args:[N.pitch]}),p.deepEqual(P.sprite,N.sprite)||K.push({command:cn.setSprite,args:[N.sprite]}),p.deepEqual(P.glyphs,N.glyphs)||K.push({command:cn.setGlyphs,args:[N.glyphs]}),p.deepEqual(P.transition,N.transition)||K.push({command:cn.setTransition,args:[N.transition]}),p.deepEqual(P.light,N.light)||K.push({command:cn.setLight,args:[N.light]});var oe={},Ce=[];(function(Ie,Ke,We,ot){var je;for(je in Ke=Ke||{},Ie=Ie||{})Ie.hasOwnProperty(je)&&(Ke.hasOwnProperty(je)||xn(je,We,ot));for(je in Ke)Ke.hasOwnProperty(je)&&(Ie.hasOwnProperty(je)?p.deepEqual(Ie[je],Ke[je])||(Ie[je].type==="geojson"&&Ke[je].type==="geojson"&&$i(Ie,Ke,je)?We.push({command:cn.setGeoJSONSourceData,args:[je,Ke[je].data]}):Li(je,Ke,We,ot)):wi(je,Ke,We))})(P.sources,N.sources,Ce,oe);var we=[];P.layers&&P.layers.forEach(function(Ie){oe[Ie.source]?K.push({command:cn.removeLayer,args:[Ie.id]}):we.push(Ie)}),K=K.concat(Ce),function(Ie,Ke,We){Ke=Ke||[];var ot,je,st,wt,Wt,gr,cr,xr=(Ie=Ie||[]).map(Ji),zr=Ke.map(Ji),an=Ie.reduce(Ni,{}),Qr=Ke.reduce(Ni,{}),Cn=xr.slice(),ei=Object.create(null);for(ot=0,je=0;ot<xr.length;ot++)Qr.hasOwnProperty(st=xr[ot])?je++:(We.push({command:cn.removeLayer,args:[st]}),Cn.splice(Cn.indexOf(st,je),1));for(ot=0,je=0;ot<zr.length;ot++)Cn[Cn.length-1-ot]!==(st=zr[zr.length-1-ot])&&(an.hasOwnProperty(st)?(We.push({command:cn.removeLayer,args:[st]}),Cn.splice(Cn.lastIndexOf(st,Cn.length-je),1)):je++,We.push({command:cn.addLayer,args:[Qr[st],gr=Cn[Cn.length-ot]]}),Cn.splice(Cn.length-ot,0,st),ei[st]=!0);for(ot=0;ot<zr.length;ot++)if(wt=an[st=zr[ot]],Wt=Qr[st],!ei[st]&&!p.deepEqual(wt,Wt))if(p.deepEqual(wt.source,Wt.source)&&p.deepEqual(wt["source-layer"],Wt["source-layer"])&&p.deepEqual(wt.type,Wt.type)){for(cr in ai(wt.layout,Wt.layout,We,st,null,cn.setLayoutProperty),ai(wt.paint,Wt.paint,We,st,null,cn.setPaintProperty),p.deepEqual(wt.filter,Wt.filter)||We.push({command:cn.setFilter,args:[st,Wt.filter]}),p.deepEqual(wt.minzoom,Wt.minzoom)&&p.deepEqual(wt.maxzoom,Wt.maxzoom)||We.push({command:cn.setLayerZoomRange,args:[st,Wt.minzoom,Wt.maxzoom]}),wt)wt.hasOwnProperty(cr)&&cr!=="layout"&&cr!=="paint"&&cr!=="filter"&&cr!=="metadata"&&cr!=="minzoom"&&cr!=="maxzoom"&&(cr.indexOf("paint.")===0?ai(wt[cr],Wt[cr],We,st,cr.slice(6),cn.setPaintProperty):p.deepEqual(wt[cr],Wt[cr])||We.push({command:cn.setLayerProperty,args:[st,cr,Wt[cr]]}));for(cr in Wt)Wt.hasOwnProperty(cr)&&!wt.hasOwnProperty(cr)&&cr!=="layout"&&cr!=="paint"&&cr!=="filter"&&cr!=="metadata"&&cr!=="minzoom"&&cr!=="maxzoom"&&(cr.indexOf("paint.")===0?ai(wt[cr],Wt[cr],We,st,cr.slice(6),cn.setPaintProperty):p.deepEqual(wt[cr],Wt[cr])||We.push({command:cn.setLayerProperty,args:[st,cr,Wt[cr]]}))}else We.push({command:cn.removeLayer,args:[st]}),gr=Cn[Cn.lastIndexOf(st)+1],We.push({command:cn.addLayer,args:[Wt,gr]})}(we,N.layers,K)}catch(Ie){console.warn("Unable to compute style diff:",Ie),K=[{command:cn.setStyle,args:[N]}]}return K}(this.serialize(),a).filter(function(P){return!(P.command in Ds)});if(_.length===0)return!1;var C=_.filter(function(P){return!(P.command in Si)});if(C.length>0)throw new Error("Unimplemented: "+C.map(function(P){return P.command}).join(", ")+".");return _.forEach(function(P){P.command!=="setTransition"&&h[P.command].apply(h,P.args)}),this.stylesheet=a,!0},u.prototype.addImage=function(a,h){if(this.getImage(a))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(a,h),this._afterImageUpdated(a)},u.prototype.updateImage=function(a,h){this.imageManager.updateImage(a,h)},u.prototype.getImage=function(a){return this.imageManager.getImage(a)},u.prototype.removeImage=function(a){if(!this.getImage(a))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(a),this._afterImageUpdated(a)},u.prototype._afterImageUpdated=function(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(a,h,_){var C=this;if(_===void 0&&(_={}),this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+a,h,null,_))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var P=this.sourceCaches[a]=new Te(a,h,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:C.loaded(),source:P.serialize(),sourceId:a}}),P.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===a)return this.fire(new p.ErrorEvent(new Error('Source "'+a+'" cannot be removed while layer "'+h+'" is using it.')));var _=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],_.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),_.setEventedParent(null),_.clearTiles(),_.onRemove&&_.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(a,h){this._checkLoaded(),this.sourceCaches[a].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()},u.prototype.addLayer=function(a,h,_){_===void 0&&(_={}),this._checkLoaded();var C=a.id;if(this.getLayer(C))this.fire(new p.ErrorEvent(new Error('Layer with id "'+C+'" already exists on this map')));else{var P;if(a.type==="custom"){if(xo(this,p.validateCustomStyleLayer(a)))return;P=p.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(C,a.source),a=p.clone$1(a),a=p.extend(a,{source:C})),this._validate(p.validateStyle.layer,"layers."+C,a,{arrayIndex:-1},_))return;P=p.createStyleLayer(a),this._validateLayer(P),P.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[P.id]=P.serialize()}var N=h?this._order.indexOf(h):this._order.length;if(h&&N===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(N,0,C),this._layerOrderChanged=!0,this._layers[C]=P,this._removedLayers[C]&&P.source&&P.type!=="custom"){var K=this._removedLayers[C];delete this._removedLayers[C],K.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},u.prototype.moveLayer=function(a,h){if(this._checkLoaded(),this._changed=!0,this._layers[a]){if(a!==h){var _=this._order.indexOf(a);this._order.splice(_,1);var C=h?this._order.indexOf(h):this._order.length;h&&C===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(C,0,a),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(a){this._checkLoaded();var h=this._layers[a];if(h){h.setEventedParent(null);var _=this._order.indexOf(a);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(a){return this._layers[a]},u.prototype.hasLayer=function(a){return a in this._layers},u.prototype.setLayerZoomRange=function(a,h,_){this._checkLoaded();var C=this.getLayer(a);C?C.minzoom===h&&C.maxzoom===_||(h!=null&&(C.minzoom=h),_!=null&&(C.maxzoom=_),this._updateLayer(C)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(a,h,_){_===void 0&&(_={}),this._checkLoaded();var C=this.getLayer(a);if(C){if(!p.deepEqual(C.filter,h))return h==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(p.validateStyle.filter,"layers."+C.id+".filter",h,null,_)||(C.filter=p.clone$1(h),this._updateLayer(C)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(a){return p.clone$1(this.getLayer(a).filter)},u.prototype.setLayoutProperty=function(a,h,_,C){C===void 0&&(C={}),this._checkLoaded();var P=this.getLayer(a);P?p.deepEqual(P.getLayoutProperty(h),_)||(P.setLayoutProperty(h,_,C),this._updateLayer(P)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(a,h){var _=this.getLayer(a);if(_)return _.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(a,h,_,C){C===void 0&&(C={}),this._checkLoaded();var P=this.getLayer(a);P?p.deepEqual(P.getPaintProperty(h),_)||(P.setPaintProperty(h,_,C)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(a,h){return this.getLayer(a).getPaintProperty(h)},u.prototype.setFeatureState=function(a,h){this._checkLoaded();var _=a.source,C=a.sourceLayer,P=this.sourceCaches[_];if(P!==void 0){var N=P.getSource().type;N==="geojson"&&C?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):N!=="vector"||C?(a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(C,a.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(a,h){this._checkLoaded();var _=a.source,C=this.sourceCaches[_];if(C!==void 0){var P=C.getSource().type,N=P==="vector"?a.sourceLayer:void 0;P!=="vector"||N?h&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(N,a.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(a){this._checkLoaded();var h=a.source,_=a.sourceLayer,C=this.sourceCaches[h];if(C!==void 0){if(C.getSource().type!=="vector"||_)return a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),C.getFeatureState(_,a.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(a){return a.serialize()}),layers:this._serializeLayers(this._order)},function(a){return a!==void 0})},u.prototype._updateLayer=function(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(a){for(var h=this,_=function(an){return h._layers[an].type==="fill-extrusion"},C={},P=[],N=this._order.length-1;N>=0;N--){var K=this._order[N];if(_(K)){C[K]=N;for(var oe=0,Ce=a;oe<Ce.length;oe+=1){var we=Ce[oe][K];if(we)for(var Ie=0,Ke=we;Ie<Ke.length;Ie+=1)P.push(Ke[Ie])}}}P.sort(function(an,Qr){return Qr.intersectionZ-an.intersectionZ});for(var We=[],ot=this._order.length-1;ot>=0;ot--){var je=this._order[ot];if(_(je))for(var st=P.length-1;st>=0;st--){var wt=P[st].feature;if(C[wt.layer.id]<ot)break;We.push(wt),P.pop()}else for(var Wt=0,gr=a;Wt<gr.length;Wt+=1){var cr=gr[Wt][je];if(cr)for(var xr=0,zr=cr;xr<zr.length;xr+=1)We.push(zr[xr].feature)}}return We},u.prototype.queryRenderedFeatures=function(a,h,_){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var C={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,N=h.layers;P<N.length;P+=1){var K=N[P],oe=this._layers[K];if(!oe)return this.fire(new p.ErrorEvent(new Error("The layer '"+K+"' does not exist in the map's style and cannot be queried for features."))),[];C[oe.source]=!0}}var Ce=[];for(var we in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!C[we]||Ce.push(pn(this.sourceCaches[we],this._layers,this._serializedLayers,a,h,_));return this.placement&&Ce.push(function(Ie,Ke,We,ot,je,st,wt){for(var Wt={},gr=st.queryRenderedSymbols(ot),cr=[],xr=0,zr=Object.keys(gr).map(Number);xr<zr.length;xr+=1)cr.push(wt[zr[xr]]);cr.sort(Vi);for(var an=function(){var ri=Cn[Qr],ia=ri.featureIndex.lookupSymbolFeatures(gr[ri.bucketInstanceId],Ke,ri.bucketIndex,ri.sourceLayerIndex,je.filter,je.layers,je.availableImages,Ie);for(var Nn in ia){var _i=Wt[Nn]=Wt[Nn]||[],Zi=ia[Nn];Zi.sort(function(k,F){var ie=ri.featureSortOrder;if(ie){var Ae=ie.indexOf(k.featureIndex);return ie.indexOf(F.featureIndex)-Ae}return F.featureIndex-k.featureIndex});for(var q=0,te=Zi;q<te.length;q+=1)_i.push(te[q])}},Qr=0,Cn=cr;Qr<Cn.length;Qr+=1)an();var ei=function(ri){Wt[ri].forEach(function(ia){var Nn=ia.feature,_i=We[Ie[ri].source].getFeatureState(Nn.layer["source-layer"],Nn.id);Nn.source=Nn.layer.source,Nn.layer["source-layer"]&&(Nn.sourceLayer=Nn.layer["source-layer"]),Nn.state=_i})};for(var fi in Wt)ei(fi);return Wt}(this._layers,this._serializedLayers,this.sourceCaches,a,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Ce)},u.prototype.querySourceFeatures=function(a,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var _=this.sourceCaches[a];return _?function(C,P){for(var N=C.getRenderableIds().map(function(Ke){return C.getTileByID(Ke)}),K=[],oe={},Ce=0;Ce<N.length;Ce++){var we=N[Ce],Ie=we.tileID.canonical.key;oe[Ie]||(oe[Ie]=!0,we.querySourceFeatures(K,P))}return K}(_,h):[]},u.prototype.addSourceType=function(a,h,_){return u.getSourceType(a)?_(new Error('A source type called "'+a+'" already exists.')):(u.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},_):_(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(a,h){h===void 0&&(h={}),this._checkLoaded();var _=this.light.getLight(),C=!1;for(var P in a)if(!p.deepEqual(a[P],_[P])){C=!0;break}if(C){var N={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,h),this.light.updateTransitions(N)}},u.prototype._validate=function(a,h,_,C,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&xo(this,a.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:_,styleSpec:p.styleSpec},C)))},u.prototype._remove=function(){for(var a in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[a].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(a){this.sourceCaches[a].clearTiles()},u.prototype._reloadSource=function(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()},u.prototype._updateSources=function(a){for(var h in this.sourceCaches)this.sourceCaches[h].update(a)},u.prototype._generateCollisionBoxes=function(){for(var a in this.sourceCaches)this._reloadSource(a)},u.prototype._updatePlacement=function(a,h,_,C,P){P===void 0&&(P=!1);for(var N=!1,K=!1,oe={},Ce=0,we=this._order;Ce<we.length;Ce+=1){var Ie=this._layers[we[Ce]];if(Ie.type==="symbol"){if(!oe[Ie.source]){var Ke=this.sourceCaches[Ie.source];oe[Ie.source]=Ke.getRenderableIds(!0).map(function(wt){return Ke.getTileByID(wt)}).sort(function(wt,Wt){return Wt.tileID.overscaledZ-wt.tileID.overscaledZ||(wt.tileID.isLessThan(Wt.tileID)?-1:1)})}var We=this.crossTileSymbolIndex.addLayer(Ie,oe[Ie.source],a.center.lng);N=N||We}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),a.zoom))&&(this.pauseablePlacement=new Xs(a,this._order,P,h,_,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,oe),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),K=!0),N&&this.pauseablePlacement.placement.setStale()),K||N)for(var ot=0,je=this._order;ot<je.length;ot+=1){var st=this._layers[je[ot]];st.type==="symbol"&&this.placement.updateLayerOpacities(st,oe[st.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()},u.prototype.getImages=function(a,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();var C=this.sourceCaches[h.source];C&&C.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(a,h,_){this.glyphManager.getGlyphs(h.stacks,_)},u.prototype.getResource=function(a,h,_){return p.makeRequest(h,_)},u}(p.Evented);ps.getSourceType=function(n){return Rr[n]},ps.setSourceType=function(n,u){Rr[n]=u},ps.registerForPluginStateChange=p.registerForPluginStateChange;var wa=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),vo=ta(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ju=ta(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Sl=ta(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),wu=ta(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Ul=ta("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Vu=ta(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Tu=ta(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Na=ta("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Gu=ta("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),m=ta("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),w=ta(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),W=ta(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=ta(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),le=ta(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Le=ta(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),ct=ta(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Nt=ta(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),kt=ta(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Tr=ta(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Gr=ta(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Jn=ta(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Mi=ta(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),ci=ta(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ti=ta(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ui=ta(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Fa=ta(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ta(n,u){var a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),_=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=C?C.concat(_):_,N={};return{fragmentSource:n=n.replace(a,function(K,oe,Ce,we,Ie){return N[Ie]=!0,oe==="define"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
varying `+Ce+" "+we+" "+Ie+`;
#else
uniform `+Ce+" "+we+" u_"+Ie+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ie+`
    `+Ce+" "+we+" "+Ie+" = u_"+Ie+`;
#endif
`}),vertexSource:u=u.replace(a,function(K,oe,Ce,we,Ie){var Ke=we==="float"?"vec2":"vec4",We=Ie.match(/color/)?"color":Ke;return N[Ie]?oe==="define"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
uniform lowp float u_`+Ie+`_t;
attribute `+Ce+" "+Ke+" a_"+Ie+`;
varying `+Ce+" "+we+" "+Ie+`;
#else
uniform `+Ce+" "+we+" u_"+Ie+`;
#endif
`:We==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+Ie+" = a_"+Ie+`;
#else
    `+Ce+" "+we+" "+Ie+" = u_"+Ie+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+Ie+" = unpack_mix_"+We+"(a_"+Ie+", u_"+Ie+`_t);
#else
    `+Ce+" "+we+" "+Ie+" = u_"+Ie+`;
#endif
`:oe==="define"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
uniform lowp float u_`+Ie+`_t;
attribute `+Ce+" "+Ke+" a_"+Ie+`;
#else
uniform `+Ce+" "+we+" u_"+Ie+`;
#endif
`:We==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+Ce+" "+we+" "+Ie+" = a_"+Ie+`;
#else
    `+Ce+" "+we+" "+Ie+" = u_"+Ie+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+Ce+" "+we+" "+Ie+" = unpack_mix_"+We+"(a_"+Ie+", u_"+Ie+`_t);
#else
    `+Ce+" "+we+" "+Ie+" = u_"+Ie+`;
#endif
`}),staticAttributes:h,staticUniforms:P}}var ds=Object.freeze({__proto__:null,prelude:vo,background:ju,backgroundPattern:Sl,circle:wu,clippingMask:Ul,heatmap:Vu,heatmapTexture:Tu,collisionBox:Na,collisionCircle:Gu,debug:m,fill:w,fillOutline:W,fillOutlinePattern:R,fillPattern:le,fillExtrusion:Le,fillExtrusionPattern:ct,hillshadePrepare:Nt,hillshade:kt,line:Tr,lineGradient:Gr,linePattern:Jn,lineSDF:Mi,raster:ci,symbolIcon:Ti,symbolSDF:Ui,symbolTextAndIcon:Fa}),bo=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Ts(n){for(var u=[],a=0;a<n.length;a++)if(n[a]!==null){var h=n[a].split(" ");u.push(h.pop())}return u}bo.prototype.bind=function(n,u,a,h,_,C,P,N){this.context=n;for(var K=this.boundPaintVertexBuffers.length!==h.length,oe=0;!K&&oe<h.length;oe++)this.boundPaintVertexBuffers[oe]!==h[oe]&&(K=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===a&&!K&&this.boundIndexBuffer===_&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===N?(n.bindVertexArrayOES.set(this.vao),P&&P.bind(),_&&_.dynamicDraw&&_.bind(),N&&N.bind()):this.freshBind(u,a,h,_,C,P,N)},bo.prototype.freshBind=function(n,u,a,h,_,C,P){var N,K=n.numAttributes,oe=this.context,Ce=oe.gl;if(oe.extVertexArrayObject)this.vao&&this.destroy(),this.vao=oe.extVertexArrayObject.createVertexArrayOES(),oe.bindVertexArrayOES.set(this.vao),N=0,this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=h,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=P;else{N=oe.currentNumAttributes||0;for(var we=K;we<N;we++)Ce.disableVertexAttribArray(we)}u.enableAttributes(Ce,n);for(var Ie=0,Ke=a;Ie<Ke.length;Ie+=1)Ke[Ie].enableAttributes(Ce,n);C&&C.enableAttributes(Ce,n),P&&P.enableAttributes(Ce,n),u.bind(),u.setVertexAttribPointers(Ce,n,_);for(var We=0,ot=a;We<ot.length;We+=1){var je=ot[We];je.bind(),je.setVertexAttribPointers(Ce,n,_)}C&&(C.bind(),C.setVertexAttribPointers(Ce,n,_)),h&&h.bind(),P&&(P.bind(),P.setVertexAttribPointers(Ce,n,_)),oe.currentNumAttributes=K},bo.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var iu=function(n,u,a,h,_,C){var P=n.gl;this.program=P.createProgram();for(var N=Ts(a.staticAttributes),K=h?h.getBinderAttributes():[],oe=N.concat(K),Ce=a.staticUniforms?Ts(a.staticUniforms):[],we=h?h.getBinderUniforms():[],Ie=[],Ke=0,We=Ce.concat(we);Ke<We.length;Ke+=1){var ot=We[Ke];Ie.indexOf(ot)<0&&Ie.push(ot)}var je=h?h.defines():[];C&&je.push("#define OVERDRAW_INSPECTOR;");var st=je.concat(vo.fragmentSource,a.fragmentSource).join(`
`),wt=je.concat(vo.vertexSource,a.vertexSource).join(`
`),Wt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Wt,st),P.compileShader(Wt),P.attachShader(this.program,Wt);var gr=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(gr,wt),P.compileShader(gr),P.attachShader(this.program,gr),this.attributes={};var cr={};this.numAttributes=oe.length;for(var xr=0;xr<this.numAttributes;xr++)oe[xr]&&(P.bindAttribLocation(this.program,xr,oe[xr]),this.attributes[oe[xr]]=xr);P.linkProgram(this.program),P.deleteShader(gr),P.deleteShader(Wt);for(var zr=0;zr<Ie.length;zr++){var an=Ie[zr];if(an&&!cr[an]){var Qr=P.getUniformLocation(this.program,an);Qr&&(cr[an]=Qr)}}this.fixedUniforms=_(n,cr),this.binderUniforms=h?h.getUniforms(n,cr):[]}}};function Ns(n,u,a){var h=1/ea(a,1,u.transform.tileZoom),_=Math.pow(2,a.tileID.overscaledZ),C=a.tileSize*Math.pow(2,u.transform.tileZoom)/_,P=C*(a.tileID.canonical.x+a.tileID.wrap*_),N=C*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,n.fromScale,n.toScale],u_fade:n.t,u_pixel_coord_upper:[P>>16,N>>16],u_pixel_coord_lower:[65535&P,65535&N]}}iu.prototype.draw=function(n,u,a,h,_,C,P,N,K,oe,Ce,we,Ie,Ke,We,ot){var je,st=n.gl;if(!this.failedToCreate){for(var wt in n.program.set(this.program),n.setDepthMode(a),n.setStencilMode(h),n.setColorMode(_),n.setCullFace(C),this.fixedUniforms)this.fixedUniforms[wt].set(P[wt]);Ke&&Ke.setUniforms(n,this.binderUniforms,we,{zoom:Ie});for(var Wt=(je={},je[st.LINES]=2,je[st.TRIANGLES]=3,je[st.LINE_STRIP]=1,je)[u],gr=0,cr=Ce.get();gr<cr.length;gr+=1){var xr=cr[gr],zr=xr.vaos||(xr.vaos={});(zr[N]||(zr[N]=new bo)).bind(n,this,K,Ke?Ke.getPaintVertexBuffers():[],oe,xr.vertexOffset,We,ot),st.drawElements(u,xr.primitiveLength*Wt,st.UNSIGNED_SHORT,xr.primitiveOffset*Wt*2)}}};var il=function(n,u,a,h){var _=u.style.light,C=_.properties.get("position"),P=[C.x,C.y,C.z],N=p.create$1();_.properties.get("anchor")==="viewport"&&p.fromRotation(N,-u.transform.angle),p.transformMat3(P,P,N);var K=_.properties.get("color");return{u_matrix:n,u_lightpos:P,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+a,u_opacity:h}},Ys=function(n,u,a,h,_,C,P){return p.extend(il(n,u,a,h),Ns(C,u,P),{u_height_factor:-Math.pow(2,_.overscaledZ)/P.tileSize/8})},Ks=function(n){return{u_matrix:n}},$s=function(n,u,a,h){return p.extend(Ks(n),Ns(a,u,h))},so=function(n,u){return{u_matrix:n,u_world:u}},Au=function(n,u,a,h,_){return p.extend($s(n,u,a,h),{u_world:_})},al=function(n,u,a,h){var _,C,P=n.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var N=ea(a,1,P.zoom);_=!0,C=[N,N]}else _=!1,C=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:n.translatePosMatrix(u.posMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:C}},is=function(n,u,a){var h=ea(a,1,u.zoom),_=Math.pow(2,u.zoom-a.tileID.overscaledZ),C=a.tileID.overscaleFactor();return{u_matrix:n,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*_),u.pixelsToGLUnits[1]/(h*_)],u_overscale_factor:C}},Zl=function(n,u,a){return{u_matrix:n,u_inv_matrix:u,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}},au=function(n,u,a){return a===void 0&&(a=1),{u_matrix:n,u_color:u,u_overlay:0,u_overlay_scale:a}},zs=function(n){return{u_matrix:n}},cc=function(n,u,a,h){return{u_matrix:n,u_extrude_scale:ea(u,1,a),u_intensity:h}},Pu=function(n,u,a){var h=n.transform;return{u_matrix:fc(n,u,a),u_ratio:1/ea(u,1,h.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Pa=function(n,u,a,h){return p.extend(Pu(n,u,a),{u_image:0,u_image_height:h})},Hu=function(n,u,a,h){var _=n.transform,C=Mu(u,_);return{u_matrix:fc(n,u,a),u_texsize:u.imageAtlasTexture.size,u_ratio:1/ea(u,1,_.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[C,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},jl=function(n,u,a,h,_){var C=n.lineAtlas,P=Mu(u,n.transform),N=a.layout.get("line-cap")==="round",K=C.getDash(h.from,N),oe=C.getDash(h.to,N),Ce=K.width*_.fromScale,we=oe.width*_.toScale;return p.extend(Pu(n,u,a),{u_patternscale_a:[P/Ce,-K.height/2],u_patternscale_b:[P/we,-oe.height/2],u_sdfgamma:C.width/(256*Math.min(Ce,we)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:K.y,u_tex_y_b:oe.y,u_mix:_.t})};function Mu(n,u){return 1/ea(n,1,u.tileZoom)}function fc(n,u,a){return n.translatePosMatrix(u.tileID.posMatrix,u,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}var hf=function(n,u,a,h,_){return{u_matrix:n,u_tl_parent:u,u_scale_parent:a,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(P=_.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(C=_.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:El(_.paint.get("raster-hue-rotate"))};var C,P};function El(n){n*=Math.PI/180;var u=Math.sin(n),a=Math.cos(n);return[(2*a+1)/3,(-Math.sqrt(3)*u-a+1)/3,(Math.sqrt(3)*u-a+1)/3]}var hc,Cl=function(n,u,a,h,_,C,P,N,K,oe){var Ce=_.transform;return{u_is_size_zoom_constant:+(n==="constant"||n==="source"),u_is_size_feature_constant:+(n==="constant"||n==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:Ce.cameraToCenterDistance,u_pitch:Ce.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:Ce.width/Ce.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:P,u_coord_matrix:N,u_is_text:+K,u_pitch_with_map:+h,u_texsize:oe,u_texture:0}},vu=function(n,u,a,h,_,C,P,N,K,oe,Ce){var we=_.transform;return p.extend(Cl(n,u,a,h,_,C,P,N,K,oe),{u_gamma_scale:h?Math.cos(we._pitch)*we.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+Ce})},ol=function(n,u,a,h,_,C,P,N,K,oe){return p.extend(vu(n,u,a,h,_,C,P,N,!0,K,!0),{u_texsize_icon:oe,u_texture_icon:1})},sl=function(n,u,a){return{u_matrix:n,u_opacity:u,u_color:a}},Wu=function(n,u,a,h,_,C){return p.extend(function(P,N,K,oe){var Ce=K.imageManager.getPattern(P.from.toString()),we=K.imageManager.getPattern(P.to.toString()),Ie=K.imageManager.getPixelSize(),Ke=Ie.width,We=Ie.height,ot=Math.pow(2,oe.tileID.overscaledZ),je=oe.tileSize*Math.pow(2,K.transform.tileZoom)/ot,st=je*(oe.tileID.canonical.x+oe.tileID.wrap*ot),wt=je*oe.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Ce.tl,u_pattern_br_a:Ce.br,u_pattern_tl_b:we.tl,u_pattern_br_b:we.br,u_texsize:[Ke,We],u_mix:N.t,u_pattern_size_a:Ce.displaySize,u_pattern_size_b:we.displaySize,u_scale_a:N.fromScale,u_scale_b:N.toScale,u_tile_units_to_pixels:1/ea(oe,1,K.transform.tileZoom),u_pixel_coord_upper:[st>>16,wt>>16],u_pixel_coord_lower:[65535&st,65535&wt]}}(h,C,a,_),{u_matrix:n,u_opacity:u})},ul={fillExtrusion:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_lightpos:new p.Uniform3f(n,u.u_lightpos),u_lightintensity:new p.Uniform1f(n,u.u_lightintensity),u_lightcolor:new p.Uniform3f(n,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,u.u_vertical_gradient),u_opacity:new p.Uniform1f(n,u.u_opacity)}},fillExtrusionPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_lightpos:new p.Uniform3f(n,u.u_lightpos),u_lightintensity:new p.Uniform1f(n,u.u_lightintensity),u_lightcolor:new p.Uniform3f(n,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,u.u_vertical_gradient),u_height_factor:new p.Uniform1f(n,u.u_height_factor),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade),u_opacity:new p.Uniform1f(n,u.u_opacity)}},fill:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},fillPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},fillOutline:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world)}},fillOutlinePattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},circle:function(n,u){return{u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(n,u.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(n,u.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},collisionBox:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(n,u.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(n,u.u_extrude_scale),u_overscale_factor:new p.Uniform1f(n,u.u_overscale_factor)}},collisionCircle:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_inv_matrix:new p.UniformMatrix4f(n,u.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(n,u.u_viewport_size)}},debug:function(n,u){return{u_color:new p.UniformColor(n,u.u_color),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_overlay:new p.Uniform1i(n,u.u_overlay),u_overlay_scale:new p.Uniform1f(n,u.u_overlay_scale)}},clippingMask:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},heatmap:function(n,u){return{u_extrude_scale:new p.Uniform1f(n,u.u_extrude_scale),u_intensity:new p.Uniform1f(n,u.u_intensity),u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},heatmapTexture:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world),u_image:new p.Uniform1i(n,u.u_image),u_color_ramp:new p.Uniform1i(n,u.u_color_ramp),u_opacity:new p.Uniform1f(n,u.u_opacity)}},hillshade:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_latrange:new p.Uniform2f(n,u.u_latrange),u_light:new p.Uniform2f(n,u.u_light),u_shadow:new p.UniformColor(n,u.u_shadow),u_highlight:new p.UniformColor(n,u.u_highlight),u_accent:new p.UniformColor(n,u.u_accent)}},hillshadePrepare:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_dimension:new p.Uniform2f(n,u.u_dimension),u_zoom:new p.Uniform1f(n,u.u_zoom),u_unpack:new p.Uniform4f(n,u.u_unpack)}},line:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels)}},lineGradient:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_image:new p.Uniform1i(n,u.u_image),u_image_height:new p.Uniform1f(n,u.u_image_height)}},linePattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_texsize:new p.Uniform2f(n,u.u_texsize),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_image:new p.Uniform1i(n,u.u_image),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},lineSDF:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(n,u.u_patternscale_a),u_patternscale_b:new p.Uniform2f(n,u.u_patternscale_b),u_sdfgamma:new p.Uniform1f(n,u.u_sdfgamma),u_image:new p.Uniform1i(n,u.u_image),u_tex_y_a:new p.Uniform1f(n,u.u_tex_y_a),u_tex_y_b:new p.Uniform1f(n,u.u_tex_y_b),u_mix:new p.Uniform1f(n,u.u_mix)}},raster:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_tl_parent:new p.Uniform2f(n,u.u_tl_parent),u_scale_parent:new p.Uniform1f(n,u.u_scale_parent),u_buffer_scale:new p.Uniform1f(n,u.u_buffer_scale),u_fade_t:new p.Uniform1f(n,u.u_fade_t),u_opacity:new p.Uniform1f(n,u.u_opacity),u_image0:new p.Uniform1i(n,u.u_image0),u_image1:new p.Uniform1i(n,u.u_image1),u_brightness_low:new p.Uniform1f(n,u.u_brightness_low),u_brightness_high:new p.Uniform1f(n,u.u_brightness_high),u_saturation_factor:new p.Uniform1f(n,u.u_saturation_factor),u_contrast_factor:new p.Uniform1f(n,u.u_contrast_factor),u_spin_weights:new p.Uniform3f(n,u.u_spin_weights)}},symbolIcon:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texture:new p.Uniform1i(n,u.u_texture)}},symbolSDF:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texture:new p.Uniform1i(n,u.u_texture),u_gamma_scale:new p.Uniform1f(n,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,u.u_is_halo)}},symbolTextAndIcon:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texsize_icon:new p.Uniform2f(n,u.u_texsize_icon),u_texture:new p.Uniform1i(n,u.u_texture),u_texture_icon:new p.Uniform1i(n,u.u_texture_icon),u_gamma_scale:new p.Uniform1f(n,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,u.u_is_halo)}},background:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_opacity:new p.Uniform1f(n,u.u_opacity),u_color:new p.UniformColor(n,u.u_color)}},backgroundPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_opacity:new p.Uniform1f(n,u.u_opacity),u_image:new p.Uniform1i(n,u.u_image),u_pattern_tl_a:new p.Uniform2f(n,u.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(n,u.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(n,u.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(n,u.u_pattern_br_b),u_texsize:new p.Uniform2f(n,u.u_texsize),u_mix:new p.Uniform1f(n,u.u_mix),u_pattern_size_a:new p.Uniform2f(n,u.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(n,u.u_pattern_size_b),u_scale_a:new p.Uniform1f(n,u.u_scale_a),u_scale_b:new p.Uniform1f(n,u.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(n,u.u_tile_units_to_pixels)}}};function Xu(n,u,a,h,_,C,P){for(var N=n.context,K=N.gl,oe=n.useProgram("collisionBox"),Ce=[],we=0,Ie=0,Ke=0;Ke<h.length;Ke++){var We=h[Ke],ot=u.getTile(We),je=ot.getBucket(a);if(je){var st=We.posMatrix;_[0]===0&&_[1]===0||(st=n.translatePosMatrix(We.posMatrix,ot,_,C));var wt=P?je.textCollisionBox:je.iconCollisionBox,Wt=je.collisionCircleArray;if(Wt.length>0){var gr=p.create(),cr=st;p.mul(gr,je.placementInvProjMatrix,n.transform.glCoordMatrix),p.mul(gr,gr,je.placementViewportMatrix),Ce.push({circleArray:Wt,circleOffset:Ie,transform:cr,invTransform:gr}),Ie=we+=Wt.length/4}wt&&oe.draw(N,K.LINES,j.disabled,se.disabled,n.colorModeForRenderPass(),Me.disabled,is(st,n.transform,ot),a.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,null,n.transform.zoom,null,null,wt.collisionVertexBuffer)}}if(P&&Ce.length){var xr=n.useProgram("collisionCircle"),zr=new p.StructArrayLayout2f1f2i16;zr.resize(4*we),zr._trim();for(var an=0,Qr=0,Cn=Ce;Qr<Cn.length;Qr+=1)for(var ei=Cn[Qr],fi=0;fi<ei.circleArray.length/4;fi++){var ri=4*fi,ia=ei.circleArray[ri+0],Nn=ei.circleArray[ri+1],_i=ei.circleArray[ri+2],Zi=ei.circleArray[ri+3];zr.emplace(an++,ia,Nn,_i,Zi,0),zr.emplace(an++,ia,Nn,_i,Zi,1),zr.emplace(an++,ia,Nn,_i,Zi,2),zr.emplace(an++,ia,Nn,_i,Zi,3)}(!hc||hc.length<2*we)&&(hc=function(ft){var Vt=2*ft,Tt=new p.StructArrayLayout3ui6;Tt.resize(Vt),Tt._trim();for(var qt=0;qt<Vt;qt++){var Lr=6*qt;Tt.uint16[Lr+0]=4*qt+0,Tt.uint16[Lr+1]=4*qt+1,Tt.uint16[Lr+2]=4*qt+2,Tt.uint16[Lr+3]=4*qt+2,Tt.uint16[Lr+4]=4*qt+3,Tt.uint16[Lr+5]=4*qt+0}return Tt}(we));for(var q=N.createIndexBuffer(hc,!0),te=N.createVertexBuffer(zr,p.collisionCircleLayout.members,!0),k=0,F=Ce;k<F.length;k+=1){var ie=F[k],Ae=Zl(ie.transform,ie.invTransform,n.transform);xr.draw(N,K.TRIANGLES,j.disabled,se.disabled,n.colorModeForRenderPass(),Me.disabled,Ae,a.id,te,q,p.SegmentVector.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,n.transform.zoom,null,null,null)}te.destroy(),q.destroy()}}var Us=p.identity(new Float32Array(16));function pc(n,u,a,h,_,C){var P=p.getAnchorAlignment(n),N=-(P.horizontalAlign-.5)*u,K=-(P.verticalAlign-.5)*a,oe=p.evaluateVariableOffset(n,h);return new p.Point((N/_+oe[0])*C,(K/_+oe[1])*C)}function dc(n,u,a,h,_,C,P,N,K,oe,Ce){var we=n.text.placedSymbolArray,Ie=n.text.dynamicLayoutVertexArray,Ke=n.icon.dynamicLayoutVertexArray,We={};Ie.clear();for(var ot=0;ot<we.length;ot++){var je=we.get(ot),st=je.hidden||!je.crossTileID||n.allowVerticalPlacement&&!je.placedOrientation?null:h[je.crossTileID];if(st){var wt=new p.Point(je.anchorX,je.anchorY),Wt=ti(wt,a?N:P),gr=Xi(C.cameraToCenterDistance,Wt.signedDistanceFromCamera),cr=_.evaluateSizeForFeature(n.textSizeData,oe,je)*gr/p.ONE_EM;a&&(cr*=n.tilePixelRatio/K);for(var xr=pc(st.anchor,st.width,st.height,st.textOffset,st.textBoxScale,cr),zr=a?ti(wt.add(xr),P).point:Wt.point.add(u?xr.rotate(-C.angle):xr),an=n.allowVerticalPlacement&&je.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,Qr=0;Qr<je.numGlyphs;Qr++)p.addDynamicAttributes(Ie,zr,an);Ce&&je.associatedIconIndex>=0&&(We[je.associatedIconIndex]={shiftedAnchor:zr,angle:an})}else zi(je.numGlyphs,Ie)}if(Ce){Ke.clear();for(var Cn=n.icon.placedSymbolArray,ei=0;ei<Cn.length;ei++){var fi=Cn.get(ei);if(fi.hidden)zi(fi.numGlyphs,Ke);else{var ri=We[ei];if(ri)for(var ia=0;ia<fi.numGlyphs;ia++)p.addDynamicAttributes(Ke,ri.shiftedAnchor,ri.angle);else zi(fi.numGlyphs,Ke)}}n.icon.dynamicLayoutVertexBuffer.updateData(Ke)}n.text.dynamicLayoutVertexBuffer.updateData(Ie)}function kc(n,u,a){return a.iconsInText&&u?"symbolTextAndIcon":n?"symbolSDF":"symbolIcon"}function Yu(n,u,a,h,_,C,P,N,K,oe,Ce,we){for(var Ie=n.context,Ke=Ie.gl,We=n.transform,ot=N==="map",je=K==="map",st=ot&&a.layout.get("symbol-placement")!=="point",wt=ot&&!je&&!st,Wt=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,gr=!1,cr=n.depthModeForSublayer(0,j.ReadOnly),xr=a.layout.get("text-variable-anchor"),zr=[],an=0,Qr=h;an<Qr.length;an+=1){var Cn=Qr[an],ei=u.getTile(Cn),fi=ei.getBucket(a);if(fi){var ri=_?fi.text:fi.icon;if(ri&&ri.segments.get().length){var ia=ri.programConfigurations.get(a.id),Nn=_||fi.sdfIcons,_i=_?fi.textSizeData:fi.iconSizeData,Zi=je||We.pitch!==0,q=n.useProgram(kc(Nn,_,fi),ia),te=p.evaluateSizeForZoom(_i,We.zoom),k=void 0,F=[0,0],ie=void 0,Ae=void 0,ft=null,Vt=void 0;if(_)ie=ei.glyphAtlasTexture,Ae=Ke.LINEAR,k=ei.glyphAtlasTexture.size,fi.iconsInText&&(F=ei.imageAtlasTexture.size,ft=ei.imageAtlasTexture,Vt=Zi||n.options.rotating||n.options.zooming||_i.kind==="composite"||_i.kind==="camera"?Ke.LINEAR:Ke.NEAREST);else{var Tt=a.layout.get("icon-size").constantOr(0)!==1||fi.iconsNeedLinear;ie=ei.imageAtlasTexture,Ae=Nn||n.options.rotating||n.options.zooming||Tt||Zi?Ke.LINEAR:Ke.NEAREST,k=ei.imageAtlasTexture.size}var qt=ea(ei,1,n.transform.zoom),Lr=Ca(Cn.posMatrix,je,ot,n.transform,qt),In=ii(Cn.posMatrix,je,ot,n.transform,qt),Fn=xr&&fi.hasTextData(),oi=a.layout.get("icon-text-fit")!=="none"&&Fn&&fi.hasIconData();st&&Vo(fi,Cn.posMatrix,n,_,Lr,In,je,oe);var ui=n.translatePosMatrix(Cn.posMatrix,ei,C,P),mi=st||_&&xr||oi?Us:Lr,Gi=n.translatePosMatrix(In,ei,C,P,!0),ma=Nn&&a.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ya={program:q,buffers:ri,uniformValues:Nn?fi.iconsInText?ol(_i.kind,te,wt,je,n,ui,mi,Gi,k,F):vu(_i.kind,te,wt,je,n,ui,mi,Gi,_,k,!0):Cl(_i.kind,te,wt,je,n,ui,mi,Gi,_,k),atlasTexture:ie,atlasTextureIcon:ft,atlasInterpolation:Ae,atlasInterpolationIcon:Vt,isSDF:Nn,hasHalo:ma};if(Wt&&fi.canOverlap){gr=!0;for(var ro=0,Oa=ri.segments.get();ro<Oa.length;ro+=1){var mo=Oa[ro];zr.push({segments:new p.SegmentVector([mo]),sortKey:mo.sortKey,state:ya})}}else zr.push({segments:ri.segments,sortKey:0,state:ya})}}}gr&&zr.sort(function(Za,ko){return Za.sortKey-ko.sortKey});for(var Ma=0,ga=zr;Ma<ga.length;Ma+=1){var aa=ga[Ma],pa=aa.state;if(Ie.activeTexture.set(Ke.TEXTURE0),pa.atlasTexture.bind(pa.atlasInterpolation,Ke.CLAMP_TO_EDGE),pa.atlasTextureIcon&&(Ie.activeTexture.set(Ke.TEXTURE1),pa.atlasTextureIcon&&pa.atlasTextureIcon.bind(pa.atlasInterpolationIcon,Ke.CLAMP_TO_EDGE)),pa.isSDF){var Ua=pa.uniformValues;pa.hasHalo&&(Ua.u_is_halo=1,wl(pa.buffers,aa.segments,a,n,pa.program,cr,Ce,we,Ua)),Ua.u_is_halo=0}wl(pa.buffers,aa.segments,a,n,pa.program,cr,Ce,we,pa.uniformValues)}}function wl(n,u,a,h,_,C,P,N,K){var oe=h.context;_.draw(oe,oe.gl.TRIANGLES,C,P,N,Me.disabled,K,a.id,n.layoutVertexBuffer,n.indexBuffer,u,a.paint,h.transform.zoom,n.programConfigurations.get(a.id),n.dynamicLayoutVertexBuffer,n.opacityVertexBuffer)}function Vl(n,u,a,h,_,C,P){var N,K,oe,Ce,we,Ie=n.context.gl,Ke=a.paint.get("fill-pattern"),We=Ke&&Ke.constantOr(1),ot=a.getCrossfadeParameters();P?(K=We&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=Ie.LINES):(K=We?"fillPattern":"fill",N=Ie.TRIANGLES);for(var je=0,st=h;je<st.length;je+=1){var wt=st[je],Wt=u.getTile(wt);if(!We||Wt.patternsLoaded()){var gr=Wt.getBucket(a);if(gr){var cr=gr.programConfigurations.get(a.id),xr=n.useProgram(K,cr);We&&(n.context.activeTexture.set(Ie.TEXTURE0),Wt.imageAtlasTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),cr.updatePaintBuffers(ot));var zr=Ke.constantOr(null);if(zr&&Wt.imageAtlas){var an=Wt.imageAtlas,Qr=an.patternPositions[zr.to.toString()],Cn=an.patternPositions[zr.from.toString()];Qr&&Cn&&cr.setConstantPatternPositions(Qr,Cn)}var ei=n.translatePosMatrix(wt.posMatrix,Wt,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(P){Ce=gr.indexBuffer2,we=gr.segments2;var fi=[Ie.drawingBufferWidth,Ie.drawingBufferHeight];oe=K==="fillOutlinePattern"&&We?Au(ei,n,ot,Wt,fi):so(ei,fi)}else Ce=gr.indexBuffer,we=gr.segments,oe=We?$s(ei,n,ot,Wt):Ks(ei);xr.draw(n.context,N,_,n.stencilModeForClipping(wt),C,Me.disabled,oe,a.id,gr.layoutVertexBuffer,Ce,we,a.paint,n.transform.zoom,cr)}}}}function vc(n,u,a,h,_,C,P){for(var N=n.context,K=N.gl,oe=a.paint.get("fill-extrusion-pattern"),Ce=oe.constantOr(1),we=a.getCrossfadeParameters(),Ie=a.paint.get("fill-extrusion-opacity"),Ke=0,We=h;Ke<We.length;Ke+=1){var ot=We[Ke],je=u.getTile(ot),st=je.getBucket(a);if(st){var wt=st.programConfigurations.get(a.id),Wt=n.useProgram(Ce?"fillExtrusionPattern":"fillExtrusion",wt);Ce&&(n.context.activeTexture.set(K.TEXTURE0),je.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),wt.updatePaintBuffers(we));var gr=oe.constantOr(null);if(gr&&je.imageAtlas){var cr=je.imageAtlas,xr=cr.patternPositions[gr.to.toString()],zr=cr.patternPositions[gr.from.toString()];xr&&zr&&wt.setConstantPatternPositions(xr,zr)}var an=n.translatePosMatrix(ot.posMatrix,je,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Qr=a.paint.get("fill-extrusion-vertical-gradient"),Cn=Ce?Ys(an,n,Qr,Ie,ot,we,je):il(an,n,Qr,Ie);Wt.draw(N,N.gl.TRIANGLES,_,C,P,Me.backCCW,Cn,a.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,a.paint,n.transform.zoom,wt)}}}function Gl(n,u,a,h,_,C){var P=n.context,N=P.gl,K=u.fbo;if(K){var oe=n.useProgram("hillshade");P.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,K.colorAttachment.get());var Ce=function(we,Ie,Ke){var We=Ke.paint.get("hillshade-shadow-color"),ot=Ke.paint.get("hillshade-highlight-color"),je=Ke.paint.get("hillshade-accent-color"),st=Ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(st-=we.transform.angle);var wt,Wt,gr,cr=!we.options.moving;return{u_matrix:we.transform.calculatePosMatrix(Ie.tileID.toUnwrapped(),cr),u_image:0,u_latrange:(wt=Ie.tileID,Wt=Math.pow(2,wt.canonical.z),gr=wt.canonical.y,[new p.MercatorCoordinate(0,gr/Wt).toLngLat().lat,new p.MercatorCoordinate(0,(gr+1)/Wt).toLngLat().lat]),u_light:[Ke.paint.get("hillshade-exaggeration"),st],u_shadow:We,u_highlight:ot,u_accent:je}}(n,u,a);oe.draw(P,N.TRIANGLES,h,_,C,Me.disabled,Ce,a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}}function Hl(n,u,a,h,_,C){var P=n.context,N=P.gl,K=u.dem;if(K&&K.data){var oe=K.dim,Ce=K.stride,we=K.getPixels();if(P.activeTexture.set(N.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||n.getTileTexture(Ce),u.demTexture){var Ie=u.demTexture;Ie.update(we,{premultiply:!1}),Ie.bind(N.NEAREST,N.CLAMP_TO_EDGE)}else u.demTexture=new p.Texture(P,we,N.RGBA,{premultiply:!1}),u.demTexture.bind(N.NEAREST,N.CLAMP_TO_EDGE);P.activeTexture.set(N.TEXTURE0);var Ke=u.fbo;if(!Ke){var We=new p.Texture(P,{width:oe,height:oe,data:null},N.RGBA);We.bind(N.LINEAR,N.CLAMP_TO_EDGE),(Ke=u.fbo=P.createFramebuffer(oe,oe,!0)).colorAttachment.set(We.texture)}P.bindFramebuffer.set(Ke.framebuffer),P.viewport.set([0,0,oe,oe]),n.useProgram("hillshadePrepare").draw(P,N.TRIANGLES,h,_,C,Me.disabled,function(ot,je){var st=je.stride,wt=p.create();return p.ortho(wt,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(wt,wt,[0,-p.EXTENT,0]),{u_matrix:wt,u_image:1,u_dimension:[st,st],u_zoom:ot.overscaledZ,u_unpack:je.getUnpackVector()}}(u.tileID,K),a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function Iu(n,u,a,h,_){var C=h.paint.get("raster-fade-duration");if(C>0){var P=p.browser.now(),N=(P-n.timeAdded)/C,K=u?(P-u.timeAdded)/C:-1,oe=a.getSource(),Ce=_.coveringZoomLevel({tileSize:oe.tileSize,roundZoom:oe.roundZoom}),we=!u||Math.abs(u.tileID.overscaledZ-Ce)>Math.abs(n.tileID.overscaledZ-Ce),Ie=we&&n.refreshedUponExpiration?1:p.clamp(we?N:1-K,0,1);return n.refreshedUponExpiration&&N>=1&&(n.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Ie}:{opacity:Ie,mix:0}}return{opacity:1,mix:0}}var Ou=new p.Color(1,0,0,1),Wl=new p.Color(0,1,0,1),Ha=new p.Color(0,0,1,1),mu=new p.Color(1,0,1,1),Xl=new p.Color(0,1,1,1);function ll(n,u,a,h){Lu(n,0,u+a/2,n.transform.width,a,h)}function Yl(n,u,a,h){Lu(n,u-a/2,0,a,n.transform.height,h)}function Lu(n,u,a,h,_,C){var P=n.context,N=P.gl;N.enable(N.SCISSOR_TEST),N.scissor(u*p.browser.devicePixelRatio,a*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,_*p.browser.devicePixelRatio),P.clear({color:C}),N.disable(N.SCISSOR_TEST)}function Kc(n,u,a){var h=n.context,_=h.gl,C=a.posMatrix,P=n.useProgram("debug"),N=j.disabled,K=se.disabled,oe=n.colorModeForRenderPass();h.activeTexture.set(_.TEXTURE0),n.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),P.draw(h,_.LINE_STRIP,N,K,oe,Me.disabled,au(C,p.Color.red),"$debug",n.debugBuffer,n.tileBorderIndexBuffer,n.debugSegments);var Ce=u.getTileByID(a.key).latestRawTileData,we=Math.floor((Ce&&Ce.byteLength||0)/1024),Ie=u.getTile(a).tileSize,Ke=512/Math.min(Ie,512)*(a.overscaledZ/n.transform.zoom)*.5,We=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(We+=" => "+a.overscaledZ),function(ot,je){ot.initDebugOverlayCanvas();var st=ot.debugOverlayCanvas,wt=ot.context.gl,Wt=ot.debugOverlayCanvas.getContext("2d");Wt.clearRect(0,0,st.width,st.height),Wt.shadowColor="white",Wt.shadowBlur=2,Wt.lineWidth=1.5,Wt.strokeStyle="white",Wt.textBaseline="top",Wt.font="bold 36px Open Sans, sans-serif",Wt.fillText(je,5,5),Wt.strokeText(je,5,5),ot.debugOverlayTexture.update(st),ot.debugOverlayTexture.bind(wt.LINEAR,wt.CLAMP_TO_EDGE)}(n,We+" "+we+"kb"),P.draw(h,_.TRIANGLES,N,K,de.alphaBlended,Me.disabled,au(C,p.Color.transparent,Ke),"$debug",n.debugBuffer,n.quadTriangleIndexBuffer,n.debugSegments)}var cl={symbol:function(n,u,a,h,_){if(n.renderPass==="translucent"){var C=se.disabled,P=n.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(N,K,oe,Ce,we,Ie,Ke){for(var We=K.transform,ot=we==="map",je=Ie==="map",st=0,wt=N;st<wt.length;st+=1){var Wt=wt[st],gr=Ce.getTile(Wt),cr=gr.getBucket(oe);if(cr&&cr.text&&cr.text.segments.get().length){var xr=p.evaluateSizeForZoom(cr.textSizeData,We.zoom),zr=ea(gr,1,K.transform.zoom),an=Ca(Wt.posMatrix,je,ot,K.transform,zr),Qr=oe.layout.get("icon-text-fit")!=="none"&&cr.hasIconData();if(xr){var Cn=Math.pow(2,We.zoom-gr.tileID.overscaledZ);dc(cr,ot,je,Ke,p.symbolSize,We,an,Wt.posMatrix,Cn,xr,Qr)}}}}(h,n,a,u,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),_),a.paint.get("icon-opacity").constantOr(1)!==0&&Yu(n,u,a,h,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),C,P),a.paint.get("text-opacity").constantOr(1)!==0&&Yu(n,u,a,h,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),C,P),u.map.showCollisionBoxes&&(Xu(n,u,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Xu(n,u,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))}},circle:function(n,u,a,h){if(n.renderPass==="translucent"){var _=a.paint.get("circle-opacity"),C=a.paint.get("circle-stroke-width"),P=a.paint.get("circle-stroke-opacity"),N=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)!==0||C.constantOr(1)!==0&&P.constantOr(1)!==0){for(var K=n.context,oe=K.gl,Ce=n.depthModeForSublayer(0,j.ReadOnly),we=se.disabled,Ie=n.colorModeForRenderPass(),Ke=[],We=0;We<h.length;We++){var ot=h[We],je=u.getTile(ot),st=je.getBucket(a);if(st){var wt=st.programConfigurations.get(a.id),Wt={programConfiguration:wt,program:n.useProgram("circle",wt),layoutVertexBuffer:st.layoutVertexBuffer,indexBuffer:st.indexBuffer,uniformValues:al(n,ot,je,a)};if(N)for(var gr=0,cr=st.segments.get();gr<cr.length;gr+=1){var xr=cr[gr];Ke.push({segments:new p.SegmentVector([xr]),sortKey:xr.sortKey,state:Wt})}else Ke.push({segments:st.segments,sortKey:0,state:Wt})}}N&&Ke.sort(function(ei,fi){return ei.sortKey-fi.sortKey});for(var zr=0,an=Ke;zr<an.length;zr+=1){var Qr=an[zr],Cn=Qr.state;Cn.program.draw(K,oe.TRIANGLES,Ce,we,Ie,Me.disabled,Cn.uniformValues,a.id,Cn.layoutVertexBuffer,Cn.indexBuffer,Qr.segments,a.paint,n.transform.zoom,Cn.programConfiguration)}}}},heatmap:function(n,u,a,h){if(a.paint.get("heatmap-opacity")!==0)if(n.renderPass==="offscreen"){var _=n.context,C=_.gl,P=se.disabled,N=new de([C.ONE,C.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Ke,We,ot){var je=Ke.gl;Ke.activeTexture.set(je.TEXTURE1),Ke.viewport.set([0,0,We.width/4,We.height/4]);var st=ot.heatmapFbo;if(st)je.bindTexture(je.TEXTURE_2D,st.colorAttachment.get()),Ke.bindFramebuffer.set(st.framebuffer);else{var wt=je.createTexture();je.bindTexture(je.TEXTURE_2D,wt),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_WRAP_S,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_WRAP_T,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_MIN_FILTER,je.LINEAR),je.texParameteri(je.TEXTURE_2D,je.TEXTURE_MAG_FILTER,je.LINEAR),st=ot.heatmapFbo=Ke.createFramebuffer(We.width/4,We.height/4,!1),function(Wt,gr,cr,xr){var zr=Wt.gl;zr.texImage2D(zr.TEXTURE_2D,0,zr.RGBA,gr.width/4,gr.height/4,0,zr.RGBA,Wt.extRenderToTextureHalfFloat?Wt.extTextureHalfFloat.HALF_FLOAT_OES:zr.UNSIGNED_BYTE,null),xr.colorAttachment.set(cr)}(Ke,We,wt,st)}})(_,n,a),_.clear({color:p.Color.transparent});for(var K=0;K<h.length;K++){var oe=h[K];if(!u.hasRenderableParent(oe)){var Ce=u.getTile(oe),we=Ce.getBucket(a);if(we){var Ie=we.programConfigurations.get(a.id);n.useProgram("heatmap",Ie).draw(_,C.TRIANGLES,j.disabled,P,N,Me.disabled,cc(oe.posMatrix,Ce,n.transform.zoom,a.paint.get("heatmap-intensity")),a.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,a.paint,n.transform.zoom,Ie)}}}_.viewport.set([0,0,n.width,n.height])}else n.renderPass==="translucent"&&(n.context.setColorMode(n.colorModeForRenderPass()),function(Ke,We){var ot=Ke.context,je=ot.gl,st=We.heatmapFbo;if(st){ot.activeTexture.set(je.TEXTURE0),je.bindTexture(je.TEXTURE_2D,st.colorAttachment.get()),ot.activeTexture.set(je.TEXTURE1);var wt=We.colorRampTexture;wt||(wt=We.colorRampTexture=new p.Texture(ot,We.colorRamp,je.RGBA)),wt.bind(je.LINEAR,je.CLAMP_TO_EDGE),Ke.useProgram("heatmapTexture").draw(ot,je.TRIANGLES,j.disabled,se.disabled,Ke.colorModeForRenderPass(),Me.disabled,function(Wt,gr,cr,xr){var zr=p.create();p.ortho(zr,0,Wt.width,Wt.height,0,0,1);var an=Wt.context.gl;return{u_matrix:zr,u_world:[an.drawingBufferWidth,an.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:gr.paint.get("heatmap-opacity")}}(Ke,We),We.id,Ke.viewportBuffer,Ke.quadTriangleIndexBuffer,Ke.viewportSegments,We.paint,Ke.transform.zoom)}}(n,a))},line:function(n,u,a,h){if(n.renderPass==="translucent"){var _=a.paint.get("line-opacity"),C=a.paint.get("line-width");if(_.constantOr(1)!==0&&C.constantOr(1)!==0)for(var P=n.depthModeForSublayer(0,j.ReadOnly),N=n.colorModeForRenderPass(),K=a.paint.get("line-dasharray"),oe=a.paint.get("line-pattern"),Ce=oe.constantOr(1),we=a.paint.get("line-gradient"),Ie=a.getCrossfadeParameters(),Ke=Ce?"linePattern":K?"lineSDF":we?"lineGradient":"line",We=n.context,ot=We.gl,je=!0,st=0,wt=h;st<wt.length;st+=1){var Wt=wt[st],gr=u.getTile(Wt);if(!Ce||gr.patternsLoaded()){var cr=gr.getBucket(a);if(cr){var xr=cr.programConfigurations.get(a.id),zr=n.context.program.get(),an=n.useProgram(Ke,xr),Qr=je||an.program!==zr,Cn=oe.constantOr(null);if(Cn&&gr.imageAtlas){var ei=gr.imageAtlas,fi=ei.patternPositions[Cn.to.toString()],ri=ei.patternPositions[Cn.from.toString()];fi&&ri&&xr.setConstantPatternPositions(fi,ri)}var ia=Ce?Hu(n,gr,a,Ie):K?jl(n,gr,a,K,Ie):we?Pa(n,gr,a,cr.lineClipsArray.length):Pu(n,gr,a);if(Ce)We.activeTexture.set(ot.TEXTURE0),gr.imageAtlasTexture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE),xr.updatePaintBuffers(Ie);else if(K&&(Qr||n.lineAtlas.dirty))We.activeTexture.set(ot.TEXTURE0),n.lineAtlas.bind(We);else if(we){var Nn=cr.gradients[a.id],_i=Nn.texture;if(a.gradientVersion!==Nn.version){var Zi=256;if(a.stepInterpolant){var q=u.getSource().maxzoom,te=Wt.canonical.z===q?Math.ceil(1<<n.transform.maxZoom-Wt.canonical.z):1;Zi=p.clamp(p.nextPowerOfTwo(cr.maxLineLength/p.EXTENT*1024*te),256,We.maxTextureSize)}Nn.gradient=p.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Zi,image:Nn.gradient||void 0,clips:cr.lineClipsArray}),Nn.texture?Nn.texture.update(Nn.gradient):Nn.texture=new p.Texture(We,Nn.gradient,ot.RGBA),Nn.version=a.gradientVersion,_i=Nn.texture}We.activeTexture.set(ot.TEXTURE0),_i.bind(a.stepInterpolant?ot.NEAREST:ot.LINEAR,ot.CLAMP_TO_EDGE)}an.draw(We,ot.TRIANGLES,P,n.stencilModeForClipping(Wt),N,Me.disabled,ia,a.id,cr.layoutVertexBuffer,cr.indexBuffer,cr.segments,a.paint,n.transform.zoom,xr,cr.layoutVertexBuffer2),je=!1}}}}},fill:function(n,u,a,h){var _=a.paint.get("fill-color"),C=a.paint.get("fill-opacity");if(C.constantOr(1)!==0){var P=n.colorModeForRenderPass(),N=a.paint.get("fill-pattern"),K=n.opaquePassEnabledForLayer()&&!N.constantOr(1)&&_.constantOr(p.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(n.renderPass===K){var oe=n.depthModeForSublayer(1,n.renderPass==="opaque"?j.ReadWrite:j.ReadOnly);Vl(n,u,a,h,oe,P,!1)}if(n.renderPass==="translucent"&&a.paint.get("fill-antialias")){var Ce=n.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,j.ReadOnly);Vl(n,u,a,h,Ce,P,!0)}}},"fill-extrusion":function(n,u,a,h){var _=a.paint.get("fill-extrusion-opacity");if(_!==0&&n.renderPass==="translucent"){var C=new j(n.context.gl.LEQUAL,j.ReadWrite,n.depthRangeFor3D);if(_!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))vc(n,u,a,h,C,se.disabled,de.disabled),vc(n,u,a,h,C,n.stencilModeFor3D(),n.colorModeForRenderPass());else{var P=n.colorModeForRenderPass();vc(n,u,a,h,C,se.disabled,P)}}},hillshade:function(n,u,a,h){if(n.renderPass==="offscreen"||n.renderPass==="translucent"){for(var _=n.context,C=n.depthModeForSublayer(0,j.ReadOnly),P=n.colorModeForRenderPass(),N=n.renderPass==="translucent"?n.stencilConfigForOverlap(h):[{},h],K=N[0],oe=0,Ce=N[1];oe<Ce.length;oe+=1){var we=Ce[oe],Ie=u.getTile(we);Ie.needsHillshadePrepare&&n.renderPass==="offscreen"?Hl(n,Ie,a,C,se.disabled,P):n.renderPass==="translucent"&&Gl(n,Ie,a,C,K[we.overscaledZ],P)}_.viewport.set([0,0,n.width,n.height])}},raster:function(n,u,a,h){if(n.renderPass==="translucent"&&a.paint.get("raster-opacity")!==0&&h.length)for(var _=n.context,C=_.gl,P=u.getSource(),N=n.useProgram("raster"),K=n.colorModeForRenderPass(),oe=P instanceof vt?[{},h]:n.stencilConfigForOverlap(h),Ce=oe[0],we=oe[1],Ie=we[we.length-1].overscaledZ,Ke=!n.options.moving,We=0,ot=we;We<ot.length;We+=1){var je=ot[We],st=n.depthModeForSublayer(je.overscaledZ-Ie,a.paint.get("raster-opacity")===1?j.ReadWrite:j.ReadOnly,C.LESS),wt=u.getTile(je),Wt=n.transform.calculatePosMatrix(je.toUnwrapped(),Ke);wt.registerFadeDuration(a.paint.get("raster-fade-duration"));var gr=u.findLoadedParent(je,0),cr=Iu(wt,gr,u,a,n.transform),xr=void 0,zr=void 0,an=a.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;_.activeTexture.set(C.TEXTURE0),wt.texture.bind(an,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(C.TEXTURE1),gr?(gr.texture.bind(an,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),xr=Math.pow(2,gr.tileID.overscaledZ-wt.tileID.overscaledZ),zr=[wt.tileID.canonical.x*xr%1,wt.tileID.canonical.y*xr%1]):wt.texture.bind(an,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var Qr=hf(Wt,zr||[0,0],xr||1,cr,a);P instanceof vt?N.draw(_,C.TRIANGLES,st,se.disabled,K,Me.disabled,Qr,a.id,P.boundsBuffer,n.quadTriangleIndexBuffer,P.boundsSegments):N.draw(_,C.TRIANGLES,st,Ce[je.overscaledZ],K,Me.disabled,Qr,a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}},background:function(n,u,a){var h=a.paint.get("background-color"),_=a.paint.get("background-opacity");if(_!==0){var C=n.context,P=C.gl,N=n.transform,K=N.tileSize,oe=a.paint.get("background-pattern");if(!n.isPatternMissing(oe)){var Ce=!oe&&h.a===1&&_===1&&n.opaquePassEnabledForLayer()?"opaque":"translucent";if(n.renderPass===Ce){var we=se.disabled,Ie=n.depthModeForSublayer(0,Ce==="opaque"?j.ReadWrite:j.ReadOnly),Ke=n.colorModeForRenderPass(),We=n.useProgram(oe?"backgroundPattern":"background"),ot=N.coveringTiles({tileSize:K});oe&&(C.activeTexture.set(P.TEXTURE0),n.imageManager.bind(n.context));for(var je=a.getCrossfadeParameters(),st=0,wt=ot;st<wt.length;st+=1){var Wt=wt[st],gr=n.transform.calculatePosMatrix(Wt.toUnwrapped()),cr=oe?Wu(gr,_,n,oe,{tileID:Wt,tileSize:K},je):sl(gr,_,h);We.draw(C,P.TRIANGLES,Ie,we,Ke,Me.disabled,cr,a.id,n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}}}},debug:function(n,u,a){for(var h=0;h<a.length;h++)Kc(n,u,a[h])},custom:function(n,u,a){var h=n.context,_=a.implementation;if(n.renderPass==="offscreen"){var C=_.prerender;C&&(n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),C.call(_,h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState())}else if(n.renderPass==="translucent"){n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),h.setStencilMode(se.disabled);var P=_.renderingMode==="3d"?new j(n.context.gl.LEQUAL,j.ReadWrite,n.depthRangeFor3D):n.depthModeForSublayer(0,j.ReadOnly);h.setDepthMode(P),_.render(h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState(),h.bindFramebuffer.set(null)}}},to=function(n,u){this.context=new ue(n),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=Te.maxUnderzooming+Te.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Lo,this.gpuTimers={}};to.prototype.resize=function(n,u){if(this.width=n*p.browser.devicePixelRatio,this.height=u*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var a=0,h=this.style._order;a<h.length;a+=1)this.style._layers[h[a]].resize()},to.prototype.setup=function(){var n=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(u,wa.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var a=new p.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(p.EXTENT,0),a.emplaceBack(0,p.EXTENT),a.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=n.createVertexBuffer(a,wa.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(h,bt.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,wa.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var C=new p.StructArrayLayout1ui2;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(C);var P=new p.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(P),this.emptyTexture=new p.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA);var N=this.context.gl;this.stencilClearMode=new se({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO)},to.prototype.clearStencil=function(){var n=this.context,u=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var a=p.create();p.ortho(a,0,this.width,this.height,0,0,1),p.scale(a,a,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,u.TRIANGLES,j.disabled,this.stencilClearMode,de.disabled,Me.disabled,zs(a),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},to.prototype._renderTileClippingMasks=function(n,u){if(this.currentStencilSource!==n.source&&n.isTileClipped()&&u&&u.length){this.currentStencilSource=n.source;var a=this.context,h=a.gl;this.nextStencilID+u.length>256&&this.clearStencil(),a.setColorMode(de.disabled),a.setDepthMode(j.disabled);var _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var C=0,P=u;C<P.length;C+=1){var N=P[C],K=this._tileClippingMaskIDs[N.key]=this.nextStencilID++;_.draw(a,h.TRIANGLES,j.disabled,new se({func:h.ALWAYS,mask:0},K,255,h.KEEP,h.KEEP,h.REPLACE),de.disabled,Me.disabled,zs(N.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},to.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var n=this.nextStencilID++,u=this.context.gl;return new se({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)},to.prototype.stencilModeForClipping=function(n){var u=this.context.gl;return new se({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,u.KEEP,u.KEEP,u.REPLACE)},to.prototype.stencilConfigForOverlap=function(n){var u,a=this.context.gl,h=n.sort(function(K,oe){return oe.overscaledZ-K.overscaledZ}),_=h[h.length-1].overscaledZ,C=h[0].overscaledZ-_+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();for(var P={},N=0;N<C;N++)P[N+_]=new se({func:a.GEQUAL,mask:255},N+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=C,[P,h]}return[(u={},u[_]=se.disabled,u),h]},to.prototype.colorModeForRenderPass=function(){var n=this.context.gl;return this._showOverdrawInspector?new de([n.CONSTANT_COLOR,n.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?de.unblended:de.alphaBlended},to.prototype.depthModeForSublayer=function(n,u,a){if(!this.opaquePassEnabledForLayer())return j.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new j(a||this.context.gl.LEQUAL,u,[h,h])},to.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},to.prototype.render=function(n,u){var a=this;this.style=n,this.options=u,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,_=this.style.sourceCaches;for(var C in _){var P=_[C];P.used&&P.prepare(this.context)}var N,K,oe={},Ce={},we={};for(var Ie in _){var Ke=_[Ie];oe[Ie]=Ke.getVisibleCoordinates(),Ce[Ie]=oe[Ie].slice().reverse(),we[Ie]=Ke.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var We=0;We<h.length;We++)if(this.style._layers[h[We]].is3D()){this.opaquePassCutoff=We;break}this.renderPass="offscreen";for(var ot=0,je=h;ot<je.length;ot+=1){var st=this.style._layers[je[ot]];if(st.hasOffscreenPass()&&!st.isHidden(this.transform.zoom)){var wt=Ce[st.source];(st.type==="custom"||wt.length)&&this.renderLayer(this,_[st.source],st,wt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Wt=this.style._layers[h[this.currentLayer]],gr=_[Wt.source],cr=oe[Wt.source];this._renderTileClippingMasks(Wt,cr),this.renderLayer(this,gr,Wt,cr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var xr=this.style._layers[h[this.currentLayer]],zr=_[xr.source],an=(xr.type==="symbol"?we:Ce)[xr.source];this._renderTileClippingMasks(xr,oe[xr.source]),this.renderLayer(this,zr,xr,an)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(Qr){Qr.source&&!Qr.isHidden(a.transform.zoom)&&(Qr.source!==(K&&K.id)&&(K=a.style.sourceCaches[Qr.source]),(!N||N.getSource().maxzoom<K.getSource().maxzoom)&&(N=K))}),N&&cl.debug(this,N,N.getVisibleCoordinates())),this.options.showPadding&&function(Qr){var Cn=Qr.transform.padding;ll(Qr,Qr.transform.height-(Cn.top||0),3,Ou),ll(Qr,Cn.bottom||0,3,Wl),Yl(Qr,Cn.left||0,3,Ha),Yl(Qr,Qr.transform.width-(Cn.right||0),3,mu);var ei=Qr.transform.centerPoint;(function(fi,ri,ia,Nn){Lu(fi,ri-1,ia-10,2,20,Nn),Lu(fi,ri-10,ia-1,20,2,Nn)})(Qr,ei.x,Qr.transform.height-ei.y,Xl)}(this),this.context.setDefault()},to.prototype.renderLayer=function(n,u,a,h){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||h.length)&&(this.id=a.id,this.gpuTimingStart(a),cl[a.type](n,u,a,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},to.prototype.gpuTimingStart=function(n){if(this.options.gpuTiming){var u=this.context.extTimerQuery,a=this.gpuTimers[n.id];a||(a=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),a.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,a.query)}},to.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}},to.prototype.collectGpuTimers=function(){var n=this.gpuTimers;return this.gpuTimers={},n},to.prototype.queryGpuTimers=function(n){var u={};for(var a in n){var h=n[a],_=this.context.extTimerQuery,C=_.getQueryObjectEXT(h.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(h.query),u[a]=C}return u},to.prototype.translatePosMatrix=function(n,u,a,h,_){if(!a[0]&&!a[1])return n;var C=_?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(C){var P=Math.sin(C),N=Math.cos(C);a=[a[0]*N-a[1]*P,a[0]*P+a[1]*N]}var K=[_?a[0]:ea(u,a[0],this.transform.zoom),_?a[1]:ea(u,a[1],this.transform.zoom),0],oe=new Float32Array(16);return p.translate(oe,n,K),oe},to.prototype.saveTileTexture=function(n){var u=this._tileTextures[n.size[0]];u?u.push(n):this._tileTextures[n.size[0]]=[n]},to.prototype.getTileTexture=function(n){var u=this._tileTextures[n];return u&&u.length>0?u.pop():null},to.prototype.isPatternMissing=function(n){if(!n)return!1;if(!n.from||!n.to)return!0;var u=this.imageManager.getPattern(n.from.toString()),a=this.imageManager.getPattern(n.to.toString());return!u||!a},to.prototype.useProgram=function(n,u){this.cache=this.cache||{};var a=""+n+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[a]||(this.cache[a]=new iu(this.context,n,ds[n],u,ul[n],this._showOverdrawInspector)),this.cache[a]},to.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},to.prototype.setBaseState=function(){var n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)},to.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},to.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var fl=function(n,u){this.points=n,this.planes=u};fl.fromInvProjectionMatrix=function(n,u,a){var h=Math.pow(2,a),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return p.transformMat4([],P,n)}).map(function(P){return p.scale$1([],P,1/P[3]/u*h)}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var N=p.sub([],_[P[0]],_[P[1]]),K=p.sub([],_[P[2]],_[P[1]]),oe=p.normalize([],p.cross([],N,K)),Ce=-p.dot(oe,_[P[1]]);return oe.concat(Ce)});return new fl(_,C)};var Ku=function(n,u){this.min=n,this.max=u,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};Ku.prototype.quadrant=function(n){for(var u=[n%2==0,n<2],a=p.clone$2(this.min),h=p.clone$2(this.max),_=0;_<u.length;_++)a[_]=u[_]?this.min[_]:this.center[_],h[_]=u[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new Ku(a,h)},Ku.prototype.distanceX=function(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]},Ku.prototype.distanceY=function(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]},Ku.prototype.intersects=function(n){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],a=!0,h=0;h<n.planes.length;h++){for(var _=n.planes[h],C=0,P=0;P<u.length;P++)C+=p.dot$1(_,u[P])>=0;if(C===0)return 0;C!==u.length&&(a=!1)}if(a)return 2;for(var N=0;N<3;N++){for(var K=Number.MAX_VALUE,oe=-Number.MAX_VALUE,Ce=0;Ce<n.points.length;Ce++){var we=n.points[Ce][N]-this.min[N];K=Math.min(K,we),oe=Math.max(oe,we)}if(oe<0||K>this.max[N]-this.min[N])return 0}return 1};var ou=function(n,u,a,h){if(n===void 0&&(n=0),u===void 0&&(u=0),a===void 0&&(a=0),h===void 0&&(h=0),isNaN(n)||n<0||isNaN(u)||u<0||isNaN(a)||a<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=a,this.right=h};ou.prototype.interpolate=function(n,u,a){return u.top!=null&&n.top!=null&&(this.top=p.number(n.top,u.top,a)),u.bottom!=null&&n.bottom!=null&&(this.bottom=p.number(n.bottom,u.bottom,a)),u.left!=null&&n.left!=null&&(this.left=p.number(n.left,u.left,a)),u.right!=null&&n.right!=null&&(this.right=p.number(n.right,u.right,a)),this},ou.prototype.getCenter=function(n,u){var a=p.clamp((this.left+n-this.right)/2,0,n),h=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.Point(a,h)},ou.prototype.equals=function(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right},ou.prototype.clone=function(){return new ou(this.top,this.bottom,this.left,this.right)},ou.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ra=function(n,u,a,h,_){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=_===void 0||_,this._minZoom=n||0,this._maxZoom=u||22,this._minPitch=a==null?0:a,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ou,this._posMatrixCache={},this._alignedPosMatrixCache={}},za={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ra.prototype.clone=function(){var n=new ra(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n._center=this._center,n.zoom=this.zoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._calcMatrices(),n},za.minZoom.get=function(){return this._minZoom},za.minZoom.set=function(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))},za.maxZoom.get=function(){return this._maxZoom},za.maxZoom.set=function(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))},za.minPitch.get=function(){return this._minPitch},za.minPitch.set=function(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))},za.maxPitch.get=function(){return this._maxPitch},za.maxPitch.set=function(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))},za.renderWorldCopies.get=function(){return this._renderWorldCopies},za.renderWorldCopies.set=function(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n},za.worldSize.get=function(){return this.tileSize*this.scale},za.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},za.size.get=function(){return new p.Point(this.width,this.height)},za.bearing.get=function(){return-this.angle/Math.PI*180},za.bearing.set=function(n){var u=-p.wrap(n,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},za.pitch.get=function(){return this._pitch/Math.PI*180},za.pitch.set=function(n){var u=p.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},za.fov.get=function(){return this._fov/Math.PI*180},za.fov.set=function(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())},za.zoom.get=function(){return this._zoom},za.zoom.set=function(n){var u=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},za.center.get=function(){return this._center},za.center.set=function(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())},za.padding.get=function(){return this._edgeInsets.toJSON()},za.padding.set=function(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())},za.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ra.prototype.isPaddingEqual=function(n){return this._edgeInsets.equals(n)},ra.prototype.interpolatePadding=function(n,u,a){this._unmodified=!1,this._edgeInsets.interpolate(n,u,a),this._constrain(),this._calcMatrices()},ra.prototype.coveringZoomLevel=function(n){var u=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,u)},ra.prototype.getVisibleUnwrappedCoordinates=function(n){var u=[new p.UnwrappedTileID(0,n)];if(this._renderWorldCopies)for(var a=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),_=this.pointCoordinate(new p.Point(this.width,this.height)),C=this.pointCoordinate(new p.Point(0,this.height)),P=Math.floor(Math.min(a.x,h.x,_.x,C.x)),N=Math.floor(Math.max(a.x,h.x,_.x,C.x)),K=P-1;K<=N+1;K++)K!==0&&u.push(new p.UnwrappedTileID(K,n));return u},ra.prototype.coveringTiles=function(n){var u=this.coveringZoomLevel(n),a=u;if(n.minzoom!==void 0&&u<n.minzoom)return[];n.maxzoom!==void 0&&u>n.maxzoom&&(u=n.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),_=Math.pow(2,u),C=[_*h.x,_*h.y,0],P=fl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),N=n.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(N=u);var K=function(Qr){return{aabb:new Ku([Qr*_,0,0],[(Qr+1)*_,_,0]),zoom:0,x:0,y:0,wrap:Qr,fullyVisible:!1}},oe=[],Ce=[],we=u,Ie=n.reparseOverscaled?a:u;if(this._renderWorldCopies)for(var Ke=1;Ke<=3;Ke++)oe.push(K(-Ke)),oe.push(K(Ke));for(oe.push(K(0));oe.length>0;){var We=oe.pop(),ot=We.x,je=We.y,st=We.fullyVisible;if(!st){var wt=We.aabb.intersects(P);if(wt===0)continue;st=wt===2}var Wt=We.aabb.distanceX(C),gr=We.aabb.distanceY(C),cr=Math.max(Math.abs(Wt),Math.abs(gr));if(We.zoom===we||cr>3+(1<<we-We.zoom)-2&&We.zoom>=N)Ce.push({tileID:new p.OverscaledTileID(We.zoom===we?Ie:We.zoom,We.wrap,We.zoom,ot,je),distanceSq:p.sqrLen([C[0]-.5-ot,C[1]-.5-je])});else for(var xr=0;xr<4;xr++){var zr=(ot<<1)+xr%2,an=(je<<1)+(xr>>1);oe.push({aabb:We.aabb.quadrant(xr),zoom:We.zoom+1,x:zr,y:an,wrap:We.wrap,fullyVisible:st})}}return Ce.sort(function(Qr,Cn){return Qr.distanceSq-Cn.distanceSq}).map(function(Qr){return Qr.tileID})},ra.prototype.resize=function(n,u){this.width=n,this.height=u,this.pixelsToGLUnits=[2/n,-2/u],this._constrain(),this._calcMatrices()},za.unmodified.get=function(){return this._unmodified},ra.prototype.zoomScale=function(n){return Math.pow(2,n)},ra.prototype.scaleZoom=function(n){return Math.log(n)/Math.LN2},ra.prototype.project=function(n){var u=p.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(n.lng)*this.worldSize,p.mercatorYfromLat(u)*this.worldSize)},ra.prototype.unproject=function(n){return new p.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()},za.point.get=function(){return this.project(this.center)},ra.prototype.setLocationAtPoint=function(n,u){var a=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(n),C=new p.MercatorCoordinate(_.x-(a.x-h.x),_.y-(a.y-h.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())},ra.prototype.locationPoint=function(n){return this.coordinatePoint(this.locationCoordinate(n))},ra.prototype.pointLocation=function(n){return this.coordinateLocation(this.pointCoordinate(n))},ra.prototype.locationCoordinate=function(n){return p.MercatorCoordinate.fromLngLat(n)},ra.prototype.coordinateLocation=function(n){return n.toLngLat()},ra.prototype.pointCoordinate=function(n){var u=[n.x,n.y,0,1],a=[n.x,n.y,1,1];p.transformMat4(u,u,this.pixelMatrixInverse),p.transformMat4(a,a,this.pixelMatrixInverse);var h=u[3],_=a[3],C=u[1]/h,P=a[1]/_,N=u[2]/h,K=a[2]/_,oe=N===K?0:(0-N)/(K-N);return new p.MercatorCoordinate(p.number(u[0]/h,a[0]/_,oe)/this.worldSize,p.number(C,P,oe)/this.worldSize)},ra.prototype.coordinatePoint=function(n){var u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix),new p.Point(u[0]/u[3],u[1]/u[3])},ra.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},ra.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ra.prototype.setMaxBounds=function(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ra.prototype.calculatePosMatrix=function(n,u){u===void 0&&(u=!1);var a=n.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[a])return h[a];var _=n.canonical,C=this.worldSize/this.zoomScale(_.z),P=_.x+Math.pow(2,_.z)*n.wrap,N=p.identity(new Float64Array(16));return p.translate(N,N,[P*C,_.y*C,0]),p.scale(N,N,[C/p.EXTENT,C/p.EXTENT,1]),p.multiply(N,u?this.alignedProjMatrix:this.projMatrix,N),h[a]=new Float32Array(N),h[a]},ra.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ra.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var n,u,a,h,_=-90,C=90,P=-180,N=180,K=this.size,oe=this._unmodified;if(this.latRange){var Ce=this.latRange;_=p.mercatorYfromLat(Ce[1])*this.worldSize,n=(C=p.mercatorYfromLat(Ce[0])*this.worldSize)-_<K.y?K.y/(C-_):0}if(this.lngRange){var we=this.lngRange;P=p.mercatorXfromLng(we[0])*this.worldSize,u=(N=p.mercatorXfromLng(we[1])*this.worldSize)-P<K.x?K.x/(N-P):0}var Ie=this.point,Ke=Math.max(u||0,n||0);if(Ke)return this.center=this.unproject(new p.Point(u?(N+P)/2:Ie.x,n?(C+_)/2:Ie.y)),this.zoom+=this.scaleZoom(Ke),this._unmodified=oe,void(this._constraining=!1);if(this.latRange){var We=Ie.y,ot=K.y/2;We-ot<_&&(h=_+ot),We+ot>C&&(h=C-ot)}if(this.lngRange){var je=Ie.x,st=K.x/2;je-st<P&&(a=P+st),je+st>N&&(a=N-st)}a===void 0&&h===void 0||(this.center=this.unproject(new p.Point(a!==void 0?a:Ie.x,h!==void 0?h:Ie.y))),this._unmodified=oe,this._constraining=!1}},ra.prototype._calcMatrices=function(){if(this.height){var n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,a=this._fov*(.5+n.y/this.height),h=Math.sin(a)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-u-a,.01,Math.PI-.01)),_=this.point,C=_.x,P=_.y,N=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),K=this.height/50,oe=new Float64Array(16);p.perspective(oe,this._fov,this.width/this.height,K,N),oe[8]=2*-n.x/this.width,oe[9]=2*n.y/this.height,p.scale(oe,oe,[1,-1,1]),p.translate(oe,oe,[0,0,-this.cameraToCenterDistance]),p.rotateX(oe,oe,this._pitch),p.rotateZ(oe,oe,this.angle),p.translate(oe,oe,[-C,-P,0]),this.mercatorMatrix=p.scale([],oe,[this.worldSize,this.worldSize,this.worldSize]),p.scale(oe,oe,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=oe,this.invProjMatrix=p.invert([],this.projMatrix);var Ce=this.width%2/2,we=this.height%2/2,Ie=Math.cos(this.angle),Ke=Math.sin(this.angle),We=C-Math.round(C)+Ie*Ce+Ke*we,ot=P-Math.round(P)+Ie*we+Ke*Ce,je=new Float64Array(oe);if(p.translate(je,je,[We>.5?We-1:We,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=je,oe=p.create(),p.scale(oe,oe,[this.width/2,-this.height/2,1]),p.translate(oe,oe,[1,-1,0]),this.labelPlaneMatrix=oe,oe=p.create(),p.scale(oe,oe,[1,-1,1]),p.translate(oe,oe,[-1,-1,0]),p.scale(oe,oe,[2/this.width,2/this.height,1]),this.glCoordMatrix=oe,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(oe=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=oe,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ra.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var n=this.pointCoordinate(new p.Point(0,0)),u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},ra.prototype.getCameraPoint=function(){var n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,n))},ra.prototype.getCameraQueryGeometry=function(n){var u=this.getCameraPoint();if(n.length===1)return[n[0],u];for(var a=u.x,h=u.y,_=u.x,C=u.y,P=0,N=n;P<N.length;P+=1){var K=N[P];a=Math.min(a,K.x),h=Math.min(h,K.y),_=Math.max(_,K.x),C=Math.max(C,K.y)}return[new p.Point(a,h),new p.Point(_,h),new p.Point(_,C),new p.Point(a,C),new p.Point(a,h)]},Object.defineProperties(ra.prototype,za);var _s=function(n){var u,a,h,_;this._hashName=n&&encodeURIComponent(n),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),a=!1,h=null,_=function(){h=null,a&&(u(),h=setTimeout(_,300),a=!1)},function(){return a=!0,h||_(),h})};_s.prototype.addTo=function(n){return this._map=n,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},_s.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},_s.prototype.getHashString=function(n){var u=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,h=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,h),C=Math.round(u.lng*_)/_,P=Math.round(u.lat*_)/_,N=this._map.getBearing(),K=this._map.getPitch(),oe="";if(oe+=n?"/"+C+"/"+P+"/"+a:a+"/"+P+"/"+C,(N||K)&&(oe+="/"+Math.round(10*N)/10),K&&(oe+="/"+Math.round(K)),this._hashName){var Ce=this._hashName,we=!1,Ie=p.window.location.hash.slice(1).split("&").map(function(Ke){var We=Ke.split("=")[0];return We===Ce?(we=!0,We+"="+oe):Ke}).filter(function(Ke){return Ke});return we||Ie.push(Ce+"="+oe),"#"+Ie.join("&")}return"#"+oe},_s.prototype._getCurrentHash=function(){var n,u=this,a=p.window.location.hash.replace("#","");return this._hashName?(a.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(n=h)}),(n&&n[1]||"").split("/")):a.split("/")},_s.prototype._onHashChange=function(){var n=this._getCurrentHash();if(n.length>=3&&!n.some(function(a){return isNaN(a)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1},_s.prototype._updateHashUnthrottled=function(){var n=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,n)}catch(u){}};var Kl={linearity:.3,easing:p.bezier(0,0,.3,1)},yu=p.extend({deceleration:2500,maxSpeed:1400},Kl),$l=p.extend({deceleration:20,maxSpeed:1400},Kl),$c=p.extend({deceleration:1e3,maxSpeed:360},Kl),Jc=p.extend({deceleration:1e3,maxSpeed:90},Kl),Tl=function(n){this._map=n,this.clear()};function Al(n,u){(!n.duration||n.duration<u.duration)&&(n.duration=u.duration,n.easing=u.easing)}function Ru(n,u,a){var h=a.maxSpeed,_=a.linearity,C=a.deceleration,P=p.clamp(n*_/(u/1e3),-h,h),N=Math.abs(P)/(C*_);return{easing:a.easing,duration:1e3*N,amount:P*(N/2)}}Tl.prototype.clear=function(){this._inertiaBuffer=[]},Tl.prototype.record=function(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:n})},Tl.prototype._drainInertiaBuffer=function(){for(var n=this._inertiaBuffer,u=p.browser.now();n.length>0&&u-n[0].time>160;)n.shift()},Tl.prototype._onMoveEnd=function(n){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},a=0,h=this._inertiaBuffer;a<h.length;a+=1){var _=h[a].settings;u.zoom+=_.zoomDelta||0,u.bearing+=_.bearingDelta||0,u.pitch+=_.pitchDelta||0,_.panDelta&&u.pan._add(_.panDelta),_.around&&(u.around=_.around),_.pinchAround&&(u.pinchAround=_.pinchAround)}var C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(u.pan.mag()){var N=Ru(u.pan.mag(),C,p.extend({},yu,n||{}));P.offset=u.pan.mult(N.amount/u.pan.mag()),P.center=this._map.transform.center,Al(P,N)}if(u.zoom){var K=Ru(u.zoom,C,$l);P.zoom=this._map.transform.zoom+K.amount,Al(P,K)}if(u.bearing){var oe=Ru(u.bearing,C,$c);P.bearing=this._map.transform.bearing+p.clamp(oe.amount,-179,179),Al(P,oe)}if(u.pitch){var Ce=Ru(u.pitch,C,Jc);P.pitch=this._map.transform.pitch+Ce.amount,Al(P,Ce)}if(P.zoom||P.bearing){var we=u.pinchAround===void 0?u.around:u.pinchAround;P.around=we?this._map.unproject(we):this._map.getCenter()}return this.clear(),p.extend(P,{noMoveStart:!0})}};var Ro=function(n){function u(h,_,C,P){P===void 0&&(P={});var N=Z.mousePos(_.getCanvasContainer(),C),K=_.unproject(N);n.call(this,h,p.extend({point:N,lngLat:K,originalEvent:C},P)),this._defaultPrevented=!1,this.target=_}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),Pl=function(n){function u(h,_,C){var P=h==="touchend"?C.changedTouches:C.touches,N=Z.touchPos(_.getCanvasContainer(),P),K=N.map(function(we){return _.unproject(we)}),oe=N.reduce(function(we,Ie,Ke,We){return we.add(Ie.div(We.length))},new p.Point(0,0)),Ce=_.unproject(oe);n.call(this,h,{points:N,point:oe,lngLats:K,lngLat:Ce,originalEvent:C}),this._defaultPrevented=!1}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),Zs=function(n){function u(h,_,C){n.call(this,h,{originalEvent:C}),this._defaultPrevented=!1}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),So=function(n,u){this._map=n,this._clickTolerance=u.clickTolerance};So.prototype.reset=function(){delete this._mousedownPos},So.prototype.wheel=function(n){return this._firePreventable(new Zs(n.type,this._map,n))},So.prototype.mousedown=function(n,u){return this._mousedownPos=u,this._firePreventable(new Ro(n.type,this._map,n))},So.prototype.mouseup=function(n){this._map.fire(new Ro(n.type,this._map,n))},So.prototype.click=function(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Ro(n.type,this._map,n))},So.prototype.dblclick=function(n){return this._firePreventable(new Ro(n.type,this._map,n))},So.prototype.mouseover=function(n){this._map.fire(new Ro(n.type,this._map,n))},So.prototype.mouseout=function(n){this._map.fire(new Ro(n.type,this._map,n))},So.prototype.touchstart=function(n){return this._firePreventable(new Pl(n.type,this._map,n))},So.prototype.touchmove=function(n){this._map.fire(new Pl(n.type,this._map,n))},So.prototype.touchend=function(n){this._map.fire(new Pl(n.type,this._map,n))},So.prototype.touchcancel=function(n){this._map.fire(new Pl(n.type,this._map,n))},So.prototype._firePreventable=function(n){if(this._map.fire(n),n.defaultPrevented)return{}},So.prototype.isEnabled=function(){return!0},So.prototype.isActive=function(){return!1},So.prototype.enable=function(){},So.prototype.disable=function(){};var kn=function(n){this._map=n};kn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},kn.prototype.mousemove=function(n){this._map.fire(new Ro(n.type,this._map,n))},kn.prototype.mousedown=function(){this._delayContextMenu=!0},kn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ro("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},kn.prototype.contextmenu=function(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Ro(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()},kn.prototype.isEnabled=function(){return!0},kn.prototype.isActive=function(){return!1},kn.prototype.enable=function(){},kn.prototype.disable=function(){};var ho=function(n,u){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1};function gu(n,u){for(var a={},h=0;h<n.length;h++)a[n[h].identifier]=u[h];return a}ho.prototype.isEnabled=function(){return!!this._enabled},ho.prototype.isActive=function(){return!!this._active},ho.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ho.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ho.prototype.mousedown=function(n,u){this.isEnabled()&&n.shiftKey&&n.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},ho.prototype.mousemoveWindow=function(n,u){if(this._active){var a=u;if(!(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=a,this._box||(this._box=Z.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));var _=Math.min(h.x,a.x),C=Math.max(h.x,a.x),P=Math.min(h.y,a.y),N=Math.max(h.y,a.y);Z.setTransform(this._box,"translate("+_+"px,"+P+"px)"),this._box.style.width=C-_+"px",this._box.style.height=N-P+"px"}}},ho.prototype.mouseupWindow=function(n,u){var a=this;if(this._active&&n.button===0){var h=this._startPos,_=u;if(this.reset(),Z.suppressClick(),h.x!==_.x||h.y!==_.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:function(C){return C.fitScreenCoordinates(h,_,a._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",n)}},ho.prototype.keydown=function(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))},ho.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos},ho.prototype._fireEvent=function(n,u){return this._map.fire(new p.Event(n,{originalEvent:u}))};var hl=function(n){this.reset(),this.numTouches=n.numTouches};hl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},hl.prototype.touchstart=function(n,u,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),a.length===this.numTouches&&(this.centroid=function(h){for(var _=new p.Point(0,0),C=0,P=h;C<P.length;C+=1)_._add(P[C]);return _.div(h.length)}(u),this.touches=gu(a,u)))},hl.prototype.touchmove=function(n,u,a){if(!this.aborted&&this.centroid){var h=gu(a,u);for(var _ in this.touches){var C=h[_];(!C||C.dist(this.touches[_])>30)&&(this.aborted=!0)}}},hl.prototype.touchend=function(n,u,a){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var Js=function(n){this.singleTap=new hl(n),this.numTaps=n.numTaps,this.reset()};Js.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Js.prototype.touchstart=function(n,u,a){this.singleTap.touchstart(n,u,a)},Js.prototype.touchmove=function(n,u,a){this.singleTap.touchmove(n,u,a)},Js.prototype.touchend=function(n,u,a){var h=this.singleTap.touchend(n,u,a);if(h){var _=n.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(h)<30;if(_&&C||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var As=function(){this._zoomIn=new Js({numTouches:1,numTaps:2}),this._zoomOut=new Js({numTouches:2,numTaps:1}),this.reset()};As.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},As.prototype.touchstart=function(n,u,a){this._zoomIn.touchstart(n,u,a),this._zoomOut.touchstart(n,u,a)},As.prototype.touchmove=function(n,u,a){this._zoomIn.touchmove(n,u,a),this._zoomOut.touchmove(n,u,a)},As.prototype.touchend=function(n,u,a){var h=this,_=this._zoomIn.touchend(n,u,a),C=this._zoomOut.touchend(n,u,a);return _?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(_)},{originalEvent:n})}}):C?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(C)},{originalEvent:n})}}):void 0},As.prototype.touchcancel=function(){this.reset()},As.prototype.enable=function(){this._enabled=!0},As.prototype.disable=function(){this._enabled=!1,this.reset()},As.prototype.isEnabled=function(){return this._enabled},As.prototype.isActive=function(){return this._active};var mc={0:1,2:2},mn=function(n){this.reset(),this._clickTolerance=n.clickTolerance||1};mn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},mn.prototype._correctButton=function(n,u){return!1},mn.prototype._move=function(n,u){return{}},mn.prototype.mousedown=function(n,u){if(!this._lastPoint){var a=Z.mouseButton(n);this._correctButton(n,a)&&(this._lastPoint=u,this._eventButton=a)}},mn.prototype.mousemoveWindow=function(n,u){var a=this._lastPoint;if(a){if(n.preventDefault(),function(h,_){var C=mc[_];return h.buttons===void 0||(h.buttons&C)!==C}(n,this._eventButton))this.reset();else if(this._moved||!(u.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(a,u)}},mn.prototype.mouseupWindow=function(n){this._lastPoint&&Z.mouseButton(n)===this._eventButton&&(this._moved&&Z.suppressClick(),this.reset())},mn.prototype.enable=function(){this._enabled=!0},mn.prototype.disable=function(){this._enabled=!1,this.reset()},mn.prototype.isEnabled=function(){return this._enabled},mn.prototype.isActive=function(){return this._active};var Jl=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.mousedown=function(a,h){n.prototype.mousedown.call(this,a,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(a,h){return h===0&&!a.ctrlKey},u.prototype._move=function(a,h){return{around:h,panDelta:h.sub(a)}},u}(mn),Ql=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var _=.8*(h.x-a.x);if(_)return this._active=!0,{bearingDelta:_}},u.prototype.contextmenu=function(a){a.preventDefault()},u}(mn),Du=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var _=-.5*(h.y-a.y);if(_)return this._active=!0,{pitchDelta:_}},u.prototype.contextmenu=function(a){a.preventDefault()},u}(mn),ja=function(n){this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset()};ja.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},ja.prototype.touchstart=function(n,u,a){return this._calculateTransform(n,u,a)},ja.prototype.touchmove=function(n,u,a){if(this._active&&!(a.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,u,a)},ja.prototype.touchend=function(n,u,a){this._calculateTransform(n,u,a),this._active&&a.length<this._minTouches&&this.reset()},ja.prototype.touchcancel=function(){this.reset()},ja.prototype._calculateTransform=function(n,u,a){a.length>0&&(this._active=!0);var h=gu(a,u),_=new p.Point(0,0),C=new p.Point(0,0),P=0;for(var N in h){var K=h[N],oe=this._touches[N];oe&&(_._add(K),C._add(K.sub(oe)),P++,h[N]=K)}if(this._touches=h,!(P<this._minTouches)&&C.mag()){var Ce=C.div(P);if(this._sum._add(Ce),!(this._sum.mag()<this._clickTolerance))return{around:_.div(P),panDelta:Ce}}},ja.prototype.enable=function(){this._enabled=!0},ja.prototype.disable=function(){this._enabled=!1,this.reset()},ja.prototype.isEnabled=function(){return this._enabled},ja.prototype.isActive=function(){return this._active};var Ps=function(){this.reset()};function ql(n,u,a){for(var h=0;h<n.length;h++)if(n[h].identifier===a)return u[h]}function _u(n,u){return Math.log(n/u)/Math.LN2}Ps.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ps.prototype._start=function(n){},Ps.prototype._move=function(n,u,a){return{}},Ps.prototype.touchstart=function(n,u,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([u[0],u[1]]))},Ps.prototype.touchmove=function(n,u,a){if(this._firstTwoTouches){n.preventDefault();var h=this._firstTwoTouches,_=h[1],C=ql(a,u,h[0]),P=ql(a,u,_);if(C&&P){var N=this._aroundCenter?null:C.add(P).div(2);return this._move([C,P],N,n)}}},Ps.prototype.touchend=function(n,u,a){if(this._firstTwoTouches){var h=this._firstTwoTouches,_=h[1],C=ql(a,u,h[0]),P=ql(a,u,_);C&&P||(this._active&&Z.suppressClick(),this.reset())}},Ps.prototype.touchcancel=function(){this.reset()},Ps.prototype.enable=function(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"},Ps.prototype.disable=function(){this._enabled=!1,this.reset()},Ps.prototype.isEnabled=function(){return this._enabled},Ps.prototype.isActive=function(){return this._active};var Ms=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(a){this._startDistance=this._distance=a[0].dist(a[1])},u.prototype._move=function(a,h){var _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(_u(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_u(this._distance,_),pinchAround:h}},u}(Ps);function xu(n,u){return 180*n.angleWith(u)/Math.PI}var Fc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])},u.prototype._move=function(a,h){var _=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:xu(this._vector,_),pinchAround:h}},u.prototype._isBelowThreshold=function(a){this._minDiameter=Math.min(this._minDiameter,a.mag());var h=25/(Math.PI*this._minDiameter)*360,_=xu(a,this._startVector);return Math.abs(_)<h},u}(Ps);function Ml(n){return Math.abs(n.y)>Math.abs(n.x)}var yc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(a){this._lastPoints=a,Ml(a[0].sub(a[1]))&&(this._valid=!1)},u.prototype._move=function(a,h,_){var C=a[0].sub(this._lastPoints[0]),P=a[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(C,P,_.timeStamp),this._valid)return this._lastPoints=a,this._active=!0,{pitchDelta:(C.y+P.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(a,h,_){if(this._valid!==void 0)return this._valid;var C=a.mag()>=2,P=h.mag()>=2;if(C||P){if(!C||!P)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;var N=a.y>0==h.y>0;return Ml(a)&&Ml(h)&&N}},u}(Ps),gc={panStep:100,bearingStep:15,pitchStep:10},Qs=function(){var n=gc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1};function Is(n){return n*(2-n)}Qs.prototype.reset=function(){this._active=!1},Qs.prototype.keydown=function(n){var u=this;if(!(n.altKey||n.ctrlKey||n.metaKey)){var a=0,h=0,_=0,C=0,P=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),C=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),C=1);break;case 38:n.shiftKey?_=1:(n.preventDefault(),P=-1);break;case 40:n.shiftKey?_=-1:(n.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(h=0,_=0),{cameraAnimation:function(N){var K=N.getZoom();N.easeTo({duration:300,easeId:"keyboardHandler",easing:Is,zoom:a?Math.round(K)+a*(n.shiftKey?2:1):K,bearing:N.getBearing()+h*u._bearingStep,pitch:N.getPitch()+_*u._pitchStep,offset:[-C*u._panStep,-P*u._panStep],center:N.getCenter()},{originalEvent:n})}}}},Qs.prototype.enable=function(){this._enabled=!0},Qs.prototype.disable=function(){this._enabled=!1,this.reset()},Qs.prototype.isEnabled=function(){return this._enabled},Qs.prototype.isActive=function(){return this._active},Qs.prototype.disableRotation=function(){this._rotationDisabled=!0},Qs.prototype.enableRotation=function(){this._rotationDisabled=!1};var na=function(n,u){this._map=n,this._el=n.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};na.prototype.setZoomRate=function(n){this._defaultZoomRate=n},na.prototype.setWheelZoomRate=function(n){this._wheelZoomRate=n},na.prototype.isEnabled=function(){return!!this._enabled},na.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},na.prototype.isZooming=function(){return!!this._zooming},na.prototype.enable=function(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&n.around==="center")},na.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},na.prototype.wheel=function(n){if(this.isEnabled()){var u=n.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,a=p.browser.now(),h=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}},na.prototype._onTimeout=function(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)},na.prototype._start=function(n){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=Z.mousePos(this._el,n);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},na.prototype.renderFrame=function(){var n=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var a=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*a)));this._delta<0&&h!==0&&(h=1/h);var _=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(_*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var C,P=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,N=this._startZoom,K=this._easing,oe=!1;if(this._type==="wheel"&&N&&K){var Ce=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),we=K(Ce);C=p.number(N,P,we),Ce<1?this._frameId||(this._frameId=!0):oe=!0}else C=P,oe=!0;return this._active=!0,oe&&(this._active=!1,this._finishTimeout=setTimeout(function(){n._zooming=!1,n._handler._triggerRenderFrame(),delete n._targetZoom,delete n._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!oe,zoomDelta:C-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},na.prototype._smoothOutEasing=function(n){var u=p.ease;if(this._prevEase){var a=this._prevEase,h=(p.browser.now()-a.start)/a.duration,_=a.easing(h+.01)-a.easing(h),C=.27/Math.sqrt(_*_+1e-4)*.01,P=Math.sqrt(.0729-C*C);u=p.bezier(C,P,.25,1)}return this._prevEase={start:p.browser.now(),duration:n,easing:u},u},na.prototype.reset=function(){this._active=!1};var bu=function(n,u){this._clickZoom=n,this._tapZoom=u};bu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},bu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},bu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},bu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var qs=function(){this.reset()};qs.prototype.reset=function(){this._active=!1},qs.prototype.dblclick=function(n,u){return n.preventDefault(),{cameraAnimation:function(a){a.easeTo({duration:300,zoom:a.getZoom()+(n.shiftKey?-1:1),around:a.unproject(u)},{originalEvent:n})}}},qs.prototype.enable=function(){this._enabled=!0},qs.prototype.disable=function(){this._enabled=!1,this.reset()},qs.prototype.isEnabled=function(){return this._enabled},qs.prototype.isActive=function(){return this._active};var No=function(){this._tap=new Js({numTouches:1,numTaps:1}),this.reset()};No.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},No.prototype.touchstart=function(n,u,a){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=u[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(n,u,a))},No.prototype.touchmove=function(n,u,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;var h=u[0],_=h.y-this._swipePoint.y;return this._swipePoint=h,n.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(n,u,a)},No.prototype.touchend=function(n,u,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(n,u,a)&&(this._tapTime=n.timeStamp)},No.prototype.touchcancel=function(){this.reset()},No.prototype.enable=function(){this._enabled=!0},No.prototype.disable=function(){this._enabled=!1,this.reset()},No.prototype.isEnabled=function(){return this._enabled},No.prototype.isActive=function(){return this._active};var $u=function(n,u,a){this._el=n,this._mousePan=u,this._touchPan=a};$u.prototype.enable=function(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},$u.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},$u.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},$u.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var su=function(n,u,a){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=u,this._mousePitch=a};su.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},su.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},su.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},su.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var uu=function(n,u,a,h){this._el=n,this._touchZoom=u,this._touchRotate=a,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};uu.prototype.enable=function(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},uu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},uu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},uu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},uu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},uu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Eo=function(n){return n.zoom||n.drag||n.pitch||n.rotate},ku=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u}(p.Event);function ni(n){return n.panDelta&&n.panDelta.mag()||n.zoomDelta||n.bearingDelta||n.pitchDelta}var Hn=function(n,u){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tl(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);var a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[p.window,"blur",void 0]];for(var h=0,_=this._listeners;h<_.length;h+=1){var C=_[h],P=C[0];Z.addEventListener(P,C[1],P===p.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};Hn.prototype.destroy=function(){for(var n=0,u=this._listeners;n<u.length;n+=1){var a=u[n],h=a[0];Z.removeEventListener(h,a[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,a[2])}},Hn.prototype._addDefaultHandlers=function(n){var u=this._map,a=u.getCanvasContainer();this._add("mapEvent",new So(u,n));var h=u.boxZoom=new ho(u,n);this._add("boxZoom",h);var _=new As,C=new qs;u.doubleClickZoom=new bu(C,_),this._add("tapZoom",_),this._add("clickZoom",C);var P=new No;this._add("tapDragZoom",P);var N=u.touchPitch=new yc;this._add("touchPitch",N);var K=new Ql(n),oe=new Du(n);u.dragRotate=new su(n,K,oe),this._add("mouseRotate",K,["mousePitch"]),this._add("mousePitch",oe,["mouseRotate"]);var Ce=new Jl(n),we=new ja(n);u.dragPan=new $u(a,Ce,we),this._add("mousePan",Ce),this._add("touchPan",we,["touchZoom","touchRotate"]);var Ie=new Fc,Ke=new Ms;u.touchZoomRotate=new uu(a,Ke,Ie,P),this._add("touchRotate",Ie,["touchPan","touchZoom"]),this._add("touchZoom",Ke,["touchPan","touchRotate"]);var We=u.scrollZoom=new na(u,this);this._add("scrollZoom",We,["mousePan"]);var ot=u.keyboard=new Qs;this._add("keyboard",ot),this._add("blockableMapEvent",new kn(u));for(var je=0,st=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];je<st.length;je+=1){var wt=st[je];n.interactive&&n[wt]&&u[wt].enable(n[wt])}},Hn.prototype._add=function(n,u,a){this._handlers.push({handlerName:n,handler:u,allowed:a}),this._handlersById[n]=u},Hn.prototype.stop=function(n){if(!this._updatingCamera){for(var u=0,a=this._handlers;u<a.length;u+=1)a[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}},Hn.prototype.isActive=function(){for(var n=0,u=this._handlers;n<u.length;n+=1)if(u[n].handler.isActive())return!0;return!1},Hn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Hn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Hn.prototype.isMoving=function(){return Boolean(Eo(this._eventsInProgress))||this.isZooming()},Hn.prototype._blockedByActive=function(n,u,a){for(var h in n)if(h!==a&&(!u||u.indexOf(h)<0))return!0;return!1},Hn.prototype.handleWindowEvent=function(n){this.handleEvent(n,n.type+"Window")},Hn.prototype._getMapTouches=function(n){for(var u=[],a=0,h=n;a<h.length;a+=1){var _=h[a];this._el.contains(_.target)&&u.push(_)}return u},Hn.prototype.handleEvent=function(n,u){if(n.type!=="blur"){this._updatingCamera=!0;for(var a=n.type==="renderFrame"?void 0:n,h={needsRenderFrame:!1},_={},C={},P=n.touches?this._getMapTouches(n.touches):void 0,N=P?Z.touchPos(this._el,P):Z.mousePos(this._el,n),K=0,oe=this._handlers;K<oe.length;K+=1){var Ce=oe[K],we=Ce.handlerName,Ie=Ce.handler,Ke=Ce.allowed;if(Ie.isEnabled()){var We=void 0;this._blockedByActive(C,Ke,we)?Ie.reset():Ie[u||n.type]&&(We=Ie[u||n.type](n,N,P),this.mergeHandlerResult(h,_,We,we,a),We&&We.needsRenderFrame&&this._triggerRenderFrame()),(We||Ie.isActive())&&(C[we]=Ie)}}var ot={};for(var je in this._previousActiveHandlers)C[je]||(ot[je]=a);this._previousActiveHandlers=C,(Object.keys(ot).length||ni(h))&&(this._changes.push([h,_,ot]),this._triggerRenderFrame()),(Object.keys(C).length||ni(h))&&this._map._stop(!0),this._updatingCamera=!1;var st=h.cameraAnimation;st&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],st(this._map))}else this.stop(!0)},Hn.prototype.mergeHandlerResult=function(n,u,a,h,_){if(a){p.extend(n,a);var C={handlerName:h,originalEvent:a.originalEvent||_};a.zoomDelta!==void 0&&(u.zoom=C),a.panDelta!==void 0&&(u.drag=C),a.pitchDelta!==void 0&&(u.pitch=C),a.bearingDelta!==void 0&&(u.rotate=C)}},Hn.prototype._applyChanges=function(){for(var n={},u={},a={},h=0,_=this._changes;h<_.length;h+=1){var C=_[h],P=C[0],N=C[1],K=C[2];P.panDelta&&(n.panDelta=(n.panDelta||new p.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(n.around=P.around),P.pinchAround!==void 0&&(n.pinchAround=P.pinchAround),P.noInertia&&(n.noInertia=P.noInertia),p.extend(u,N),p.extend(a,K)}this._updateMapTransform(n,u,a),this._changes=[]},Hn.prototype._updateMapTransform=function(n,u,a){var h=this._map,_=h.transform;if(!ni(n))return this._fireEvents(u,a,!0);var C=n.panDelta,P=n.zoomDelta,N=n.bearingDelta,K=n.pitchDelta,oe=n.around,Ce=n.pinchAround;Ce!==void 0&&(oe=Ce),h._stop(!0),oe=oe||h.transform.centerPoint;var we=_.pointLocation(C?oe.sub(C):oe);N&&(_.bearing+=N),K&&(_.pitch+=K),P&&(_.zoom+=P),_.setLocationAtPoint(we,oe),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,a,!0)},Hn.prototype._fireEvents=function(n,u,a){var h=this,_=Eo(this._eventsInProgress),C=Eo(n),P={};for(var N in n)this._eventsInProgress[N]||(P[N+"start"]=n[N].originalEvent),this._eventsInProgress[N]=n[N];for(var K in!_&&C&&this._fireEvent("movestart",C.originalEvent),P)this._fireEvent(K,P[K]);for(var oe in C&&this._fireEvent("move",C.originalEvent),n)this._fireEvent(oe,n[oe].originalEvent);var Ce,we={};for(var Ie in this._eventsInProgress){var Ke=this._eventsInProgress[Ie],We=Ke.handlerName,ot=Ke.originalEvent;this._handlersById[We].isActive()||(delete this._eventsInProgress[Ie],we[Ie+"end"]=Ce=u[We]||ot)}for(var je in we)this._fireEvent(je,we[je]);var st=Eo(this._eventsInProgress);if(a&&(_||C)&&!st){this._updatingCamera=!0;var wt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Wt=function(gr){return gr!==0&&-h._bearingSnap<gr&&gr<h._bearingSnap};wt?(Wt(wt.bearing||this._map.getBearing())&&(wt.bearing=0),this._map.easeTo(wt,{originalEvent:Ce})):(this._map.fire(new p.Event("moveend",{originalEvent:Ce})),Wt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Hn.prototype._fireEvent=function(n,u){this._map.fire(new p.Event(n,u?{originalEvent:u}:{}))},Hn.prototype._requestFrame=function(){var n=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete n._frameId,n.handleEvent(new ku("renderFrame",{timeStamp:u})),n._applyChanges()})},Hn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Il=function(n){function u(a,h){n.call(this),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(a,h){return this.jumpTo({center:a},h)},u.prototype.panBy=function(a,h,_){return a=p.Point.convert(a).mult(-1),this.panTo(this.transform.center,p.extend({offset:a},h),_)},u.prototype.panTo=function(a,h,_){return this.easeTo(p.extend({center:a},h),_)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(a,h){return this.jumpTo({zoom:a},h),this},u.prototype.zoomTo=function(a,h,_){return this.easeTo(p.extend({zoom:a},h),_)},u.prototype.zoomIn=function(a,h){return this.zoomTo(this.getZoom()+1,a,h),this},u.prototype.zoomOut=function(a,h){return this.zoomTo(this.getZoom()-1,a,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(a,h){return this.jumpTo({bearing:a},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(a,h){return this.jumpTo({padding:a},h),this},u.prototype.rotateTo=function(a,h,_){return this.easeTo(p.extend({bearing:a},h),_)},u.prototype.resetNorth=function(a,h){return this.rotateTo(0,p.extend({duration:1e3},a),h),this},u.prototype.resetNorthPitch=function(a,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},a),h),this},u.prototype.snapToNorth=function(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(a,h){return this.jumpTo({pitch:a},h),this},u.prototype.cameraForBounds=function(a,h){a=p.LngLatBounds.convert(a);var _=h&&h.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),_,h)},u.prototype._cameraForBoxAndBearing=function(a,h,_,C){var P={top:0,bottom:0,right:0,left:0};if(typeof(C=p.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){var N=C.padding;C.padding={top:N,bottom:N,right:N,left:N}}C.padding=p.extend(P,C.padding);var K=this.transform,oe=K.padding,Ce=K.project(p.LngLat.convert(a)),we=K.project(p.LngLat.convert(h)),Ie=Ce.rotate(-_*Math.PI/180),Ke=we.rotate(-_*Math.PI/180),We=new p.Point(Math.max(Ie.x,Ke.x),Math.max(Ie.y,Ke.y)),ot=new p.Point(Math.min(Ie.x,Ke.x),Math.min(Ie.y,Ke.y)),je=We.sub(ot),st=(K.width-(oe.left+oe.right+C.padding.left+C.padding.right))/je.x,wt=(K.height-(oe.top+oe.bottom+C.padding.top+C.padding.bottom))/je.y;if(!(wt<0||st<0)){var Wt=Math.min(K.scaleZoom(K.scale*Math.min(st,wt)),C.maxZoom),gr=typeof C.offset.x=="number"?new p.Point(C.offset.x,C.offset.y):p.Point.convert(C.offset),cr=new p.Point((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(_*Math.PI/180),xr=gr.add(cr).mult(K.scale/K.zoomScale(Wt));return{center:K.unproject(Ce.add(we).div(2).sub(xr)),zoom:Wt,bearing:_}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(a,h,_){return this._fitInternal(this.cameraForBounds(a,h),h,_)},u.prototype.fitScreenCoordinates=function(a,h,_,C,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(a)),this.transform.pointLocation(p.Point.convert(h)),_,C),C,P)},u.prototype._fitInternal=function(a,h,_){return a?(delete(h=p.extend(a,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this},u.prototype.jumpTo=function(a,h){this.stop();var _=this.transform,C=!1,P=!1,N=!1;return"zoom"in a&&_.zoom!==+a.zoom&&(C=!0,_.zoom=+a.zoom),a.center!==void 0&&(_.center=p.LngLat.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(P=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(N=!0,_.pitch=+a.pitch),a.padding==null||_.isPaddingEqual(a.padding)||(_.padding=a.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),C&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),P&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),N&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},u.prototype.easeTo=function(a,h){var _=this;this._stop(!1,a.easeId),((a=p.extend({offset:[0,0],duration:500,easing:p.ease},a)).animate===!1||!a.essential&&p.browser.prefersReducedMotion)&&(a.duration=0);var C=this.transform,P=this.getZoom(),N=this.getBearing(),K=this.getPitch(),oe=this.getPadding(),Ce="zoom"in a?+a.zoom:P,we="bearing"in a?this._normalizeBearing(a.bearing,N):N,Ie="pitch"in a?+a.pitch:K,Ke="padding"in a?a.padding:C.padding,We=p.Point.convert(a.offset),ot=C.centerPoint.add(We),je=C.pointLocation(ot),st=p.LngLat.convert(a.center||je);this._normalizeCenter(st);var wt,Wt,gr=C.project(je),cr=C.project(st).sub(gr),xr=C.zoomScale(Ce-P);a.around&&(wt=p.LngLat.convert(a.around),Wt=C.locationPoint(wt));var zr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ce!==P,this._rotating=this._rotating||N!==we,this._pitching=this._pitching||Ie!==K,this._padding=!C.isPaddingEqual(Ke),this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,zr),this._ease(function(an){if(_._zooming&&(C.zoom=p.number(P,Ce,an)),_._rotating&&(C.bearing=p.number(N,we,an)),_._pitching&&(C.pitch=p.number(K,Ie,an)),_._padding&&(C.interpolatePadding(oe,Ke,an),ot=C.centerPoint.add(We)),wt)C.setLocationAtPoint(wt,Wt);else{var Qr=C.zoomScale(C.zoom-P),Cn=Ce>P?Math.min(2,xr):Math.max(.5,xr),ei=Math.pow(Cn,1-an),fi=C.unproject(gr.add(cr.mult(an*ei)).mult(Qr));C.setLocationAtPoint(C.renderWorldCopies?fi.wrap():fi,ot)}_._fireMoveEvents(h)},function(an){_._afterEase(h,an)},a),this},u.prototype._prepareEase=function(a,h,_){_===void 0&&(_={}),this._moving=!0,h||_.moving||this.fire(new p.Event("movestart",a)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",a))},u.prototype._fireMoveEvents=function(a){this.fire(new p.Event("move",a)),this._zooming&&this.fire(new p.Event("zoom",a)),this._rotating&&this.fire(new p.Event("rotate",a)),this._pitching&&this.fire(new p.Event("pitch",a))},u.prototype._afterEase=function(a,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var _=this._zooming,C=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",a)),C&&this.fire(new p.Event("rotateend",a)),P&&this.fire(new p.Event("pitchend",a)),this.fire(new p.Event("moveend",a))}},u.prototype.flyTo=function(a,h){var _=this;if(!a.essential&&p.browser.prefersReducedMotion){var C=p.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(C,h)}this.stop(),a=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},a);var P=this.transform,N=this.getZoom(),K=this.getBearing(),oe=this.getPitch(),Ce=this.getPadding(),we="zoom"in a?p.clamp(+a.zoom,P.minZoom,P.maxZoom):N,Ie="bearing"in a?this._normalizeBearing(a.bearing,K):K,Ke="pitch"in a?+a.pitch:oe,We="padding"in a?a.padding:P.padding,ot=P.zoomScale(we-N),je=p.Point.convert(a.offset),st=P.centerPoint.add(je),wt=P.pointLocation(st),Wt=p.LngLat.convert(a.center||wt);this._normalizeCenter(Wt);var gr=P.project(wt),cr=P.project(Wt).sub(gr),xr=a.curve,zr=Math.max(P.width,P.height),an=zr/ot,Qr=cr.mag();if("minZoom"in a){var Cn=p.clamp(Math.min(a.minZoom,N,we),P.minZoom,P.maxZoom),ei=zr/P.zoomScale(Cn-N);xr=Math.sqrt(ei/Qr*2)}var fi=xr*xr;function ri(F){var ie=(an*an-zr*zr+(F?-1:1)*fi*fi*Qr*Qr)/(2*(F?an:zr)*fi*Qr);return Math.log(Math.sqrt(ie*ie+1)-ie)}function ia(F){return(Math.exp(F)-Math.exp(-F))/2}function Nn(F){return(Math.exp(F)+Math.exp(-F))/2}var _i=ri(0),Zi=function(F){return Nn(_i)/Nn(_i+xr*F)},q=function(F){return zr*((Nn(_i)*(ia(ie=_i+xr*F)/Nn(ie))-ia(_i))/fi)/Qr;var ie},te=(ri(1)-_i)/xr;if(Math.abs(Qr)<1e-6||!isFinite(te)){if(Math.abs(zr-an)<1e-6)return this.easeTo(a,h);var k=an<zr?-1:1;te=Math.abs(Math.log(an/zr))/xr,q=function(){return 0},Zi=function(F){return Math.exp(k*xr*F)}}return a.duration="duration"in a?+a.duration:1e3*te/("screenSpeed"in a?+a.screenSpeed/xr:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=K!==Ie,this._pitching=Ke!==oe,this._padding=!P.isPaddingEqual(We),this._prepareEase(h,!1),this._ease(function(F){var ie=F*te,Ae=1/Zi(ie);P.zoom=F===1?we:N+P.scaleZoom(Ae),_._rotating&&(P.bearing=p.number(K,Ie,F)),_._pitching&&(P.pitch=p.number(oe,Ke,F)),_._padding&&(P.interpolatePadding(Ce,We,F),st=P.centerPoint.add(je));var ft=F===1?Wt:P.unproject(gr.add(cr.mult(q(ie))).mult(Ae));P.setLocationAtPoint(P.renderWorldCopies?ft.wrap():ft,st),_._fireMoveEvents(h)},function(){return _._afterEase(h)},a),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,h)}if(!a){var C=this.handlers;C&&C.stop(!1)}return this},u.prototype._ease=function(a,h,_){_.animate===!1||_.duration===0?(a(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var a=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(a,h){a=p.wrap(a,-180,180);var _=Math.abs(a-h);return Math.abs(a-360-h)<_&&(a-=360),Math.abs(a+360-h)<_&&(a+=360),a},u.prototype._normalizeCenter=function(a){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var _=a.lng-h.center.lng;a.lng+=_>180?-360:_<-180?360:0}},u}(p.Evented),as=function(n){n===void 0&&(n={}),this.options=n,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};as.prototype.getDefaultPosition=function(){return"bottom-right"},as.prototype.onAdd=function(n){var u=this.options&&this.options.compact;return this._map=n,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},as.prototype.onRemove=function(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},as.prototype._setElementTitle=function(n,u){var a=this._map._getUIString("AttributionControl."+u);n.title=a,n.setAttribute("aria-label",a)},as.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},as.prototype._updateEditLink=function(){var n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(n){var a=u.reduce(function(h,_,C){return _.value&&(h+=_.key+"="+_.value+(C<u.length-1?"&":"")),h},"?");n.href=p.config.FEEDBACK_URL+"/"+a+(this._map._hash?this._map._hash.getHashString(!0):""),n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}},as.prototype._updateData=function(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},as.prototype._updateAttributions=function(){if(this._map.style){var n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(function(N){return typeof N!="string"?"":N})):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var a=this._map.style.sourceCaches;for(var h in a){var _=a[h];if(_.used){var C=_.getSource();C.attribution&&n.indexOf(C.attribution)<0&&n.push(C.attribution)}}n.sort(function(N,K){return N.length-K.length});var P=(n=n.filter(function(N,K){for(var oe=K+1;oe<n.length;oe++)if(n[oe].indexOf(N)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,n.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},as.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var js=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};js.prototype.onAdd=function(n){this._map=n,this._container=Z.create("div","mapboxgl-ctrl");var u=Z.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},js.prototype.onRemove=function(){Z.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},js.prototype.getDefaultPosition=function(){return"bottom-left"},js.prototype._updateLogo=function(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},js.prototype._logoRequired=function(){if(this._map.style){var n=this._map.style.sourceCaches;for(var u in n)if(n[u].getSource().mapbox_logo)return!0;return!1}},js.prototype._updateCompact=function(){var n=this._container.children;if(n.length){var u=n[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var Wo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Wo.prototype.add=function(n){var u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u},Wo.prototype.remove=function(n){for(var u=this._currentlyRunning,a=0,h=u?this._queue.concat(u):this._queue;a<h.length;a+=1){var _=h[a];if(_.id===n)return void(_.cancelled=!0)}},Wo.prototype.run=function(n){n===void 0&&(n=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var a=0,h=u;a<h.length;a+=1){var _=h[a];if(!_.cancelled&&(_.callback(n),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Wo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var lu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},_c=p.window.HTMLImageElement,ec=p.window.HTMLElement,Qi=p.window.ImageBitmap,Do={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Bc=function(n){function u(h){var _=this;if((h=p.extend({},Do,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var C=new ra(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(n.call(this,C,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Wo,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},lu,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof ec))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return _._update(!1)}),this.on("moveend",function(){return _._update(!1)}),this.on("zoom",function(){return _._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Hn(this,h),this._hash=h.hash&&new _s(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new as({customAttribution:h.customAttribution})),this.addControl(new js,h.logoPosition),this.on("style.load",function(){_.transform.unmodified&&_.jumpTo(_.style.stylesheet)}),this.on("data",function(P){_._update(P.dataType==="style"),_.fire(new p.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){_.fire(new p.Event(P.dataType+"dataloading",P))})}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,_){if(_===void 0&&(_=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var C=h.onAdd(this);this._controls.push(h);var P=this._controlPositions[_];return _.indexOf("bottom")!==-1?P.insertBefore(C,P.firstChild):P.appendChild(C),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var _=this._controls.indexOf(h);return _>-1&&this._controls.splice(_,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var _=this._containerDimensions(),C=_[0],P=_[1];this._resizeCanvas(C,P),this.transform.resize(C,P),this.painter.resize(C,P);var N=!this._moving;return N&&(this.stop(),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h))),this.fire(new p.Event("resize",h)),N&&this.fire(new p.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,_,C){var P,N=this;if(h==="mouseenter"||h==="mouseover"){var K=!1;return{layer:_,listener:C,delegates:{mousemove:function(Ce){var we=N.getLayer(_)?N.queryRenderedFeatures(Ce.point,{layers:[_]}):[];we.length?K||(K=!0,C.call(N,new Ro(h,N,Ce.originalEvent,{features:we}))):K=!1},mouseout:function(){K=!1}}}}if(h==="mouseleave"||h==="mouseout"){var oe=!1;return{layer:_,listener:C,delegates:{mousemove:function(Ce){(N.getLayer(_)?N.queryRenderedFeatures(Ce.point,{layers:[_]}):[]).length?oe=!0:oe&&(oe=!1,C.call(N,new Ro(h,N,Ce.originalEvent)))},mouseout:function(Ce){oe&&(oe=!1,C.call(N,new Ro(h,N,Ce.originalEvent)))}}}}return{layer:_,listener:C,delegates:(P={},P[h]=function(Ce){var we=N.getLayer(_)?N.queryRenderedFeatures(Ce.point,{layers:[_]}):[];we.length&&(Ce.features=we,C.call(N,Ce),delete Ce.features)},P)}},u.prototype.on=function(h,_,C){if(C===void 0)return n.prototype.on.call(this,h,_);var P=this._createDelegatedListener(h,_,C);for(var N in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(P),P.delegates)this.on(N,P.delegates[N]);return this},u.prototype.once=function(h,_,C){if(C===void 0)return n.prototype.once.call(this,h,_);var P=this._createDelegatedListener(h,_,C);for(var N in P.delegates)this.once(N,P.delegates[N]);return this},u.prototype.off=function(h,_,C){var P=this;return C===void 0?n.prototype.off.call(this,h,_):(this._delegatedListeners&&this._delegatedListeners[h]&&function(N){for(var K=N[h],oe=0;oe<K.length;oe++){var Ce=K[oe];if(Ce.layer===_&&Ce.listener===C){for(var we in Ce.delegates)P.off(we,Ce.delegates[we]);return K.splice(oe,1),P}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,_){if(!this.style)return[];var C;if(_!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(_=h,h=void 0),_=_||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")C=[p.Point.convert(h)];else{var P=p.Point.convert(h[0]),N=p.Point.convert(h[1]);C=[P,new p.Point(N.x,P.y),N,new p.Point(P.x,N.y),P]}return this.style.queryRenderedFeatures(C,_,this.transform)},u.prototype.querySourceFeatures=function(h,_){return this.style.querySourceFeatures(h,_)},u.prototype.setStyle=function(h,_){return(_=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},_)).diff!==!1&&_.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,_),this):(this._localIdeographFontFamily=_.localIdeographFontFamily,this._updateStyle(h,_))},u.prototype._getUIString=function(h){var _=this._locale[h];if(_==null)throw new Error("Missing UI string '"+h+"'");return _},u.prototype._updateStyle=function(h,_){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new ps(this,_||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ps(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,_){var C=this;if(typeof h=="string"){var P=this._requestManager.normalizeStyleURL(h),N=this._requestManager.transformRequest(P,p.ResourceType.Style);p.getJSON(N,function(K,oe){K?C.fire(new p.ErrorEvent(K)):oe&&C._updateDiff(oe,_)})}else typeof h=="object"&&this._updateDiff(h,_)},u.prototype._updateDiff=function(h,_){try{this.style.setState(h)&&this._update(!0)}catch(C){p.warnOnce("Unable to perform style diff: "+(C.message||C.error||C)+".  Rebuilding the style from scratch."),this._updateStyle(h,_)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,_){return this._lazyInitEmptyStyle(),this.style.addSource(h,_),this._update(!0)},u.prototype.isSourceLoaded=function(h){var _=this.style&&this.style.sourceCaches[h];if(_!==void 0)return _.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var _ in h){var C=h[_]._tiles;for(var P in C){var N=C[P];if(N.state!=="loaded"&&N.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,_,C){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,_,C)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,_,C){C===void 0&&(C={});var P=C.pixelRatio;P===void 0&&(P=1);var N=C.sdf;N===void 0&&(N=!1);var K=C.stretchX,oe=C.stretchY,Ce=C.content;if(this._lazyInitEmptyStyle(),_ instanceof _c||Qi&&_ instanceof Qi){var we=p.browser.getImageData(_);this.style.addImage(h,{data:new p.RGBAImage({width:we.width,height:we.height},we.data),pixelRatio:P,stretchX:K,stretchY:oe,content:Ce,sdf:N,version:0})}else{if(_.width===void 0||_.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ie=_;this.style.addImage(h,{data:new p.RGBAImage({width:_.width,height:_.height},new Uint8Array(_.data)),pixelRatio:P,stretchX:K,stretchY:oe,content:Ce,sdf:N,version:0,userImage:Ie}),Ie.onAdd&&Ie.onAdd(this,h)}},u.prototype.updateImage=function(h,_){var C=this.style.getImage(h);if(!C)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=_ instanceof _c||Qi&&_ instanceof Qi?p.browser.getImageData(_):_,N=P.width,K=P.height,oe=P.data;return N===void 0||K===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):N!==C.data.width||K!==C.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(C.data.replace(oe,!(_ instanceof _c||Qi&&_ instanceof Qi)),void this.style.updateImage(h,C))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,_){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),_)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,_){return this._lazyInitEmptyStyle(),this.style.addLayer(h,_),this._update(!0)},u.prototype.moveLayer=function(h,_){return this.style.moveLayer(h,_),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,_,C){return this.style.setLayerZoomRange(h,_,C),this._update(!0)},u.prototype.setFilter=function(h,_,C){return C===void 0&&(C={}),this.style.setFilter(h,_,C),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,_,C,P){return P===void 0&&(P={}),this.style.setPaintProperty(h,_,C,P),this._update(!0)},u.prototype.getPaintProperty=function(h,_){return this.style.getPaintProperty(h,_)},u.prototype.setLayoutProperty=function(h,_,C,P){return P===void 0&&(P={}),this.style.setLayoutProperty(h,_,C,P),this._update(!0)},u.prototype.getLayoutProperty=function(h,_){return this.style.getLayoutProperty(h,_)},u.prototype.setLight=function(h,_){return _===void 0&&(_={}),this._lazyInitEmptyStyle(),this.style.setLight(h,_),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,_){return this.style.setFeatureState(h,_),this._update()},u.prototype.removeFeatureState=function(h,_){return this.style.removeFeatureState(h,_),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,_=0;return this._container&&(h=this._container.clientWidth||400,_=this._container.clientHeight||300),[h,_]},u.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var _=this._canvasContainer=Z.create("div","mapboxgl-canvas-container",h);this._interactive&&_.classList.add("mapboxgl-interactive"),this._canvas=Z.create("canvas","mapboxgl-canvas",_),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var C=this._containerDimensions();this._resizeCanvas(C[0],C[1]);var P=this._controlContainer=Z.create("div","mapboxgl-control-container",h),N=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(K){N[K]=Z.create("div","mapboxgl-ctrl-"+K,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,_){var C=p.browser.devicePixelRatio||1;this._canvas.width=C*h,this._canvas.height=C*_,this._canvas.style.width=h+"px",this._canvas.style.height=_+"px"},u.prototype._setupPainter=function(){var h=p.extend({},E.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),_=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);_?(this.painter=new to(_,this.transform),p.webpSupported.testSupport(_)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var _,C=this,P=0,N=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(_=N.createQueryEXT(),N.beginQueryEXT(N.TIME_ELAPSED_EXT,_),P=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var K=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var oe=this.transform.zoom,Ce=p.browser.now();this.style.zoomHistory.update(oe,Ce);var we=new p.EvaluationParameters(oe,{now:Ce,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ie=we.crossFadingFactor();Ie===1&&Ie===this._crossFadingFactor||(K=!0,this._crossFadingFactor=Ie),this.style.update(we)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||K)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ke=p.browser.now()-P;N.endQueryEXT(N.TIME_ELAPSED_EXT,_),setTimeout(function(){var je=N.getQueryObjectEXT(_,N.QUERY_RESULT_EXT)/1e6;N.deleteQueryEXT(_),C.fire(new p.Event("gpu-timing-frame",{cpuTime:Ke,gpuTime:je}))},50)}if(this.listens("gpu-timing-layer")){var We=this.painter.collectGpuTimers();setTimeout(function(){var je=C.painter.queryGpuTimers(We);C.fire(new p.Event("gpu-timing-layer",{layerTimes:je}))},50)}var ot=this._sourcesDirty||this._styleDirty||this._placementDirty;return ot||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||ot||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,_=this._controls;h<_.length;h+=1)_[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),xs(this._canvasContainer),xs(this._controlContainer),xs(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(_){h._frame=null,h._render(_)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,_){p.setCacheLimits(h,_)},a.version.get=function(){return p.version},Object.defineProperties(u.prototype,a),u}(Il);function xs(n){n.parentNode&&n.parentNode.removeChild(n)}var Ol={showCompass:!0,showZoom:!0,visualizePitch:!1},bs=function(n){var u=this;this.options=p.extend({},Ol,n),this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(a){return a.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(a){return u._map.zoomIn({},{originalEvent:a})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(a){return u._map.zoomOut({},{originalEvent:a})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(a){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:a}):u._map.resetNorth({},{originalEvent:a})}),this._compassIcon=Z.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};bs.prototype._updateZoomButtons=function(){var n=this._map.getZoom(),u=n===this._map.getMaxZoom(),a=n===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},bs.prototype._rotateCompassArrow=function(){var n=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=n},bs.prototype.onAdd=function(n){return this._map=n,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new vs(this._map,this._compass,this.options.visualizePitch)),this._container},bs.prototype.onRemove=function(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},bs.prototype._createButton=function(n,u){var a=Z.create("button",n,this._container);return a.type="button",a.addEventListener("click",u),a},bs.prototype._setButtonTitle=function(n,u){var a=this._map._getUIString("NavigationControl."+u);n.title=a,n.setAttribute("aria-label",a)};var vs=function(n,u,a){a===void 0&&(a=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new Ql({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,a&&(this.mousePitch=new Du({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Z.addEventListener(u,"mousedown",this.mousedown),Z.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(u,"touchmove",this.touchmove),Z.addEventListener(u,"touchend",this.touchend),Z.addEventListener(u,"touchcancel",this.reset)};function pl(n,u,a){if(n=new p.LngLat(n.lng,n.lat),u){var h=new p.LngLat(n.lng-360,n.lat),_=new p.LngLat(n.lng+360,n.lat),C=a.locationPoint(n).distSqr(u);a.locationPoint(h).distSqr(u)<C?n=h:a.locationPoint(_).distSqr(u)<C&&(n=_)}for(;Math.abs(n.lng-a.center.lng)>180;){var P=a.locationPoint(n);if(P.x>=0&&P.y>=0&&P.x<=a.width&&P.y<=a.height)break;n.lng>a.center.lng?n.lng-=360:n.lng+=360}return n}vs.prototype.down=function(n,u){this.mouseRotate.mousedown(n,u),this.mousePitch&&this.mousePitch.mousedown(n,u),Z.disableDrag()},vs.prototype.move=function(n,u){var a=this.map,h=this.mouseRotate.mousemoveWindow(n,u);if(h&&h.bearingDelta&&a.setBearing(a.getBearing()+h.bearingDelta),this.mousePitch){var _=this.mousePitch.mousemoveWindow(n,u);_&&_.pitchDelta&&a.setPitch(a.getPitch()+_.pitchDelta)}},vs.prototype.off=function(){var n=this.element;Z.removeEventListener(n,"mousedown",this.mousedown),Z.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(n,"touchmove",this.touchmove),Z.removeEventListener(n,"touchend",this.touchend),Z.removeEventListener(n,"touchcancel",this.reset),this.offTemp()},vs.prototype.offTemp=function(){Z.enableDrag(),Z.removeEventListener(p.window,"mousemove",this.mousemove),Z.removeEventListener(p.window,"mouseup",this.mouseup)},vs.prototype.mousedown=function(n){this.down(p.extend({},n,{ctrlKey:!0,preventDefault:function(){return n.preventDefault()}}),Z.mousePos(this.element,n)),Z.addEventListener(p.window,"mousemove",this.mousemove),Z.addEventListener(p.window,"mouseup",this.mouseup)},vs.prototype.mousemove=function(n){this.move(n,Z.mousePos(this.element,n))},vs.prototype.mouseup=function(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()},vs.prototype.touchstart=function(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return n.preventDefault()}},this._startPos))},vs.prototype.touchmove=function(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:function(){return n.preventDefault()}},this._lastPos))},vs.prototype.touchend=function(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},vs.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var cu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function tc(n,u,a){var h=n.classList;for(var _ in cu)h.remove("mapboxgl-"+a+"-anchor-"+_);h.add("mapboxgl-"+a+"-anchor-"+u)}var Ju,dl=function(n){function u(a,h){if(n.call(this),(a instanceof p.window.HTMLElement||h)&&(a=p.extend({element:a},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,a&&a.element)this._element=a.element,this._offset=p.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div"),this._element.setAttribute("aria-label","Map marker");var _=Z.createNS("http://www.w3.org/2000/svg","svg");_.setAttributeNS(null,"display","block"),_.setAttributeNS(null,"height","41px"),_.setAttributeNS(null,"width","27px"),_.setAttributeNS(null,"viewBox","0 0 27 41");var C=Z.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");var P=Z.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var N=Z.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(3.0, 29.0)"),N.setAttributeNS(null,"fill","#000000");for(var K=0,oe=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];K<oe.length;K+=1){var Ce=oe[K],we=Z.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",Ce.rx),we.setAttributeNS(null,"ry",Ce.ry),N.appendChild(we)}var Ie=Z.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"fill",this._color);var Ke=Z.createNS("http://www.w3.org/2000/svg","path");Ke.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ie.appendChild(Ke);var We=Z.createNS("http://www.w3.org/2000/svg","g");We.setAttributeNS(null,"opacity","0.25"),We.setAttributeNS(null,"fill","#000000");var ot=Z.createNS("http://www.w3.org/2000/svg","path");ot.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),We.appendChild(ot);var je=Z.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"transform","translate(6.0, 7.0)"),je.setAttributeNS(null,"fill","#FFFFFF");var st=Z.createNS("http://www.w3.org/2000/svg","g");st.setAttributeNS(null,"transform","translate(8.0, 8.0)");var wt=Z.createNS("http://www.w3.org/2000/svg","circle");wt.setAttributeNS(null,"fill","#000000"),wt.setAttributeNS(null,"opacity","0.25"),wt.setAttributeNS(null,"cx","5.5"),wt.setAttributeNS(null,"cy","5.5"),wt.setAttributeNS(null,"r","5.4999962");var Wt=Z.createNS("http://www.w3.org/2000/svg","circle");Wt.setAttributeNS(null,"fill","#FFFFFF"),Wt.setAttributeNS(null,"cx","5.5"),Wt.setAttributeNS(null,"cy","5.5"),Wt.setAttributeNS(null,"r","5.4999962"),st.appendChild(wt),st.appendChild(Wt),P.appendChild(N),P.appendChild(Ie),P.appendChild(We),P.appendChild(je),P.appendChild(st),_.appendChild(P),_.setAttributeNS(null,"height",41*this._scale+"px"),_.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(_),this._offset=p.Point.convert(a&&a.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(gr){gr.preventDefault()}),this._element.addEventListener("mousedown",function(gr){gr.preventDefault()}),tc(this._element,this._anchor,"marker"),this._popup=null}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.addTo=function(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(a){var h=a.code,_=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&_!==32&&_!==13||this.togglePopup()},u.prototype._onMapClick=function(a){var h=a.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this},u.prototype._update=function(a){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=pl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_="rotateX("+this._map.getPitch()+"deg)"),a&&a.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,cu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+_+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(a){return this._offset=p.Point.convert(a),this._update(),this},u.prototype._onMove=function(a){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(a){return this._rotation=a||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(a){return this._rotationAlignment=a||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(p.Evented),Nc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ll=0,vl=!1,xc=function(n){function u(a){n.call(this),this.options=p.extend({},Nc,a),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.onAdd=function(a){var h;return this._map=a,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,Ju!==void 0?h(Ju):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(_){h(Ju=_.state!=="denied")}):h(Ju=!!p.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ll=0,vl=!1},u.prototype._isOutOfMapMaxBounds=function(a){var h=this._map.getMaxBounds(),_=a.coords;return h&&(_.longitude<h.getWest()||_.longitude>h.getEast()||_.latitude<h.getSouth()||_.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(a){if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",a)),this._finish()}},u.prototype._updateCamera=function(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude),_=a.coords.accuracy,C=this._map.getBearing(),P=p.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(_),P,{geolocateSource:!0})},u.prototype._updateMarker=function(a){if(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var a=this._map._container.clientHeight/2,h=this._map.unproject([0,a]),_=this._map.unproject([1,a]),C=h.distanceTo(_),P=Math.ceil(2*this._accuracy/C);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(a){if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&vl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",a)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(a){var h=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=Z.create("button","mapboxgl-ctrl-geolocate",this._container),Z.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",a===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var _=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=_,this._geolocateButton.setAttribute("aria-label",_)}else{var C=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new dl(this._dotElement),this._circleElement=Z.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||h._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ll--,vl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var a;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Ll>1?(a={maximumAge:6e5,timeout:0},vl=!0):(a=this.options.positionOptions,vl=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,a)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(p.Evented),Qu={maxWidth:100,unit:"metric"},Fu=function(n){this.options=p.extend({},Qu,n),p.bindAll(["_onMove","setUnit"],this)};function rc(n,u,a){var h=a&&a.maxWidth||100,_=n._container.clientHeight/2,C=n.unproject([0,_]),P=n.unproject([h,_]),N=C.distanceTo(P);if(a&&a.unit==="imperial"){var K=3.2808*N;K>5280?Bu(u,h,K/5280,n._getUIString("ScaleControl.Miles")):Bu(u,h,K,n._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Bu(u,h,N/1852,n._getUIString("ScaleControl.NauticalMiles")):N>=1e3?Bu(u,h,N/1e3,n._getUIString("ScaleControl.Kilometers")):Bu(u,h,N,n._getUIString("ScaleControl.Meters"))}function Bu(n,u,a,h){var _,C,P,N=(_=a,(C=Math.pow(10,(""+Math.floor(_)).length-1))*(P=(P=_/C)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(K){var oe=Math.pow(10,Math.ceil(-Math.log(K)/Math.LN10));return Math.round(K*oe)/oe}(P)));n.style.width=u*(N/a)+"px",n.innerHTML=N+"&nbsp;"+h}Fu.prototype.getDefaultPosition=function(){return"bottom-left"},Fu.prototype._onMove=function(){rc(this._map,this._container,this.options)},Fu.prototype.onAdd=function(n){return this._map=n,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",n.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Fu.prototype.onRemove=function(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Fu.prototype.setUnit=function(n){this.options.unit=n,rc(this._map,this._container,this.options)};var Vs=function(n){this._fullscreen=!1,n&&n.container&&(n.container instanceof p.window.HTMLElement?this._container=n.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};Vs.prototype.onAdd=function(n){return this._map=n,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Vs.prototype.onRemove=function(){Z.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Vs.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},Vs.prototype._setupUI=function(){var n=this._fullscreenButton=Z.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z.create("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden",!0),n.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Vs.prototype._updateTitle=function(){var n=this._getTitle();this._fullscreenButton.setAttribute("aria-label",n),this._fullscreenButton.title=n},Vs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Vs.prototype._isFullscreen=function(){return this._fullscreen},Vs.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Vs.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var bc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Nu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),nc=function(n){function u(a){n.call(this),this.options=p.extend(Object.create(bc),a),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.addTo=function(a){return this._map&&this.remove(),this._map=a,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(a){return this.setDOMContent(p.window.document.createTextNode(a))},u.prototype.setHTML=function(a){var h,_=p.window.document.createDocumentFragment(),C=p.window.document.createElement("body");for(C.innerHTML=a;h=C.firstChild;)_.appendChild(h);return this.setDOMContent(_)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(a){return this.options.maxWidth=a,this._update(),this},u.prototype.setDOMContent=function(a){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(a),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(a){this._container&&this._container.classList.add(a)},u.prototype.removeClassName=function(a){this._container&&this._container.classList.remove(a)},u.prototype.setOffset=function(a){return this.options.offset=a,this._update(),this},u.prototype.toggleClassName=function(a){if(this._container)return this._container.classList.toggle(a)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Z.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(a){this._update(a.point)},u.prototype._onMouseMove=function(a){this._update(a.point)},u.prototype._onDrag=function(a){this._update(a.point)},u.prototype._update=function(a){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Z.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Z.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(we){return h._container.classList.add(we)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||a)){var _=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat),C=this.options.anchor,P=function we(Ie){if(Ie){if(typeof Ie=="number"){var Ke=Math.round(Math.sqrt(.5*Math.pow(Ie,2)));return{center:new p.Point(0,0),top:new p.Point(0,Ie),"top-left":new p.Point(Ke,Ke),"top-right":new p.Point(-Ke,Ke),bottom:new p.Point(0,-Ie),"bottom-left":new p.Point(Ke,-Ke),"bottom-right":new p.Point(-Ke,-Ke),left:new p.Point(Ie,0),right:new p.Point(-Ie,0)}}if(Ie instanceof p.Point||Array.isArray(Ie)){var We=p.Point.convert(Ie);return{center:We,top:We,"top-left":We,"top-right":We,bottom:We,"bottom-left":We,"bottom-right":We,left:We,right:We}}return{center:p.Point.convert(Ie.center||[0,0]),top:p.Point.convert(Ie.top||[0,0]),"top-left":p.Point.convert(Ie["top-left"]||[0,0]),"top-right":p.Point.convert(Ie["top-right"]||[0,0]),bottom:p.Point.convert(Ie.bottom||[0,0]),"bottom-left":p.Point.convert(Ie["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(Ie["bottom-right"]||[0,0]),left:p.Point.convert(Ie.left||[0,0]),right:p.Point.convert(Ie.right||[0,0])}}return we(new p.Point(0,0))}(this.options.offset);if(!C){var N,K=this._container.offsetWidth,oe=this._container.offsetHeight;N=_.y+P.bottom.y<oe?["top"]:_.y>this._map.transform.height-oe?["bottom"]:[],_.x<K/2?N.push("left"):_.x>this._map.transform.width-K/2&&N.push("right"),C=N.length===0?"bottom":N.join("-")}var Ce=_.add(P[C]).round();Z.setTransform(this._container,cu[C]+" translate("+Ce.x+"px,"+Ce.y+"px)"),tc(this._container,C,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var a=this._container.querySelector(Nu);a&&a.focus()}},u.prototype._onClose=function(){this.remove()},u}(p.Evented),qu={version:p.version,supported:E,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:Bc,NavigationControl:bs,GeolocateControl:xc,AttributionControl:as,ScaleControl:Fu,FullscreenControl:Vs,Popup:nc,Marker:dl,Style:ps,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){tr().acquire(nr)},clearPrewarmedResources:function(){var n=Mn;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(nr),Mn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(n){p.config.ACCESS_TOKEN=n},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(n){p.config.API_URL=n},get workerCount(){return kr.workerCount},set workerCount(n){kr.workerCount=n},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(n){p.config.MAX_PARALLEL_IMAGE_REQUESTS=n},clearStorage:function(n){p.clearTileCache(n)},workerUrl:""};return qu}),U})},28660:function(Qe,D,g){var U=g(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var b;(function(p){(function(E){var Z=typeof g.g=="object"?g.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),V=H(p);typeof Z.Reflect=="undefined"?Z.Reflect=p:V=H(Z.Reflect,V),E(V);function H(I,L){return function(_e,xe){typeof I[_e]!="function"&&Object.defineProperty(I,_e,{configurable:!0,writable:!0,value:xe}),L&&L(_e,xe)}}})(function(E){var Z=Object.prototype.hasOwnProperty,V=typeof Symbol=="function",H=V&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",I=V&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",L=typeof Object.create=="function",_e={__proto__:[]}instanceof Array,xe=!L&&!_e,Re={create:L?function(){return Mr(Object.create(null))}:_e?function(){return Mr({__proto__:null})}:function(){return Mr({})},has:xe?function(nt,xt){return Z.call(nt,xt)}:function(nt,xt){return xt in nt},get:xe?function(nt,xt){return Z.call(nt,xt)?nt[xt]:void 0}:function(nt,xt){return nt[xt]}},$e=Object.getPrototypeOf(Function),Rt=typeof U=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Lt=!Rt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ne(),zt=!Rt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Kt(),St=!Rt&&typeof WeakMap=="function"?WeakMap:Dr(),Et=new St;function at(nt,xt,ht,vr){if(pn(ht)){if(!T(nt))throw new TypeError;if(!Se(xt))throw new TypeError;return Jt(nt,xt)}else{if(!T(nt))throw new TypeError;if(!pe(xt))throw new TypeError;if(!pe(vr)&&!pn(vr)&&!Vi(vr))throw new TypeError;return Vi(vr)&&(vr=void 0),ht=ir(ht),Fr(nt,xt,ht,vr)}}E("decorate",at);function ur(nt,xt){function ht(vr,Zr){if(!pe(vr))throw new TypeError;if(!pn(Zr)&&!Be(Zr))throw new TypeError;Zt(nt,xt,vr,Zr)}return ht}E("metadata",ur);function ee(nt,xt,ht,vr){if(!pe(ht))throw new TypeError;return pn(vr)||(vr=ir(vr)),Zt(nt,xt,ht,vr)}E("defineMetadata",ee);function fr(nt,xt,ht){if(!pe(xt))throw new TypeError;return pn(ht)||(ht=ir(ht)),Fe(nt,xt,ht)}E("hasMetadata",fr);function At(nt,xt,ht){if(!pe(xt))throw new TypeError;return pn(ht)||(ht=ir(ht)),me(nt,xt,ht)}E("hasOwnMetadata",At);function Je(nt,xt,ht){if(!pe(xt))throw new TypeError;return pn(ht)||(ht=ir(ht)),bt(nt,xt,ht)}E("getMetadata",Je);function Pt(nt,xt,ht){if(!pe(xt))throw new TypeError;return pn(ht)||(ht=ir(ht)),vt(nt,xt,ht)}E("getOwnMetadata",Pt);function Ve(nt,xt){if(!pe(nt))throw new TypeError;return pn(xt)||(xt=ir(xt)),Ut(nt,xt)}E("getMetadataKeys",Ve);function It(nt,xt){if(!pe(nt))throw new TypeError;return pn(xt)||(xt=ir(xt)),Rr(nt,xt)}E("getOwnMetadataKeys",It);function hr(nt,xt,ht){if(!pe(xt))throw new TypeError;pn(ht)||(ht=ir(ht));var vr=fe(xt,ht,!1);if(pn(vr)||!vr.delete(nt))return!1;if(vr.size>0)return!0;var Zr=Et.get(xt);return Zr.delete(ht),Zr.size>0||Et.delete(xt),!0}E("deleteMetadata",hr);function Jt(nt,xt){for(var ht=nt.length-1;ht>=0;--ht){var vr=nt[ht],Zr=vr(xt);if(!pn(Zr)&&!Vi(Zr)){if(!Se(Zr))throw new TypeError;xt=Zr}}return xt}function Fr(nt,xt,ht,vr){for(var Zr=nt.length-1;Zr>=0;--Zr){var Ur=nt[Zr],tn=Ur(xt,ht,vr);if(!pn(tn)&&!Vi(tn)){if(!pe(tn))throw new TypeError;vr=tn}}return vr}function fe(nt,xt,ht){var vr=Et.get(nt);if(pn(vr)){if(!ht)return;vr=new Lt,Et.set(nt,vr)}var Zr=vr.get(xt);if(pn(Zr)){if(!ht)return;Zr=new Lt,vr.set(xt,Zr)}return Zr}function Fe(nt,xt,ht){var vr=me(nt,xt,ht);if(vr)return!0;var Zr=Qt(xt);return Vi(Zr)?!1:Fe(nt,Zr,ht)}function me(nt,xt,ht){var vr=fe(xt,ht,!1);return pn(vr)?!1:ke(vr.has(nt))}function bt(nt,xt,ht){var vr=me(nt,xt,ht);if(vr)return vt(nt,xt,ht);var Zr=Qt(xt);if(!Vi(Zr))return bt(nt,Zr,ht)}function vt(nt,xt,ht){var vr=fe(xt,ht,!1);if(!pn(vr))return vr.get(nt)}function Zt(nt,xt,ht,vr){var Zr=fe(ht,vr,!0);Zr.set(nt,xt)}function Ut(nt,xt){var ht=Rr(nt,xt),vr=Qt(nt);if(vr===null)return ht;var Zr=Ut(vr,xt);if(Zr.length<=0)return ht;if(ht.length<=0)return Zr;for(var Ur=new zt,tn=[],jr=0,wr=ht;jr<wr.length;jr++){var Dn=wr[jr],Zn=Ur.has(Dn);Zn||(Ur.add(Dn),tn.push(Dn))}for(var bi=0,Hi=Zr;bi<Hi.length;bi++){var Dn=Hi[bi],Zn=Ur.has(Dn);Zn||(Ur.add(Dn),tn.push(Dn))}return tn}function Rr(nt,xt){var ht=[],vr=fe(nt,xt,!1);if(pn(vr))return ht;for(var Zr=vr.keys(),Ur=tt(Zr),tn=0;;){var jr=jt(Ur);if(!jr)return ht.length=tn,ht;var wr=Ct(jr);try{ht[tn]=wr}catch(Dn){try{Mt(Ur)}finally{throw Dn}}tn++}}function ln(nt){if(nt===null)return 1;switch(typeof nt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return nt===null?1:6;default:return 6}}function pn(nt){return nt===void 0}function Vi(nt){return nt===null}function ar(nt){return typeof nt=="symbol"}function pe(nt){return typeof nt=="object"?nt!==null:typeof nt=="function"}function Pe(nt,xt){switch(ln(nt)){case 0:return nt;case 1:return nt;case 2:return nt;case 3:return nt;case 4:return nt;case 5:return nt}var ht=xt===3?"string":xt===5?"number":"default",vr=et(nt,H);if(vr!==void 0){var Zr=vr.call(nt,ht);if(pe(Zr))throw new TypeError;return Zr}return Ge(nt,ht==="default"?"number":ht)}function Ge(nt,xt){if(xt==="string"){var ht=nt.toString;if(G(ht)){var vr=ht.call(nt);if(!pe(vr))return vr}var Zr=nt.valueOf;if(G(Zr)){var vr=Zr.call(nt);if(!pe(vr))return vr}}else{var Zr=nt.valueOf;if(G(Zr)){var vr=Zr.call(nt);if(!pe(vr))return vr}var Ur=nt.toString;if(G(Ur)){var vr=Ur.call(nt);if(!pe(vr))return vr}}throw new TypeError}function ke(nt){return!!nt}function Ft(nt){return""+nt}function ir(nt){var xt=Pe(nt,3);return ar(xt)?xt:Ft(xt)}function T(nt){return Array.isArray?Array.isArray(nt):nt instanceof Object?nt instanceof Array:Object.prototype.toString.call(nt)==="[object Array]"}function G(nt){return typeof nt=="function"}function Se(nt){return typeof nt=="function"}function Be(nt){switch(ln(nt)){case 3:return!0;case 4:return!0;default:return!1}}function et(nt,xt){var ht=nt[xt];if(ht!=null){if(!G(ht))throw new TypeError;return ht}}function tt(nt){var xt=et(nt,I);if(!G(xt))throw new TypeError;var ht=xt.call(nt);if(!pe(ht))throw new TypeError;return ht}function Ct(nt){return nt.value}function jt(nt){var xt=nt.next();return xt.done?!1:xt}function Mt(nt){var xt=nt.return;xt&&xt.call(nt)}function Qt(nt){var xt=Object.getPrototypeOf(nt);if(typeof nt!="function"||nt===$e||xt!==$e)return xt;var ht=nt.prototype,vr=ht&&Object.getPrototypeOf(ht);if(vr==null||vr===Object.prototype)return xt;var Zr=vr.constructor;return typeof Zr!="function"||Zr===nt?xt:Zr}function ne(){var nt={},xt=[],ht=function(){function tn(jr,wr,Dn){this._index=0,this._keys=jr,this._values=wr,this._selector=Dn}return tn.prototype["@@iterator"]=function(){return this},tn.prototype[I]=function(){return this},tn.prototype.next=function(){var jr=this._index;if(jr>=0&&jr<this._keys.length){var wr=this._selector(this._keys[jr],this._values[jr]);return jr+1>=this._keys.length?(this._index=-1,this._keys=xt,this._values=xt):this._index++,{value:wr,done:!1}}return{value:void 0,done:!0}},tn.prototype.throw=function(jr){throw this._index>=0&&(this._index=-1,this._keys=xt,this._values=xt),jr},tn.prototype.return=function(jr){return this._index>=0&&(this._index=-1,this._keys=xt,this._values=xt),{value:jr,done:!0}},tn}();return function(){function tn(){this._keys=[],this._values=[],this._cacheKey=nt,this._cacheIndex=-2}return Object.defineProperty(tn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),tn.prototype.has=function(jr){return this._find(jr,!1)>=0},tn.prototype.get=function(jr){var wr=this._find(jr,!1);return wr>=0?this._values[wr]:void 0},tn.prototype.set=function(jr,wr){var Dn=this._find(jr,!0);return this._values[Dn]=wr,this},tn.prototype.delete=function(jr){var wr=this._find(jr,!1);if(wr>=0){for(var Dn=this._keys.length,Zn=wr+1;Zn<Dn;Zn++)this._keys[Zn-1]=this._keys[Zn],this._values[Zn-1]=this._values[Zn];return this._keys.length--,this._values.length--,jr===this._cacheKey&&(this._cacheKey=nt,this._cacheIndex=-2),!0}return!1},tn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=nt,this._cacheIndex=-2},tn.prototype.keys=function(){return new ht(this._keys,this._values,vr)},tn.prototype.values=function(){return new ht(this._keys,this._values,Zr)},tn.prototype.entries=function(){return new ht(this._keys,this._values,Ur)},tn.prototype["@@iterator"]=function(){return this.entries()},tn.prototype[I]=function(){return this.entries()},tn.prototype._find=function(jr,wr){return this._cacheKey!==jr&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=jr)),this._cacheIndex<0&&wr&&(this._cacheIndex=this._keys.length,this._keys.push(jr),this._values.push(void 0)),this._cacheIndex},tn}();function vr(tn,jr){return tn}function Zr(tn,jr){return jr}function Ur(tn,jr){return[tn,jr]}}function Kt(){return function(){function nt(){this._map=new Lt}return Object.defineProperty(nt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),nt.prototype.has=function(xt){return this._map.has(xt)},nt.prototype.add=function(xt){return this._map.set(xt,xt),this},nt.prototype.delete=function(xt){return this._map.delete(xt)},nt.prototype.clear=function(){this._map.clear()},nt.prototype.keys=function(){return this._map.keys()},nt.prototype.values=function(){return this._map.values()},nt.prototype.entries=function(){return this._map.entries()},nt.prototype["@@iterator"]=function(){return this.keys()},nt.prototype[I]=function(){return this.keys()},nt}()}function Dr(){var nt=16,xt=Re.create(),ht=vr();return function(){function wr(){this._key=vr()}return wr.prototype.has=function(Dn){var Zn=Zr(Dn,!1);return Zn!==void 0?Re.has(Zn,this._key):!1},wr.prototype.get=function(Dn){var Zn=Zr(Dn,!1);return Zn!==void 0?Re.get(Zn,this._key):void 0},wr.prototype.set=function(Dn,Zn){var bi=Zr(Dn,!0);return bi[this._key]=Zn,this},wr.prototype.delete=function(Dn){var Zn=Zr(Dn,!1);return Zn!==void 0?delete Zn[this._key]:!1},wr.prototype.clear=function(){this._key=vr()},wr}();function vr(){var wr;do wr="@@WeakMap@@"+jr();while(Re.has(xt,wr));return xt[wr]=!0,wr}function Zr(wr,Dn){if(!Z.call(wr,ht)){if(!Dn)return;Object.defineProperty(wr,ht,{value:Re.create()})}return wr[ht]}function Ur(wr,Dn){for(var Zn=0;Zn<Dn;++Zn)wr[Zn]=Math.random()*255|0;return wr}function tn(wr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(wr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(wr)):Ur(new Uint8Array(wr),wr):Ur(new Array(wr),wr)}function jr(){var wr=tn(nt);wr[6]=wr[6]&79|64,wr[8]=wr[8]&191|128;for(var Dn="",Zn=0;Zn<nt;++Zn){var bi=wr[Zn];(Zn===4||Zn===6||Zn===8)&&(Dn+="-"),bi<16&&(Dn+="0"),Dn+=bi.toString(16).toLowerCase()}return Dn}}function Mr(nt){return nt.__=void 0,delete nt.__,nt}})})(b||(b={}))},69848:function(Qe){(function(D,g){Qe.exports=g()})(this,function(){"use strict";function D(At,Je,Pt,Ve,It,hr){if(!(It-Ve<=Pt)){var Jt=Ve+It>>1;g(At,Je,Jt,Ve,It,hr%2),D(At,Je,Pt,Ve,Jt-1,hr+1),D(At,Je,Pt,Jt+1,It,hr+1)}}function g(At,Je,Pt,Ve,It,hr){for(;It>Ve;){if(It-Ve>600){var Jt=It-Ve+1,Fr=Pt-Ve+1,fe=Math.log(Jt),Fe=.5*Math.exp(2*fe/3),me=.5*Math.sqrt(fe*Fe*(Jt-Fe)/Jt)*(Fr-Jt/2<0?-1:1),bt=Math.max(Ve,Math.floor(Pt-Fr*Fe/Jt+me)),vt=Math.min(It,Math.floor(Pt+(Jt-Fr)*Fe/Jt+me));g(At,Je,Pt,bt,vt,hr)}var Zt=Je[2*Pt+hr],Ut=Ve,Rr=It;for(U(At,Je,Ve,Pt),Je[2*It+hr]>Zt&&U(At,Je,Ve,It);Ut<Rr;){for(U(At,Je,Ut,Rr),Ut++,Rr--;Je[2*Ut+hr]<Zt;)Ut++;for(;Je[2*Rr+hr]>Zt;)Rr--}Je[2*Ve+hr]===Zt?U(At,Je,Ve,Rr):(Rr++,U(At,Je,Rr,It)),Rr<=Pt&&(Ve=Rr+1),Pt<=Rr&&(It=Rr-1)}}function U(At,Je,Pt,Ve){b(At,Pt,Ve),b(Je,2*Pt,2*Ve),b(Je,2*Pt+1,2*Ve+1)}function b(At,Je,Pt){var Ve=At[Je];At[Je]=At[Pt],At[Pt]=Ve}function p(At,Je,Pt,Ve,It,hr,Jt){for(var Fr=[0,At.length-1,0],fe=[],Fe,me;Fr.length;){var bt=Fr.pop(),vt=Fr.pop(),Zt=Fr.pop();if(vt-Zt<=Jt){for(var Ut=Zt;Ut<=vt;Ut++)Fe=Je[2*Ut],me=Je[2*Ut+1],Fe>=Pt&&Fe<=It&&me>=Ve&&me<=hr&&fe.push(At[Ut]);continue}var Rr=Math.floor((Zt+vt)/2);Fe=Je[2*Rr],me=Je[2*Rr+1],Fe>=Pt&&Fe<=It&&me>=Ve&&me<=hr&&fe.push(At[Rr]);var ln=(bt+1)%2;(bt===0?Pt<=Fe:Ve<=me)&&(Fr.push(Zt),Fr.push(Rr-1),Fr.push(ln)),(bt===0?It>=Fe:hr>=me)&&(Fr.push(Rr+1),Fr.push(vt),Fr.push(ln))}return fe}function E(At,Je,Pt,Ve,It,hr){for(var Jt=[0,At.length-1,0],Fr=[],fe=It*It;Jt.length;){var Fe=Jt.pop(),me=Jt.pop(),bt=Jt.pop();if(me-bt<=hr){for(var vt=bt;vt<=me;vt++)Z(Je[2*vt],Je[2*vt+1],Pt,Ve)<=fe&&Fr.push(At[vt]);continue}var Zt=Math.floor((bt+me)/2),Ut=Je[2*Zt],Rr=Je[2*Zt+1];Z(Ut,Rr,Pt,Ve)<=fe&&Fr.push(At[Zt]);var ln=(Fe+1)%2;(Fe===0?Pt-It<=Ut:Ve-It<=Rr)&&(Jt.push(bt),Jt.push(Zt-1),Jt.push(ln)),(Fe===0?Pt+It>=Ut:Ve+It>=Rr)&&(Jt.push(Zt+1),Jt.push(me),Jt.push(ln))}return Fr}function Z(At,Je,Pt,Ve){var It=At-Pt,hr=Je-Ve;return It*It+hr*hr}var V=function(At){return At[0]},H=function(At){return At[1]},I=function(Je,Pt,Ve,It,hr){Pt===void 0&&(Pt=V),Ve===void 0&&(Ve=H),It===void 0&&(It=64),hr===void 0&&(hr=Float64Array),this.nodeSize=It,this.points=Je;for(var Jt=Je.length<65536?Uint16Array:Uint32Array,Fr=this.ids=new Jt(Je.length),fe=this.coords=new hr(Je.length*2),Fe=0;Fe<Je.length;Fe++)Fr[Fe]=Fe,fe[2*Fe]=Pt(Je[Fe]),fe[2*Fe+1]=Ve(Je[Fe]);D(Fr,fe,It,0,Fr.length-1,0)};I.prototype.range=function(Je,Pt,Ve,It){return p(this.ids,this.coords,Je,Pt,Ve,It,this.nodeSize)},I.prototype.within=function(Je,Pt,Ve){return E(this.ids,this.coords,Je,Pt,Ve,this.nodeSize)};var L={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(At){return At}},_e=Math.fround||function(At){return function(Je){return At[0]=+Je,At[0]}}(new Float32Array(1)),xe=function(Je){this.options=ur(Object.create(L),Je),this.trees=new Array(this.options.maxZoom+1)};xe.prototype.load=function(Je){var Pt=this.options,Ve=Pt.log,It=Pt.minZoom,hr=Pt.maxZoom,Jt=Pt.nodeSize;Ve&&console.time("total time");var Fr="prepare "+Je.length+" points";Ve&&console.time(Fr),this.points=Je;for(var fe=[],Fe=0;Fe<Je.length;Fe++)!Je[Fe].geometry||fe.push($e(Je[Fe],Fe));this.trees[hr+1]=new I(fe,ee,fr,Jt,Float32Array),Ve&&console.timeEnd(Fr);for(var me=hr;me>=It;me--){var bt=+Date.now();fe=this._cluster(fe,me),this.trees[me]=new I(fe,ee,fr,Jt,Float32Array),Ve&&console.log("z%d: %d clusters in %dms",me,fe.length,+Date.now()-bt)}return Ve&&console.timeEnd("total time"),this},xe.prototype.getClusters=function(Je,Pt){var Ve=((Je[0]+180)%360+360)%360-180,It=Math.max(-90,Math.min(90,Je[1])),hr=Je[2]===180?180:((Je[2]+180)%360+360)%360-180,Jt=Math.max(-90,Math.min(90,Je[3]));if(Je[2]-Je[0]>=360)Ve=-180,hr=180;else if(Ve>hr){var Fr=this.getClusters([Ve,It,180,Jt],Pt),fe=this.getClusters([-180,It,hr,Jt],Pt);return Fr.concat(fe)}for(var Fe=this.trees[this._limitZoom(Pt)],me=Fe.range(zt(Ve),St(Jt),zt(hr),St(It)),bt=[],vt=0,Zt=me;vt<Zt.length;vt+=1){var Ut=Zt[vt],Rr=Fe.points[Ut];bt.push(Rr.numPoints?Rt(Rr):this.points[Rr.index])}return bt},xe.prototype.getChildren=function(Je){var Pt=this._getOriginId(Je),Ve=this._getOriginZoom(Je),It="No cluster with the specified id.",hr=this.trees[Ve];if(!hr)throw new Error(It);var Jt=hr.points[Pt];if(!Jt)throw new Error(It);for(var Fr=this.options.radius/(this.options.extent*Math.pow(2,Ve-1)),fe=hr.within(Jt.x,Jt.y,Fr),Fe=[],me=0,bt=fe;me<bt.length;me+=1){var vt=bt[me],Zt=hr.points[vt];Zt.parentId===Je&&Fe.push(Zt.numPoints?Rt(Zt):this.points[Zt.index])}if(Fe.length===0)throw new Error(It);return Fe},xe.prototype.getLeaves=function(Je,Pt,Ve){Pt=Pt||10,Ve=Ve||0;var It=[];return this._appendLeaves(It,Je,Pt,Ve,0),It},xe.prototype.getTile=function(Je,Pt,Ve){var It=this.trees[this._limitZoom(Je)],hr=Math.pow(2,Je),Jt=this.options,Fr=Jt.extent,fe=Jt.radius,Fe=fe/Fr,me=(Ve-Fe)/hr,bt=(Ve+1+Fe)/hr,vt={features:[]};return this._addTileFeatures(It.range((Pt-Fe)/hr,me,(Pt+1+Fe)/hr,bt),It.points,Pt,Ve,hr,vt),Pt===0&&this._addTileFeatures(It.range(1-Fe/hr,me,1,bt),It.points,hr,Ve,hr,vt),Pt===hr-1&&this._addTileFeatures(It.range(0,me,Fe/hr,bt),It.points,-1,Ve,hr,vt),vt.features.length?vt:null},xe.prototype.getClusterExpansionZoom=function(Je){for(var Pt=this._getOriginZoom(Je)-1;Pt<=this.options.maxZoom;){var Ve=this.getChildren(Je);if(Pt++,Ve.length!==1)break;Je=Ve[0].properties.cluster_id}return Pt},xe.prototype._appendLeaves=function(Je,Pt,Ve,It,hr){for(var Jt=this.getChildren(Pt),Fr=0,fe=Jt;Fr<fe.length;Fr+=1){var Fe=fe[Fr],me=Fe.properties;if(me&&me.cluster?hr+me.point_count<=It?hr+=me.point_count:hr=this._appendLeaves(Je,me.cluster_id,Ve,It,hr):hr<It?hr++:Je.push(Fe),Je.length===Ve)break}return hr},xe.prototype._addTileFeatures=function(Je,Pt,Ve,It,hr,Jt){for(var Fr=0,fe=Je;Fr<fe.length;Fr+=1){var Fe=fe[Fr],me=Pt[Fe],bt=me.numPoints,vt=void 0,Zt=void 0,Ut=void 0;if(bt)vt=Lt(me),Zt=me.x,Ut=me.y;else{var Rr=this.points[me.index];vt=Rr.properties,Zt=zt(Rr.geometry.coordinates[0]),Ut=St(Rr.geometry.coordinates[1])}var ln={type:1,geometry:[[Math.round(this.options.extent*(Zt*hr-Ve)),Math.round(this.options.extent*(Ut*hr-It))]],tags:vt},pn=void 0;bt?pn=me.id:this.options.generateId?pn=me.index:this.points[me.index].id&&(pn=this.points[me.index].id),pn!==void 0&&(ln.id=pn),Jt.features.push(ln)}},xe.prototype._limitZoom=function(Je){return Math.max(this.options.minZoom,Math.min(+Je,this.options.maxZoom+1))},xe.prototype._cluster=function(Je,Pt){for(var Ve=[],It=this.options,hr=It.radius,Jt=It.extent,Fr=It.reduce,fe=It.minPoints,Fe=hr/(Jt*Math.pow(2,Pt)),me=0;me<Je.length;me++){var bt=Je[me];if(!(bt.zoom<=Pt)){bt.zoom=Pt;for(var vt=this.trees[Pt+1],Zt=vt.within(bt.x,bt.y,Fe),Ut=bt.numPoints||1,Rr=Ut,ln=0,pn=Zt;ln<pn.length;ln+=1){var Vi=pn[ln],ar=vt.points[Vi];ar.zoom>Pt&&(Rr+=ar.numPoints||1)}if(Rr>=fe){for(var pe=bt.x*Ut,Pe=bt.y*Ut,Ge=Fr&&Ut>1?this._map(bt,!0):null,ke=(me<<5)+(Pt+1)+this.points.length,Ft=0,ir=Zt;Ft<ir.length;Ft+=1){var T=ir[Ft],G=vt.points[T];if(!(G.zoom<=Pt)){G.zoom=Pt;var Se=G.numPoints||1;pe+=G.x*Se,Pe+=G.y*Se,G.parentId=ke,Fr&&(Ge||(Ge=this._map(bt,!0)),Fr(Ge,this._map(G)))}}bt.parentId=ke,Ve.push(Re(pe/Rr,Pe/Rr,ke,Rr,Ge))}else if(Ve.push(bt),Rr>1)for(var Be=0,et=Zt;Be<et.length;Be+=1){var tt=et[Be],Ct=vt.points[tt];Ct.zoom<=Pt||(Ct.zoom=Pt,Ve.push(Ct))}}}return Ve},xe.prototype._getOriginId=function(Je){return Je-this.points.length>>5},xe.prototype._getOriginZoom=function(Je){return(Je-this.points.length)%32},xe.prototype._map=function(Je,Pt){if(Je.numPoints)return Pt?ur({},Je.properties):Je.properties;var Ve=this.points[Je.index].properties,It=this.options.map(Ve);return Pt&&It===Ve?ur({},It):It};function Re(At,Je,Pt,Ve,It){return{x:_e(At),y:_e(Je),zoom:Infinity,id:Pt,parentId:-1,numPoints:Ve,properties:It}}function $e(At,Je){var Pt=At.geometry.coordinates,Ve=Pt[0],It=Pt[1];return{x:_e(zt(Ve)),y:_e(St(It)),zoom:Infinity,index:Je,parentId:-1}}function Rt(At){return{type:"Feature",id:At.id,properties:Lt(At),geometry:{type:"Point",coordinates:[Et(At.x),at(At.y)]}}}function Lt(At){var Je=At.numPoints,Pt=Je>=1e4?Math.round(Je/1e3)+"k":Je>=1e3?Math.round(Je/100)/10+"k":Je;return ur(ur({},At.properties),{cluster:!0,cluster_id:At.id,point_count:Je,point_count_abbreviated:Pt})}function zt(At){return At/360+.5}function St(At){var Je=Math.sin(At*Math.PI/180),Pt=.5-.25*Math.log((1+Je)/(1-Je))/Math.PI;return Pt<0?0:Pt>1?1:Pt}function Et(At){return(At-.5)*360}function at(At){var Je=(180-At*360)*Math.PI/180;return 360*Math.atan(Math.exp(Je))/Math.PI-90}function ur(At,Je){for(var Pt in Je)At[Pt]=Je[Pt];return At}function ee(At){return At.x}function fr(At){return At.y}return xe})},75752:function(Qe){Qe.exports.RADIUS=6378137,Qe.exports.FLATTENING=1/298.257223563,Qe.exports.POLAR_RADIUS=63567523142e-4}}]);
